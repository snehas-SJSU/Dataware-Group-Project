[0m22:06:57.390978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497e7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f07d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f07c50>]}


============================== 22:06:57.393600 | f7e363d8-21e4-4e29-a11a-f378ae49ba54 ==============================
[0m22:06:57.393600 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:06:57.393892 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'debug': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'empty': 'False', 'log_path': 'logs', 'version_check': 'True', 'static_parser': 'True', 'write_json': 'True', 'target_path': 'None', 'printer_width': '80', 'introspect': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'quiet': 'False'}
[0m22:06:57.394209 [error] [MainThread]: Encountered an error:
Runtime Error
  No dbt_project.yml found at expected path /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
  Verify that each entry within packages.yml (and their transitive dependencies) contains a file named dbt_project.yml
  
[0m22:06:57.395794 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.01891071, "process_in_blocks": "0", "process_kernel_time": 0.136564, "process_mem_max_rss": "114573312", "process_out_blocks": "0", "process_user_time": 0.564068}
[0m22:06:57.395995 [debug] [MainThread]: Command `dbt run` failed at 22:06:57.395949 after 0.02 seconds
[0m22:06:57.396131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d01810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f48050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cae580>]}
[0m22:06:57.396266 [debug] [MainThread]: Flushing usage events
[0m22:06:57.774121 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:30:31.110150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10878e7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a123b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1239d0>]}


============================== 22:30:31.112504 | e31aa181-a4d5-4bed-8075-e306e072a311 ==============================
[0m22:30:31.112504 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:30:31.112739 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt', 'invocation_command': 'dbt compile', 'version_check': 'True', 'use_colors': 'True', 'quiet': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'introspect': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'empty': 'False', 'printer_width': '80', 'target_path': 'None', 'write_json': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False'}
[0m22:30:31.114970 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m22:30:31.116045 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": false, "command_wall_clock_time": 0.033001166, "process_in_blocks": "0", "process_kernel_time": 0.098034, "process_mem_max_rss": "114294784", "process_out_blocks": "0", "process_user_time": 0.507925}
[0m22:30:31.116212 [debug] [MainThread]: Command `dbt compile` failed at 22:30:31.116174 after 0.03 seconds
[0m22:30:31.116326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1b03e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1529f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fae9c0>]}
[0m22:30:31.116436 [debug] [MainThread]: Flushing usage events
[0m22:30:31.523965 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:34:20.499399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10581a7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9bb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9b9d0>]}


============================== 22:34:20.501747 | 035930e6-020f-40a0-a98e-bbfa03644809 ==============================
[0m22:34:20.501747 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:34:20.502011 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'debug': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'use_colors': 'True', 'profiles_dir': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt', 'no_print': 'None', 'empty': 'None', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'cache_selected_only': 'False', 'fail_fast': 'False', 'quiet': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'version_check': 'True', 'write_json': 'True', 'introspect': 'True'}
[0m22:34:20.510427 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:34:20.510644 [info ] [MainThread]: python version: 3.13.5
[0m22:34:20.510747 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:34:20.510843 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:34:20.514169 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.snowflake'
[0m22:34:20.514402 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt
[0m22:34:20.514511 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/profiles.yml
[0m22:34:20.514601 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:34:20.549696 [info ] [MainThread]: Configuration:
[0m22:34:20.549924 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:34:20.550043 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:34:20.550138 [info ] [MainThread]: Required dependencies:
[0m22:34:20.550292 [debug] [MainThread]: Executing "git --help"
[0m22:34:20.572660 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:34:20.573046 [debug] [MainThread]: STDERR: "b''"
[0m22:34:20.573174 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:34:20.573293 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:34:20.573391 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:34:20.573478 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "btc_elt", target "dev" invalid: Runtime Error
    Could not find adapter type snowflake!


[0m22:34:20.574773 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.10223671, "process_in_blocks": "0", "process_kernel_time": 0.10807, "process_mem_max_rss": "117653504", "process_out_blocks": "0", "process_user_time": 0.540593}
[0m22:34:20.574943 [debug] [MainThread]: Command `dbt debug` failed at 22:34:20.574906 after 0.10 seconds
[0m22:34:20.575113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fa28b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e039b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b2b130>]}
[0m22:34:20.575265 [debug] [MainThread]: Flushing usage events
[0m22:34:20.956625 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:35:41.373764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037be7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c3fb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c3f9d0>]}


============================== 22:35:41.376230 | be378b60-a72a-4cff-bfca-5548f0ff61cb ==============================
[0m22:35:41.376230 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:35:41.376471 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'introspect': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'invocation_command': 'dbt debug', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'fail_fast': 'False', 'target_path': 'None', 'static_parser': 'True', 'no_print': 'None', 'log_format': 'default', 'version_check': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'debug': 'False'}
[0m22:35:41.384527 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:35:41.384721 [info ] [MainThread]: python version: 3.13.5
[0m22:35:41.384828 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:35:41.384920 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:35:41.388324 [info ] [MainThread]: Error importing adapter: No module named 'dbt.adapters.snowflake'
[0m22:35:41.388575 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:35:41.388682 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:35:41.388773 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:35:41.425903 [info ] [MainThread]: Configuration:
[0m22:35:41.426344 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:35:41.426513 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:35:41.426618 [info ] [MainThread]: Required dependencies:
[0m22:35:41.426797 [debug] [MainThread]: Executing "git --help"
[0m22:35:41.447723 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:35:41.448150 [debug] [MainThread]: STDERR: "b''"
[0m22:35:41.448278 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:35:41.448407 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:35:41.448512 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:35:41.448604 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "btc_elt", target "dev" invalid: Runtime Error
    Could not find adapter type snowflake!


[0m22:35:41.450044 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.10382275, "process_in_blocks": "0", "process_kernel_time": 0.106828, "process_mem_max_rss": "117506048", "process_out_blocks": "0", "process_user_time": 0.535448}
[0m22:35:41.450241 [debug] [MainThread]: Command `dbt debug` failed at 22:35:41.450200 after 0.10 seconds
[0m22:35:41.450434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f468b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104da79b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104acf130>]}
[0m22:35:41.450595 [debug] [MainThread]: Flushing usage events
[0m22:35:41.876724 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:38:19.506792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107caa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1192279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119227c50>]}


============================== 22:38:19.509395 | cbcbb43e-404c-4e83-bfd2-e6632507c03f ==============================
[0m22:38:19.509395 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:38:19.509677 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'static_parser': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error': 'None', 'introspect': 'True', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'printer_width': '80', 'write_json': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m22:38:19.517568 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:38:19.517727 [info ] [MainThread]: python version: 3.13.5
[0m22:38:19.517830 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:38:19.517924 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:38:20.468569 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:38:20.468830 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:38:20.468959 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:38:20.502579 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:38:20.502855 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:38:20.503008 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:38:20.503331 [info ] [MainThread]: adapter type: snowflake
[0m22:38:20.503468 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m22:38:20.541984 [info ] [MainThread]: Configuration:
[0m22:38:20.542219 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:38:20.542387 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:38:20.542544 [info ] [MainThread]: Required dependencies:
[0m22:38:20.542723 [debug] [MainThread]: Executing "git --help"
[0m22:38:20.563866 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:38:20.564279 [debug] [MainThread]: STDERR: "b''"
[0m22:38:20.564416 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:38:20.564542 [info ] [MainThread]: Connection:
[0m22:38:20.564666 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m22:38:20.564760 [info ] [MainThread]:   user: RACCOON
[0m22:38:20.564844 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m22:38:20.564930 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m22:38:20.565009 [info ] [MainThread]:   role: TRAINING_ROLE
[0m22:38:20.565091 [info ] [MainThread]:   schema: analytics
[0m22:38:20.565170 [info ] [MainThread]:   authenticator: None
[0m22:38:20.565247 [info ] [MainThread]:   oauth_client_id: None
[0m22:38:20.565326 [info ] [MainThread]:   query_tag: None
[0m22:38:20.565406 [info ] [MainThread]:   client_session_keep_alive: False
[0m22:38:20.565486 [info ] [MainThread]:   host: None
[0m22:38:20.565563 [info ] [MainThread]:   port: None
[0m22:38:20.565639 [info ] [MainThread]:   proxy_host: None
[0m22:38:20.565718 [info ] [MainThread]:   proxy_port: None
[0m22:38:20.565791 [info ] [MainThread]:   protocol: None
[0m22:38:20.565869 [info ] [MainThread]:   connect_retries: 1
[0m22:38:20.565945 [info ] [MainThread]:   connect_timeout: None
[0m22:38:20.566020 [info ] [MainThread]:   retry_on_database_errors: False
[0m22:38:20.566098 [info ] [MainThread]:   retry_all: False
[0m22:38:20.566173 [info ] [MainThread]:   insecure_mode: False
[0m22:38:20.566247 [info ] [MainThread]:   reuse_connections: True
[0m22:38:20.566326 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m22:38:20.566407 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m22:38:20.566680 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:38:20.610104 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m22:38:20.655304 [debug] [MainThread]: Using snowflake connection "debug"
[0m22:38:20.655478 [debug] [MainThread]: On debug: select 1 as id
[0m22:38:20.655582 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:38:21.277148 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m22:38:21.277742 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m22:38:21.278218 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m22:38:21.278565 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:38:21.278821 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001 (08001): Failed to connect to DB: SFEDU02-LVB17920.snowflakecomputing.com:443. Incorrect username or password was specified.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m22:38:21.286178 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 1.8078579, "process_in_blocks": "0", "process_kernel_time": 0.910785, "process_mem_max_rss": "223526912", "process_out_blocks": "0", "process_user_time": 2.649875}
[0m22:38:21.286725 [debug] [MainThread]: Command `dbt debug` failed at 22:38:21.286614 after 1.81 seconds
[0m22:38:21.287073 [debug] [MainThread]: Connection 'debug' was left open.
[0m22:38:21.287308 [debug] [MainThread]: On debug: No close available on handle
[0m22:38:21.287596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14acd3ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14af69c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab4b680>]}
[0m22:38:21.287944 [debug] [MainThread]: Flushing usage events
[0m22:38:21.692043 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:39:33.791136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dbe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107827c50>]}


============================== 22:39:33.793600 | dd92a66d-27df-4675-ad13-6491fbbd0030 ==============================
[0m22:39:33.793600 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:39:33.793833 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'empty': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'no_print': 'None', 'use_colors': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'partial_parse': 'True', 'version_check': 'True', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'invocation_command': 'dbt debug'}
[0m22:39:33.801852 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:39:33.802035 [info ] [MainThread]: python version: 3.13.5
[0m22:39:33.802144 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:39:33.802237 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:39:34.355046 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:39:34.355319 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:39:34.355443 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:39:34.383585 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:39:34.383825 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:39:34.384104 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:39:34.384459 [info ] [MainThread]: adapter type: snowflake
[0m22:39:34.384603 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m22:39:34.424757 [info ] [MainThread]: Configuration:
[0m22:39:34.424979 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:39:34.425178 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:39:34.425299 [info ] [MainThread]: Required dependencies:
[0m22:39:34.425457 [debug] [MainThread]: Executing "git --help"
[0m22:39:34.448730 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:39:34.449201 [debug] [MainThread]: STDERR: "b''"
[0m22:39:34.449358 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:39:34.449491 [info ] [MainThread]: Connection:
[0m22:39:34.449617 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m22:39:34.449715 [info ] [MainThread]:   user: YOUR_SNOWFLAKE_USERNAME
[0m22:39:34.449804 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m22:39:34.449893 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m22:39:34.450048 [info ] [MainThread]:   role: TRAINING_ROLE
[0m22:39:34.450198 [info ] [MainThread]:   schema: analytics
[0m22:39:34.450300 [info ] [MainThread]:   authenticator: None
[0m22:39:34.450387 [info ] [MainThread]:   oauth_client_id: None
[0m22:39:34.450474 [info ] [MainThread]:   query_tag: None
[0m22:39:34.450558 [info ] [MainThread]:   client_session_keep_alive: False
[0m22:39:34.450647 [info ] [MainThread]:   host: None
[0m22:39:34.450728 [info ] [MainThread]:   port: None
[0m22:39:34.450809 [info ] [MainThread]:   proxy_host: None
[0m22:39:34.450891 [info ] [MainThread]:   proxy_port: None
[0m22:39:34.450990 [info ] [MainThread]:   protocol: None
[0m22:39:34.451092 [info ] [MainThread]:   connect_retries: 1
[0m22:39:34.451178 [info ] [MainThread]:   connect_timeout: None
[0m22:39:34.451259 [info ] [MainThread]:   retry_on_database_errors: False
[0m22:39:34.451343 [info ] [MainThread]:   retry_all: False
[0m22:39:34.451422 [info ] [MainThread]:   insecure_mode: False
[0m22:39:34.451501 [info ] [MainThread]:   reuse_connections: True
[0m22:39:34.451582 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m22:39:34.451664 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m22:39:34.451920 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:39:34.499106 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m22:39:34.550431 [debug] [MainThread]: Using snowflake connection "debug"
[0m22:39:34.550662 [debug] [MainThread]: On debug: select 1 as id
[0m22:39:34.550797 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:39:34.803793 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m22:39:34.804138 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m22:39:34.804438 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m22:39:34.804709 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:39:34.804934 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001 (08001): Failed to connect to DB: SFEDU02-LVB17920.snowflakecomputing.com:443. Incorrect username or password was specified.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m22:39:34.810031 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 1.0461591, "process_in_blocks": "0", "process_kernel_time": 1.234617, "process_mem_max_rss": "220823552", "process_out_blocks": "0", "process_user_time": 2.255936}
[0m22:39:34.810444 [debug] [MainThread]: Command `dbt debug` failed at 22:39:34.810352 after 1.05 seconds
[0m22:39:34.810739 [debug] [MainThread]: Connection 'debug' was left open.
[0m22:39:34.811028 [debug] [MainThread]: On debug: No close available on handle
[0m22:39:34.811288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d3d3ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d521c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d24b680>]}
[0m22:39:34.811593 [debug] [MainThread]: Flushing usage events
[0m22:39:35.247126 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:41:29.408051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052da900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a27c50>]}


============================== 22:41:29.410883 | addfd518-5712-462a-b0a2-f486d52f4919 ==============================
[0m22:41:29.410883 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:41:29.411134 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'invocation_command': 'dbt debug', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'static_parser': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'use_experimental_parser': 'False', 'no_print': 'None', 'partial_parse': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_cache_events': 'False', 'target_path': 'None', 'empty': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m22:41:29.421782 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m22:41:29.422065 [info ] [MainThread]: python version: 3.13.5
[0m22:41:29.422281 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m22:41:29.422497 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m22:41:30.078448 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:41:30.078679 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:41:30.078793 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:41:30.102180 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m22:41:30.102391 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m22:41:30.102501 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m22:41:30.102871 [info ] [MainThread]: adapter type: snowflake
[0m22:41:30.103015 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m22:41:30.137354 [info ] [MainThread]: Configuration:
[0m22:41:30.137577 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:41:30.137698 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:41:30.137828 [info ] [MainThread]: Required dependencies:
[0m22:41:30.138000 [debug] [MainThread]: Executing "git --help"
[0m22:41:30.167334 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:41:30.167945 [debug] [MainThread]: STDERR: "b''"
[0m22:41:30.168121 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:41:30.168261 [info ] [MainThread]: Connection:
[0m22:41:30.168391 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m22:41:30.168501 [info ] [MainThread]:   user: PEACOCK
[0m22:41:30.168589 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m22:41:30.168675 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m22:41:30.168753 [info ] [MainThread]:   role: TRAINING_ROLE
[0m22:41:30.168835 [info ] [MainThread]:   schema: analytics
[0m22:41:30.168912 [info ] [MainThread]:   authenticator: None
[0m22:41:30.168994 [info ] [MainThread]:   oauth_client_id: None
[0m22:41:30.169072 [info ] [MainThread]:   query_tag: None
[0m22:41:30.169164 [info ] [MainThread]:   client_session_keep_alive: False
[0m22:41:30.169249 [info ] [MainThread]:   host: None
[0m22:41:30.169325 [info ] [MainThread]:   port: None
[0m22:41:30.169403 [info ] [MainThread]:   proxy_host: None
[0m22:41:30.169481 [info ] [MainThread]:   proxy_port: None
[0m22:41:30.169557 [info ] [MainThread]:   protocol: None
[0m22:41:30.169638 [info ] [MainThread]:   connect_retries: 1
[0m22:41:30.169714 [info ] [MainThread]:   connect_timeout: None
[0m22:41:30.169793 [info ] [MainThread]:   retry_on_database_errors: False
[0m22:41:30.169871 [info ] [MainThread]:   retry_all: False
[0m22:41:30.169947 [info ] [MainThread]:   insecure_mode: False
[0m22:41:30.170026 [info ] [MainThread]:   reuse_connections: True
[0m22:41:30.170104 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m22:41:30.170186 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m22:41:30.170506 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:41:30.235622 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m22:41:30.290078 [debug] [MainThread]: Using snowflake connection "debug"
[0m22:41:30.290296 [debug] [MainThread]: On debug: select 1 as id
[0m22:41:30.290413 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:41:30.727976 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.437 seconds
[0m22:41:30.729631 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m22:41:30.730044 [info ] [MainThread]: [32mAll checks passed![0m
[0m22:41:30.736601 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.3680593, "process_in_blocks": "0", "process_kernel_time": 1.765843, "process_mem_max_rss": "208486400", "process_out_blocks": "0", "process_user_time": 1.467025}
[0m22:41:30.737155 [debug] [MainThread]: Command `dbt debug` succeeded at 22:41:30.737042 after 1.37 seconds
[0m22:41:30.737496 [debug] [MainThread]: Connection 'debug' was left open.
[0m22:41:30.737799 [debug] [MainThread]: On debug: Close
[0m22:41:30.886715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1641fbe10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x164502450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163fe78a0>]}
[0m22:41:30.887354 [debug] [MainThread]: Flushing usage events
[0m22:41:31.296746 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:41:42.543860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ec6900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105327c50>]}


============================== 22:41:42.546108 | 0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc ==============================
[0m22:41:42.546108 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:41:42.546349 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'empty': 'False', 'static_parser': 'True', 'write_json': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'target_path': 'None', 'partial_parse': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'introspect': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt compile', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_colors': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m22:41:43.040963 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:41:43.041181 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:41:43.041289 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:41:43.182729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046b9f30>]}
[0m22:41:43.202096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc7ff00>]}
[0m22:41:43.202575 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:41:43.247729 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m22:41:43.248098 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:41:43.248246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd35350>]}
[0m22:41:43.640599 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.btc_elt.output
[0m22:41:43.643604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd4f020>]}
[0m22:41:43.667016 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:41:43.668166 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:41:43.676138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b409fd0>]}
[0m22:41:43.676318 [info ] [MainThread]: Found 2 models, 3 sources, 516 macros
[0m22:41:43.676439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a22a1a0>]}
[0m22:41:43.677310 [info ] [MainThread]: 
[0m22:41:43.677435 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:41:43.677529 [info ] [MainThread]: 
[0m22:41:43.677709 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:41:43.677836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ddeb3f4-b2f4-43b3-9cfb-3292854a64fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3396d0>]}
[0m22:41:43.679246 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m22:41:43.679397 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.btc_elt.stg_btc_market'
[0m22:41:43.679498 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m22:41:43.682129 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m22:41:43.682725 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m22:41:43.682918 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m22:41:43.683095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m22:41:43.683218 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m22:41:43.684709 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m22:41:43.685127 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m22:41:43.685570 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:41:43.685703 [debug] [MainThread]: Connection 'model.btc_elt.stg_btc_ohlc' was properly closed.
[0m22:41:43.685888 [debug] [MainThread]: Command end result
[0m22:41:43.693569 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:41:43.694197 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:41:43.695276 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:41:43.697697 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.1824161, "process_in_blocks": "0", "process_kernel_time": 2.00493, "process_mem_max_rss": "223051776", "process_out_blocks": "0", "process_user_time": 1.784642}
[0m22:41:43.697850 [debug] [MainThread]: Command `dbt compile` succeeded at 22:41:43.697812 after 1.18 seconds
[0m22:41:43.697991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b31ef10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b49ce10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b49e990>]}
[0m22:41:43.698107 [debug] [MainThread]: Flushing usage events
[0m22:41:44.063714 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:24:39.470811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b3a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f9f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f9fc50>]}


============================== 23:24:39.473278 | d637efcb-4e8a-45ba-bd6a-a19aa49ee29f ==============================
[0m23:24:39.473278 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:24:39.473546 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'use_colors': 'True', 'target_path': 'None', 'no_print': 'None', 'write_json': 'True', 'log_format': 'default', 'version_check': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'empty': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'cache_selected_only': 'False', 'warn_error': 'None', 'static_parser': 'True'}
[0m23:24:40.003859 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:24:40.004064 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:24:40.004173 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:24:40.120255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10832df30>]}
[0m23:24:40.138852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe7ff00>]}
[0m23:24:40.139310 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:24:40.191420 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:24:40.262789 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:24:40.263039 [debug] [MainThread]: Partial parsing: added file: btc_elt://models/output/fct_btc_indicators.sql
[0m23:24:40.356439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e92cd50>]}
[0m23:24:40.380824 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:24:40.382055 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:24:40.393410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ff4d310>]}
[0m23:24:40.393633 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:24:40.393802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ee91470>]}
[0m23:24:40.394576 [info ] [MainThread]: 
[0m23:24:40.394721 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:24:40.394827 [info ] [MainThread]: 
[0m23:24:40.395017 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:24:40.395358 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:24:40.449061 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:24:40.449252 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:24:40.449352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:24:41.031734 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.582 seconds
[0m23:24:41.035519 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:24:41.049392 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:24:41.049843 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:24:41.185894 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.136 seconds
[0m23:24:41.189108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f4c120>]}
[0m23:24:41.193881 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:24:41.195002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:24:41.195356 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:24:41.202165 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:24:41.203591 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:24:41.203931 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:24:41.204277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:24:41.204589 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:24:41.206680 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:24:41.207607 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:24:41.208152 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:24:41.208524 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:24:41.208805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:24:41.208994 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:24:41.226251 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:24:41.226942 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:24:41.241858 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:24:41.243580 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:24:41.243840 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.
-- Columns are named in plain English for your report & dashboard.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:24:41.350388 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0833c-0307-153c-000f-c0df0084e7f2
[0m23:24:41.350860 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 22 at position 143 unexpected ';'.
[0m23:24:41.354909 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:24:41.356207 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd637efcb-4e8a-45ba-bd6a-a19aa49ee29f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150b72c90>]}
[0m23:24:41.356753 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.15s]
[0m23:24:41.357187 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:24:41.357616 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:24:41.358897 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:24:41.359093 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:24:41.359282 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:24:41.479755 [info ] [MainThread]: 
[0m23:24:41.480395 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.08 seconds (1.08s).
[0m23:24:41.481262 [debug] [MainThread]: Command end result
[0m23:24:41.505405 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:24:41.507138 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:24:41.511854 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:24:41.512083 [info ] [MainThread]: 
[0m23:24:41.512339 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:24:41.512524 [info ] [MainThread]: 
[0m23:24:41.512759 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:24:41.512963 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 22 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:24:41.513107 [info ] [MainThread]: 
[0m23:24:41.513282 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:24:41.513421 [info ] [MainThread]: 
[0m23:24:41.513596 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:24:41.518308 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.0745935, "process_in_blocks": "0", "process_kernel_time": 1.48311, "process_mem_max_rss": "230457344", "process_out_blocks": "0", "process_user_time": 2.354057}
[0m23:24:41.518614 [debug] [MainThread]: Command `dbt run` failed at 23:24:41.518559 after 2.08 seconds
[0m23:24:41.518949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150e7b280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f4b7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150f4bcf0>]}
[0m23:24:41.519222 [debug] [MainThread]: Flushing usage events
[0m23:24:41.911071 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:26:38.762735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b3a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11232f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11232fc50>]}


============================== 23:26:38.765151 | 2d4d66ff-6779-43fc-8879-581543c3e5ed ==============================
[0m23:26:38.765151 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:26:38.765423 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'debug': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'log_format': 'default', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'version_check': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'indirect_selection': 'eager', 'partial_parse': 'True', 'use_colors': 'True', 'no_print': 'None', 'target_path': 'None', 'quiet': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:26:39.299161 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:26:39.299381 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:26:39.299486 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:26:39.413780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113bdf30>]}
[0m23:26:39.433409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e27ff00>]}
[0m23:26:39.433880 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:26:39.480214 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:26:39.535373 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:26:39.535606 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/output/fct_btc_indicators.sql
[0m23:26:39.624910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14eb48d50>]}
[0m23:26:39.648401 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:26:39.649335 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:26:39.658687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e34d310>]}
[0m23:26:39.658856 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:26:39.658982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ed991d0>]}
[0m23:26:39.659619 [info ] [MainThread]: 
[0m23:26:39.659751 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:26:39.659849 [info ] [MainThread]: 
[0m23:26:39.660018 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:26:39.660323 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:26:39.710975 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:26:39.711150 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:26:39.711249 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:26:40.272971 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.562 seconds
[0m23:26:40.276531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:26:40.288328 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:26:40.288738 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:26:40.469317 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.180 seconds
[0m23:26:40.473472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fd40120>]}
[0m23:26:40.476427 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:26:40.477534 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:26:40.477889 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:26:40.484691 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:26:40.485648 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:26:40.485824 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:26:40.486017 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:26:40.486172 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:26:40.487141 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:26:40.487468 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:26:40.487755 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:26:40.488017 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:26:40.488216 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:26:40.488338 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:26:40.502799 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:26:40.503433 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:26:40.516130 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:26:40.517771 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:26:40.517924 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:26:40.625796 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0833e-0307-153f-000f-c0df00849656
[0m23:26:40.626195 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 143 unexpected ';'.
[0m23:26:40.631359 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:26:40.632875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2d4d66ff-6779-43fc-8879-581543c3e5ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa6ec90>]}
[0m23:26:40.633383 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.14s]
[0m23:26:40.633801 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:26:40.634215 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:26:40.635519 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:26:40.635785 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:26:40.635990 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:26:40.756375 [info ] [MainThread]: 
[0m23:26:40.757015 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.10 seconds (1.10s).
[0m23:26:40.757739 [debug] [MainThread]: Command end result
[0m23:26:40.779894 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:26:40.781345 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:26:40.785553 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:26:40.785777 [info ] [MainThread]: 
[0m23:26:40.786027 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:26:40.786217 [info ] [MainThread]: 
[0m23:26:40.786453 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:26:40.786656 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:26:40.786803 [info ] [MainThread]: 
[0m23:26:40.786977 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:26:40.787118 [info ] [MainThread]: 
[0m23:26:40.787288 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:26:40.792493 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.055735, "process_in_blocks": "0", "process_kernel_time": 1.316128, "process_mem_max_rss": "230309888", "process_out_blocks": "0", "process_user_time": 2.458278}
[0m23:26:40.793383 [debug] [MainThread]: Command `dbt run` failed at 23:26:40.793299 after 2.06 seconds
[0m23:26:40.793669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc76fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fd3efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fd3edf0>]}
[0m23:26:40.793902 [debug] [MainThread]: Flushing usage events
[0m23:26:41.204224 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:28:34.445407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cee900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632fc50>]}


============================== 23:28:34.447862 | e844ccca-faaf-4fe0-8f77-a0e57bc3fd23 ==============================
[0m23:28:34.447862 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:28:34.448122 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'write_json': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'target_path': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'empty': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'version_check': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'warn_error': 'None'}
[0m23:28:35.027058 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:28:35.027264 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:28:35.027413 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:28:35.142866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b1f30>]}
[0m23:28:35.161450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b07ff00>]}
[0m23:28:35.161910 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:28:35.206923 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:28:35.262046 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:28:35.262288 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/input/stg_btc_ohlc.sql
[0m23:28:35.353692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ba48b50>]}
[0m23:28:35.375982 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:28:35.377117 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:28:35.386541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b14d310>]}
[0m23:28:35.386724 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:28:35.386852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bbd5a90>]}
[0m23:28:35.387479 [info ] [MainThread]: 
[0m23:28:35.387611 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:28:35.387705 [info ] [MainThread]: 
[0m23:28:35.387881 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:28:35.388199 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:28:35.438391 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:28:35.438570 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:28:35.438666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:28:36.017001 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.578 seconds
[0m23:28:36.021985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:28:36.031439 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:28:36.031740 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:28:36.156301 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.124 seconds
[0m23:28:36.160911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cb7f860>]}
[0m23:28:36.165427 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:28:36.165987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:28:36.166360 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:28:36.173668 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:28:36.174901 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:28:36.175233 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:28:36.175572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:28:36.175833 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:28:36.178175 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:28:36.178889 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:28:36.179393 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:28:36.179738 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:28:36.180491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:28:36.180743 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:28:36.202226 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:28:36.202948 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:28:36.217027 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:28:36.218786 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:28:36.218956 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:28:36.352261 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08340-0307-1540-000f-c0df0084774e
[0m23:28:36.352782 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 143 unexpected ';'.
[0m23:28:36.358346 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:28:36.359893 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e844ccca-faaf-4fe0-8f77-a0e57bc3fd23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c872ed0>]}
[0m23:28:36.360421 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.18s]
[0m23:28:36.360904 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:28:36.361419 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:28:36.362742 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:28:36.362947 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:28:36.363130 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:28:36.547200 [info ] [MainThread]: 
[0m23:28:36.548007 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m23:28:36.548945 [debug] [MainThread]: Command end result
[0m23:28:36.576806 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:28:36.578349 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:28:36.582516 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:28:36.582693 [info ] [MainThread]: 
[0m23:28:36.582906 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:28:36.583067 [info ] [MainThread]: 
[0m23:28:36.583266 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:28:36.583441 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:28:36.583579 [info ] [MainThread]: 
[0m23:28:36.583737 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:28:36.583874 [info ] [MainThread]: 
[0m23:28:36.584033 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:28:36.588395 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.1703696, "process_in_blocks": "0", "process_kernel_time": 0.786676, "process_mem_max_rss": "233816064", "process_out_blocks": "0", "process_user_time": 2.904135}
[0m23:28:36.588671 [debug] [MainThread]: Command `dbt run` failed at 23:28:36.588616 after 2.17 seconds
[0m23:28:36.588918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cb731d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc0d810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc0c050>]}
[0m23:28:36.589145 [debug] [MainThread]: Flushing usage events
[0m23:28:36.995115 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:29:05.438881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10786a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba179d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba17c50>]}


============================== 23:29:05.441906 | d0fc5d6f-56eb-48ac-ae5b-c5b49b1b1642 ==============================
[0m23:29:05.441906 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:29:05.442188 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'indirect_selection': 'eager', 'partial_parse': 'True', 'no_print': 'None', 'write_json': 'True', 'warn_error': 'None', 'printer_width': '80', 'empty': 'None', 'use_experimental_parser': 'False', 'use_colors': 'True', 'quiet': 'False', 'target_path': 'None', 'version_check': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'log_format': 'default', 'fail_fast': 'False', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:29:05.497999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd0fc5d6f-56eb-48ac-ae5b-c5b49b1b1642', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10805df30>]}
[0m23:29:05.507787 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.10025488, "process_in_blocks": "0", "process_kernel_time": 0.124872, "process_mem_max_rss": "116326400", "process_out_blocks": "0", "process_user_time": 0.568777}
[0m23:29:05.507988 [debug] [MainThread]: Command `dbt clean` succeeded at 23:29:05.507946 after 0.10 seconds
[0m23:29:05.508127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8b3130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8b2cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bce2450>]}
[0m23:29:05.508255 [debug] [MainThread]: Flushing usage events
[0m23:29:05.857241 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:29:21.374069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ebe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113937c50>]}


============================== 23:29:21.376394 | c93d3797-aaf5-4b39-8bd8-437e8abdd7b8 ==============================
[0m23:29:21.376394 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:29:21.376626 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'introspect': 'True', 'target_path': 'None', 'partial_parse': 'True', 'version_check': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'fail_fast': 'False', 'empty': 'False', 'log_format': 'default', 'debug': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt compile', 'printer_width': '80', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'static_parser': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:29:21.891430 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:29:21.891640 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:29:21.891747 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:29:21.962984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117bdf30>]}
[0m23:29:21.982706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e47ff00>]}
[0m23:29:21.983727 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:29:22.028438 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:29:22.028788 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:29:22.028935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e535350>]}
[0m23:29:22.427425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f8e8a0>]}
[0m23:29:22.450262 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:22.451872 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:22.459940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f48d550>]}
[0m23:29:22.460111 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:29:22.460231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1509624e0>]}
[0m23:29:22.460871 [info ] [MainThread]: 
[0m23:29:22.461000 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:29:22.461094 [info ] [MainThread]: 
[0m23:29:22.461261 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:29:22.461559 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:29:22.512133 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:29:22.512331 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:29:22.512438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:29:23.095740 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.583 seconds
[0m23:29:23.098861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c93d3797-aaf5-4b39-8bd8-437e8abdd7b8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f672ed0>]}
[0m23:29:23.102390 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:29:23.102879 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:29:23.103195 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:29:23.112975 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:29:23.114055 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:29:23.114301 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:29:23.114546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:29:23.114812 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:29:23.116686 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:29:23.117192 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:29:23.117592 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:29:23.117870 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:29:23.118091 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:29:23.136750 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:29:23.137243 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:29:23.137487 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:29:23.137880 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:29:23.138017 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:29:23.138139 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:29:23.281445 [debug] [MainThread]: Command end result
[0m23:29:23.304610 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:23.305996 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:23.310481 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:29:23.315170 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9681581, "process_in_blocks": "0", "process_kernel_time": 0.933403, "process_mem_max_rss": "235077632", "process_out_blocks": "0", "process_user_time": 3.118434}
[0m23:29:23.315429 [debug] [MainThread]: Command `dbt compile` succeeded at 23:29:23.315376 after 1.97 seconds
[0m23:29:23.315665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1560e5390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1509b7570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1509b6530>]}
[0m23:29:23.315867 [debug] [MainThread]: Flushing usage events
[0m23:29:23.691324 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:29:28.735444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063ba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792fc50>]}


============================== 23:29:28.737558 | afa245bd-71d0-47e6-b3ae-88959ceb378b ==============================
[0m23:29:28.737558 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:29:28.737791 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_format': 'default', 'use_colors': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/snehasingh/.dbt', 'static_parser': 'True', 'empty': 'False', 'fail_fast': 'False', 'introspect': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'version_check': 'True', 'quiet': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'debug': 'False', 'log_cache_events': 'False'}
[0m23:29:29.176269 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:29:29.176489 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:29:29.176597 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:29:29.246669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068bdf30>]}
[0m23:29:29.265499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15167ff00>]}
[0m23:29:29.266018 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:29:29.309617 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:29:29.362757 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:29:29.362919 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:29:29.373796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151837950>]}
[0m23:29:29.398611 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:29.399341 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:29.407613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15184d310>]}
[0m23:29:29.407778 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:29:29.407899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1518f3310>]}
[0m23:29:29.408530 [info ] [MainThread]: 
[0m23:29:29.408654 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:29:29.408749 [info ] [MainThread]: 
[0m23:29:29.408918 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:29:29.409241 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:29:29.431969 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:29:29.432153 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:29:29.432261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:29:29.966580 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.534 seconds
[0m23:29:29.969553 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:29:29.980279 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:29:29.980550 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:29:30.120181 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.139 seconds
[0m23:29:30.124333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154c806d0>]}
[0m23:29:30.128545 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:29:30.129065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:29:30.129411 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:29:30.136967 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:29:30.137912 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:29:30.138222 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:29:30.138637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:29:30.139018 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:29:30.141411 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:29:30.142037 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:29:30.142542 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:29:30.143001 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:29:30.143378 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:29:30.143606 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:29:30.167217 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:29:30.167716 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:29:30.181549 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:29:30.183328 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:29:30.183496 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Cleans the raw.market table for BTC daily market data

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:29:30.308699 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08341-0307-153c-000f-c0df0084e802
[0m23:29:30.309053 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 143 unexpected ';'.
[0m23:29:30.313844 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:29:30.315237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'afa245bd-71d0-47e6-b3ae-88959ceb378b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154bf1c10>]}
[0m23:29:30.315729 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.17s]
[0m23:29:30.316121 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:29:30.316428 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:29:30.317639 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:29:30.317844 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:29:30.318029 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:29:30.458967 [info ] [MainThread]: 
[0m23:29:30.459638 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.05 seconds (1.05s).
[0m23:29:30.460476 [debug] [MainThread]: Command end result
[0m23:29:30.483260 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:29:30.484687 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:29:30.489007 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:29:30.489213 [info ] [MainThread]: 
[0m23:29:30.489458 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:29:30.489640 [info ] [MainThread]: 
[0m23:29:30.489875 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:29:30.490177 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:29:30.490405 [info ] [MainThread]: 
[0m23:29:30.490626 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:29:30.490786 [info ] [MainThread]: 
[0m23:29:30.490985 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:29:30.495828 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.7846107, "process_in_blocks": "0", "process_kernel_time": 0.959001, "process_mem_max_rss": "231882752", "process_out_blocks": "0", "process_user_time": 2.793759}
[0m23:29:30.496174 [debug] [MainThread]: Command `dbt run` failed at 23:29:30.496103 after 1.79 seconds
[0m23:29:30.496491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154c066d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153c83b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153c83bb0>]}
[0m23:29:30.496740 [debug] [MainThread]: Flushing usage events
[0m23:29:30.866960 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:17.246305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046d2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b479d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b47c50>]}


============================== 23:34:17.248760 | 74ad5f41-9090-40e4-bd15-5233bad8e684 ==============================
[0m23:34:17.248760 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:34:17.248987 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'write_json': 'True', 'debug': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'invocation_command': 'dbt clean', 'indirect_selection': 'eager', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'quiet': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_colors': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'empty': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'version_check': 'True'}
[0m23:34:17.348988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74ad5f41-9090-40e4-bd15-5233bad8e684', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eddf30>]}
[0m23:34:17.359703 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.1405172, "process_in_blocks": "0", "process_kernel_time": 0.113138, "process_mem_max_rss": "115687424", "process_out_blocks": "0", "process_user_time": 0.518426}
[0m23:34:17.359899 [debug] [MainThread]: Command `dbt clean` succeeded at 23:34:17.359858 after 0.14 seconds
[0m23:34:17.360046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059d3130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059d2cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf6450>]}
[0m23:34:17.360182 [debug] [MainThread]: Flushing usage events
[0m23:34:17.801483 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:23.492967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10613b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10613bc50>]}


============================== 23:34:23.495611 | f860eaf5-f2a1-42ff-908e-2f588a28be03 ==============================
[0m23:34:23.495611 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:34:23.495870 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'printer_width': '80', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'write_json': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'empty': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_format': 'default', 'profiles_dir': '/Users/snehasingh/.dbt', 'partial_parse': 'True', 'invocation_command': 'dbt compile', 'warn_error': 'None', 'no_print': 'None', 'version_check': 'True', 'fail_fast': 'False'}
[0m23:34:24.047104 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:34:24.047313 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:34:24.047417 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:34:24.116260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051bdf30>]}
[0m23:34:24.134966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14397ff00>]}
[0m23:34:24.135481 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:34:24.179657 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:34:24.180002 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:34:24.180153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143b35350>]}
[0m23:34:24.565210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f8e8a0>]}
[0m23:34:24.588121 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:24.589143 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:24.597341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144115550>]}
[0m23:34:24.597517 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:34:24.597638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1443ea4e0>]}
[0m23:34:24.598301 [info ] [MainThread]: 
[0m23:34:24.598427 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:34:24.598526 [info ] [MainThread]: 
[0m23:34:24.598699 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:34:24.598997 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:34:24.650365 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:34:24.650538 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:34:24.650636 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:25.185554 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.535 seconds
[0m23:34:25.187884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f860eaf5-f2a1-42ff-908e-2f588a28be03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1441faed0>]}
[0m23:34:25.191292 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:34:25.191720 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:34:25.191991 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:34:25.202208 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:34:25.203535 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:34:25.203788 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:34:25.204113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:34:25.204374 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:34:25.206484 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:34:25.207016 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:34:25.207523 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:34:25.207789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:34:25.207999 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:34:25.226276 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:34:25.226849 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:34:25.227134 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:34:25.227533 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:25.227659 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:34:25.227775 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:34:25.377475 [debug] [MainThread]: Command end result
[0m23:34:25.397727 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:25.399072 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:25.403715 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:34:25.408055 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.9429365, "process_in_blocks": "0", "process_kernel_time": 1.516712, "process_mem_max_rss": "232767488", "process_out_blocks": "0", "process_user_time": 2.302742}
[0m23:34:25.408336 [debug] [MainThread]: Command `dbt compile` succeeded at 23:34:25.408275 after 1.94 seconds
[0m23:34:25.408573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145be1390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14443e530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14443e5d0>]}
[0m23:34:25.408769 [debug] [MainThread]: Flushing usage events
[0m23:34:25.771919 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:34:35.723683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037be900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c2b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c2bc50>]}


============================== 23:34:35.725832 | 1f078f10-a476-42ee-94c3-186acfb1f08f ==============================
[0m23:34:35.725832 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:34:35.726070 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'empty': 'False', 'log_cache_events': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'invocation_command': 'dbt run', 'use_colors': 'True', 'no_print': 'None', 'printer_width': '80', 'quiet': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'debug': 'False'}
[0m23:34:36.176499 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:34:36.176711 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:34:36.176819 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:34:36.245348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fb1f30>]}
[0m23:34:36.264027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149f7ff00>]}
[0m23:34:36.264523 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:34:36.310252 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:34:36.362117 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:34:36.362276 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:34:36.373156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a037950>]}
[0m23:34:36.398551 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:36.399517 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:36.408196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a04d310>]}
[0m23:34:36.408368 [info ] [MainThread]: Found 3 models, 3 sources, 516 macros
[0m23:34:36.408490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a0f34d0>]}
[0m23:34:36.409134 [info ] [MainThread]: 
[0m23:34:36.409263 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:34:36.409362 [info ] [MainThread]: 
[0m23:34:36.409544 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:34:36.409863 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:34:36.433539 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:34:36.433723 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:34:36.433827 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:36.939485 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.505 seconds
[0m23:34:36.943330 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:34:36.957462 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:34:36.957925 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:34:37.068344 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.110 seconds
[0m23:34:37.072275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b57c6d0>]}
[0m23:34:37.077692 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:34:37.078215 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:34:37.078552 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:34:37.086478 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:34:37.087583 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:34:37.087928 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:34:37.088307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:34:37.088615 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:34:37.091282 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:34:37.091900 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:34:37.092416 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:34:37.092907 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:34:37.093275 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:34:37.093517 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:34:37.117966 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:34:37.118644 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:34:37.132989 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:34:37.134927 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:34:37.135173 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (price, market cap, volume)
    SELECT * FROM __dbt__cte__stg_btc_market
), ohlc_data AS (
    -- Staging: BTC daily candlestick inputs (open, high, low, close)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
), joined_data AS (
    -- Join trend + candles on date → one row per date with all fields
    SELECT
        m.date              AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open              AS open_price,
        o.high              AS high_price,
        o.low               AS low_price,
        o.close             AS close_price
    FROM market_data m
    LEFT JOIN ohlc_data o
      ON m.date = o.date
), moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
), rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
), gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
), rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
), momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
), final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:34:39.032725 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.897 seconds
[0m23:34:39.047089 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1f078f10-a476-42ee-94c3-186acfb1f08f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4ee2d0>]}
[0m23:34:39.047432 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.95s]
[0m23:34:39.047698 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:34:39.048340 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:39.048525 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:34:39.048668 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:34:39.181355 [info ] [MainThread]: 
[0m23:34:39.182019 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.77 seconds (2.77s).
[0m23:34:39.182807 [debug] [MainThread]: Command end result
[0m23:34:39.203206 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:34:39.204380 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:34:39.207121 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:34:39.207312 [info ] [MainThread]: 
[0m23:34:39.207514 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:34:39.207661 [info ] [MainThread]: 
[0m23:34:39.207824 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:34:39.211556 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.5121827, "process_in_blocks": "0", "process_kernel_time": 0.962504, "process_mem_max_rss": "231702528", "process_out_blocks": "0", "process_user_time": 2.779631}
[0m23:34:39.211805 [debug] [MainThread]: Command `dbt run` succeeded at 23:34:39.211751 after 3.51 seconds
[0m23:34:39.212008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b502a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a5bbcf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a5bbd90>]}
[0m23:34:39.212196 [debug] [MainThread]: Flushing usage events
[0m23:34:39.577968 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:38:24.161429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072aa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108737c50>]}


============================== 23:38:24.163832 | d165260b-062a-451b-bf38-2578b43c4844 ==============================
[0m23:38:24.163832 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:38:24.164075 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt test', 'use_experimental_parser': 'False', 'warn_error': 'None', 'printer_width': '80', 'write_json': 'True', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'no_print': 'None', 'debug': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'log_format': 'default', 'profiles_dir': '/Users/snehasingh/.dbt', 'introspect': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'empty': 'None', 'partial_parse': 'True'}
[0m23:38:24.725440 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:38:24.725666 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:38:24.725781 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:38:24.838005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077bdf30>]}
[0m23:38:24.856604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f97ff00>]}
[0m23:38:24.857052 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:38:24.907343 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:38:24.965650 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:38:24.965897 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/schema.yml
[0m23:38:25.055876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c840d50>]}
[0m23:38:25.084759 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:38:25.085738 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:38:25.101876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc08aa0>]}
[0m23:38:25.102063 [info ] [MainThread]: Found 3 models, 3 data tests, 3 sources, 516 macros
[0m23:38:25.102194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cb1e350>]}
[0m23:38:25.102869 [info ] [MainThread]: 
[0m23:38:25.102999 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:38:25.103098 [info ] [MainThread]: 
[0m23:38:25.103273 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:38:25.103617 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:38:25.154962 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:38:25.155153 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:38:25.155261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:38:25.810435 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.655 seconds
[0m23:38:25.815548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd165260b-062a-451b-bf38-2578b43c4844', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d199090>]}
[0m23:38:25.818918 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:25.819287 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m23:38:25.819665 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m23:38:25.819935 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:25.832112 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:38:25.832818 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:25.843998 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:38:25.844859 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:38:25.845062 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m23:38:26.090350 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.245 seconds
[0m23:38:26.102111 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.28s]
[0m23:38:26.102762 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:38:26.103136 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.103536 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m23:38:26.103940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m23:38:26.104237 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.108262 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:38:26.109168 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.111482 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:38:26.112372 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:38:26.112672 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m23:38:26.466955 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.354 seconds
[0m23:38:26.470669 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.37s]
[0m23:38:26.471429 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:38:26.471873 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.472370 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m23:38:26.472903 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m23:38:26.473291 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.481628 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:38:26.482770 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.485130 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:38:26.486162 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:38:26.486445 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m23:38:26.709828 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.223 seconds
[0m23:38:26.713847 [error] [Thread-1 (]: 3 of 3 FAIL 1 unique_fct_btc_indicators_date ................................... [[31mFAIL 1[0m in 0.24s]
[0m23:38:26.714450 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:38:26.715504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:38:26.715773 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m23:38:26.715998 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m23:38:26.872126 [info ] [MainThread]: 
[0m23:38:26.872842 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 1.77 seconds (1.77s).
[0m23:38:26.873840 [debug] [MainThread]: Command end result
[0m23:38:26.897122 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:38:26.898121 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:38:26.902212 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:38:26.902419 [info ] [MainThread]: 
[0m23:38:26.902619 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:38:26.902771 [info ] [MainThread]: 
[0m23:38:26.902951 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_date (models/schema.yml)[0m
[0m23:38:26.903114 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m23:38:26.903233 [info ] [MainThread]: 
[0m23:38:26.903385 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/schema.yml/unique_fct_btc_indicators_date.sql
[0m23:38:26.903511 [info ] [MainThread]: 
[0m23:38:26.903657 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m23:38:26.907159 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 2.7729714, "process_in_blocks": "0", "process_kernel_time": 1.410598, "process_mem_max_rss": "234389504", "process_out_blocks": "0", "process_user_time": 2.410128}
[0m23:38:26.907386 [debug] [MainThread]: Command `dbt test` failed at 23:38:26.907333 after 2.77 seconds
[0m23:38:26.907578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086f0950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d4936a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d4933e0>]}
[0m23:38:26.907818 [debug] [MainThread]: Flushing usage events
[0m23:38:27.292090 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:39.895662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d9e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092039d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109203c50>]}


============================== 23:46:39.898186 | 8a31aa3c-15c9-40ba-ba35-01cb047d40f5 ==============================
[0m23:46:39.898186 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:46:39.898443 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'empty': 'None', 'indirect_selection': 'eager', 'partial_parse': 'True', 'introspect': 'True', 'printer_width': '80', 'quiet': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'invocation_command': 'dbt clean', 'use_experimental_parser': 'False', 'debug': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'version_check': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'static_parser': 'True', 'warn_error': 'None', 'no_print': 'None', 'log_format': 'default', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False'}
[0m23:46:39.997990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8a31aa3c-15c9-40ba-ba35-01cb047d40f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108591f30>]}
[0m23:46:40.007998 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.14048725, "process_in_blocks": "0", "process_kernel_time": 0.117092, "process_mem_max_rss": "115654656", "process_out_blocks": "0", "process_user_time": 0.523906}
[0m23:46:40.008158 [debug] [MainThread]: Command `dbt clean` succeeded at 23:46:40.008117 after 0.14 seconds
[0m23:46:40.008283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109087130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109086cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093ae450>]}
[0m23:46:40.008403 [debug] [MainThread]: Flushing usage events
[0m23:46:40.416970 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:46.225361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104442900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058bf9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058bfc50>]}


============================== 23:46:46.227611 | 4a1dddbf-734a-4e0e-ab38-d4cc50350021 ==============================
[0m23:46:46.227611 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:46:46.227853 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt compile', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'version_check': 'True', 'log_format': 'default', 'quiet': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'printer_width': '80', 'no_print': 'None', 'debug': 'False', 'introspect': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'indirect_selection': 'eager', 'use_experimental_parser': 'False'}
[0m23:46:46.828398 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:46:46.828602 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:46:46.828706 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:46:46.899965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4a1dddbf-734a-4e0e-ab38-d4cc50350021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c4df30>]}
[0m23:46:46.919759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4a1dddbf-734a-4e0e-ab38-d4cc50350021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124de7f00>]}
[0m23:46:46.920181 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:46:46.965012 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:46:46.965368 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:46:46.965518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4a1dddbf-734a-4e0e-ab38-d4cc50350021', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124e9d350>]}
[0m23:46:47.351735 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  invalid syntax for function call expression
    line 3
      config(
[0m23:46:47.354296 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": false, "command_wall_clock_time": 1.1543303, "process_in_blocks": "0", "process_kernel_time": 1.348889, "process_mem_max_rss": "221167616", "process_out_blocks": "0", "process_user_time": 2.348112}
[0m23:46:47.354478 [debug] [MainThread]: Command `dbt compile` failed at 23:46:47.354436 after 1.15 seconds
[0m23:46:47.354629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124eb45f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12540e300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058abe70>]}
[0m23:46:47.354747 [debug] [MainThread]: Flushing usage events
[0m23:46:47.726206 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:52.751453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c56900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c39d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090c3c50>]}


============================== 23:46:52.753612 | 7bbf5fc2-2c43-462b-9373-e884e3ae7aca ==============================
[0m23:46:52.753612 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:46:52.753855 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'use_colors': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'empty': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'log_format': 'default', 'version_check': 'True', 'fail_fast': 'False', 'warn_error': 'None'}
[0m23:46:53.210459 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:46:53.210688 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:46:53.210809 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:46:53.279974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7bbf5fc2-2c43-462b-9373-e884e3ae7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108449f30>]}
[0m23:46:53.299532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7bbf5fc2-2c43-462b-9373-e884e3ae7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146c7ff00>]}
[0m23:46:53.300047 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:46:53.344064 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:46:53.344439 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:46:53.344601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7bbf5fc2-2c43-462b-9373-e884e3ae7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146d35350>]}
[0m23:46:53.728406 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  invalid syntax for function call expression
    line 3
      config(
[0m23:46:53.730961 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.0038918, "process_in_blocks": "0", "process_kernel_time": 1.061105, "process_mem_max_rss": "223002624", "process_out_blocks": "0", "process_user_time": 2.735523}
[0m23:46:53.731143 [debug] [MainThread]: Command `dbt run` failed at 23:46:53.731100 after 1.00 seconds
[0m23:46:53.731287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146d4c5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147212300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090a3e70>]}
[0m23:46:53.731404 [debug] [MainThread]: Flushing usage events
[0m23:46:54.148081 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:50:48.574486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d8a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071eb9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071ebc50>]}


============================== 23:50:48.576931 | 337e2aa6-422b-4019-a19b-cd4fc431cf5a ==============================
[0m23:50:48.576931 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:50:48.577175 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'introspect': 'True', 'partial_parse': 'True', 'no_print': 'None', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'version_check': 'True', 'invocation_command': 'dbt snapshot', 'empty': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'quiet': 'False'}
[0m23:50:49.162977 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:50:49.163224 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:50:49.163339 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:50:49.280333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '337e2aa6-422b-4019-a19b-cd4fc431cf5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10657df30>]}
[0m23:50:49.299942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '337e2aa6-422b-4019-a19b-cd4fc431cf5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13307ff00>]}
[0m23:50:49.300392 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:50:49.347782 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:50:49.348152 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:50:49.348300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '337e2aa6-422b-4019-a19b-cd4fc431cf5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133135350>]}
[0m23:50:49.749400 [error] [MainThread]: Encountered an error:
Compilation Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  invalid syntax for function call expression
    line 3
      config(
[0m23:50:49.752725 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": false, "command_wall_clock_time": 1.2064234, "process_in_blocks": "0", "process_kernel_time": 1.779903, "process_mem_max_rss": "220102656", "process_out_blocks": "0", "process_user_time": 1.866237}
[0m23:50:49.752946 [debug] [MainThread]: Command `dbt snapshot` failed at 23:50:49.752897 after 1.21 seconds
[0m23:50:49.753115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13314c5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1337ce300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071dbd90>]}
[0m23:50:49.753239 [debug] [MainThread]: Flushing usage events
[0m23:50:50.238047 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:53:14.102679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103afe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f5b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f5bc50>]}


============================== 23:53:14.105114 | 0650e2bd-3c23-46d6-87fe-e350889f138b ==============================
[0m23:53:14.105114 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:53:14.105394 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt clean', 'introspect': 'True', 'partial_parse': 'True', 'printer_width': '80', 'static_parser': 'True', 'target_path': 'None', 'log_cache_events': 'False', 'debug': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'empty': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m23:53:14.204887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0650e2bd-3c23-46d6-87fe-e350889f138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042f1f30>]}
[0m23:53:14.213886 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.1382515, "process_in_blocks": "0", "process_kernel_time": 0.121303, "process_mem_max_rss": "115851264", "process_out_blocks": "0", "process_user_time": 0.535413}
[0m23:53:14.214167 [debug] [MainThread]: Command `dbt clean` succeeded at 23:53:14.214102 after 0.14 seconds
[0m23:53:14.214452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104de7130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104de6cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050fa450>]}
[0m23:53:14.214603 [debug] [MainThread]: Flushing usage events
[0m23:53:14.604679 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:53:30.994753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108aa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c2b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c2bc50>]}


============================== 23:53:30.996936 | 1937b573-09d0-4976-bf35-e8e1ba50d392 ==============================
[0m23:53:30.996936 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:53:30.997172 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'no_print': 'None', 'log_format': 'default', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'write_json': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'printer_width': '80', 'profiles_dir': '/Users/snehasingh/.dbt', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt snapshot', 'indirect_selection': 'eager', 'target_path': 'None', 'version_check': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'debug': 'False', 'static_parser': 'True'}
[0m23:53:31.510143 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:53:31.510352 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:53:31.510464 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:53:31.579676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cbdf30>]}
[0m23:53:31.598829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e27ff00>]}
[0m23:53:31.599339 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:53:31.646450 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:53:31.646842 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:53:31.646997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e335350>]}
[0m23:53:32.173316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e88a210>]}
[0m23:53:32.206710 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:53:32.207777 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:53:32.217633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ee3dfd0>]}
[0m23:53:32.217839 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:53:32.217969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150087e10>]}
[0m23:53:32.218666 [info ] [MainThread]: 
[0m23:53:32.218797 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:53:32.218895 [info ] [MainThread]: 
[0m23:53:32.219075 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:53:32.220528 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:53:32.269647 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:53:32.269829 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:53:32.269931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:32.708103 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.438 seconds
[0m23:53:32.712542 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:53:32.726936 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:53:32.727365 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:53:32.882493 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.155 seconds
[0m23:53:32.885614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m23:53:32.889027 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:53:32.889466 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:53:33.037733 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.148 seconds
[0m23:53:33.042088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1501e7f50>]}
[0m23:53:33.046305 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m23:53:33.046973 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m23:53:33.047438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m23:53:33.047756 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m23:53:33.058773 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m23:53:33.100194 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:53:33.100443 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:53:33.942067 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.841 seconds
[0m23:53:33.947481 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:53:33.947987 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:53:34.045247 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.097 seconds
[0m23:53:34.046742 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m23:53:34.049358 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:53:34.049899 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_market
    
    
    
    as (
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

    ) sbq



    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */;
[0m23:53:35.169979 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.119 seconds
[0m23:53:35.194929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155a305d0>]}
[0m23:53:35.195772 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 2.15s]
[0m23:53:35.196206 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m23:53:35.196484 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:35.196845 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m23:53:35.197145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m23:53:35.197367 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:35.200386 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:35.203329 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.203624 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:53:35.462727 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.258 seconds
[0m23:53:35.465442 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.465955 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:53:35.557398 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.091 seconds
[0m23:53:35.558989 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.562176 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:53:35.562616 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_ohlc
    
    
    
    as (
    

    select *,
        md5(coalesce(cast(coin_id as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
from (
        


SELECT
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

    ) sbq



    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */;
[0m23:53:36.444139 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.881 seconds
[0m23:53:36.447143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1937b573-09d0-4976-bf35-e8e1ba50d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155aa1270>]}
[0m23:53:36.448008 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.25s]
[0m23:53:36.448573 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m23:53:36.449742 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:36.450062 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was left open.
[0m23:53:36.450308 [debug] [MainThread]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m23:53:36.593833 [info ] [MainThread]: 
[0m23:53:36.594436 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.37 seconds (4.37s).
[0m23:53:36.595350 [debug] [MainThread]: Command end result
[0m23:53:36.619431 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:53:36.620984 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:53:36.624946 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:53:36.625158 [info ] [MainThread]: 
[0m23:53:36.625418 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:53:36.625585 [info ] [MainThread]: 
[0m23:53:36.625779 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:53:36.630479 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 5.66549, "process_in_blocks": "0", "process_kernel_time": 1.348495, "process_mem_max_rss": "240959488", "process_out_blocks": "0", "process_user_time": 2.948727}
[0m23:53:36.630796 [debug] [MainThread]: Command `dbt snapshot` succeeded at 23:53:36.630731 after 5.67 seconds
[0m23:53:36.631050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150058f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c5e9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c43d90>]}
[0m23:53:36.631270 [debug] [MainThread]: Flushing usage events
[0m23:53:36.996452 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:54:16.288965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c52900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050af9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050afc50>]}


============================== 23:54:16.291966 | 76cd56db-842d-4e5f-a692-edcb785050fa ==============================
[0m23:54:16.291966 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:54:16.292258 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'use_colors': 'True', 'invocation_command': 'dbt test', 'debug': 'False', 'log_cache_events': 'False', 'empty': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'profiles_dir': '/Users/snehasingh/.dbt', 'version_check': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'fail_fast': 'False'}
[0m23:54:16.894991 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:54:16.895229 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:54:16.895346 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:54:17.012913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104441f30>]}
[0m23:54:17.048376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12557ff00>]}
[0m23:54:17.048965 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:54:17.101759 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:54:17.174691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:54:17.174881 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:54:17.196392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e36150>]}
[0m23:54:17.231312 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:54:17.232681 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:54:17.249718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1320423f0>]}
[0m23:54:17.250000 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:54:17.250153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1320ae0b0>]}
[0m23:54:17.250979 [info ] [MainThread]: 
[0m23:54:17.251134 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:54:17.251234 [info ] [MainThread]: 
[0m23:54:17.251444 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:54:17.253177 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m23:54:17.306631 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:54:17.306841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:54:17.306956 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:54:17.899484 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.592 seconds
[0m23:54:17.901969 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m23:54:17.904705 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:54:17.905055 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:54:18.012738 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.107 seconds
[0m23:54:18.017593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76cd56db-842d-4e5f-a692-edcb785050fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13250db20>]}
[0m23:54:18.024130 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.024614 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m23:54:18.025075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m23:54:18.025403 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.038505 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:54:18.039430 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.052641 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:54:18.053415 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:54:18.053617 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m23:54:18.199327 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.145 seconds
[0m23:54:18.209572 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.18s]
[0m23:54:18.210261 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:54:18.210591 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.211007 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m23:54:18.211502 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m23:54:18.211821 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.215205 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:54:18.216023 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.218367 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:54:18.219252 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:54:18.219520 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m23:54:18.792097 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.572 seconds
[0m23:54:18.795169 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.58s]
[0m23:54:18.795822 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:54:18.796180 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.796580 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m23:54:18.797031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m23:54:18.797364 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.803395 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:54:18.804181 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.806740 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:54:18.807848 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:54:18.808170 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m23:54:18.939384 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.131 seconds
[0m23:54:18.942584 [error] [Thread-1 (]: 3 of 3 FAIL 1 unique_fct_btc_indicators_date ................................... [[31mFAIL 1[0m in 0.15s]
[0m23:54:18.943247 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:54:18.944437 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:54:18.944770 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m23:54:18.945050 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m23:54:19.076267 [info ] [MainThread]: 
[0m23:54:19.076786 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 1.82 seconds (1.82s).
[0m23:54:19.077800 [debug] [MainThread]: Command end result
[0m23:54:19.096372 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:54:19.097162 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:54:19.099663 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:54:19.099787 [info ] [MainThread]: 
[0m23:54:19.099925 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:54:19.100036 [info ] [MainThread]: 
[0m23:54:19.100166 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_date (models/schema.yml)[0m
[0m23:54:19.100283 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m23:54:19.100370 [info ] [MainThread]: 
[0m23:54:19.100475 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/schema.yml/unique_fct_btc_indicators_date.sql
[0m23:54:19.100570 [info ] [MainThread]: 
[0m23:54:19.100711 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m23:54:19.103499 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 2.844331, "process_in_blocks": "0", "process_kernel_time": 2.042544, "process_mem_max_rss": "227950592", "process_out_blocks": "0", "process_user_time": 1.569935}
[0m23:54:19.103671 [debug] [MainThread]: Command `dbt test` failed at 23:54:19.103638 after 2.84 seconds
[0m23:54:19.103810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105074950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132723540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132723800>]}
[0m23:54:19.103933 [debug] [MainThread]: Flushing usage events
[0m23:54:19.460701 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:57:46.188421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111abe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134279d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113427c50>]}


============================== 23:57:46.190824 | d3c8c781-d817-4ae2-9aff-6b796d56927a ==============================
[0m23:57:46.190824 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:57:46.191091 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'printer_width': '80', 'write_json': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'empty': 'None', 'invocation_command': 'dbt clean', 'cache_selected_only': 'False', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'no_print': 'None', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'version_check': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:57:46.297303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3c8c781-d817-4ae2-9aff-6b796d56927a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124bdf30>]}
[0m23:57:46.307745 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.14667341, "process_in_blocks": "0", "process_kernel_time": 0.112888, "process_mem_max_rss": "115703808", "process_out_blocks": "0", "process_user_time": 0.526976}
[0m23:57:46.307906 [debug] [MainThread]: Command `dbt clean` succeeded at 23:57:46.307870 after 0.15 seconds
[0m23:57:46.308043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132b3130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132b2cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1136de450>]}
[0m23:57:46.308164 [debug] [MainThread]: Flushing usage events
[0m23:57:46.976142 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:58:04.358366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10470a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b7bc50>]}


============================== 23:58:04.360693 | ac5f7ecf-abc8-4dff-8457-4b222ab20c01 ==============================
[0m23:58:04.360693 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:58:04.360941 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'use_colors': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None', 'no_print': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'introspect': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt compile'}
[0m23:58:04.955535 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:58:04.955777 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:58:04.955902 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:58:05.040999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104efdf30>]}
[0m23:58:05.061581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14087ff00>]}
[0m23:58:05.063075 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:58:05.112122 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:58:05.112546 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:58:05.112726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140a35350>]}
[0m23:58:05.644545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142abe210>]}
[0m23:58:05.680691 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:05.681922 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:05.691020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b8eeb0>]}
[0m23:58:05.691235 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:58:05.691360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14430f380>]}
[0m23:58:05.692184 [info ] [MainThread]: 
[0m23:58:05.692368 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:58:05.692480 [info ] [MainThread]: 
[0m23:58:05.692672 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:58:05.694266 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m23:58:05.746445 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:58:05.746636 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:58:05.746741 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:58:06.261537 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.515 seconds
[0m23:58:06.264132 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m23:58:06.267333 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:58:06.267777 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:58:06.416165 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.148 seconds
[0m23:58:06.420090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac5f7ecf-abc8-4dff-8457-4b222ab20c01', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1442d9fd0>]}
[0m23:58:06.423887 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:58:06.425635 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m23:58:06.426133 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:58:06.434437 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:58:06.435961 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:58:06.436344 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:58:06.436810 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:58:06.437207 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:58:06.439843 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:58:06.440599 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:58:06.440907 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m23:58:06.441225 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now snapshot.btc_elt.snap_btc_market)
[0m23:58:06.441510 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m23:58:06.447067 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m23:58:06.447494 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m23:58:06.447721 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.447972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m23:58:06.448173 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.449939 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.450372 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m23:58:06.450626 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:58:06.450875 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:58:06.451095 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:58:06.461491 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:58:06.461922 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:58:06.462212 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:58:06.462575 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.462761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.fct_btc_indicators, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m23:58:06.462911 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.468541 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:58:06.468891 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.469135 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:58:06.469283 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.469441 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m23:58:06.469574 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.471084 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:58:06.471323 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.471563 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:58:06.471712 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.471862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m23:58:06.471996 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.474252 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:58:06.474490 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.474706 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:58:06.475168 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:58:06.475295 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m23:58:06.475409 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m23:58:06.610720 [debug] [MainThread]: Command end result
[0m23:58:06.632754 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:06.634100 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:06.638432 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:58:06.642605 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.3102677, "process_in_blocks": "0", "process_kernel_time": 1.893109, "process_mem_max_rss": "238239744", "process_out_blocks": "0", "process_user_time": 2.147471}
[0m23:58:06.642879 [debug] [MainThread]: Command `dbt compile` succeeded at 23:58:06.642817 after 2.31 seconds
[0m23:58:06.643114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144b4c100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144af3bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144af2c10>]}
[0m23:58:06.643315 [debug] [MainThread]: Flushing usage events
[0m23:58:07.020175 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:58:30.039716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049be900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12072f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12072fc50>]}


============================== 23:58:30.042549 | e9a08186-764c-4fd6-a269-4182344caa2b ==============================
[0m23:58:30.042549 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:58:30.042904 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'write_json': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'introspect': 'True', 'static_parser': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'version_check': 'True', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'target_path': 'None', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m23:58:30.648791 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:58:30.649032 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:58:30.649140 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:58:30.723903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052bdf30>]}
[0m23:58:30.743989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b17ff00>]}
[0m23:58:30.744392 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:58:30.788953 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:58:30.853125 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:58:30.853318 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:58:30.874643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b235450>]}
[0m23:58:30.907347 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:30.908310 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:30.917158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b24d310>]}
[0m23:58:30.917344 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:58:30.917467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b293150>]}
[0m23:58:30.918164 [info ] [MainThread]: 
[0m23:58:30.918294 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:58:30.918391 [info ] [MainThread]: 
[0m23:58:30.918574 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:58:30.918888 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:58:30.942255 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:58:30.942412 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:58:30.942503 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:58:31.451811 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.509 seconds
[0m23:58:31.458043 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m23:58:31.468578 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:58:31.468776 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:58:31.603501 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.132 seconds
[0m23:58:31.606933 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m23:58:31.610364 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:58:31.610754 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:58:31.731411 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.120 seconds
[0m23:58:31.735510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c539570>]}
[0m23:58:31.738960 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:58:31.739528 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:58:31.739906 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:58:31.749003 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:58:31.750216 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:58:31.750571 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:58:31.750982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:58:31.751340 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:58:31.754193 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:58:31.755299 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:58:31.756068 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:58:31.756589 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:58:31.756932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:58:31.757169 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:58:31.769499 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:58:31.770197 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:58:31.786780 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:58:31.788187 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:58:31.788413 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql (top section with de-dup for BOTH sides)

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → exactly one row per date
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    LEFT JOIN ohlc_daily o
      ON m.date = o.date
)
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:58:31.909685 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0835e-0307-15a3-000f-c0df0084281a
[0m23:58:31.910135 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 105 at position 4 unexpected ')'.
[0m23:58:31.915434 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 105 at position 4 unexpected ')'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:58:31.916963 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9a08186-764c-4fd6-a269-4182344caa2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c54ee10>]}
[0m23:58:31.917465 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.16s]
[0m23:58:31.917847 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:58:31.918172 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 105 at position 4 unexpected ')'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m23:58:31.919484 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:58:31.919744 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:58:31.919947 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:58:32.074743 [info ] [MainThread]: 
[0m23:58:32.075300 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m23:58:32.076042 [debug] [MainThread]: Command end result
[0m23:58:32.099378 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:32.100496 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:32.103637 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:58:32.103812 [info ] [MainThread]: 
[0m23:58:32.104006 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:58:32.104156 [info ] [MainThread]: 
[0m23:58:32.104330 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m23:58:32.104519 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 105 at position 4 unexpected ')'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m23:58:32.104689 [info ] [MainThread]: 
[0m23:58:32.104888 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m23:58:32.105011 [info ] [MainThread]: 
[0m23:58:32.105158 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:58:32.108340 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.1018443, "process_in_blocks": "0", "process_kernel_time": 1.614929, "process_mem_max_rss": "227885056", "process_out_blocks": "0", "process_user_time": 1.867314}
[0m23:58:32.108567 [debug] [MainThread]: Command `dbt run` failed at 23:58:32.108510 after 2.10 seconds
[0m23:58:32.108796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c8ed700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c91fed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c91e170>]}
[0m23:58:32.108989 [debug] [MainThread]: Flushing usage events
[0m23:58:32.479217 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:14:56.784303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f12900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10936f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10936fc50>]}


============================== 00:14:56.786743 | 72c52a52-e838-4d54-9a46-2535bfedab52 ==============================
[0m00:14:56.786743 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:14:56.786999 [debug] [MainThread]: running dbt with arguments {'empty': 'None', 'indirect_selection': 'eager', 'invocation_command': 'dbt clean', 'use_experimental_parser': 'False', 'log_format': 'default', 'target_path': 'None', 'debug': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'version_check': 'True', 'introspect': 'True', 'warn_error': 'None'}
[0m00:14:56.886662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72c52a52-e838-4d54-9a46-2535bfedab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108705f30>]}
[0m00:14:56.896614 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.1396353, "process_in_blocks": "0", "process_kernel_time": 0.110314, "process_mem_max_rss": "115752960", "process_out_blocks": "0", "process_user_time": 0.520723}
[0m00:14:56.896758 [debug] [MainThread]: Command `dbt clean` succeeded at 00:14:56.896725 after 0.14 seconds
[0m00:14:56.896880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091fb130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091facf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109522450>]}
[0m00:14:56.896985 [debug] [MainThread]: Flushing usage events
[0m00:14:57.292247 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:15:10.260305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107eba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11192f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11192fc50>]}


============================== 00:15:10.262491 | 5c00358c-ab1a-40f9-b828-10589faecc49 ==============================
[0m00:15:10.262491 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:15:10.262727 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/snehasingh/.dbt', 'no_print': 'None', 'invocation_command': 'dbt compile', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'target_path': 'None', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'debug': 'False', 'empty': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'static_parser': 'True'}
[0m00:15:10.789556 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:15:10.789770 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:15:10.789877 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:15:10.860039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108bdf30>]}
[0m00:15:10.879442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a67ff00>]}
[0m00:15:10.879838 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:15:10.924644 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:15:10.925002 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:15:10.925145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a735350>]}
[0m00:15:11.435517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14adce210>]}
[0m00:15:11.469477 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:11.470585 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:11.479109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ae8eeb0>]}
[0m00:15:11.479310 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m00:15:11.479436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b507380>]}
[0m00:15:11.480168 [info ] [MainThread]: 
[0m00:15:11.480299 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:15:11.480393 [info ] [MainThread]: 
[0m00:15:11.480572 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:15:11.482069 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m00:15:11.533380 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:15:11.533562 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:15:11.533662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:12.242499 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.709 seconds
[0m00:15:12.245667 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m00:15:12.249478 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:15:12.249903 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:15:12.528401 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.278 seconds
[0m00:15:12.531919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c00358c-ab1a-40f9-b828-10589faecc49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4b9fd0>]}
[0m00:15:12.536502 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m00:15:12.537949 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m00:15:12.538367 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m00:15:12.546176 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m00:15:12.547601 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m00:15:12.547919 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m00:15:12.548340 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m00:15:12.548747 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m00:15:12.551365 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m00:15:12.552106 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m00:15:12.552421 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m00:15:12.552748 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now snapshot.btc_elt.snap_btc_market)
[0m00:15:12.553021 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m00:15:12.558428 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m00:15:12.558842 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m00:15:12.559051 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.559264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m00:15:12.559450 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.561281 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.561623 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m00:15:12.561823 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m00:15:12.562026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m00:15:12.562208 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m00:15:12.585885 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m00:15:12.586354 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m00:15:12.586613 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m00:15:12.586933 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.587086 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.fct_btc_indicators, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:15:12.587257 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.591949 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:12.592273 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.592516 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:12.592657 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.592806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m00:15:12.592934 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.594319 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:12.594562 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.594770 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:12.594895 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.595024 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m00:15:12.595140 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.597333 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:12.597556 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.597765 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:12.598160 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:12.598275 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m00:15:12.598381 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m00:15:12.790398 [debug] [MainThread]: Command end result
[0m00:15:12.810601 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:12.811987 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:12.816226 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:15:12.820490 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.5846174, "process_in_blocks": "0", "process_kernel_time": 1.145698, "process_mem_max_rss": "239173632", "process_out_blocks": "0", "process_user_time": 3.065501}
[0m00:15:12.820782 [debug] [MainThread]: Command `dbt compile` succeeded at 00:15:12.820721 after 2.58 seconds
[0m00:15:12.821014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bb58260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baf2490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baf2350>]}
[0m00:15:12.821218 [debug] [MainThread]: Flushing usage events
[0m00:15:13.182547 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:15:30.864521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100ba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11152f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11152fc50>]}


============================== 00:15:30.866699 | 759980d6-dbd3-42ec-8225-85c24559ece6 ==============================
[0m00:15:30.866699 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:15:30.866940 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'write_json': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'invocation_command': 'dbt run', 'empty': 'False', 'debug': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_colors': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'version_check': 'True', 'target_path': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_format': 'default', 'static_parser': 'True', 'log_cache_events': 'False', 'no_print': 'None'}
[0m00:15:31.327567 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:15:31.327783 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:15:31.327890 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:15:31.399841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104bdf30>]}
[0m00:15:31.419749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13727ff00>]}
[0m00:15:31.420149 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:15:31.465727 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:15:31.531739 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:15:31.531932 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:15:31.552066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137335450>]}
[0m00:15:31.586536 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:31.587418 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:31.596102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13734d310>]}
[0m00:15:31.596273 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m00:15:31.596403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137393150>]}
[0m00:15:31.597083 [info ] [MainThread]: 
[0m00:15:31.597214 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:15:31.597313 [info ] [MainThread]: 
[0m00:15:31.597492 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:15:31.597804 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m00:15:31.621271 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m00:15:31.621453 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m00:15:31.621550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:32.162350 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.541 seconds
[0m00:15:32.170400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m00:15:32.183324 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:15:32.183698 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:15:32.395106 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.207 seconds
[0m00:15:32.397249 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m00:15:32.400143 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:15:32.400495 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:15:32.563761 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.163 seconds
[0m00:15:32.567156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144939570>]}
[0m00:15:32.571628 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m00:15:32.572233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m00:15:32.572606 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m00:15:32.584138 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m00:15:32.585373 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m00:15:32.585701 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m00:15:32.586017 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m00:15:32.586411 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m00:15:32.589320 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m00:15:32.590099 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m00:15:32.590700 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m00:15:32.591200 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m00:15:32.591539 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m00:15:32.591757 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m00:15:32.619353 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m00:15:32.620208 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m00:15:32.634153 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m00:15:32.636176 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m00:15:32.636483 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → exactly one row per date
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    LEFT JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m00:15:34.968180 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.331 seconds
[0m00:15:34.993980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '759980d6-dbd3-42ec-8225-85c24559ece6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14494f1d0>]}
[0m00:15:34.994606 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.40s]
[0m00:15:34.995016 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m00:15:34.996160 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:34.996449 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m00:15:34.996679 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m00:15:35.107243 [info ] [MainThread]: 
[0m00:15:35.107959 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.51 seconds (3.51s).
[0m00:15:35.108735 [debug] [MainThread]: Command end result
[0m00:15:35.128942 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:35.130161 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:35.133478 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:15:35.133657 [info ] [MainThread]: 
[0m00:15:35.133863 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:15:35.134010 [info ] [MainThread]: 
[0m00:15:35.134180 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:15:35.137759 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.300075, "process_in_blocks": "0", "process_kernel_time": 1.134432, "process_mem_max_rss": "232587264", "process_out_blocks": "0", "process_user_time": 2.705874}
[0m00:15:35.138004 [debug] [MainThread]: Command `dbt run` succeeded at 00:15:35.137955 after 4.30 seconds
[0m00:15:35.138198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144bed180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137526df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1170165d0>]}
[0m00:15:35.138380 [debug] [MainThread]: Flushing usage events
[0m00:15:35.498077 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:15:54.214541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e26900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092879d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109287c50>]}


============================== 00:15:54.216679 | 1f3f0664-87cf-43a1-ad5b-ceaccd015f14 ==============================
[0m00:15:54.216679 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:15:54.216912 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error': 'None', 'version_check': 'True', 'target_path': 'None', 'fail_fast': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'printer_width': '80', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'debug': 'False'}
[0m00:15:54.680302 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:15:54.680510 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:15:54.680616 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:15:54.756653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108619f30>]}
[0m00:15:54.776109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ce7ff00>]}
[0m00:15:54.776659 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:15:54.823428 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:15:54.889124 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:15:54.889334 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:15:54.911225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d036150>]}
[0m00:15:54.949326 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:54.950332 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:54.963235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13da423f0>]}
[0m00:15:54.963439 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m00:15:54.963572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13daae0b0>]}
[0m00:15:54.964268 [info ] [MainThread]: 
[0m00:15:54.964399 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:15:54.964494 [info ] [MainThread]: 
[0m00:15:54.964673 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:15:54.966211 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m00:15:54.993602 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:15:54.993788 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:15:54.993900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:55.591515 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.597 seconds
[0m00:15:55.595103 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m00:15:55.598755 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:15:55.599169 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:15:55.752672 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.153 seconds
[0m00:15:55.756271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1f3f0664-87cf-43a1-ad5b-ceaccd015f14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e80db20>]}
[0m00:15:55.759266 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:55.759693 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m00:15:55.760102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:15:55.760412 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:55.773503 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:55.774288 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:55.787659 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:55.788434 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:15:55.788658 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m00:15:56.121259 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.332 seconds
[0m00:15:56.132996 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.37s]
[0m00:15:56.133739 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:15:56.134126 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.134604 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m00:15:56.135163 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m00:15:56.135502 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.138913 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:56.139686 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.142121 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:56.142947 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:15:56.143203 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m00:15:56.667121 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.523 seconds
[0m00:15:56.670140 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.53s]
[0m00:15:56.670845 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:15:56.671258 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.671718 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m00:15:56.672228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m00:15:56.672593 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.679458 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:56.680340 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.682928 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:56.683743 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:15:56.683878 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m00:15:56.970656 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.286 seconds
[0m00:15:56.974013 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.30s]
[0m00:15:56.974700 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:15:56.976425 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:56.976823 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m00:15:56.977122 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m00:15:57.123971 [info ] [MainThread]: 
[0m00:15:57.124974 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 2.16 seconds (2.16s).
[0m00:15:57.126251 [debug] [MainThread]: Command end result
[0m00:15:57.149754 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:15:57.151469 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:15:57.156404 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:15:57.156625 [info ] [MainThread]: 
[0m00:15:57.156874 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:15:57.157048 [info ] [MainThread]: 
[0m00:15:57.157237 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m00:15:57.162129 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.9714067, "process_in_blocks": "0", "process_kernel_time": 1.571596, "process_mem_max_rss": "234209280", "process_out_blocks": "0", "process_user_time": 2.248268}
[0m00:15:57.162397 [debug] [MainThread]: Command `dbt test` succeeded at 00:15:57.162344 after 2.97 seconds
[0m00:15:57.162627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10924c950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb275f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb27540>]}
[0m00:15:57.162825 [debug] [MainThread]: Flushing usage events
[0m00:15:57.523580 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:17:42.899526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10611e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075839d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107583c50>]}


============================== 01:17:42.902102 | 3d3c8c27-17f9-4e4b-b558-3a95274f5d21 ==============================
[0m01:17:42.902102 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m01:17:42.902366 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'target_path': 'None', 'empty': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'write_json': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'use_experimental_parser': 'False', 'warn_error': 'None', 'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'fail_fast': 'False', 'no_print': 'None', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'introspect': 'True', 'invocation_command': 'dbt run'}
[0m01:17:43.600664 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:17:43.600923 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:17:43.601047 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:17:43.724675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106911f30>]}
[0m01:17:43.745643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131b7ff00>]}
[0m01:17:43.746270 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m01:17:43.798941 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m01:17:43.873470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:17:43.873797 [debug] [MainThread]: Partial parsing: updated file: btc_elt://models/output/fct_btc_indicators.sql
[0m01:17:44.028819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1333d1450>]}
[0m01:17:44.063682 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:44.065515 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:44.076011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131e4d310>]}
[0m01:17:44.076248 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m01:17:44.076388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133420910>]}
[0m01:17:44.077154 [info ] [MainThread]: 
[0m01:17:44.077306 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:17:44.077407 [info ] [MainThread]: 
[0m01:17:44.077596 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:17:44.077928 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m01:17:44.130139 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m01:17:44.130350 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m01:17:44.130470 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:17:44.644899 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.514 seconds
[0m01:17:44.652694 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m01:17:44.668563 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:17:44.668909 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m01:17:44.912176 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.243 seconds
[0m01:17:44.915903 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:17:44.919136 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:17:44.919507 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m01:17:45.094356 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.174 seconds
[0m01:17:45.097075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133b5c6d0>]}
[0m01:17:45.101280 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m01:17:45.101723 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m01:17:45.102011 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m01:17:45.109805 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m01:17:45.111346 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m01:17:45.111771 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m01:17:45.112212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m01:17:45.112579 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m01:17:45.115262 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m01:17:45.116093 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m01:17:45.116700 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m01:17:45.117105 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m01:17:45.117411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m01:17:45.117655 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m01:17:45.146158 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m01:17:45.146720 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m01:17:45.161088 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m01:17:45.163427 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m01:17:45.163698 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m01:17:47.385674 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.221 seconds
[0m01:17:47.412792 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d3c8c27-17f9-4e4b-b558-3a95274f5d21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13406c290>]}
[0m01:17:47.413399 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.29s]
[0m01:17:47.413818 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m01:17:47.414800 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:17:47.415094 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m01:17:47.415315 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m01:17:47.540160 [info ] [MainThread]: 
[0m01:17:47.540572 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.46 seconds (3.46s).
[0m01:17:47.541081 [debug] [MainThread]: Command end result
[0m01:17:47.556272 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:47.557448 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:47.561200 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m01:17:47.561376 [info ] [MainThread]: 
[0m01:17:47.561566 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:17:47.561703 [info ] [MainThread]: 
[0m01:17:47.561858 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m01:17:47.565668 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6966414, "process_in_blocks": "0", "process_kernel_time": 2.063432, "process_mem_max_rss": "231653376", "process_out_blocks": "0", "process_user_time": 1.878705}
[0m01:17:47.565866 [debug] [MainThread]: Command `dbt run` succeeded at 01:17:47.565824 after 4.70 seconds
[0m01:17:47.566049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133f56830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13400f070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13400c0f0>]}
[0m01:17:47.566212 [debug] [MainThread]: Flushing usage events
[0m01:17:47.941375 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:17:54.452814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f8e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124339d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112433c50>]}


============================== 01:17:54.454460 | dcbe13ed-514d-4f94-ab1c-cd723e1462ea ==============================
[0m01:17:54.454460 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m01:17:54.454705 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'use_colors': 'True', 'printer_width': '80', 'log_format': 'default', 'debug': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'invocation_command': 'dbt test', 'empty': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'introspect': 'True', 'indirect_selection': 'eager', 'fail_fast': 'False', 'target_path': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None'}
[0m01:17:54.922020 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:17:54.922236 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:17:54.922347 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:17:54.992372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113bdf30>]}
[0m01:17:55.012029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13657ff00>]}
[0m01:17:55.012597 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m01:17:55.059342 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m01:17:55.124616 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:17:55.124772 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:17:55.145225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136736150>]}
[0m01:17:55.177768 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:55.178474 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:55.191261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a463f0>]}
[0m01:17:55.191474 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m01:17:55.191606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146aae0b0>]}
[0m01:17:55.192312 [info ] [MainThread]: 
[0m01:17:55.192447 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:17:55.192546 [info ] [MainThread]: 
[0m01:17:55.192736 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:17:55.194290 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m01:17:55.220739 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:17:55.220933 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m01:17:55.221037 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:17:55.859754 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.638 seconds
[0m01:17:55.863359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:17:55.867032 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:17:55.867420 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m01:17:56.007701 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.140 seconds
[0m01:17:56.012444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcbe13ed-514d-4f94-ab1c-cd723e1462ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146f09b20>]}
[0m01:17:56.016654 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.017174 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m01:17:56.017652 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m01:17:56.017994 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.034293 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:17:56.035354 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.049400 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:17:56.050256 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:17:56.050474 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m01:17:56.679642 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.629 seconds
[0m01:17:56.691619 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.67s]
[0m01:17:56.692327 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:17:56.692728 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.693164 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m01:17:56.693622 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m01:17:56.693949 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.698529 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m01:17:56.699594 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.702368 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m01:17:56.703251 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m01:17:56.703737 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m01:17:56.970361 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.266 seconds
[0m01:17:56.973886 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.28s]
[0m01:17:56.974657 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m01:17:56.975111 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:56.975683 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m01:17:56.976300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m01:17:56.976744 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:56.984621 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m01:17:56.986023 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:56.990795 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m01:17:56.991939 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m01:17:56.992253 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m01:17:57.197156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.204 seconds
[0m01:17:57.200731 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.22s]
[0m01:17:57.201541 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m01:17:57.203066 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:17:57.203473 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m01:17:57.203814 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m01:17:57.986486 [info ] [MainThread]: 
[0m01:17:57.987619 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 2.79 seconds (2.79s).
[0m01:17:57.989016 [debug] [MainThread]: Command end result
[0m01:17:58.014582 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:17:58.016418 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:17:58.021837 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m01:17:58.022117 [info ] [MainThread]: 
[0m01:17:58.022400 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:17:58.022590 [info ] [MainThread]: 
[0m01:17:58.022815 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m01:17:58.029722 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.5999541, "process_in_blocks": "0", "process_kernel_time": 1.156772, "process_mem_max_rss": "233865216", "process_out_blocks": "0", "process_user_time": 2.681446}
[0m01:17:58.030085 [debug] [MainThread]: Command `dbt test` succeeded at 01:17:58.030016 after 3.60 seconds
[0m01:17:58.030422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123f0950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479235f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147923540>]}
[0m01:17:58.030696 [debug] [MainThread]: Flushing usage events
[0m01:17:58.399945 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:52.808626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e0d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115e15b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115e13d0>]}


============================== 22:09:52.811235 | 2281c320-7d32-4335-b301-642812f7a0e6 ==============================
[0m22:09:52.811235 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:09:52.811521 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'target_path': 'None', 'no_print': 'None', 'invocation_command': 'dbt ', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'empty': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'warn_error': 'None', 'indirect_selection': 'eager', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'use_colors': 'True', 'debug': 'False', 'introspect': 'True', 'profiles_dir': '/Users/snehasingh/.dbt'}
[0m22:09:52.864650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2281c320-7d32-4335-b301-642812f7a0e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115bc5e0>]}
[0m22:09:52.870376 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m22:09:52.870785 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m22:09:52.872262 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.10019721, "process_in_blocks": "0", "process_kernel_time": 0.058007, "process_mem_max_rss": "100237312", "process_out_blocks": "0", "process_user_time": 0.591329}
[0m22:09:52.872479 [debug] [MainThread]: Command `cli deps` succeeded at 22:09:52.872431 after 0.10 seconds
[0m22:09:52.872647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e0d610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111833790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a86dc0>]}
[0m22:09:52.872820 [debug] [MainThread]: Flushing usage events
[0m22:09:53.272150 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:45:54.344311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1d9ca70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3a24cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb29dd160>]}


============================== 06:45:54.347266 | 79e5be18-aacf-43de-9c3c-f45767e7f785 ==============================
[0m06:45:54.347266 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:45:54.347596 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:45:54.397313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79e5be18-aacf-43de-9c3c-f45767e7f785', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1af7b30>]}
[0m06:45:54.397713 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:45:54.398817 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:45:54.399295 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.07549, "process_user_time": 1.045017, "process_kernel_time": 0.093001, "process_mem_max_rss": "107216", "process_out_blocks": "1339", "process_in_blocks": "0"}
[0m06:45:54.399533 [debug] [MainThread]: Command `dbt deps` succeeded at 06:45:54.399472 after 0.08 seconds
[0m06:45:54.399718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1df7b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1df4710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1d5af30>]}
[0m06:45:54.399888 [debug] [MainThread]: Flushing usage events
[0m06:46:20.854856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4161ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2e1b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2e1b530>]}


============================== 06:46:20.862170 | 03509dfe-c700-44cf-9bcb-b84a4c763336 ==============================
[0m06:46:20.862170 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:46:20.862711 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt ls -s stg_btc_market stg_btc_ohlc', 'send_anonymous_usage_stats': 'True'}
[0m06:46:20.864466 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'btc_elt'
[0m06:46:20.865152 [debug] [MainThread]: Resource report: {"command_name": "list", "command_wall_clock_time": 0.038131375, "process_user_time": 0.982625, "process_kernel_time": 0.109069, "process_mem_max_rss": "106136", "process_out_blocks": "2", "command_success": false, "process_in_blocks": "0"}
[0m06:46:20.865422 [debug] [MainThread]: Command `dbt ls` failed at 06:46:20.865351 after 0.04 seconds
[0m06:46:20.865639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3356d20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb394d880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2cc6ff0>]}
[0m06:46:20.866078 [debug] [MainThread]: Flushing usage events
[0m06:48:06.619355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb81e7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8de8da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8cdcbf0>]}


============================== 06:48:06.623889 | 9c290639-b7f4-42cb-a11f-ac33e399dc26 ==============================
[0m06:48:06.623889 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:48:06.624336 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:48:06.624891 [info ] [MainThread]: dbt version: 1.7.19
[0m06:48:06.625098 [info ] [MainThread]: python version: 3.12.5
[0m06:48:06.625288 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m06:48:06.625473 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m06:48:06.625807 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m06:48:06.625968 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m06:48:06.626116 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/btc_elt/dbt_project.yml
[0m06:48:06.667542 [info ] [MainThread]: Configuration:
[0m06:48:06.667899 [info ] [MainThread]:   profiles.yml file [[31mERROR not found[0m]
[0m06:48:06.668134 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m06:48:06.668361 [info ] [MainThread]: Required dependencies:
[0m06:48:06.668617 [debug] [MainThread]: Executing "git --help"
[0m06:48:06.669188 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m06:48:06.669409 [info ] [MainThread]: Connection test skipped since no profile was found
[0m06:48:06.669647 [info ] [MainThread]: [31m2 checks failed:[0m
[0m06:48:06.669915 [info ] [MainThread]: dbt looked for a profiles.yml file in /opt/airflow/dbt/profiles.yml, but did
not find one. For more information on configuring your profile, consult the
documentation:

https://docs.getdbt.com/docs/configure-your-profile


[0m06:48:06.670120 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m06:48:06.670647 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.077999584, "process_user_time": 1.083041, "process_kernel_time": 0.085397, "process_mem_max_rss": "106772", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m06:48:06.670900 [debug] [MainThread]: Command `dbt debug` failed at 06:48:06.670843 after 0.08 seconds
[0m06:48:06.671090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8c9ac00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8c9b530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb81e7b0>]}
[0m06:48:06.671275 [debug] [MainThread]: Flushing usage events
[0m06:50:22.772738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c1a47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c606900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c606d20>]}


============================== 06:50:22.776174 | 01f699aa-bedb-42ec-972d-8e9e3976bba2 ==============================
[0m06:50:22.776174 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:50:22.776560 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m06:50:22.776841 [info ] [MainThread]: dbt version: 1.7.19
[0m06:50:22.777008 [info ] [MainThread]: python version: 3.12.5
[0m06:50:22.777236 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m06:50:22.777451 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m06:50:22.780207 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_ACCOUNT'
[0m06:50:22.780711 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.031558376, "process_user_time": 0.958144, "process_kernel_time": 0.079845, "process_mem_max_rss": "106640", "process_out_blocks": "19", "command_success": false, "process_in_blocks": "0"}
[0m06:50:22.780977 [debug] [MainThread]: Command `dbt debug` failed at 06:50:22.780919 after 0.03 seconds
[0m06:50:22.781140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c1a3170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cee4560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c15e780>]}
[0m06:50:22.781291 [debug] [MainThread]: Flushing usage events
[0m06:53:02.754341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996bd130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996bc890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff996bc290>]}


============================== 06:53:02.757641 | 46260245-9459-4e17-8a69-aecb76fc4e3c ==============================
[0m06:53:02.757641 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:53:02.757986 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:53:02.758274 [info ] [MainThread]: dbt version: 1.7.19
[0m06:53:02.758482 [info ] [MainThread]: python version: 3.12.5
[0m06:53:02.758724 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m06:53:02.758947 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m06:53:03.074019 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m06:53:03.074329 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m06:53:03.074645 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/btc_elt/dbt_project.yml
[0m06:53:03.074971 [info ] [MainThread]: adapter type: snowflake
[0m06:53:03.075194 [info ] [MainThread]: adapter version: 1.7.0
[0m06:53:03.111769 [info ] [MainThread]: Configuration:
[0m06:53:03.111998 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m06:53:03.112258 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m06:53:03.112500 [info ] [MainThread]: Required dependencies:
[0m06:53:03.112722 [debug] [MainThread]: Executing "git --help"
[0m06:53:03.113216 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m06:53:03.113456 [info ] [MainThread]: Connection:
[0m06:53:03.113695 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m06:53:03.113916 [info ] [MainThread]:   user: PEACOCK
[0m06:53:03.114115 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m06:53:03.114362 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m06:53:03.114550 [info ] [MainThread]:   role: TRAINING_ROLE
[0m06:53:03.114781 [info ] [MainThread]:   schema: analytics
[0m06:53:03.115005 [info ] [MainThread]:   authenticator: None
[0m06:53:03.115218 [info ] [MainThread]:   private_key_path: None
[0m06:53:03.115428 [info ] [MainThread]:   token: None
[0m06:53:03.115624 [info ] [MainThread]:   oauth_client_id: None
[0m06:53:03.115820 [info ] [MainThread]:   query_tag: None
[0m06:53:03.116035 [info ] [MainThread]:   client_session_keep_alive: False
[0m06:53:03.116226 [info ] [MainThread]:   host: None
[0m06:53:03.116460 [info ] [MainThread]:   port: None
[0m06:53:03.116664 [info ] [MainThread]:   proxy_host: None
[0m06:53:03.116863 [info ] [MainThread]:   proxy_port: None
[0m06:53:03.117043 [info ] [MainThread]:   protocol: None
[0m06:53:03.117233 [info ] [MainThread]:   connect_retries: 1
[0m06:53:03.117430 [info ] [MainThread]:   connect_timeout: None
[0m06:53:03.117661 [info ] [MainThread]:   retry_on_database_errors: False
[0m06:53:03.117875 [info ] [MainThread]:   retry_all: False
[0m06:53:03.118071 [info ] [MainThread]:   insecure_mode: False
[0m06:53:03.118264 [info ] [MainThread]:   reuse_connections: None
[0m06:53:03.118530 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:53:03.118852 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m06:53:03.119132 [debug] [MainThread]: Using snowflake connection "debug"
[0m06:53:03.119279 [debug] [MainThread]: On debug: select 1 as id
[0m06:53:03.119434 [debug] [MainThread]: Opening a new connection, currently in state init
[0m06:53:03.618782 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:53:03.619384 [debug] [MainThread]: On debug: Close
[0m06:53:03.749578 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m06:53:03.749871 [info ] [MainThread]: [31m1 check failed:[0m
[0m06:53:03.750132 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m06:53:03.750673 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.0171638, "process_user_time": 2.159201, "process_kernel_time": 0.121384, "process_mem_max_rss": "205944", "process_out_blocks": "121", "command_success": false, "process_in_blocks": "0"}
[0m06:53:03.750909 [debug] [MainThread]: Command `dbt debug` failed at 06:53:03.750855 after 1.02 seconds
[0m06:53:03.751072 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m06:53:03.751233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78d47530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff994605f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff795ba8a0>]}
[0m06:53:03.751419 [debug] [MainThread]: Flushing usage events
[0m06:53:47.506771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa23dfd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa272b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2c9d1f0>]}


============================== 06:53:47.509936 | 8413d120-8f4e-4d32-9acc-bf1fca687390 ==============================
[0m06:53:47.509936 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:53:47.510279 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:53:47.889790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8413d120-8f4e-4d32-9acc-bf1fca687390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81433dd0>]}
[0m06:53:47.920315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8413d120-8f4e-4d32-9acc-bf1fca687390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91597d70>]}
[0m06:53:47.920678 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:53:47.924137 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m06:53:47.930753 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m06:53:47.931039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8413d120-8f4e-4d32-9acc-bf1fca687390', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80ec7380>]}
[0m06:53:48.297412 [error] [MainThread]: Encountered an error:
Parsing Error
  at path ['unique_key']: ['coin_id', 'timestamp'] is not valid under any of the given schemas
[0m06:53:48.298095 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8117203, "process_user_time": 2.477201, "process_kernel_time": 0.175003, "process_mem_max_rss": "210004", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m06:53:48.298366 [debug] [MainThread]: Command `dbt run` failed at 06:53:48.298300 after 0.81 seconds
[0m06:53:48.298588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2c9d1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80fd47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80fd4800>]}
[0m06:53:48.298816 [debug] [MainThread]: Flushing usage events
[0m07:22:10.180610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85d51a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff869402c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8615a180>]}


============================== 07:22:10.183932 | ca30c85e-4ac7-4f89-bda7-b6c51d4853ce ==============================
[0m07:22:10.183932 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:22:10.184240 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt parse', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:22:10.560983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85d4e9c0>]}
[0m07:22:10.592514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64efbf20>]}
[0m07:22:10.592928 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:22:10.596469 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:22:10.602349 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m07:22:10.602596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff650345c0>]}
[0m07:22:11.120658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca30c85e-4ac7-4f89-bda7-b6c51d4853ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff643a8e90>]}
[0m07:22:11.121517 [info ] [MainThread]: Performance info: /opt/airflow/dbt/btc_elt/target/perf_info.json
[0m07:22:11.126011 [debug] [MainThread]: Resource report: {"command_name": "parse", "command_success": true, "command_wall_clock_time": 0.96761096, "process_user_time": 2.630774, "process_kernel_time": 0.12123, "process_mem_max_rss": "217268", "process_out_blocks": "1741", "process_in_blocks": "0"}
[0m07:22:11.126280 [debug] [MainThread]: Command `dbt parse` succeeded at 07:22:11.126222 after 0.97 seconds
[0m07:22:11.126457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85d8f500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff650aab40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64658560>]}
[0m07:22:11.126621 [debug] [MainThread]: Flushing usage events
[0m07:23:47.883180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7d06150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8b52180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb80ecfb0>]}


============================== 07:23:47.887148 | 338fa384-2c68-4b85-af1c-af5a1f9a869e ==============================
[0m07:23:47.887148 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:23:47.887643 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt parse', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:23:48.329277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '338fa384-2c68-4b85-af1c-af5a1f9a869e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92b36780>]}
[0m07:23:48.360799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '338fa384-2c68-4b85-af1c-af5a1f9a869e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8049b50>]}
[0m07:23:48.361262 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:23:48.365386 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:23:48.380085 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:23:48.380352 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:23:48.382749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '338fa384-2c68-4b85-af1c-af5a1f9a869e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9396a030>]}
[0m07:23:48.383439 [info ] [MainThread]: Performance info: /opt/airflow/dbt/btc_elt/target/perf_info.json
[0m07:23:48.388122 [debug] [MainThread]: Resource report: {"command_name": "parse", "command_success": true, "command_wall_clock_time": 0.53204143, "process_user_time": 2.320016, "process_kernel_time": 0.189725, "process_mem_max_rss": "204524", "process_out_blocks": "866", "process_in_blocks": "0"}
[0m07:23:48.388411 [debug] [MainThread]: Command `dbt parse` succeeded at 07:23:48.388346 after 0.53 seconds
[0m07:23:48.388606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7d018b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9300b5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb7d9c260>]}
[0m07:23:48.388793 [debug] [MainThread]: Flushing usage events
[0m07:24:00.044260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa6139e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaac5d520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa610410>]}


============================== 07:24:00.047124 | ce0d95b2-93d7-401b-a541-1dc993c7087b ==============================
[0m07:24:00.047124 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:24:00.047466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt snapshot', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:24:00.395356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff898bf170>]}
[0m07:24:00.424468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8acb2b10>]}
[0m07:24:00.424813 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:24:00.427893 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:24:00.439666 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:24:00.439865 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:24:00.442056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8915d6d0>]}
[0m07:24:00.447191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89115310>]}
[0m07:24:00.447417 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:24:00.447613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89114f20>]}
[0m07:24:00.448416 [info ] [MainThread]: 
[0m07:24:00.448827 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:24:00.449430 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:24:00.454509 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:24:00.454692 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:24:00.454825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:24:01.081157 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:24:01.084388 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:24:01.727177 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:24:01.733842 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:24:01.734244 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:24:01.734650 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:24:02.345072 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:24:02.348335 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:24:02.547105 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:24:02.552004 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:24:02.552678 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:24:02.553731 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:24:03.050965 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:24:03.054890 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:24:03.218357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8873dd60>]}
[0m07:24:03.219078 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:24:03.219536 [info ] [MainThread]: 
[0m07:24:03.225159 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:24:03.225554 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:24:03.226076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:24:03.226373 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:24:03.230793 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:24:03.226541 => 07:24:03.230661
[0m07:24:03.231031 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:24:03.252215 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:24:03.252461 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:24:03.252661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:24:03.811358 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 1.0 seconds
[0m07:24:03.846877 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:24:03.847356 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:24:04.049072 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e7c-0307-19fd-000f-c0df008a114a
[0m07:24:04.050073 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:24:04.051055 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:24:03.231187 => 07:24:04.050716
[0m07:24:04.051746 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:24:04.430723 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:04.432058 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff885f4920>]}
[0m07:24:04.433439 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.21s]
[0m07:24:04.434503 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:24:04.435132 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:04.436767 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:24:04.437747 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:24:04.438262 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:04.441947 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:24:04.438584 => 07:24:04.441739
[0m07:24:04.442332 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:04.446321 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:24:04.446641 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:24:04.446949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:24:04.966923 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 1.0 seconds
[0m07:24:04.977178 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:24:04.977999 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:24:05.307376 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e7c-0307-19b7-000f-c0df0089d66a
[0m07:24:05.308578 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:24:05.309750 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:24:04.442580 => 07:24:05.309410
[0m07:24:05.310532 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:24:05.467665 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:05.469064 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce0d95b2-93d7-401b-a541-1dc993c7087b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa49cef90>]}
[0m07:24:05.470520 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.03s]
[0m07:24:05.471464 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:24:05.474751 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:24:05.475340 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:24:05.475948 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:24:05.476666 [info ] [MainThread]: 
[0m07:24:05.477394 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 5.03 seconds (5.03s).
[0m07:24:05.478718 [debug] [MainThread]: Command end result
[0m07:24:05.489786 [info ] [MainThread]: 
[0m07:24:05.490451 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:24:05.490824 [info ] [MainThread]: 
[0m07:24:05.491241 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:05.491693 [info ] [MainThread]: 
[0m07:24:05.492040 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:24:05.492358 [info ] [MainThread]: 
[0m07:24:05.492790 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:24:05.494004 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 5.4777417, "process_user_time": 2.540753, "process_kernel_time": 0.135253, "process_mem_max_rss": "215232", "process_out_blocks": "1803", "command_success": false, "process_in_blocks": "0"}
[0m07:24:05.494580 [debug] [MainThread]: Command `dbt snapshot` failed at 07:24:05.494473 after 5.48 seconds
[0m07:24:05.494976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa613650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa5ca2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff893777a0>]}
[0m07:24:05.495346 [debug] [MainThread]: Flushing usage events
[0m07:24:10.045849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c68470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5caa150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5cabcb0>]}


============================== 07:24:10.048548 | 8272badb-ecc8-4abc-b8a6-c081da5f51fe ==============================
[0m07:24:10.048548 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:24:10.048883 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run -s stg_* fct_*', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:24:10.402933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84a9ede0>]}
[0m07:24:10.432653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84d71a00>]}
[0m07:24:10.433004 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:24:10.436183 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:24:10.448735 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:24:10.448901 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:24:10.451066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92de3110>]}
[0m07:24:10.455714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8483d2b0>]}
[0m07:24:10.455922 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:24:10.456185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8272badb-ecc8-4abc-b8a6-c081da5f51fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8496da60>]}
[0m07:24:10.456601 [warn ] [MainThread]: The selection criterion 'stg_*' does not match any nodes
[0m07:24:10.456862 [warn ] [MainThread]: The selection criterion 'fct_*' does not match any nodes
[0m07:24:10.457394 [info ] [MainThread]: 
[0m07:24:10.457589 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m07:24:10.457921 [debug] [MainThread]: Command end result
[0m07:24:10.461203 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.43612117, "process_user_time": 2.092118, "process_kernel_time": 0.107645, "process_mem_max_rss": "204944", "process_out_blocks": "1762", "process_in_blocks": "0"}
[0m07:24:10.461434 [debug] [MainThread]: Command `dbt run` succeeded at 07:24:10.461383 after 0.44 seconds
[0m07:24:10.461618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa61251f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5b642c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c692e0>]}
[0m07:24:10.461778 [debug] [MainThread]: Flushing usage events
[0m07:26:01.783407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb277f7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2b690d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2ac5b50>]}


============================== 07:26:01.786418 | 229b622a-da63-4246-bf1d-42e8b9a4e8de ==============================
[0m07:26:01.786418 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:26:01.786816 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt ls --resource-type model', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:26:02.153491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91612ff0>]}
[0m07:26:02.184202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97866e10>]}
[0m07:26:02.184548 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:26:02.188479 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:26:02.192985 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m07:26:02.193257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91830e90>]}
[0m07:26:02.732623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90509940>]}
[0m07:26:02.737732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90508740>]}
[0m07:26:02.737977 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:26:02.738206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '229b622a-da63-4246-bf1d-42e8b9a4e8de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90d36e40>]}
[0m07:26:02.739080 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 0.9780157, "process_user_time": 2.697954, "process_kernel_time": 0.154767, "process_mem_max_rss": "216388", "process_out_blocks": "1769", "process_in_blocks": "0"}
[0m07:26:02.739336 [debug] [MainThread]: Command `dbt ls` succeeded at 07:26:02.739275 after 0.98 seconds
[0m07:26:02.739522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb273a330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2b690d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff914e07a0>]}
[0m07:26:02.739684 [debug] [MainThread]: Flushing usage events
[0m07:26:52.836546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eabf710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eea5310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee086e0>]}


============================== 07:26:52.839446 | 15a7952e-682a-467c-b92e-7b2fe101fc75 ==============================
[0m07:26:52.839446 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:26:52.839782 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run -s +fct_btc_indicators', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:26:53.238203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d9431a0>]}
[0m07:26:53.269439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e1e2d80>]}
[0m07:26:53.269783 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:26:53.273881 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:26:53.286956 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:26:53.287134 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:26:53.289431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d99c620>]}
[0m07:26:53.295035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d6e0dd0>]}
[0m07:26:53.295239 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:26:53.295439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d9cb7a0>]}
[0m07:26:53.296333 [info ] [MainThread]: 
[0m07:26:53.296734 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:26:53.297275 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:26:53.302595 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:26:53.302760 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:26:53.302911 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:26:53.844511 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:26:53.847827 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:26:53.992447 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m07:26:54.001407 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:26:54.002129 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:26:54.002624 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:26:54.509946 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:26:54.512262 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:26:54.657706 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:26:54.661953 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:26:54.662533 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:26:54.663493 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:26:55.212571 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:26:55.219593 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:26:55.355093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d678e30>]}
[0m07:26:55.355707 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:26:55.356011 [info ] [MainThread]: 
[0m07:26:55.360972 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:26:55.361422 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m07:26:55.361660 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:26:55.366063 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:26:55.367361 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:26:55.361844 => 07:26:55.367207
[0m07:26:55.368081 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:26:55.368366 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:26:55.368990 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:26:55.369234 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:26:55.371137 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:26:55.371757 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:26:55.369405 => 07:26:55.371657
[0m07:26:55.372229 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:26:55.372700 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:26:55.373017 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m07:26:55.373578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:26:55.373767 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:26:55.394536 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:26:55.395574 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:26:55.373919 => 07:26:55.395460
[0m07:26:55.395807 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:26:55.409182 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m07:26:55.411814 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m07:26:55.412131 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m07:26:55.412461 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:26:57.854353 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:26:57.878532 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:26:55.395946 => 07:26:57.878257
[0m07:26:57.879105 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m07:26:58.029694 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15a7952e-682a-467c-b92e-7b2fe101fc75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d5bc380>]}
[0m07:26:58.031252 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.66s]
[0m07:26:58.032647 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:26:58.035884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:26:58.036493 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m07:26:58.037000 [info ] [MainThread]: 
[0m07:26:58.037549 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.74 seconds (4.74s).
[0m07:26:58.038829 [debug] [MainThread]: Command end result
[0m07:26:58.053359 [info ] [MainThread]: 
[0m07:26:58.053957 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:26:58.054471 [info ] [MainThread]: 
[0m07:26:58.054973 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:26:58.056168 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.2412987, "process_user_time": 2.420644, "process_kernel_time": 0.237714, "process_mem_max_rss": "212900", "process_out_blocks": "1851", "process_in_blocks": "0"}
[0m07:26:58.056710 [debug] [MainThread]: Command `dbt run` succeeded at 07:26:58.056594 after 5.24 seconds
[0m07:26:58.057152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ef79280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eabbf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ea76d50>]}
[0m07:26:58.057504 [debug] [MainThread]: Flushing usage events
[0m07:28:21.496563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb621d970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb626e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb626d220>]}


============================== 07:28:21.499543 | a378f3d9-60d5-4602-82f8-0c9effb84194 ==============================
[0m07:28:21.499543 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:28:21.499854 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt test -s fct_btc_indicators', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:28:21.916463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95045520>]}
[0m07:28:21.947812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff955b45c0>]}
[0m07:28:21.948166 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:28:21.952096 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:28:21.965122 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:28:21.965302 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:28:21.967585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94f63170>]}
[0m07:28:21.973302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94e14b30>]}
[0m07:28:21.973522 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:28:21.973724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff950d5280>]}
[0m07:28:21.974407 [info ] [MainThread]: 
[0m07:28:21.974834 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:28:21.975464 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:28:21.981295 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:28:21.981485 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:28:21.981656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:28:22.574602 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:28:22.578075 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:28:22.752326 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:28:22.758129 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:28:22.758813 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:28:22.759353 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:28:23.198831 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:28:23.202725 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:28:23.360850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a378f3d9-60d5-4602-82f8-0c9effb84194', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94d7e8a0>]}
[0m07:28:23.362356 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:28:23.363017 [info ] [MainThread]: 
[0m07:28:23.374937 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:23.375733 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m07:28:23.377013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:28:23.377587 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:23.391140 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:28:23.393625 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:28:23.377980 => 07:28:23.393284
[0m07:28:23.394465 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:23.412862 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:28:23.414259 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:28:23.414555 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m07:28:23.414848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:28:23.973504 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:28:23.985590 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:28:23.395111 => 07:28:23.985151
[0m07:28:23.986366 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m07:28:24.123311 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.75s]
[0m07:28:24.125088 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:28:24.126044 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.126792 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m07:28:24.128022 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:28:24.128672 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.136263 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:28:24.139140 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:28:24.129139 => 07:28:24.138723
[0m07:28:24.139937 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.142916 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:28:24.144568 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:28:24.145291 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m07:28:24.145733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:28:24.802653 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:28:24.807062 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:28:24.140197 => 07:28:24.806668
[0m07:28:24.807805 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m07:28:24.964380 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.84s]
[0m07:28:24.965867 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:28:24.966651 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:24.967315 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m07:28:24.968519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:28:24.969206 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:24.982491 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:28:24.984599 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:28:24.969605 => 07:28:24.984125
[0m07:28:24.985191 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:24.988100 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:28:24.989524 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:28:24.989971 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m07:28:24.990323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:28:25.568394 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:28:25.572054 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:28:24.985500 => 07:28:25.571666
[0m07:28:25.572818 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m07:28:25.713842 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.75s]
[0m07:28:25.715357 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:28:25.718557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:28:25.719203 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:28:25.719830 [info ] [MainThread]: 
[0m07:28:25.720417 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.75 seconds (3.75s).
[0m07:28:25.721863 [debug] [MainThread]: Command end result
[0m07:28:25.737562 [info ] [MainThread]: 
[0m07:28:25.738227 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:28:25.738819 [info ] [MainThread]: 
[0m07:28:25.739322 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:28:25.740571 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.2661686, "process_user_time": 2.53369, "process_kernel_time": 0.200975, "process_mem_max_rss": "212776", "process_out_blocks": "1799", "process_in_blocks": "0"}
[0m07:28:25.741201 [debug] [MainThread]: Command `dbt test` succeeded at 07:28:25.741073 after 4.27 seconds
[0m07:28:25.741606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6561d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6567e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff955461b0>]}
[0m07:28:25.742003 [debug] [MainThread]: Flushing usage events
[0m07:29:05.932375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e7920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e74d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e6a20>]}


============================== 07:29:05.935584 | aac2b118-8676-419f-b4e2-1f3e66bb15c7 ==============================
[0m07:29:05.935584 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:29:05.935958 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:29:06.346816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e1e27b0>]}
[0m07:29:06.381778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ee492e0>]}
[0m07:29:06.382263 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:29:06.386620 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:29:06.399941 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:29:06.400169 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:29:06.402560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e0ceed0>]}
[0m07:29:06.409858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e184800>]}
[0m07:29:06.410141 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:29:06.410388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb342c170>]}
[0m07:29:06.411269 [info ] [MainThread]: 
[0m07:29:06.411774 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:29:06.412427 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:29:06.417888 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:29:06.418081 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:29:06.418251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:06.882620 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:29:06.883573 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:29:06.991639 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m07:29:06.995389 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:29:06.995644 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:29:06.995833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:29:07.406648 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:29:07.409802 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:29:07.568206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:29:07.572976 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:29:07.573515 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:29:07.574448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:29:08.054472 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:29:08.056753 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:29:08.181263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8df89cd0>]}
[0m07:29:08.182935 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:29:08.183614 [info ] [MainThread]: 
[0m07:29:08.196789 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:29:08.197880 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:29:08.199138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:29:08.199692 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:29:08.207358 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:29:08.200061 => 07:29:08.207134
[0m07:29:08.207760 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:29:08.237466 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:29:08.237834 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:29:08.238093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:29:08.660887 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:29:08.683138 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:29:08.683599 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:29:08.932918 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e81-0307-1ab7-000f-c0df0089e50a
[0m07:29:08.935259 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:29:08.935641 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:29:08.208033 => 07:29:08.935521
[0m07:29:08.936346 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:29:09.063683 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.064260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cb255b0>]}
[0m07:29:09.065004 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 0.87s]
[0m07:29:09.065774 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:29:09.066200 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.067078 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:29:09.067750 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:29:09.068041 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.070585 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:29:09.068252 => 07:29:09.070430
[0m07:29:09.070874 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.073994 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:29:09.074275 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:29:09.074528 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:29:09.461878 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:29:09.470674 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:29:09.471381 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            nullif(timestamp, timestamp) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(timestamp as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            timestamp as dbt_updated_at,
            timestamp as dbt_valid_from,
            timestamp as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data.dbt_valid_from < source_data.timestamp)
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data.dbt_valid_from < source_data.timestamp)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:29:09.658277 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e81-0307-19b7-000f-c0df0089d752
[0m07:29:09.659391 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:29:09.660408 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:29:09.071072 => 07:29:09.660046
[0m07:29:09.661052 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:29:09.820239 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.821586 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aac2b118-8676-419f-b4e2-1f3e66bb15c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cb259a0>]}
[0m07:29:09.822917 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 0.75s]
[0m07:29:09.823923 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:29:09.826691 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:29:09.827229 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:29:09.827595 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:29:09.828016 [info ] [MainThread]: 
[0m07:29:09.828482 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 3.42 seconds (3.42s).
[0m07:29:09.829736 [debug] [MainThread]: Command end result
[0m07:29:09.841047 [info ] [MainThread]: 
[0m07:29:09.841574 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:29:09.842048 [info ] [MainThread]: 
[0m07:29:09.842546 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.842893 [info ] [MainThread]: 
[0m07:29:09.843284 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:29:09.843652 [info ] [MainThread]: 
[0m07:29:09.844106 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:29:09.845180 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.9430404, "process_user_time": 2.437832, "process_kernel_time": 0.197634, "process_mem_max_rss": "215260", "process_out_blocks": "1803", "command_success": false, "process_in_blocks": "0"}
[0m07:29:09.845679 [debug] [MainThread]: Command `dbt snapshot` failed at 07:29:09.845567 after 3.94 seconds
[0m07:29:09.846044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb34c7a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb33e76e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb591ac60>]}
[0m07:29:09.846401 [debug] [MainThread]: Flushing usage events
[0m07:32:59.762152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2656990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2a11970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb347e240>]}


============================== 07:32:59.765287 | a724b5dc-49cc-42a7-a060-7185fcb0f4c0 ==============================
[0m07:32:59.765287 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:32:59.765709 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot', 'send_anonymous_usage_stats': 'True'}
[0m07:33:00.156310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91589f10>]}
[0m07:33:00.188068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff917a1700>]}
[0m07:33:00.188510 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:33:00.192599 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:33:00.205213 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:33:00.205465 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_market.sql
[0m07:33:00.205636 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_ohlc.sql
[0m07:33:00.285155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9101b2f0>]}
[0m07:33:00.290961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff910ae0c0>]}
[0m07:33:00.291174 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:33:00.291381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff910ac530>]}
[0m07:33:00.292271 [info ] [MainThread]: 
[0m07:33:00.292721 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:33:00.293351 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:33:00.299075 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:33:00.299269 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:33:00.299413 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:33:01.186487 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:33:01.190012 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:33:01.317532 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:33:01.330897 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:33:01.331786 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:33:01.332262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:33:01.814610 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:33:01.815619 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:33:01.945321 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:33:01.946806 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:33:01.946994 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:33:01.947336 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:33:02.394088 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:33:02.396372 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:33:02.540499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9111a060>]}
[0m07:33:02.541685 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:33:02.542260 [info ] [MainThread]: 
[0m07:33:02.552530 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:33:02.553411 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:33:02.554179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:33:02.554451 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:33:02.558138 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:33:02.554621 => 07:33:02.558007
[0m07:33:02.558394 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:33:02.586681 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:02.587186 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:02.587470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:03.111197 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:33:03.122844 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:03.123604 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:03.202165 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:03.216404 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:03.217322 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:03.339942 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:03.362450 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:03.362859 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:03.521577 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-18e5-000f-c0df00897cde
[0m07:33:03.522278 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:03.523101 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:33:02.558557 => 07:33:03.522777
[0m07:33:03.523689 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:33:03.665210 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:03.666182 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9054cbc0>]}
[0m07:33:03.667405 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.11s]
[0m07:33:03.668603 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:33:03.669321 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:03.670720 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:33:03.671698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:33:03.672194 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:03.675904 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:33:03.672492 => 07:33:03.675744
[0m07:33:03.676184 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:03.678281 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:03.678511 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:03.678744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:04.247965 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:33:04.252613 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:04.253409 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:04.333857 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:04.335938 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:04.336179 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:04.426492 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:04.430628 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:04.431051 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:04.606149 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-1a0c-000f-c0df008a3182
[0m07:33:04.606944 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:04.607934 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:33:03.676331 => 07:33:04.607539
[0m07:33:04.608578 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:33:04.793428 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:04.794279 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a724b5dc-49cc-42a7-a060-7185fcb0f4c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90402600>]}
[0m07:33:04.795349 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.12s]
[0m07:33:04.796395 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:04.799152 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:33:04.799582 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:33:04.800043 [info ] [MainThread]: 
[0m07:33:04.800553 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.51 seconds (4.51s).
[0m07:33:04.801655 [debug] [MainThread]: Command end result
[0m07:33:04.809813 [info ] [MainThread]: 
[0m07:33:04.810136 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:33:04.810416 [info ] [MainThread]: 
[0m07:33:04.810676 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:04.810892 [info ] [MainThread]: 
[0m07:33:04.811120 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:04.811341 [info ] [MainThread]: 
[0m07:33:04.811569 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:33:04.812396 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 5.0724964, "process_user_time": 2.669033, "process_kernel_time": 0.206932, "process_mem_max_rss": "218284", "process_out_blocks": "2693", "command_success": false, "process_in_blocks": "0"}
[0m07:33:04.812737 [debug] [MainThread]: Command `dbt snapshot` failed at 07:33:04.812659 after 5.07 seconds
[0m07:33:04.813073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb760b170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff905fd4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb27ab2f0>]}
[0m07:33:04.813267 [debug] [MainThread]: Flushing usage events
[0m07:33:47.062273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a22c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b13d1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b13e240>]}


============================== 07:33:47.065455 | bc3d5677-aea9-476f-bfe1-b5b181ab99eb ==============================
[0m07:33:47.065455 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:33:47.065785 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot', 'send_anonymous_usage_stats': 'True'}
[0m07:33:47.448941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff691f7e90>]}
[0m07:33:47.480278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a33ac60>]}
[0m07:33:47.480739 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:33:47.484137 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:33:47.497388 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:33:47.497589 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:33:47.499822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff845d5ee0>]}
[0m07:33:47.504939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68f9d370>]}
[0m07:33:47.505166 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:33:47.505373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69002de0>]}
[0m07:33:47.506217 [info ] [MainThread]: 
[0m07:33:47.506623 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:33:47.507231 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:33:47.512364 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:33:47.512544 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:33:47.512689 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:33:48.356846 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:33:48.358881 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:33:48.485226 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:33:48.494666 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:33:48.495145 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:33:48.495534 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:33:49.008457 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:33:49.010805 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:33:49.166065 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:33:49.170537 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:33:49.171169 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:33:49.172199 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:33:49.652690 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:33:49.655763 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:33:49.874531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a22aa80>]}
[0m07:33:49.876526 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:33:49.877188 [info ] [MainThread]: 
[0m07:33:49.890480 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:33:49.891235 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:33:49.892144 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:33:49.892668 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:33:49.900050 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:33:49.893006 => 07:33:49.899823
[0m07:33:49.900461 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:33:49.932387 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:49.932731 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:49.932966 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:50.449737 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:33:50.463675 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:50.464939 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:50.545226 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:50.548398 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:50.548606 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:33:50.650010 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:33:50.667298 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:33:50.667663 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  -- make the unique key a real column in the select
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                             AS timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:50.867090 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-1a01-000f-c0df008a21ca
[0m07:33:50.867802 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:50.868648 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:33:49.900706 => 07:33:50.868318
[0m07:33:50.869206 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:33:51.009824 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:51.010597 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68217ce0>]}
[0m07:33:51.011627 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.12s]
[0m07:33:51.012670 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:33:51.013277 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.014561 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:33:51.015496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:33:51.015941 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.019801 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:33:51.016253 => 07:33:51.019609
[0m07:33:51.020166 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.023997 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.024350 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:33:51.024687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:33:51.443949 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:33:51.450488 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.451370 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:51.532710 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:51.540222 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.541057 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:33:51.646304 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:33:51.659229 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:33:51.660180 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



SELECT
  TO_VARCHAR(coin_id) || '|' || TO_VARCHAR("TIMESTAMP") AS business_key,
  "TIMESTAMP"                   AS timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:33:51.808194 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e85-0307-19fd-000f-c0df008a127a
[0m07:33:51.808577 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:33:51.808999 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:33:51.020412 => 07:33:51.808847
[0m07:33:51.809275 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:33:51.986146 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:51.986883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc3d5677-aea9-476f-bfe1-b5b181ab99eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6815fe90>]}
[0m07:33:51.987742 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 0.97s]
[0m07:33:51.988506 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:33:51.990446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:33:51.990828 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:33:51.991150 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:33:51.991499 [info ] [MainThread]: 
[0m07:33:51.991870 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.49 seconds (4.49s).
[0m07:33:51.992659 [debug] [MainThread]: Command end result
[0m07:33:52.002194 [info ] [MainThread]: 
[0m07:33:52.002592 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:33:52.002992 [info ] [MainThread]: 
[0m07:33:52.003350 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:52.003664 [info ] [MainThread]: 
[0m07:33:52.004049 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:33:52.004341 [info ] [MainThread]: 
[0m07:33:52.004668 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:33:52.005457 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 4.9640093, "process_user_time": 2.50896, "process_kernel_time": 0.20575, "process_mem_max_rss": "215620", "process_out_blocks": "1819", "command_success": false, "process_in_blocks": "0"}
[0m07:33:52.005863 [debug] [MainThread]: Command `dbt snapshot` failed at 07:33:52.005776 after 4.96 seconds
[0m07:33:52.006159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a75fa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff697cb230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69e51a30>]}
[0m07:33:52.006453 [debug] [MainThread]: Flushing usage events
[0m07:36:26.860089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e836b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa36cde50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ebf1b50>]}


============================== 07:36:26.863572 | 808149ce-d352-4e4a-918c-344a708cb5ea ==============================
[0m07:36:26.863572 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:36:26.863941 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:36:27.325981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ee4eea0>]}
[0m07:36:27.359375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d79f7d0>]}
[0m07:36:27.359831 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:36:27.363454 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:36:27.377243 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:36:27.377542 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_market.sql
[0m07:36:27.377735 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_ohlc.sql
[0m07:36:27.457967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d127e00>]}
[0m07:36:27.464928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d0bc620>]}
[0m07:36:27.465169 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:36:27.465357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d37ffe0>]}
[0m07:36:27.466218 [info ] [MainThread]: 
[0m07:36:27.466681 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:36:27.467396 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:36:27.472828 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:36:27.473025 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:36:27.473172 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:27.954212 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:36:27.956791 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:36:28.137058 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:36:28.148767 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:36:28.149286 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:36:28.149717 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:28.669413 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m07:36:28.671088 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:36:28.812674 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:36:28.817801 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:36:28.818550 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:36:28.819890 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:29.293839 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:36:29.296369 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:36:29.441883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d3abec0>]}
[0m07:36:29.443652 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:36:29.444372 [info ] [MainThread]: 
[0m07:36:29.455307 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:36:29.455910 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:36:29.457075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:36:29.457582 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:36:29.464951 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:36:29.457873 => 07:36:29.464662
[0m07:36:29.465493 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:36:29.497389 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:29.497753 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:29.497990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:30.175707 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:36:30.189449 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:30.190603 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:30.300941 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:30.313582 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:30.314547 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:30.429405 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:30.461615 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:30.462339 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:30.666738 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-1a0e-000f-c0df008a4106
[0m07:36:30.667828 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:30.668879 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:36:29.465786 => 07:36:30.668555
[0m07:36:30.669537 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:36:30.808547 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:30.809914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c7c8da0>]}
[0m07:36:30.811301 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.35s]
[0m07:36:30.812347 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:36:30.813138 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:30.814929 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:36:30.816102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:36:30.816666 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:30.820547 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:36:30.817031 => 07:36:30.820312
[0m07:36:30.821090 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:30.824849 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:30.825229 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:30.825572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:31.376460 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:36:31.381660 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:31.382449 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:31.501334 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:31.506720 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:31.507404 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:31.646880 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:31.658970 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:31.659975 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:31.831985 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-18e5-000f-c0df00897d4a
[0m07:36:31.832835 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:31.833879 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:36:30.821369 => 07:36:31.833648
[0m07:36:31.834492 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:36:31.989404 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:31.989881 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '808149ce-d352-4e4a-918c-344a708cb5ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c63a180>]}
[0m07:36:31.990331 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.17s]
[0m07:36:31.990749 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:31.991955 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:36:31.992185 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:36:31.992445 [info ] [MainThread]: 
[0m07:36:31.992706 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.53 seconds (4.53s).
[0m07:36:31.993190 [debug] [MainThread]: Command end result
[0m07:36:31.998238 [info ] [MainThread]: 
[0m07:36:31.998532 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:36:31.998779 [info ] [MainThread]: 
[0m07:36:31.998998 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:31.999242 [info ] [MainThread]: 
[0m07:36:31.999452 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:31.999672 [info ] [MainThread]: 
[0m07:36:31.999899 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:36:32.000572 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 5.1642203, "process_user_time": 2.804799, "process_kernel_time": 0.303323, "process_mem_max_rss": "217676", "process_out_blocks": "2691", "command_success": false, "process_in_blocks": "0"}
[0m07:36:32.000845 [debug] [MainThread]: Command `dbt snapshot` failed at 07:36:32.000785 after 5.16 seconds
[0m07:36:32.001047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e87d0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e836b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c75f500>]}
[0m07:36:32.001225 [debug] [MainThread]: Flushing usage events
[0m07:36:49.351688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff888fe990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88900440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88a0cb60>]}


============================== 07:36:49.354505 | f2fe64ca-7487-4f55-83c0-60489c30055f ==============================
[0m07:36:49.354505 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:36:49.354758 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt snapshot', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:36:49.705492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff888fec60>]}
[0m07:36:49.735494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88900440>]}
[0m07:36:49.735836 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:36:49.738995 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:36:49.752367 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:36:49.752550 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:36:49.754750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6368a150>]}
[0m07:36:49.759682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff636253d0>]}
[0m07:36:49.759877 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:36:49.760086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63625040>]}
[0m07:36:49.760867 [info ] [MainThread]: 
[0m07:36:49.761287 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:36:49.761869 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:36:49.766893 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:36:49.767058 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:36:49.767223 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:50.359060 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:36:50.361952 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:36:50.505344 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:36:50.517713 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:36:50.518490 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:36:50.519034 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:36:51.053660 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:36:51.057488 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:36:51.203818 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:36:51.208936 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:36:51.209590 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:36:51.210481 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:36:51.712535 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m07:36:51.716152 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:36:51.857552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff635eddf0>]}
[0m07:36:51.858249 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:36:51.858624 [info ] [MainThread]: 
[0m07:36:51.864986 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:36:51.865387 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:36:51.865863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:36:51.866171 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:36:51.870801 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:36:51.866375 => 07:36:51.870649
[0m07:36:51.871105 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:36:51.905156 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:51.906147 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:51.906394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:52.341931 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:36:52.355621 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:52.356537 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:52.442861 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:52.456206 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:52.457070 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:36:52.578722 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:36:52.609260 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:36:52.609842 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:52.787561 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-1ab7-000f-c0df0089e5a2
[0m07:36:52.788484 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:52.789371 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:36:51.871332 => 07:36:52.789057
[0m07:36:52.789927 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:36:52.939438 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:52.940773 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6332bf80>]}
[0m07:36:52.942103 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.07s]
[0m07:36:52.943092 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:36:52.943783 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:52.945216 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:36:52.946477 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:36:52.947452 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:52.952297 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:36:52.947801 => 07:36:52.952054
[0m07:36:52.952752 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:52.957270 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:52.957646 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:36:52.958019 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:36:53.397346 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:36:53.404064 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:53.405043 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:53.507868 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:53.511948 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:53.512352 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:36:53.590236 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:36:53.594713 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:36:53.595045 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  cast(coin_id || '|' || to_varchar(timestamp) as string) as BUSINESS_KEY
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            BUSINESS_KEY as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(BUSINESS_KEY as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            BUSINESS_KEY as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:36:53.778215 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e88-0307-18e5-000f-c0df00897d52
[0m07:36:53.779434 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:36:53.780308 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:36:52.953073 => 07:36:53.780001
[0m07:36:53.780907 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:36:53.958755 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:53.960062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2fe64ca-7487-4f55-83c0-60489c30055f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63329850>]}
[0m07:36:53.961385 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.01s]
[0m07:36:53.962281 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:36:53.965019 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:36:53.965548 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:36:53.965924 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:36:53.966389 [info ] [MainThread]: 
[0m07:36:53.966893 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.21 seconds (4.21s).
[0m07:36:53.968059 [debug] [MainThread]: Command end result
[0m07:36:53.979162 [info ] [MainThread]: 
[0m07:36:53.979607 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:36:53.980075 [info ] [MainThread]: 
[0m07:36:53.980490 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 25 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:53.980931 [info ] [MainThread]: 
[0m07:36:53.981533 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:36:53.981999 [info ] [MainThread]: 
[0m07:36:53.982475 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:36:53.983582 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 4.652883, "process_user_time": 2.57328, "process_kernel_time": 0.171151, "process_mem_max_rss": "215884", "process_out_blocks": "1818", "command_success": false, "process_in_blocks": "0"}
[0m07:36:53.984060 [debug] [MainThread]: Command `dbt snapshot` failed at 07:36:53.983969 after 4.65 seconds
[0m07:36:53.984374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff889ffe60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63e4e930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff635eea20>]}
[0m07:36:53.984674 [debug] [MainThread]: Flushing usage events
[0m07:39:12.232753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4edab70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5251970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4f7b560>]}


============================== 07:39:12.235784 | b7db34f5-9216-4d13-8a94-12d0b08139fb ==============================
[0m07:39:12.235784 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:39:12.236076 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot', 'send_anonymous_usage_stats': 'True'}
[0m07:39:12.602227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91f86000>]}
[0m07:39:12.632493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ff25eb0>]}
[0m07:39:12.632825 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:39:12.636587 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:39:12.649314 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:39:12.649589 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_ohlc.sql
[0m07:39:12.649801 [debug] [MainThread]: Partial parsing: updated file: btc_elt://snapshots/snap_btc_market.sql
[0m07:39:12.728535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f95e0f0>]}
[0m07:39:12.733725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fbf11c0>]}
[0m07:39:12.733953 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:39:12.734159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fc22a20>]}
[0m07:39:12.735007 [info ] [MainThread]: 
[0m07:39:12.735396 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:39:12.736021 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:39:12.741407 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:39:12.741590 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:39:12.741741 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:39:13.305734 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:39:13.309096 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:39:13.452556 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m07:39:13.464428 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:39:13.465206 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:39:13.465795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:39:13.902777 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:39:13.906120 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:39:14.058287 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:39:14.063793 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:39:14.064497 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:39:14.065522 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:39:14.524739 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:39:14.527841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:39:14.698865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f7601a0>]}
[0m07:39:14.700152 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:39:14.700766 [info ] [MainThread]: 
[0m07:39:14.711618 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:39:14.712262 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:39:14.713154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:39:14.713614 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:39:14.722738 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:39:14.713903 => 07:39:14.721981
[0m07:39:14.723507 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:39:14.756629 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:14.756990 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:39:14.757293 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:39:15.237251 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:39:15.249070 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:15.249818 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:39:15.361191 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:39:15.371712 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:15.372408 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:39:15.466030 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.0 seconds
[0m07:39:15.497110 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:39:15.497619 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:39:15.633843 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e8b-0307-1ab7-000f-c0df0089e662
[0m07:39:15.634890 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:39:15.635782 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:39:14.724072 => 07:39:15.635485
[0m07:39:15.636338 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:39:15.763777 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:15.765096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f9c7020>]}
[0m07:39:15.766312 [error] [Thread-1 (]: 1 of 2 ERROR snapshotting snapshot.snap_btc_market ............................. [[31mERROR[0m in 1.05s]
[0m07:39:15.767159 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:39:15.767897 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:15.769681 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:39:15.770889 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:39:15.771568 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:15.775860 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:39:15.772123 => 07:39:15.775590
[0m07:39:15.776345 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:15.780525 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:15.780924 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:39:15.781296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:39:16.335295 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:39:16.341470 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:16.342339 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:39:16.451442 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:39:16.458970 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:16.459564 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:39:16.535117 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:39:16.547958 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:39:16.548804 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:39:16.673924 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c08e8b-0307-19fd-000f-c0df008a138a
[0m07:39:16.674959 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 27 at position 12
invalid identifier 'BUSINESS_KEY'
[0m07:39:16.675845 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:39:15.776676 => 07:39:16.675526
[0m07:39:16.676532 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:39:16.826976 [debug] [Thread-1 (]: Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 27 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:16.828325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7db34f5-9216-4d13-8a94-12d0b08139fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d917cb0>]}
[0m07:39:16.829560 [error] [Thread-1 (]: 2 of 2 ERROR snapshotting snapshot.snap_btc_ohlc ............................... [[31mERROR[0m in 1.06s]
[0m07:39:16.830532 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:39:16.833626 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:39:16.834155 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m07:39:16.834519 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:39:16.834951 [info ] [MainThread]: 
[0m07:39:16.835852 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 4.10 seconds (4.10s).
[0m07:39:16.837474 [debug] [MainThread]: Command end result
[0m07:39:16.851210 [info ] [MainThread]: 
[0m07:39:16.851773 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m07:39:16.852065 [info ] [MainThread]: 
[0m07:39:16.852626 [error] [MainThread]:   Database Error in snapshot snap_btc_market (snapshots/snap_btc_market.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:16.853110 [info ] [MainThread]: 
[0m07:39:16.853515 [error] [MainThread]:   Database Error in snapshot snap_btc_ohlc (snapshots/snap_btc_ohlc.sql)
  000904 (42000): SQL compilation error: error line 27 at position 12
  invalid identifier 'BUSINESS_KEY'
[0m07:39:16.854058 [info ] [MainThread]: 
[0m07:39:16.854519 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
[0m07:39:16.855560 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 4.6450443, "process_user_time": 2.722059, "process_kernel_time": 0.163604, "process_mem_max_rss": "219188", "process_out_blocks": "2692", "command_success": false, "process_in_blocks": "0"}
[0m07:39:16.856128 [debug] [MainThread]: Command `dbt snapshot` failed at 07:39:16.855943 after 4.65 seconds
[0m07:39:16.856596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4e96bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f9e5970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5251970>]}
[0m07:39:16.856976 [debug] [MainThread]: Flushing usage events
[0m07:41:23.788643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93edaff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94508b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff943dfe00>]}


============================== 07:41:23.791813 | bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1 ==============================
[0m07:41:23.791813 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:41:23.792122 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt compile -s snap_btc_market', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:41:24.146737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f50b410>]}
[0m07:41:24.177364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ed5d6a0>]}
[0m07:41:24.177734 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:41:24.181726 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:41:24.194952 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:41:24.195138 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:41:24.197432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93ed8c50>]}
[0m07:41:24.203326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6eae1430>]}
[0m07:41:24.203538 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:41:24.203745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ec2f320>]}
[0m07:41:24.204482 [info ] [MainThread]: 
[0m07:41:24.204949 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:41:24.205525 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:41:24.211361 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:41:24.211528 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:41:24.211660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:41:24.807669 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:41:24.811149 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:41:24.961494 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:41:24.967055 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:41:24.967752 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:41:24.968295 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:41:25.456704 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:41:25.461442 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:41:25.601770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfad7388-6326-4cb4-8fb2-f84d4dfaf4c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7465f1d0>]}
[0m07:41:25.604109 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:41:25.605001 [info ] [MainThread]: 
[0m07:41:25.616621 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:41:25.617596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:41:25.618072 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:41:25.625258 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:41:25.618374 => 07:41:25.625034
[0m07:41:25.625671 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:41:25.626127 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:41:25.625964 => 07:41:25.625980
[0m07:41:25.626847 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:41:25.627847 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:41:25.628203 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_market' was properly closed.
[0m07:41:25.628761 [debug] [MainThread]: Command end result
[0m07:41:25.636632 [info ] [MainThread]: Compiled node 'snap_btc_market' is:




select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

[0m07:41:25.637438 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 1.8710045, "process_user_time": 2.27418, "process_kernel_time": 0.180331, "process_mem_max_rss": "212060", "process_out_blocks": "1779", "process_in_blocks": "0"}
[0m07:41:25.637856 [debug] [MainThread]: Command `dbt compile` succeeded at 07:41:25.637751 after 1.87 seconds
[0m07:41:25.638144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9479dac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ea75280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93dd8770>]}
[0m07:41:25.638408 [debug] [MainThread]: Flushing usage events
[0m07:48:12.199985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6097680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa63de030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6095310>]}


============================== 07:48:12.202948 | 73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0 ==============================
[0m07:48:12.202948 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:48:12.203256 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot -s snap_btc_market', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:48:12.569786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff850fb380>]}
[0m07:48:12.599164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86aba330>]}
[0m07:48:12.599547 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:48:12.603385 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:48:12.618192 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:48:12.618360 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:48:12.620600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e0df70>]}
[0m07:48:12.625844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84d352b0>]}
[0m07:48:12.626047 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:48:12.626253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8515dc40>]}
[0m07:48:12.626928 [info ] [MainThread]: 
[0m07:48:12.627329 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:48:12.627955 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:48:12.632955 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:48:12.633117 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:48:12.633244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:48:13.199929 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:48:13.202295 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:48:13.381902 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m07:48:13.393806 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:48:13.394371 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:48:13.394888 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:13.948386 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:48:13.951674 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:48:14.119046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:48:14.122806 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:48:14.123526 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:48:14.124070 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:48:14.610906 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:48:14.613782 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:48:14.749446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6096540>]}
[0m07:48:14.750533 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:48:14.750899 [info ] [MainThread]: 
[0m07:48:14.758429 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:48:14.758921 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:48:14.759714 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:48:14.760075 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:48:14.765794 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:48:14.760296 => 07:48:14.765602
[0m07:48:14.766108 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:48:14.799830 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m07:48:14.801346 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:48:14.801601 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_market
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

    ) sbq



        );
[0m07:48:14.801840 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:48:16.597839 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:48:16.624992 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:48:14.766308 => 07:48:16.624730
[0m07:48:16.625640 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:48:16.777661 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73ab8f9b-be83-4ed5-9be1-ae6a73e3efb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f693a0>]}
[0m07:48:16.779354 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 1[0m in 2.02s]
[0m07:48:16.780463 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:48:16.783590 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:48:16.784177 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_market' was properly closed.
[0m07:48:16.784698 [info ] [MainThread]: 
[0m07:48:16.785267 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 4.16 seconds (4.16s).
[0m07:48:16.786673 [debug] [MainThread]: Command end result
[0m07:48:16.800147 [info ] [MainThread]: 
[0m07:48:16.800769 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:48:16.801317 [info ] [MainThread]: 
[0m07:48:16.801895 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:48:16.803347 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 4.6235895, "process_user_time": 2.456076, "process_kernel_time": 0.181707, "process_mem_max_rss": "212836", "process_out_blocks": "1786", "process_in_blocks": "0"}
[0m07:48:16.804005 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:48:16.803865 after 4.62 seconds
[0m07:48:16.804463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa64a6240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e0ed50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa63de030>]}
[0m07:48:16.804942 [debug] [MainThread]: Flushing usage events
[0m07:49:26.876796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa60426c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6042810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa60427b0>]}


============================== 07:49:26.879909 | ce797d46-84b1-443c-894f-99ecbf1450dc ==============================
[0m07:49:26.879909 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:49:26.880365 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot -s snap_btc_ohlc', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:49:27.223518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85411a30>]}
[0m07:49:27.252983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c323c0>]}
[0m07:49:27.253335 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:49:27.257222 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:49:27.270900 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:49:27.271082 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:49:27.273264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff850cb920>]}
[0m07:49:27.278946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84edce60>]}
[0m07:49:27.279173 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:49:27.279383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e0ddf0>]}
[0m07:49:27.280027 [info ] [MainThread]: 
[0m07:49:27.280421 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:49:27.280998 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:49:27.285788 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:49:27.285967 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:49:27.286102 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:49:27.749343 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:49:27.751164 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:49:27.876072 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:49:27.884208 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:49:27.885179 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:49:27.885483 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:49:28.293826 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m07:49:28.297260 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:49:28.440470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:49:28.443951 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:49:28.444466 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:49:28.445193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:49:29.604219 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.0 seconds
[0m07:49:29.608139 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:49:29.736976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84c76c30>]}
[0m07:49:29.738726 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:49:29.739377 [info ] [MainThread]: 
[0m07:49:29.752314 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:29.753205 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:49:29.754247 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:49:29.754729 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:29.762432 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:49:29.755037 => 07:49:29.762201
[0m07:49:29.762854 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:29.801811 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m07:49:29.803109 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:49:29.803337 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace transient table USER_DB_PEACOCK.snapshot.snap_btc_ohlc
         as
        (

    select *,
        md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

    ) sbq



        );
[0m07:49:29.803541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:49:31.255015 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:49:31.278971 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:49:29.763117 => 07:49:31.278749
[0m07:49:31.279504 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:49:31.461157 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce797d46-84b1-443c-894f-99ecbf1450dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f9b140>]}
[0m07:49:31.462806 [info ] [Thread-1 (]: 1 of 1 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 1[0m in 1.71s]
[0m07:49:31.464071 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:49:31.467144 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:49:31.467673 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:49:31.468147 [info ] [MainThread]: 
[0m07:49:31.468681 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 4.19 seconds (4.19s).
[0m07:49:31.469859 [debug] [MainThread]: Command end result
[0m07:49:31.484992 [info ] [MainThread]: 
[0m07:49:31.485580 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:49:31.486150 [info ] [MainThread]: 
[0m07:49:31.486746 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:49:31.487954 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 4.632018, "process_user_time": 2.416763, "process_kernel_time": 0.158115, "process_mem_max_rss": "212988", "process_out_blocks": "1786", "process_in_blocks": "0"}
[0m07:49:31.488543 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:49:31.488411 after 4.63 seconds
[0m07:49:31.488909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6088a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f40e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84f69970>]}
[0m07:49:31.489269 [debug] [MainThread]: Flushing usage events
[0m07:50:30.363668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab625460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab625190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab625b80>]}


============================== 07:50:30.366576 | 694362e4-900c-4655-a9bd-039771c4d90d ==============================
[0m07:50:30.366576 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:50:30.366840 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:50:30.754920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86517080>]}
[0m07:50:30.785624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87181c70>]}
[0m07:50:30.785971 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:50:30.789834 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:50:30.802537 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:50:30.802707 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:50:30.804902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8648f140>]}
[0m07:50:30.806705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86429430>]}
[0m07:50:30.806900 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:50:30.807119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86379b20>]}
[0m07:50:30.807892 [info ] [MainThread]: 
[0m07:50:30.808290 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:50:30.808804 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m07:50:30.814931 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:50:30.815109 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:50:30.815251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:50:31.336192 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m07:50:31.339866 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:50:31.469199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:50:31.477169 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:50:31.477750 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:50:31.478210 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:50:32.093094 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:50:32.094422 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:50:32.239058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '694362e4-900c-4655-a9bd-039771c4d90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8733a9f0>]}
[0m07:50:32.239803 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:50:32.240173 [info ] [MainThread]: 
[0m07:50:32.247479 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:50:32.247981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m07:50:32.248278 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:50:32.253301 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:50:32.254965 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:50:32.248507 => 07:50:32.254818
[0m07:50:32.255530 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:50:32.255809 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:50:32.256258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:50:32.256533 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:50:32.258684 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:50:32.259219 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:50:32.256737 => 07:50:32.259108
[0m07:50:32.259674 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:50:32.259914 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:50:32.260291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now snapshot.btc_elt.snap_btc_market)
[0m07:50:32.260535 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:50:32.262221 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:50:32.260669 => 07:50:32.262114
[0m07:50:32.262424 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:50:32.262639 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:50:32.262547 => 07:50:32.262553
[0m07:50:32.263061 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:50:32.263272 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.263584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:50:32.263770 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.265356 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:50:32.263891 => 07:50:32.265250
[0m07:50:32.265635 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.265889 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:50:32.265780 => 07:50:32.265786
[0m07:50:32.266377 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:50:32.266623 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:50:32.267000 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:50:32.267181 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:50:32.286554 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:50:32.287324 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:50:32.267301 => 07:50:32.287235
[0m07:50:32.287502 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:50:32.287717 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:50:32.287633 => 07:50:32.287637
[0m07:50:32.288097 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:50:32.288468 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.288784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.fct_btc_indicators, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:50:32.289000 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.294289 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:50:32.295010 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:50:32.289107 => 07:50:32.294915
[0m07:50:32.295175 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.295348 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:50:32.295275 => 07:50:32.295278
[0m07:50:32.295685 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:50:32.295865 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.296143 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:50:32.296296 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.297874 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:50:32.298464 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:50:32.296397 => 07:50:32.298381
[0m07:50:32.298621 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.298793 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:50:32.298718 => 07:50:32.298721
[0m07:50:32.299133 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:50:32.299429 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.299794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:50:32.299982 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.302597 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:50:32.303038 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:50:32.300090 => 07:50:32.302957
[0m07:50:32.303199 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.303373 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:50:32.303300 => 07:50:32.303303
[0m07:50:32.303696 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:50:32.304198 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:50:32.304352 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:50:32.304789 [debug] [MainThread]: Command end result
[0m07:50:32.311724 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m07:50:32.311882 [info ] [MainThread]: Building catalog
[0m07:50:32.312951 [debug] [ThreadPool]: Acquiring new snowflake connection 'USER_DB_PEACOCK.information_schema'
[0m07:50:32.317353 [debug] [ThreadPool]: Using snowflake connection "USER_DB_PEACOCK.information_schema"
[0m07:50:32.317575 [debug] [ThreadPool]: On USER_DB_PEACOCK.information_schema: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "USER_DB_PEACOCK.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        coalesce(table_type, 'DYNAMIC TABLE') as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from USER_DB_PEACOCK.INFORMATION_SCHEMA.tables
            where (
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_market_daily')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_market')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('fct_btc_indicators')
                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from USER_DB_PEACOCK.INFORMATION_SCHEMA.columns
            where (
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_market_daily')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_market')
                )
             or 
                (
                    upper("table_schema") = upper('snapshot')
                    and upper("table_name") = upper('snap_btc_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('raw')
                    and upper("table_name") = upper('coin_gecko_ohlc')
                )
             or 
                (
                    upper("table_schema") = upper('analytics')
                    and upper("table_name") = upper('fct_btc_indicators')
                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m07:50:32.317765 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:50:35.292517 [debug] [ThreadPool]: SQL status: SUCCESS 50 in 3.0 seconds
[0m07:50:35.304350 [debug] [ThreadPool]: On USER_DB_PEACOCK.information_schema: Close
[0m07:50:35.487272 [info ] [MainThread]: Catalog written to /opt/airflow/dbt/btc_elt/target/catalog.json
[0m07:50:35.488798 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 5.1467156, "process_user_time": 2.40698, "process_kernel_time": 0.16464, "process_mem_max_rss": "212376", "process_out_blocks": "4825", "process_in_blocks": "0"}
[0m07:50:35.489413 [debug] [MainThread]: Command `dbt docs generate` succeeded at 07:50:35.489292 after 5.15 seconds
[0m07:50:35.489759 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m07:50:35.489983 [debug] [MainThread]: Connection 'USER_DB_PEACOCK.information_schema' was properly closed.
[0m07:50:35.490246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff869b3110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff861c6ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8661ba40>]}
[0m07:50:35.490629 [debug] [MainThread]: Flushing usage events
[0m07:51:55.791133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a77dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cc0f9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aac5730>]}


============================== 07:51:55.794014 | af9fdc08-5c98-4fc2-8a15-04929d5c3a76 ==============================
[0m07:51:55.794014 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:51:55.794349 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt docs serve', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:51:56.140954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af9fdc08-5c98-4fc2-8a15-04929d5c3a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff779da930>]}
[0m07:51:56.171627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af9fdc08-5c98-4fc2-8a15-04929d5c3a76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69b070b0>]}
[0m07:51:56.174042 [error] [MainThread]: Encountered an error:
[Errno 98] Address already in use
[0m07:51:56.174829 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 91, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 76, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 169, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 198, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 245, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/main.py", line 325, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/task/serve.py", line 24, in run
    with socketserver.TCPServer((host, port), SimpleHTTPRequestHandler) as httpd:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socketserver.py", line 457, in __init__
    self.server_bind()
  File "/usr/local/lib/python3.12/socketserver.py", line 473, in server_bind
    self.socket.bind(self.server_address)
OSError: [Errno 98] Address already in use

[0m07:51:56.175402 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 0.40570313, "process_user_time": 2.063335, "process_kernel_time": 0.109977, "process_mem_max_rss": "202136", "process_out_blocks": "2938", "command_success": false, "process_in_blocks": "0"}
[0m07:51:56.175670 [debug] [MainThread]: Command `dbt docs serve` failed at 07:51:56.175612 after 0.41 seconds
[0m07:51:56.175857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f80b260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff696107a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ae1f530>]}
[0m07:51:56.176040 [debug] [MainThread]: Flushing usage events


============================== 07:55:21.609537 | 8c70c1bd-5f8f-4bb6-b21e-723291fce54b ==============================
[0m07:55:21.609537 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:55:21.612747 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8081 --host 0.0.0.0', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'False'}
[0m08:11:33.018805 [error] [MainThread]: Encountered an error:

[0m08:11:33.040875 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 91, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 76, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 169, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 198, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/requires.py", line 245, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/cli/main.py", line 325, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/dbt/task/serve.py", line 29, in run
    httpd.serve_forever()
  File "/usr/local/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m08:11:33.055383 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 971.4707, "process_user_time": 2.302042, "process_kernel_time": 0.18237, "process_mem_max_rss": "202240", "process_out_blocks": "2936", "command_success": false, "process_in_blocks": "0"}
[0m08:11:33.059442 [debug] [MainThread]: Command `dbt docs serve` failed at 08:11:33.059004 after 971.48 seconds
[0m08:11:33.061442 [debug] [MainThread]: Flushing usage events
[0m08:12:53.636226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff990bc320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9952a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff990bcb00>]}


============================== 08:12:53.639189 | 5e2498ad-37a1-40be-84ed-4ac3b3392bdf ==============================
[0m08:12:53.639189 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:12:53.639649 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:12:54.078818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff781f7bc0>]}
[0m08:12:54.111866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78e91160>]}
[0m08:12:54.112224 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:12:54.115863 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:12:54.129795 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:12:54.129967 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:12:54.132245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73ef1f10>]}
[0m08:12:54.139041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73c606b0>]}
[0m08:12:54.139264 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:12:54.139577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff990b93a0>]}
[0m08:12:54.140281 [info ] [MainThread]: 
[0m08:12:54.140661 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:12:54.141216 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:12:54.146495 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:12:54.146650 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:12:54.146802 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:12:54.683117 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:12:54.686685 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:12:54.844438 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m08:12:54.850660 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:12:54.850961 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:12:54.851193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:12:55.419907 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m08:12:55.421101 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:12:55.572927 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:12:55.574386 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:12:55.574566 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:12:55.574864 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:12:56.008898 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:12:56.011987 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:12:56.150134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98e0d220>]}
[0m08:12:56.151192 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:12:56.152545 [info ] [MainThread]: 
[0m08:12:56.162132 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:12:56.162721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m08:12:56.162996 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:12:56.169005 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:12:56.171304 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:12:56.163183 => 08:12:56.171101
[0m08:12:56.171993 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:12:56.172304 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:12:56.172953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:12:56.173179 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:12:56.175535 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:12:56.177510 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:12:56.173351 => 08:12:56.177342
[0m08:12:56.178261 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:12:56.178990 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:12:56.179319 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:12:56.180357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:12:56.180611 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:12:56.205249 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:12:56.206269 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:12:56.180816 => 08:12:56.206164
[0m08:12:56.206480 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:12:56.218378 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:12:56.221033 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:12:56.221316 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:12:56.221623 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:12:58.874894 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m08:12:58.900502 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:12:56.206619 => 08:12:58.900270
[0m08:12:58.900967 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:12:59.219731 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e2498ad-37a1-40be-84ed-4ac3b3392bdf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73b3b9e0>]}
[0m08:12:59.221525 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 3.04s]
[0m08:12:59.224105 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:12:59.227111 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:12:59.227795 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:12:59.228245 [info ] [MainThread]: 
[0m08:12:59.229240 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.09 seconds (5.09s).
[0m08:12:59.230063 [debug] [MainThread]: Command end result
[0m08:12:59.242381 [info ] [MainThread]: 
[0m08:12:59.243118 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:12:59.243430 [info ] [MainThread]: 
[0m08:12:59.243944 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:12:59.245319 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.632635, "process_user_time": 2.465758, "process_kernel_time": 0.237736, "process_mem_max_rss": "212540", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:12:59.245784 [debug] [MainThread]: Command `dbt run` succeeded at 08:12:59.245693 after 5.63 seconds
[0m08:12:59.246125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99150ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff796ea210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73dbcbf0>]}
[0m08:12:59.246427 [debug] [MainThread]: Flushing usage events
[0m08:13:01.310459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaae26a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9fc530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaae24ef0>]}


============================== 08:13:01.313171 | 065f39ea-b5d1-4063-90eb-af525c51e40b ==============================
[0m08:13:01.313171 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:13:01.313879 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:13:01.682125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a98cef0>]}
[0m08:13:01.713559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a3b3830>]}
[0m08:13:01.714003 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:13:01.717537 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:13:01.730646 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:13:01.730826 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:13:01.733224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89bc0bc0>]}
[0m08:13:01.738912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89c2cad0>]}
[0m08:13:01.739152 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:13:01.739473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89b60920>]}
[0m08:13:01.740346 [info ] [MainThread]: 
[0m08:13:01.740808 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:13:01.741440 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m08:13:01.747351 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:13:01.747539 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:13:01.747682 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:13:02.233504 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:13:02.237285 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:13:02.382669 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:13:02.389473 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:13:02.390280 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:13:02.390801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:13:02.774456 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:13:02.776183 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:13:02.912683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '065f39ea-b5d1-4063-90eb-af525c51e40b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89c2ea50>]}
[0m08:13:02.914097 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:13:02.915230 [info ] [MainThread]: 
[0m08:13:02.925578 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:02.926009 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:13:02.926679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:13:02.927022 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:02.938701 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:13:02.939847 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:13:02.927243 => 08:13:02.939705
[0m08:13:02.940094 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:02.950382 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:13:02.951407 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:13:02.951618 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:13:02.951851 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:03.688317 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:03.697704 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:13:02.940245 => 08:13:03.697387
[0m08:13:03.698190 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:13:03.882164 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.96s]
[0m08:13:03.883480 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:13:03.884231 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:03.884965 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:13:03.886480 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:13:03.887137 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:03.893230 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:13:03.895499 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:13:03.887614 => 08:13:03.895093
[0m08:13:03.896219 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:03.899390 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:13:03.900957 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:13:03.901413 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:13:03.901786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:04.487805 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:04.492038 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:13:03.896557 => 08:13:04.491676
[0m08:13:04.492758 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:13:04.628652 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.74s]
[0m08:13:04.630542 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:13:04.631229 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:04.631843 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:13:04.633529 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:13:04.634317 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:04.646344 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:13:04.647952 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:13:04.634959 => 08:13:04.647738
[0m08:13:04.648354 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:04.650706 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:13:04.652188 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:13:04.652594 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:13:04.652910 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:05.212608 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:05.216145 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:13:04.648600 => 08:13:05.215799
[0m08:13:05.216837 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:13:05.355026 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.72s]
[0m08:13:05.355769 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:13:05.357238 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:13:05.357509 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:13:05.357754 [info ] [MainThread]: 
[0m08:13:05.358201 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.62 seconds (3.62s).
[0m08:13:05.358911 [debug] [MainThread]: Command end result
[0m08:13:05.365423 [info ] [MainThread]: 
[0m08:13:05.365800 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:13:05.365975 [info ] [MainThread]: 
[0m08:13:05.366213 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:13:05.367076 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.078525, "process_user_time": 2.467058, "process_kernel_time": 0.11599, "process_mem_max_rss": "212276", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:13:05.367396 [debug] [MainThread]: Command `dbt test` succeeded at 08:13:05.367337 after 4.08 seconds
[0m08:13:05.367611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9fc530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab4412b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab210aa0>]}
[0m08:13:05.367804 [debug] [MainThread]: Flushing usage events
[0m08:13:07.561344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e49760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8611e6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff861701d0>]}


============================== 08:13:07.564165 | 961828e4-15e8-4f8a-9ee0-a24042eca661 ==============================
[0m08:13:07.564165 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:13:07.565483 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:13:07.971770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64adf3b0>]}
[0m08:13:08.004417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff648173e0>]}
[0m08:13:08.004924 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:13:08.009119 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:13:08.024367 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:13:08.024562 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:13:08.026861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ad04a0>]}
[0m08:13:08.032200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff647ac830>]}
[0m08:13:08.032410 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:13:08.032784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85a8e2a0>]}
[0m08:13:08.033552 [info ] [MainThread]: 
[0m08:13:08.033942 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:13:08.034525 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:13:08.039679 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:13:08.039841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:13:08.039959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:13:08.475273 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:13:08.477516 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:13:08.600260 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:13:08.610980 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:13:08.611626 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:13:08.612169 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:13:09.045253 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:13:09.048361 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:13:09.210522 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:13:09.215578 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:13:09.216199 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:13:09.217248 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:13:09.703881 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:13:09.706004 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:13:09.857369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff648158b0>]}
[0m08:13:09.858745 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:13:09.860328 [info ] [MainThread]: 
[0m08:13:09.871124 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:13:09.871594 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:13:09.872227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:13:09.872412 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:13:09.876789 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:13:09.872569 => 08:13:09.876657
[0m08:13:09.877018 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:13:09.903225 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:09.903559 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:13:09.903760 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:10.491825 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:13:10.504414 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:10.505135 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:10.589112 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:10.600229 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:10.600888 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:10.727890 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:10.751061 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:10.751958 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:13:11.989116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:11.993837 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:11.994929 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:13:12.117637 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:13:12.123491 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.124070 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:12.235569 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:12.241678 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.242475 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:13:12.341754 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:13:12.348319 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.349115 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:13:12.494538 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:13:12.506566 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.507507 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:13:12.613935 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:13:12.622885 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.625341 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.625795 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:13:12.754266 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:12.754821 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:12.755041 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:13:13.334168 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m08:13:13.335167 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:13:13.335508 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:13:13.721542 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:13.749570 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:13:09.877141 => 08:13:13.749213
[0m08:13:13.750143 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:13:13.884116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff642a2570>]}
[0m08:13:13.886575 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 4.01s]
[0m08:13:13.889349 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:13:13.890542 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:13.892026 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:13:13.893457 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:13:13.894035 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:13.899871 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:13:13.894398 => 08:13:13.899598
[0m08:13:13.900386 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:13.904540 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:13.904887 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:13:13.905229 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:13:14.561108 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:13:14.570115 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:14.571247 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:14.739552 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:14.747243 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:14.747764 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:14.886847 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:14.900654 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:14.901951 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:13:16.182128 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:16.188576 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.189201 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:13:16.320560 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:13:16.327428 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.328364 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:16.457748 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:16.460625 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.460987 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:13:16.602352 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:13:16.609170 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.610376 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:13:16.685957 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:13:16.690375 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.690752 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:13:16.780757 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:13:16.785459 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.788597 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.789200 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:13:16.942943 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:16.943302 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:16.943522 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:13:17.611810 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:13:17.612280 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:13:17.612525 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:13:18.177691 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:13:18.180098 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:13:13.900663 => 08:13:18.179885
[0m08:13:18.180411 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:13:18.295978 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '961828e4-15e8-4f8a-9ee0-a24042eca661', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64293fe0>]}
[0m08:13:18.298205 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.40s]
[0m08:13:18.299691 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:13:18.302121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:13:18.302355 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:13:18.302578 [info ] [MainThread]: 
[0m08:13:18.302921 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.27 seconds (10.27s).
[0m08:13:18.303476 [debug] [MainThread]: Command end result
[0m08:13:18.311358 [info ] [MainThread]: 
[0m08:13:18.311827 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:13:18.311976 [info ] [MainThread]: 
[0m08:13:18.312233 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:13:18.313966 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 10.773754, "process_user_time": 2.897732, "process_kernel_time": 0.254222, "process_mem_max_rss": "213948", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:13:18.314525 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:13:18.314442 after 10.77 seconds
[0m08:13:18.314928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ef3530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bee900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6483bef0>]}
[0m08:13:18.315114 [debug] [MainThread]: Flushing usage events


============================== 08:13:43.237381 | fbd3503e-9870-458b-b029-bac14cd59371 ==============================
[0m08:13:43.237381 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:13:43.240520 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt debug --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m08:13:43.240771 [info ] [MainThread]: dbt version: 1.7.19
[0m08:13:43.241043 [info ] [MainThread]: python version: 3.12.5
[0m08:13:43.241286 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m08:13:43.241533 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m08:13:43.557859 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m08:13:43.558234 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m08:13:43.558553 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/btc_elt/dbt_project.yml
[0m08:13:43.558885 [info ] [MainThread]: adapter type: snowflake
[0m08:13:43.559140 [info ] [MainThread]: adapter version: 1.7.0
[0m08:13:43.597558 [info ] [MainThread]: Configuration:
[0m08:13:43.597858 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:13:43.598098 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:13:43.598339 [info ] [MainThread]: Required dependencies:
[0m08:13:43.598575 [debug] [MainThread]: Executing "git --help"
[0m08:13:43.599114 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m08:13:43.599293 [info ] [MainThread]: Connection:
[0m08:13:43.599531 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m08:13:43.599790 [info ] [MainThread]:   user: PEACOCK
[0m08:13:43.600018 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m08:13:43.600188 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m08:13:43.600391 [info ] [MainThread]:   role: TRAINING_ROLE
[0m08:13:43.600590 [info ] [MainThread]:   schema: analytics
[0m08:13:43.600815 [info ] [MainThread]:   authenticator: None
[0m08:13:43.601060 [info ] [MainThread]:   private_key_path: None
[0m08:13:43.601285 [info ] [MainThread]:   token: None
[0m08:13:43.601519 [info ] [MainThread]:   oauth_client_id: None
[0m08:13:43.601726 [info ] [MainThread]:   query_tag: None
[0m08:13:43.601976 [info ] [MainThread]:   client_session_keep_alive: False
[0m08:13:43.602219 [info ] [MainThread]:   host: None
[0m08:13:43.602451 [info ] [MainThread]:   port: None
[0m08:13:43.602634 [info ] [MainThread]:   proxy_host: None
[0m08:13:43.602829 [info ] [MainThread]:   proxy_port: None
[0m08:13:43.603045 [info ] [MainThread]:   protocol: None
[0m08:13:43.603274 [info ] [MainThread]:   connect_retries: 1
[0m08:13:43.603501 [info ] [MainThread]:   connect_timeout: None
[0m08:13:43.603691 [info ] [MainThread]:   retry_on_database_errors: False
[0m08:13:43.603901 [info ] [MainThread]:   retry_all: False
[0m08:13:43.604142 [info ] [MainThread]:   insecure_mode: False
[0m08:13:43.604321 [info ] [MainThread]:   reuse_connections: None
[0m08:13:43.604564 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:13:43.604905 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m08:13:43.605199 [debug] [MainThread]: Using snowflake connection "debug"
[0m08:13:43.605356 [debug] [MainThread]: On debug: select 1 as id
[0m08:13:43.605502 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:13:44.049099 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:13:44.050339 [debug] [MainThread]: On debug: Close
[0m08:13:44.186750 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:13:44.187890 [info ] [MainThread]: [31m1 check failed:[0m
[0m08:13:44.188654 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m08:13:44.190741 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.9763269, "process_user_time": 2.187716, "process_kernel_time": 0.164354, "process_mem_max_rss": "205576", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m08:13:44.191657 [debug] [MainThread]: Command `dbt debug` failed at 08:13:44.191459 after 0.98 seconds
[0m08:13:44.192365 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:13:44.192889 [debug] [MainThread]: Flushing usage events
[0m08:31:13.304029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9958e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9d47080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9f56240>]}


============================== 08:31:13.308976 | c8002dba-2a5b-4be7-a5f8-ebb0d4814507 ==============================
[0m08:31:13.308976 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:31:13.309862 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:31:13.824118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8002dba-2a5b-4be7-a5f8-ebb0d4814507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3dcfbf0>]}
[0m08:31:13.858551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8002dba-2a5b-4be7-a5f8-ebb0d4814507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a04a9f0>]}
[0m08:31:13.859006 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:31:13.863031 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:31:13.877449 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:31:13.877677 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:31:13.880121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8002dba-2a5b-4be7-a5f8-ebb0d4814507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98937f80>]}
[0m08:31:13.886595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8002dba-2a5b-4be7-a5f8-ebb0d4814507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff984e0b00>]}
[0m08:31:13.886794 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:31:13.887125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8002dba-2a5b-4be7-a5f8-ebb0d4814507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3dcfb90>]}
[0m08:31:13.887903 [info ] [MainThread]: 
[0m08:31:13.888361 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:31:13.888959 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:31:13.894217 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:31:13.894388 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:31:13.894510 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:31:14.436105 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:31:14.438922 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:31:14.584864 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:31:14.608728 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:31:14.609437 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:31:14.609635 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:31:15.116382 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m08:31:15.118634 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:31:15.274853 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:31:15.277267 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:31:15.277512 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:31:15.277951 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:31:15.716019 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:31:15.717392 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:31:16.491529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8002dba-2a5b-4be7-a5f8-ebb0d4814507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98c0fdd0>]}
[0m08:31:16.493473 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:31:16.495554 [info ] [MainThread]: 
[0m08:31:16.507903 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:31:16.508927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:31:16.509395 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:31:16.518025 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:31:16.520328 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:31:16.509672 => 08:31:16.520146
[0m08:31:16.521023 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:31:16.521383 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:31:16.522135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:31:16.522416 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:31:16.524897 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:31:16.525744 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:31:16.522602 => 08:31:16.525605
[0m08:31:16.526312 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:31:16.526960 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:31:16.527301 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:31:16.528380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:31:16.528683 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:31:16.552898 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:31:16.553676 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:31:16.528850 => 08:31:16.553579
[0m08:31:16.553860 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:31:16.565961 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:31:16.568516 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:31:16.568796 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:31:16.569100 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:31:18.211552 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:31:18.231533 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:31:16.553984 => 08:31:18.231342
[0m08:31:18.231991 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:31:18.392949 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8002dba-2a5b-4be7-a5f8-ebb0d4814507', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9839bcb0>]}
[0m08:31:18.394571 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.86s]
[0m08:31:18.396427 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:31:18.399150 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:31:18.399655 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:31:18.400142 [info ] [MainThread]: 
[0m08:31:18.400877 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.51 seconds (4.51s).
[0m08:31:18.401803 [debug] [MainThread]: Command end result
[0m08:31:18.414185 [info ] [MainThread]: 
[0m08:31:18.414830 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:31:18.415130 [info ] [MainThread]: 
[0m08:31:18.415606 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:31:18.416793 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.149048, "process_user_time": 2.492851, "process_kernel_time": 0.201523, "process_mem_max_rss": "212664", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:31:18.417291 [debug] [MainThread]: Command `dbt run` succeeded at 08:31:18.417190 after 5.15 seconds
[0m08:31:18.417644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9d47080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b1b5cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8b91550>]}
[0m08:31:18.417934 [debug] [MainThread]: Flushing usage events
[0m08:31:20.474738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9c141a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9cac530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9c144a0>]}


============================== 08:31:20.477342 | cf3fb67e-ca15-40c1-89b1-16b49946da71 ==============================
[0m08:31:20.477342 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:31:20.477948 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:31:20.809596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cf3fb67e-ca15-40c1-89b1-16b49946da71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88dc6e40>]}
[0m08:31:20.839866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cf3fb67e-ca15-40c1-89b1-16b49946da71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88dc6e40>]}
[0m08:31:20.840295 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:31:20.843693 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:31:20.857441 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:31:20.857603 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:31:20.859813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cf3fb67e-ca15-40c1-89b1-16b49946da71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9c18740>]}
[0m08:31:20.864738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cf3fb67e-ca15-40c1-89b1-16b49946da71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88814320>]}
[0m08:31:20.864944 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:31:20.865228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf3fb67e-ca15-40c1-89b1-16b49946da71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88b03bc0>]}
[0m08:31:20.865949 [info ] [MainThread]: 
[0m08:31:20.866345 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:31:20.866964 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m08:31:20.872560 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:31:20.872709 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:31:20.872832 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:31:21.380377 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m08:31:21.383021 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:31:21.501616 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:31:21.505360 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:31:21.505754 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:31:21.506067 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:31:21.943092 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:31:21.945971 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:31:22.130489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf3fb67e-ca15-40c1-89b1-16b49946da71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88816660>]}
[0m08:31:22.131501 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:31:22.132180 [info ] [MainThread]: 
[0m08:31:22.137769 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:31:22.138096 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:31:22.138677 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:31:22.138893 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:31:22.147812 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:31:22.148763 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:31:22.139038 => 08:31:22.148638
[0m08:31:22.148962 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:31:22.157671 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:31:22.158464 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:31:22.158666 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:31:22.158820 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:31:22.677933 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:31:22.691080 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:31:22.149098 => 08:31:22.690475
[0m08:31:22.692037 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:31:22.842001 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.70s]
[0m08:31:22.843533 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:31:22.844321 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:31:22.845083 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:31:22.846472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:31:22.847130 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:31:22.853880 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:31:22.855665 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:31:22.847515 => 08:31:22.855353
[0m08:31:22.856169 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:31:22.858831 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:31:22.860125 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:31:22.860559 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:31:22.860993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:31:23.589848 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:31:23.594253 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:31:22.856503 => 08:31:23.593877
[0m08:31:23.594997 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:31:23.744280 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.90s]
[0m08:31:23.746389 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:31:23.747203 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:31:23.747825 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:31:23.749142 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:31:23.749678 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:31:23.761365 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:31:23.763435 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:31:23.750014 => 08:31:23.763215
[0m08:31:23.763835 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:31:23.766312 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:31:23.767642 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:31:23.768036 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:31:23.768367 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:31:24.271112 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:31:24.274952 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:31:23.764068 => 08:31:24.274456
[0m08:31:24.275556 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:31:24.406223 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.66s]
[0m08:31:24.408068 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:31:24.413190 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:31:24.414283 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:31:24.415348 [info ] [MainThread]: 
[0m08:31:24.417256 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.55 seconds (3.55s).
[0m08:31:24.420652 [debug] [MainThread]: Command end result
[0m08:31:24.436234 [info ] [MainThread]: 
[0m08:31:24.437176 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:31:24.437406 [info ] [MainThread]: 
[0m08:31:24.437693 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:31:24.439257 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.9848702, "process_user_time": 2.404287, "process_kernel_time": 0.113913, "process_mem_max_rss": "212296", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:31:24.440565 [debug] [MainThread]: Command `dbt test` succeeded at 08:31:24.440406 after 3.99 seconds
[0m08:31:24.440984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9cac530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaeab8b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88bff080>]}
[0m08:31:24.441369 [debug] [MainThread]: Flushing usage events
[0m08:31:26.461794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91cccf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ff9ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ff98a40>]}


============================== 08:31:26.464503 | e74ef013-585b-4216-b6bc-fc8ad2dc7c41 ==============================
[0m08:31:26.464503 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:31:26.464936 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:31:26.825362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff912ed280>]}
[0m08:31:26.856641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff703fa750>]}
[0m08:31:26.856969 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:31:26.860234 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:31:26.873562 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:31:26.873720 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:31:26.875815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6adb2030>]}
[0m08:31:26.881874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6acc04d0>]}
[0m08:31:26.882078 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:31:26.882383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff910d0380>]}
[0m08:31:26.883065 [info ] [MainThread]: 
[0m08:31:26.883434 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:31:26.883988 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:31:26.889148 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:31:26.889299 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:31:26.889432 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:31:27.439819 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:31:27.442055 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:31:27.583884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m08:31:27.594810 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:31:27.595472 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:31:27.595956 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:31:28.075684 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:31:28.079098 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:31:28.228585 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:31:28.233573 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:31:28.234290 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:31:28.235692 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:31:28.758688 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m08:31:28.760826 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:31:28.917229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6aa54aa0>]}
[0m08:31:28.918834 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:31:28.920534 [info ] [MainThread]: 
[0m08:31:28.933060 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:31:28.933758 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:31:28.934949 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m08:31:28.935322 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:31:28.942787 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:31:28.935571 => 08:31:28.942609
[0m08:31:28.943082 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:31:28.974812 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:28.975043 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:31:28.975276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:31:29.518893 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:31:29.531985 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:29.533122 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:31:29.665135 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:31:29.676753 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:29.677341 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:31:29.798008 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:31:29.825569 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:29.826046 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:31:31.167540 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:31:31.172270 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.172921 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:31:31.296705 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:31:31.302960 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.303704 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:31:31.423237 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:31:31.427967 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.428444 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:31:31.515872 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:31:31.523165 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.524223 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:31:31.627253 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:31:31.636877 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.637465 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:31:31.720322 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:31:31.729061 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.731190 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.731463 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:31:31.857349 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:31:31.858385 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:31.859099 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:31:32.907139 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m08:31:32.909360 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:31:32.910133 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:31:33.324164 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:31:33.338753 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:31:28.943266 => 08:31:33.338559
[0m08:31:33.339050 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:31:33.507344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69f93f50>]}
[0m08:31:33.509123 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 4.57s]
[0m08:31:33.511690 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:31:33.512597 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:31:33.513324 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:31:33.514590 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:31:33.515118 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:31:33.520350 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:31:33.515504 => 08:31:33.519939
[0m08:31:33.520920 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:31:33.525825 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:33.526203 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:31:33.526585 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:31:34.104829 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:31:34.110573 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:34.111736 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:31:34.198631 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:31:34.204278 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:34.204869 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:31:34.327793 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:31:34.338332 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:34.339358 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:31:35.620603 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:31:35.625893 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:35.626515 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:31:35.716375 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:31:35.720729 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:35.721180 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:31:35.826695 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:31:35.831584 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:35.832089 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:31:35.927371 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:31:35.932175 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:35.932663 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:31:36.072653 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:31:36.077713 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:36.078210 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:31:36.196512 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:31:36.200071 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:36.202376 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:36.202851 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:31:36.350863 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:31:36.351695 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:36.352344 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:31:37.000217 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:31:37.000870 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:31:37.001047 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:31:37.517501 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:31:37.520435 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:31:33.521227 => 08:31:37.520257
[0m08:31:37.520786 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:31:37.643731 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e74ef013-585b-4216-b6bc-fc8ad2dc7c41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69f7d130>]}
[0m08:31:37.644542 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.13s]
[0m08:31:37.646835 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:31:37.650151 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:31:37.650386 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:31:37.650657 [info ] [MainThread]: 
[0m08:31:37.651054 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.77 seconds (10.77s).
[0m08:31:37.651587 [debug] [MainThread]: Command end result
[0m08:31:37.659140 [info ] [MainThread]: 
[0m08:31:37.659550 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:31:37.659745 [info ] [MainThread]: 
[0m08:31:37.660056 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:31:37.662009 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.220645, "process_user_time": 2.67748, "process_kernel_time": 0.167532, "process_mem_max_rss": "214188", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:31:37.663236 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:31:37.663166 after 11.22 seconds
[0m08:31:37.663838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ffec950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ae80650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ff947a0>]}
[0m08:31:37.664033 [debug] [MainThread]: Flushing usage events


============================== 08:32:43.558260 | 19670d82-11b6-4109-8a25-6522dd5bc58c ==============================
[0m08:32:43.558260 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:32:43.561368 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'False'}
[0m08:32:43.561612 [info ] [MainThread]: dbt version: 1.7.19
[0m08:32:43.561857 [info ] [MainThread]: python version: 3.12.5
[0m08:32:43.562113 [info ] [MainThread]: python path: /home/airflow/.local/bin/python
[0m08:32:43.562314 [info ] [MainThread]: os info: Linux-6.10.14-linuxkit-aarch64-with-glibc2.36
[0m08:32:43.888664 [info ] [MainThread]: Using profiles dir at /opt/airflow/dbt
[0m08:32:43.889067 [info ] [MainThread]: Using profiles.yml file at /opt/airflow/dbt/profiles.yml
[0m08:32:43.889356 [info ] [MainThread]: Using dbt_project.yml file at /opt/airflow/dbt/btc_elt/dbt_project.yml
[0m08:32:43.889724 [info ] [MainThread]: adapter type: snowflake
[0m08:32:43.889953 [info ] [MainThread]: adapter version: 1.7.0
[0m08:32:43.929578 [info ] [MainThread]: Configuration:
[0m08:32:43.929845 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:32:43.930181 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:32:43.930411 [info ] [MainThread]: Required dependencies:
[0m08:32:43.930690 [debug] [MainThread]: Executing "git --help"
[0m08:32:43.931214 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m08:32:43.931458 [info ] [MainThread]: Connection:
[0m08:32:43.931670 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m08:32:43.931928 [info ] [MainThread]:   user: PEACOCK
[0m08:32:43.932130 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m08:32:43.932343 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m08:32:43.932550 [info ] [MainThread]:   role: TRAINING_ROLE
[0m08:32:43.932780 [info ] [MainThread]:   schema: analytics
[0m08:32:43.932998 [info ] [MainThread]:   authenticator: None
[0m08:32:43.933229 [info ] [MainThread]:   private_key_path: None
[0m08:32:43.933491 [info ] [MainThread]:   token: None
[0m08:32:43.933742 [info ] [MainThread]:   oauth_client_id: None
[0m08:32:43.933936 [info ] [MainThread]:   query_tag: None
[0m08:32:43.934159 [info ] [MainThread]:   client_session_keep_alive: False
[0m08:32:43.934375 [info ] [MainThread]:   host: None
[0m08:32:43.934573 [info ] [MainThread]:   port: None
[0m08:32:43.934771 [info ] [MainThread]:   proxy_host: None
[0m08:32:43.935046 [info ] [MainThread]:   proxy_port: None
[0m08:32:43.935239 [info ] [MainThread]:   protocol: None
[0m08:32:43.935440 [info ] [MainThread]:   connect_retries: 1
[0m08:32:43.935624 [info ] [MainThread]:   connect_timeout: None
[0m08:32:43.935826 [info ] [MainThread]:   retry_on_database_errors: False
[0m08:32:43.936085 [info ] [MainThread]:   retry_all: False
[0m08:32:43.936310 [info ] [MainThread]:   insecure_mode: False
[0m08:32:43.936493 [info ] [MainThread]:   reuse_connections: None
[0m08:32:43.936730 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:32:43.937105 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m08:32:43.937409 [debug] [MainThread]: Using snowflake connection "debug"
[0m08:32:43.937562 [debug] [MainThread]: On debug: select 1 as id
[0m08:32:43.937707 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:32:44.384933 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:32:44.386037 [debug] [MainThread]: On debug: Close
[0m08:32:44.690239 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:32:44.691372 [info ] [MainThread]: [31m1 check failed:[0m
[0m08:32:44.692203 [info ] [MainThread]: Error from git --help: User does not have permissions for this command: "git"

[0m08:32:44.694333 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.156796, "process_user_time": 2.217886, "process_kernel_time": 0.134294, "process_mem_max_rss": "205560", "process_out_blocks": "16", "command_success": false, "process_in_blocks": "0"}
[0m08:32:44.695311 [debug] [MainThread]: Command `dbt debug` failed at 08:32:44.695108 after 1.16 seconds
[0m08:32:44.695954 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:32:44.696487 [debug] [MainThread]: Flushing usage events
[0m08:33:07.789910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa940aed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7b6c680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa72c70b0>]}


============================== 08:33:07.792568 | 1e11605c-c8c5-4729-a0f9-ddb5b506c628 ==============================
[0m08:33:07.792568 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:33:07.792954 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:33:08.142995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e11605c-c8c5-4729-a0f9-ddb5b506c628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85e3e390>]}
[0m08:33:08.173278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e11605c-c8c5-4729-a0f9-ddb5b506c628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5fffe60>]}
[0m08:33:08.173614 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:33:08.176934 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:33:08.190679 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:33:08.190836 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:33:08.193046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e11605c-c8c5-4729-a0f9-ddb5b506c628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85d79ac0>]}
[0m08:33:08.198801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e11605c-c8c5-4729-a0f9-ddb5b506c628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bb0410>]}
[0m08:33:08.199003 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:33:08.199311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e11605c-c8c5-4729-a0f9-ddb5b506c628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff860b6f30>]}
[0m08:33:08.200058 [info ] [MainThread]: 
[0m08:33:08.200454 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:33:08.200931 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:33:08.205713 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:33:08.205873 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:33:08.206013 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:33:08.753847 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:33:08.756982 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:33:08.932090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:33:08.939073 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:33:08.939391 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:33:08.939707 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:33:09.377509 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:33:09.380853 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:33:09.525210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:33:09.529877 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:33:09.530465 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:33:09.531374 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:33:10.021727 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:33:10.024578 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:33:10.166817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e11605c-c8c5-4729-a0f9-ddb5b506c628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c048140>]}
[0m08:33:10.168269 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:33:10.169563 [info ] [MainThread]: 
[0m08:33:10.180878 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:33:10.181750 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:33:10.182136 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:33:10.189377 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:33:10.191716 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:33:10.182372 => 08:33:10.191543
[0m08:33:10.192409 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:33:10.192727 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:33:10.193398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:33:10.193662 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:33:10.195947 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:33:10.196884 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:33:10.193845 => 08:33:10.196771
[0m08:33:10.197388 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:33:10.197948 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:33:10.198315 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:33:10.199213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:33:10.199490 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:33:10.222751 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:33:10.223524 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:33:10.199662 => 08:33:10.223428
[0m08:33:10.223710 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:33:10.235520 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:33:10.237743 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:33:10.237994 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:33:10.238282 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:33:11.823635 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:33:11.842143 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:33:10.223829 => 08:33:11.841977
[0m08:33:11.842627 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:33:12.059316 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e11605c-c8c5-4729-a0f9-ddb5b506c628', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bb23c0>]}
[0m08:33:12.060105 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.86s]
[0m08:33:12.060669 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:33:12.062062 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:33:12.062314 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:33:12.062543 [info ] [MainThread]: 
[0m08:33:12.062910 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.86 seconds (3.86s).
[0m08:33:12.063332 [debug] [MainThread]: Command end result
[0m08:33:12.071602 [info ] [MainThread]: 
[0m08:33:12.072105 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:33:12.072441 [info ] [MainThread]: 
[0m08:33:12.072842 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:33:12.073663 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.304898, "process_user_time": 2.369029, "process_kernel_time": 0.105911, "process_mem_max_rss": "213076", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:33:12.074073 [debug] [MainThread]: Command `dbt run` succeeded at 08:33:12.073979 after 4.31 seconds
[0m08:33:12.074379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa747f3e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff860b6f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bcfa10>]}
[0m08:33:12.074710 [debug] [MainThread]: Flushing usage events
[0m08:33:14.121381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff879f5910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff879f43e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff879f55b0>]}


============================== 08:33:14.124179 | 422a9fb6-72cc-4107-a3e9-28dc5d0370d3 ==============================
[0m08:33:14.124179 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:33:14.124638 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:33:14.465309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '422a9fb6-72cc-4107-a3e9-28dc5d0370d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87d44590>]}
[0m08:33:14.496793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '422a9fb6-72cc-4107-a3e9-28dc5d0370d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62aac380>]}
[0m08:33:14.497188 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:33:14.500715 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:33:14.515196 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:33:14.515404 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:33:14.517660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '422a9fb6-72cc-4107-a3e9-28dc5d0370d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62800e00>]}
[0m08:33:14.524164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '422a9fb6-72cc-4107-a3e9-28dc5d0370d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6259cc20>]}
[0m08:33:14.524427 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:33:14.524802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '422a9fb6-72cc-4107-a3e9-28dc5d0370d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62a1c8c0>]}
[0m08:33:14.525576 [info ] [MainThread]: 
[0m08:33:14.526017 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:33:14.526742 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m08:33:14.533117 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:33:14.533337 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:33:14.533517 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:33:14.903989 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:33:14.905202 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:33:15.083219 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:33:15.085705 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:33:15.085993 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:33:15.086203 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:33:15.462594 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:33:15.466143 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:33:15.586649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '422a9fb6-72cc-4107-a3e9-28dc5d0370d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6259e810>]}
[0m08:33:15.587485 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:33:15.588378 [info ] [MainThread]: 
[0m08:33:15.596384 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:33:15.596821 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:33:15.597584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:33:15.597807 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:33:15.608560 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:33:15.610641 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:33:15.597956 => 08:33:15.610458
[0m08:33:15.610897 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:33:15.620598 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:33:15.621722 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:33:15.622015 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:33:15.622246 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:33:16.112933 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:33:16.122126 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:33:15.611035 => 08:33:16.121771
[0m08:33:16.122700 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:33:16.245108 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.65s]
[0m08:33:16.246964 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:33:16.247652 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:33:16.248190 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:33:16.249396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:33:16.249910 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:33:16.255787 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:33:16.258565 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:33:16.250238 => 08:33:16.258201
[0m08:33:16.259089 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:33:16.261982 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:33:16.263728 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:33:16.264087 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:33:16.264441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:33:16.824835 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:33:16.827665 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:33:16.259404 => 08:33:16.827426
[0m08:33:16.828103 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:33:16.955093 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.71s]
[0m08:33:16.955768 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:33:16.956063 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:33:16.956351 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:33:16.956960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:33:16.957261 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:33:16.962248 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:33:16.963130 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:33:16.957460 => 08:33:16.963004
[0m08:33:16.963365 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:33:16.964759 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:33:16.965584 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:33:16.965786 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:33:16.966029 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:33:17.508243 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:33:17.512347 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:33:16.963514 => 08:33:17.511994
[0m08:33:17.512945 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:33:17.668038 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.71s]
[0m08:33:17.670000 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:33:17.672738 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:33:17.673259 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:33:17.673731 [info ] [MainThread]: 
[0m08:33:17.674525 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.15 seconds (3.15s).
[0m08:33:17.675605 [debug] [MainThread]: Command end result
[0m08:33:17.689192 [info ] [MainThread]: 
[0m08:33:17.689883 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:33:17.690211 [info ] [MainThread]: 
[0m08:33:17.690688 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:33:17.691655 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.5914521, "process_user_time": 2.363715, "process_kernel_time": 0.086208, "process_mem_max_rss": "212284", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:33:17.692085 [debug] [MainThread]: Command `dbt test` succeeded at 08:33:17.691997 after 3.59 seconds
[0m08:33:17.692461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88064170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74bfda00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87a8c920>]}
[0m08:33:17.692841 [debug] [MainThread]: Flushing usage events
[0m08:33:19.747347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cf11f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cf12450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cf11fd0>]}


============================== 08:33:19.749983 | e7690d57-def0-4443-ad03-d0058c8c0bb6 ==============================
[0m08:33:19.749983 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:33:19.750386 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:33:20.085881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77cbe750>]}
[0m08:33:20.116421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ffd6030>]}
[0m08:33:20.116753 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:33:20.120018 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:33:20.132383 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:33:20.132547 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:33:20.134704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77c5f0e0>]}
[0m08:33:20.140027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77bf8dd0>]}
[0m08:33:20.140227 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:33:20.140544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77cbdc10>]}
[0m08:33:20.141300 [info ] [MainThread]: 
[0m08:33:20.141691 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:33:20.142235 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:33:20.147208 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:33:20.147363 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:33:20.147488 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:33:20.581266 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:33:20.583246 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:33:20.844877 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:33:20.855207 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:33:20.856009 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:33:20.856510 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:33:21.323643 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:33:21.326655 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:33:21.455308 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:33:21.458664 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:33:21.459143 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:33:21.459993 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:33:21.892767 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:33:21.896387 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:33:22.026705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff779663f0>]}
[0m08:33:22.028328 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:33:22.029911 [info ] [MainThread]: 
[0m08:33:22.042435 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:33:22.043252 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:33:22.044415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:33:22.044850 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:33:22.052392 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:33:22.045180 => 08:33:22.052175
[0m08:33:22.052754 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:33:22.084622 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:22.084881 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:33:22.085092 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:33:22.456735 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:33:22.468274 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:22.468865 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:33:22.583042 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:33:22.596749 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:22.597681 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:33:22.704808 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:33:22.730865 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:22.731345 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:33:23.873477 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:33:23.878184 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:23.878829 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:33:24.004532 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:33:24.010585 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:24.011214 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:33:24.104098 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:33:24.109101 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:24.109606 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:33:24.232350 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:33:24.239167 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:24.239884 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:33:24.334613 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:33:24.345707 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:24.346482 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:33:24.449108 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:33:24.459739 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:33:24.464136 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:24.464667 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:33:24.633353 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:33:24.634556 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:24.635164 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:33:25.242350 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:33:25.243989 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:33:25.244590 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:33:25.625690 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:33:25.649679 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:33:22.053005 => 08:33:25.649479
[0m08:33:25.650166 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:33:25.795701 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77a38230>]}
[0m08:33:25.797571 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 0[0m in 3.75s]
[0m08:33:25.799641 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:33:25.800451 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:33:25.801186 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:33:25.802693 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:33:25.803370 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:33:25.807876 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:33:25.803714 => 08:33:25.807648
[0m08:33:25.808307 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:33:25.812367 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:25.812702 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:33:25.813023 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:33:26.230278 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:33:26.235451 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:26.236209 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:33:26.366547 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:33:26.373033 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:26.373567 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:33:26.515710 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:33:26.527165 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:26.528195 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:33:27.493646 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:33:27.498869 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:27.499529 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:33:27.610403 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:33:27.616890 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:27.617550 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:33:27.714329 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:33:27.720996 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:27.721827 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:33:27.811738 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:33:27.817782 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:27.818452 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:33:27.910745 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:33:27.917596 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:27.918498 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:33:28.052584 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:33:28.054931 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:28.056884 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:28.057294 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:33:28.185818 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:33:28.186655 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:28.187291 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:33:28.679789 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:33:28.681388 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:33:28.682059 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:33:29.030123 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:33:29.035266 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:33:25.808561 => 08:33:29.034907
[0m08:33:29.036067 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:33:29.161313 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7690d57-def0-4443-ad03-d0058c8c0bb6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76fd7350>]}
[0m08:33:29.163066 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.36s]
[0m08:33:29.164636 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:33:29.167548 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:33:29.168079 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:33:29.168557 [info ] [MainThread]: 
[0m08:33:29.169594 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 9.03 seconds (9.03s).
[0m08:33:29.170512 [debug] [MainThread]: Command end result
[0m08:33:29.181541 [info ] [MainThread]: 
[0m08:33:29.182242 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:33:29.182535 [info ] [MainThread]: 
[0m08:33:29.182922 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:33:29.183873 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 9.456996, "process_user_time": 2.708858, "process_kernel_time": 0.139146, "process_mem_max_rss": "214560", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:33:29.184305 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:33:29.184213 after 9.46 seconds
[0m08:33:29.184626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d333ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d291a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dcfe630>]}
[0m08:33:29.184950 [debug] [MainThread]: Flushing usage events
[0m08:36:55.023718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86cf4710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86cf7ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86cf7bf0>]}


============================== 08:36:55.026723 | a612f5bd-deae-4a51-bbd9-9a47e3a344d8 ==============================
[0m08:36:55.026723 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:36:55.027359 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:36:55.214575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c359520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c358a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c35ade0>]}


============================== 08:36:55.217475 | 4298322d-ecd4-4c1f-9f2c-10c4b87ccc46 ==============================
[0m08:36:55.217475 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:36:55.217927 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:36:55.436087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a612f5bd-deae-4a51-bbd9-9a47e3a344d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65bb2990>]}
[0m08:36:55.468355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a612f5bd-deae-4a51-bbd9-9a47e3a344d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86b74cb0>]}
[0m08:36:55.468736 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:36:55.472758 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:36:55.489054 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:36:55.489310 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:36:55.492035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a612f5bd-deae-4a51-bbd9-9a47e3a344d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65b50b00>]}
[0m08:36:55.499632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a612f5bd-deae-4a51-bbd9-9a47e3a344d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65954e60>]}
[0m08:36:55.499885 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:36:55.500485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a612f5bd-deae-4a51-bbd9-9a47e3a344d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff839f8e00>]}
[0m08:36:55.501328 [info ] [MainThread]: 
[0m08:36:55.501790 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:36:55.502349 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:36:55.507581 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:36:55.507776 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:36:55.507931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:36:55.602083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4298322d-ecd4-4c1f-9f2c-10c4b87ccc46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ccc6360>]}
[0m08:36:55.633996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4298322d-ecd4-4c1f-9f2c-10c4b87ccc46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c3560f0>]}
[0m08:36:55.634366 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:36:55.637594 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:36:55.649173 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:36:55.649332 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:36:55.651426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4298322d-ecd4-4c1f-9f2c-10c4b87ccc46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57332f00>]}
[0m08:36:55.656600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4298322d-ecd4-4c1f-9f2c-10c4b87ccc46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56edca10>]}
[0m08:36:55.656796 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:36:55.656967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4298322d-ecd4-4c1f-9f2c-10c4b87ccc46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57b66840>]}
[0m08:36:55.657656 [info ] [MainThread]: 
[0m08:36:55.657979 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:36:55.658530 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:36:55.663574 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:36:55.663723 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:36:55.663853 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:36:55.966766 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:36:55.968335 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:36:56.127745 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:36:56.129814 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:36:56.164591 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:36:56.173424 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:36:56.173812 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:36:56.174116 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:36:56.279425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m08:36:56.287390 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:36:56.287753 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:36:56.288046 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:36:56.623056 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:36:56.625946 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:36:56.713776 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:36:56.717172 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:36:56.785012 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:36:56.789752 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:36:56.790328 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:36:56.791262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:36:56.885709 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:36:56.890271 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:36:56.890801 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:36:56.891736 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:36:57.238589 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:36:57.241699 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:36:57.293606 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:36:57.295734 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:36:57.395739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a612f5bd-deae-4a51-bbd9-9a47e3a344d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65a40560>]}
[0m08:36:57.397236 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:36:57.397736 [info ] [MainThread]: 
[0m08:36:57.410259 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:36:57.411351 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:36:57.411931 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:36:57.418499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4298322d-ecd4-4c1f-9f2c-10c4b87ccc46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff767ed820>]}
[0m08:36:57.419423 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:36:57.420181 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:36:57.420297 [info ] [MainThread]: 
[0m08:36:57.425453 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:36:57.412230 => 08:36:57.425307
[0m08:36:57.426080 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:36:57.426374 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:36:57.427010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:36:57.427264 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:36:57.428409 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:36:57.428920 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m08:36:57.429181 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:36:57.429414 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:36:57.430205 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:36:57.427438 => 08:36:57.430035
[0m08:36:57.430726 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:36:57.431305 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:36:57.431612 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:36:57.432252 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:36:57.432529 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:36:57.434560 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:36:57.435374 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:36:57.429355 => 08:36:57.435212
[0m08:36:57.435941 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:36:57.436194 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:36:57.436724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:36:57.436976 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:36:57.438867 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:36:57.439522 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:36:57.437131 => 08:36:57.439408
[0m08:36:57.440002 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:36:57.440525 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:36:57.440792 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:36:57.441537 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:36:57.441747 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:36:57.456610 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:36:57.457876 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:36:57.432696 => 08:36:57.457737
[0m08:36:57.458151 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:36:57.463919 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:36:57.464601 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:36:57.441875 => 08:36:57.464511
[0m08:36:57.464756 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:36:57.470372 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:36:57.472679 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:36:57.472947 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:36:57.473218 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:36:57.476263 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:36:57.478720 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:36:57.478991 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:36:57.479247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:36:59.051631 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:36:59.061072 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:36:57.458300 => 08:36:59.060958
[0m08:36:59.061349 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:36:59.204160 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a612f5bd-deae-4a51-bbd9-9a47e3a344d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6575dcd0>]}
[0m08:36:59.204640 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.77s]
[0m08:36:59.205026 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:36:59.206328 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:36:59.206537 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:36:59.206755 [info ] [MainThread]: 
[0m08:36:59.206944 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.71 seconds (3.71s).
[0m08:36:59.207259 [debug] [MainThread]: Command end result
[0m08:36:59.211808 [info ] [MainThread]: 
[0m08:36:59.212020 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:36:59.212215 [info ] [MainThread]: 
[0m08:36:59.212396 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:36:59.213110 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.211583, "process_user_time": 2.341885, "process_kernel_time": 0.168279, "process_mem_max_rss": "454512", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:36:59.213328 [debug] [MainThread]: Command `dbt run` succeeded at 08:36:59.213277 after 4.21 seconds
[0m08:36:59.213472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d4a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65d15160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87166b10>]}
[0m08:36:59.213633 [debug] [MainThread]: Flushing usage events
[0m08:36:59.358515 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:36:59.366831 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:36:57.464851 => 08:36:59.366748
[0m08:36:59.367055 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:36:59.512994 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4298322d-ecd4-4c1f-9f2c-10c4b87ccc46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56db8050>]}
[0m08:36:59.513385 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.07s]
[0m08:36:59.513838 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:36:59.514640 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:36:59.514790 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:36:59.514972 [info ] [MainThread]: 
[0m08:36:59.515209 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.86 seconds (3.86s).
[0m08:36:59.515508 [debug] [MainThread]: Command end result
[0m08:36:59.520107 [info ] [MainThread]: 
[0m08:36:59.520362 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:36:59.520518 [info ] [MainThread]: 
[0m08:36:59.520724 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:36:59.521128 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.328305, "process_user_time": 2.314587, "process_kernel_time": 0.157019, "process_mem_max_rss": "212668", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:36:59.521328 [debug] [MainThread]: Command `dbt run` succeeded at 08:36:59.521287 after 4.33 seconds
[0m08:36:59.521476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57303980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff695e2090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5706d130>]}
[0m08:36:59.521618 [debug] [MainThread]: Flushing usage events
[0m08:37:48.482008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb16bc440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6517b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb16bd2b0>]}


============================== 08:37:48.485258 | f34ef44e-7dd1-4cba-ae34-b9ea1bd77934 ==============================
[0m08:37:48.485258 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:37:48.485633 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:37:48.861182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f34ef44e-7dd1-4cba-ae34-b9ea1bd77934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91410e00>]}
[0m08:37:48.893436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f34ef44e-7dd1-4cba-ae34-b9ea1bd77934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91235b50>]}
[0m08:37:48.893861 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:37:48.897867 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:37:48.912343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:37:48.912529 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:37:48.915207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f34ef44e-7dd1-4cba-ae34-b9ea1bd77934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff906cfbf0>]}
[0m08:37:48.925545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f34ef44e-7dd1-4cba-ae34-b9ea1bd77934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff902e09e0>]}
[0m08:37:48.926015 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:37:48.926225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f34ef44e-7dd1-4cba-ae34-b9ea1bd77934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9054bfb0>]}
[0m08:37:48.927522 [info ] [MainThread]: 
[0m08:37:48.928299 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:37:48.929339 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m08:37:48.938399 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:37:48.938774 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:37:48.939007 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:37:49.216665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2d97170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2d54b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2d56810>]}


============================== 08:37:49.219330 | 68a24cb5-6523-45d2-9034-4c528fdab984 ==============================
[0m08:37:49.219330 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:37:49.219574 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:37:49.429866 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:37:49.430811 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:37:49.570975 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:37:49.573787 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:37:49.574004 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:37:49.574180 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:37:49.598088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '68a24cb5-6523-45d2-9034-4c528fdab984', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2d55280>]}
[0m08:37:49.631077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '68a24cb5-6523-45d2-9034-4c528fdab984', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2d55280>]}
[0m08:37:49.631447 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:37:49.637731 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:37:49.648653 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:37:49.648840 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:37:49.651066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '68a24cb5-6523-45d2-9034-4c528fdab984', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2d12180>]}
[0m08:37:49.656117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '68a24cb5-6523-45d2-9034-4c528fdab984', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff918e8a40>]}
[0m08:37:49.656296 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:37:49.656471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68a24cb5-6523-45d2-9034-4c528fdab984', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91badbe0>]}
[0m08:37:49.657194 [info ] [MainThread]: 
[0m08:37:49.657526 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:37:49.658075 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:37:49.663112 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:37:49.663264 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:37:49.663402 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:37:50.023510 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:37:50.026182 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:37:50.172951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f34ef44e-7dd1-4cba-ae34-b9ea1bd77934', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9027a510>]}
[0m08:37:50.173938 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:37:50.174453 [info ] [MainThread]: 
[0m08:37:50.181699 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:37:50.183598 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:37:50.183915 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:37:50.184199 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:37:50.186198 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:37:50.186591 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:37:50.197146 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:37:50.198748 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:37:50.186835 => 08:37:50.198623
[0m08:37:50.198971 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:37:50.209222 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:37:50.210283 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:37:50.210534 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:37:50.210770 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:50.317173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:37:50.324263 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:37:50.324592 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:37:50.324893 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:37:50.710326 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:37:50.710368 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:37:50.711536 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:37:50.715495 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:37:50.199109 => 08:37:50.715346
[0m08:37:50.715756 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:37:50.860146 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.67s]
[0m08:37:50.860264 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:37:50.861407 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:37:50.862289 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:37:50.863545 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:37:50.865490 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:37:50.865679 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:37:50.866309 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:37:50.866393 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:37:50.868233 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:37:50.875108 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:37:50.877249 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:37:50.867696 => 08:37:50.876966
[0m08:37:50.877697 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:37:50.880481 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:37:50.881641 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:37:50.881943 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:37:50.882198 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:51.362501 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:37:51.365179 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:37:51.394832 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:37:51.398686 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:37:50.877995 => 08:37:51.398374
[0m08:37:51.399272 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:37:51.510796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68a24cb5-6523-45d2-9034-4c528fdab984', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9190ba40>]}
[0m08:37:51.512252 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:37:51.512740 [info ] [MainThread]: 
[0m08:37:51.520921 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.66s]
[0m08:37:51.522369 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:37:51.523134 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:37:51.523650 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:37:51.525047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:37:51.525829 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:37:51.526033 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:37:51.530610 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:37:51.531203 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:37:51.534405 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:37:51.535623 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:37:51.526217 => 08:37:51.535428
[0m08:37:51.535940 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:37:51.538045 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:37:51.538549 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:37:51.539071 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:37:51.539442 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:37:51.539766 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:51.541453 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:37:51.531899 => 08:37:51.541241
[0m08:37:51.542695 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:37:51.543089 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:37:51.543795 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:37:51.544073 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:37:51.546769 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:37:51.547693 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:37:51.544243 => 08:37:51.547543
[0m08:37:51.548300 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:37:51.548874 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:37:51.549155 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:37:51.549744 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:37:51.549960 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:37:51.573428 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:37:51.574127 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:37:51.550085 => 08:37:51.574017
[0m08:37:51.574317 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:37:51.586300 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:37:51.588616 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:37:51.588927 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:37:51.589221 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:37:52.104108 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:37:52.106477 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:37:51.536155 => 08:37:52.106223
[0m08:37:52.106967 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:37:52.231332 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.71s]
[0m08:37:52.232559 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:37:52.235241 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:37:52.235783 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:37:52.236204 [info ] [MainThread]: 
[0m08:37:52.236521 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.31 seconds (3.31s).
[0m08:37:52.237704 [debug] [MainThread]: Command end result
[0m08:37:52.248771 [info ] [MainThread]: 
[0m08:37:52.249274 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:37:52.249611 [info ] [MainThread]: 
[0m08:37:52.249990 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:37:52.251297 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.7908912, "process_user_time": 2.625753, "process_kernel_time": 0.175723, "process_mem_max_rss": "454552", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:37:52.251798 [debug] [MainThread]: Command `dbt test` succeeded at 08:37:52.251668 after 3.79 seconds
[0m08:37:52.252169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1b26630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb16b9760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1b5b530>]}
[0m08:37:52.252514 [debug] [MainThread]: Flushing usage events
[0m08:37:53.067578 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:37:53.078063 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:37:51.574442 => 08:37:53.077951
[0m08:37:53.078716 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:37:53.238913 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '68a24cb5-6523-45d2-9034-4c528fdab984', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff917a5bb0>]}
[0m08:37:53.239476 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.69s]
[0m08:37:53.240134 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:37:53.241569 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:37:53.241749 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:37:53.241979 [info ] [MainThread]: 
[0m08:37:53.242216 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.58 seconds (3.58s).
[0m08:37:53.242594 [debug] [MainThread]: Command end result
[0m08:37:53.248960 [info ] [MainThread]: 
[0m08:37:53.249315 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:37:53.249847 [info ] [MainThread]: 
[0m08:37:53.250200 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:37:53.250748 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.054837, "process_user_time": 2.393563, "process_kernel_time": 0.157862, "process_mem_max_rss": "212748", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:37:53.250954 [debug] [MainThread]: Command `dbt run` succeeded at 08:37:53.250912 after 4.06 seconds
[0m08:37:53.251095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2d97170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91994d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9187cb30>]}
[0m08:37:53.251235 [debug] [MainThread]: Flushing usage events
[0m08:38:51.886265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93e60b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93e618e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93e603e0>]}


============================== 08:38:51.889392 | 91c64107-668e-46db-8741-8d972d204fa2 ==============================
[0m08:38:51.889392 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:38:51.890491 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:38:52.256123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93bb59d0>]}
[0m08:38:52.288323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6edd2a50>]}
[0m08:38:52.288697 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:38:52.292931 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:38:52.305506 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:38:52.305699 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:38:52.308050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90b67740>]}
[0m08:38:52.314021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ea38cb0>]}
[0m08:38:52.314236 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:38:52.314697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ef65c10>]}
[0m08:38:52.315598 [info ] [MainThread]: 
[0m08:38:52.316185 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:38:52.316779 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:38:52.322260 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:38:52.322425 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:38:52.322544 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:38:52.552707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7aac6db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7aeb4e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b1ab980>]}


============================== 08:38:52.555591 | 60884a8b-dd42-4b68-9e87-5f484a386076 ==============================
[0m08:38:52.555591 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:38:52.556034 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:38:52.784950 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:38:52.785841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:38:52.919237 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m08:38:52.922955 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:38:52.923155 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:38:52.923319 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:38:52.924396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60884a8b-dd42-4b68-9e87-5f484a386076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e596690>]}
[0m08:38:52.956178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60884a8b-dd42-4b68-9e87-5f484a386076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a9a9bb0>]}
[0m08:38:52.956557 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:38:52.959733 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:38:52.971178 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:38:52.971349 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:38:52.973701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60884a8b-dd42-4b68-9e87-5f484a386076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59e13530>]}
[0m08:38:52.978554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60884a8b-dd42-4b68-9e87-5f484a386076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff598d9070>]}
[0m08:38:52.978740 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:38:52.978915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60884a8b-dd42-4b68-9e87-5f484a386076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59942fc0>]}
[0m08:38:52.979602 [info ] [MainThread]: 
[0m08:38:52.979928 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:38:52.980442 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:38:52.985497 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:38:52.985669 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:38:52.985822 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:38:53.417295 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:38:53.418630 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:38:53.464726 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:38:53.466531 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:38:53.543205 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:38:53.547450 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:38:53.548068 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:38:53.548974 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:38:53.612016 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m08:38:53.617815 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:38:53.618677 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:38:53.619149 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:38:53.985673 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:38:53.986917 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:38:54.074852 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:38:54.075678 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:38:54.132104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93e1f800>]}
[0m08:38:54.132951 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:38:54.133200 [info ] [MainThread]: 
[0m08:38:54.137363 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:38:54.137629 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:38:54.137974 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m08:38:54.138189 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:38:54.141509 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:38:54.138305 => 08:38:54.141410
[0m08:38:54.141689 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:38:54.164621 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:54.164838 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:38:54.165012 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:38:54.215048 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:38:54.216355 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:38:54.216536 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:38:54.216844 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:38:54.491652 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:38:54.501547 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:54.502118 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:38:54.552871 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:38:54.554959 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:38:54.601679 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:38:54.611506 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:54.612043 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:38:54.676373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60884a8b-dd42-4b68-9e87-5f484a386076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59b06840>]}
[0m08:38:54.677409 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:38:54.677852 [info ] [MainThread]: 
[0m08:38:54.686983 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:38:54.687823 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m08:38:54.688275 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:38:54.692950 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:38:54.694499 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:38:54.688505 => 08:38:54.694390
[0m08:38:54.694906 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:38:54.695124 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:38:54.695512 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:38:54.695710 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:38:54.697115 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:38:54.697656 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:38:54.695860 => 08:38:54.697573
[0m08:38:54.697973 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:38:54.698392 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:38:54.698598 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:38:54.699014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:38:54.699196 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:38:54.713500 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:38:54.717801 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:38:54.718607 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:38:54.699302 => 08:38:54.718478
[0m08:38:54.718787 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:38:54.726854 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:54.729918 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:38:54.730835 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:38:54.734015 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:38:54.734313 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:38:54.734620 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:38:55.588350 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:38:55.595166 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:55.595744 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:38:55.686998 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:38:55.693393 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:55.694932 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:38:55.786241 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:38:55.791896 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:55.792647 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:38:55.875876 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:38:55.879550 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:55.879964 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:38:55.963955 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:38:55.974227 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:55.975124 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:38:56.075786 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:38:56.088805 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:38:56.091750 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:56.092186 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:38:56.234716 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:38:56.235962 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:56.236839 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:38:56.260398 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:38:56.285014 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:38:54.718900 => 08:38:56.284811
[0m08:38:56.285434 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:38:56.461345 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60884a8b-dd42-4b68-9e87-5f484a386076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff595dbe60>]}
[0m08:38:56.462259 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.76s]
[0m08:38:56.462997 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:38:56.464952 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:38:56.465277 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:38:56.465688 [info ] [MainThread]: 
[0m08:38:56.466019 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.49 seconds (3.49s).
[0m08:38:56.466714 [debug] [MainThread]: Command end result
[0m08:38:56.476363 [info ] [MainThread]: 
[0m08:38:56.476672 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:38:56.476922 [info ] [MainThread]: 
[0m08:38:56.477398 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:38:56.478365 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.9472697, "process_user_time": 2.384707, "process_kernel_time": 0.162116, "process_mem_max_rss": "212348", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:38:56.478738 [debug] [MainThread]: Command `dbt run` succeeded at 08:38:56.478666 after 3.95 seconds
[0m08:38:56.479010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ae0d490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7aeb4e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59870fb0>]}
[0m08:38:56.479335 [debug] [MainThread]: Flushing usage events
[0m08:38:56.811451 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:38:56.812638 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:38:56.813248 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:38:57.223652 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:38:57.236606 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:38:54.141804 => 08:38:57.236477
[0m08:38:57.236860 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:38:57.388947 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6dedfce0>]}
[0m08:38:57.389775 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 0[0m in 3.25s]
[0m08:38:57.390281 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:38:57.390605 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:38:57.391826 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:38:57.392172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:38:57.392377 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:38:57.394111 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:38:57.392501 => 08:38:57.394013
[0m08:38:57.394320 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:38:57.396172 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:57.396577 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:38:57.396742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:38:57.833602 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:38:57.835324 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:57.835573 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:38:57.958598 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:38:57.960443 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:57.960646 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:38:58.053822 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:38:58.057265 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:58.057596 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:38:58.459989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6bd1460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa719b440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa87c4c50>]}


============================== 08:38:58.462535 | 0c59a2da-380a-440a-976c-e8a13d2ed1c6 ==============================
[0m08:38:58.462535 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:38:58.462784 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:38:58.795837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0c59a2da-380a-440a-976c-e8a13d2ed1c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6fbf140>]}
[0m08:38:58.825542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0c59a2da-380a-440a-976c-e8a13d2ed1c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7bc4260>]}
[0m08:38:58.825862 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:38:58.828831 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:38:58.840590 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:38:58.840742 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:38:58.842849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c59a2da-380a-440a-976c-e8a13d2ed1c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85972330>]}
[0m08:38:58.847970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c59a2da-380a-440a-976c-e8a13d2ed1c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff858dd130>]}
[0m08:38:58.848146 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:38:58.848299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c59a2da-380a-440a-976c-e8a13d2ed1c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff862d6780>]}
[0m08:38:58.848984 [info ] [MainThread]: 
[0m08:38:58.849329 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:38:58.849907 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m08:38:58.855255 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:38:58.855431 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:38:58.855579 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:38:58.883801 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:38:58.885206 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:58.885422 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:38:58.986343 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:38:58.988608 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:58.988847 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:38:59.072847 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:38:59.076263 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:59.076695 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:38:59.223792 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:38:59.226483 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:59.226786 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:38:59.294656 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:38:59.296860 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:38:59.317433 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:38:59.321767 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:59.322146 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:38:59.425838 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:38:59.428105 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:59.429998 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:59.430266 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:38:59.533077 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:38:59.538088 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:38:59.538684 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:38:59.539087 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:38:59.559404 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:38:59.560176 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:38:59.560782 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:39:00.038378 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:39:00.041394 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:39:00.197774 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:39:00.199106 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:39:00.199747 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:39:00.201173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c59a2da-380a-440a-976c-e8a13d2ed1c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6e01550>]}
[0m08:39:00.202497 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:39:00.203001 [info ] [MainThread]: 
[0m08:39:00.214098 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:39:00.214770 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:39:00.215638 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:39:00.216005 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:39:00.229597 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:39:00.231743 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:39:00.216259 => 08:39:00.231589
[0m08:39:00.232083 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:39:00.243154 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:39:00.244122 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:39:00.244373 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:39:00.244607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:39:00.497261 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:39:00.501721 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:38:57.394467 => 08:39:00.501423
[0m08:39:00.502440 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:39:00.660456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91c64107-668e-46db-8741-8d972d204fa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6df691c0>]}
[0m08:39:00.662054 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.27s]
[0m08:39:00.662926 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:39:00.665879 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:39:00.666410 [debug] [MainThread]: Connection 'list_USER_DB_PEACOCK' was properly closed.
[0m08:39:00.666796 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:39:00.667222 [info ] [MainThread]: 
[0m08:39:00.667625 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.35 seconds (8.35s).
[0m08:39:00.668667 [debug] [MainThread]: Command end result
[0m08:39:00.683884 [info ] [MainThread]: 
[0m08:39:00.685051 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:39:00.685887 [info ] [MainThread]: 
[0m08:39:00.686816 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:39:00.688764 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 8.824523, "process_user_time": 2.473046, "process_kernel_time": 0.159648, "process_mem_max_rss": "454552", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:39:00.689532 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:39:00.689340 after 8.83 seconds
[0m08:39:00.690350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93efb4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93e604d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ea78890>]}
[0m08:39:00.691129 [debug] [MainThread]: Flushing usage events
[0m08:39:00.741785 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:39:00.746779 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:39:00.232276 => 08:39:00.746551
[0m08:39:00.747188 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:39:00.865638 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.65s]
[0m08:39:00.866798 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:39:00.867466 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:39:00.868071 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:39:00.869324 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:39:00.869880 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:39:00.876221 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:39:00.878027 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:39:00.870218 => 08:39:00.877838
[0m08:39:00.878369 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:39:00.881489 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:39:00.883150 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:39:00.883608 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:39:00.883918 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:39:01.329506 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:39:01.330554 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:39:00.878590 => 08:39:01.330448
[0m08:39:01.330756 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:39:01.494134 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.63s]
[0m08:39:01.494825 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:39:01.495086 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:39:01.495403 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:39:01.495918 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:39:01.496064 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:39:01.500375 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:39:01.501245 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:39:01.496158 => 08:39:01.501093
[0m08:39:01.501483 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:39:01.503042 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:39:01.503723 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:39:01.503928 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:39:01.504156 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:39:02.021624 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:39:02.022833 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:39:01.501638 => 08:39:02.022705
[0m08:39:02.023081 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:39:02.183634 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.69s]
[0m08:39:02.184148 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:39:02.185052 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:39:02.185221 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:39:02.185404 [info ] [MainThread]: 
[0m08:39:02.185579 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.34 seconds (3.34s).
[0m08:39:02.186037 [debug] [MainThread]: Command end result
[0m08:39:02.190853 [info ] [MainThread]: 
[0m08:39:02.191165 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:39:02.191393 [info ] [MainThread]: 
[0m08:39:02.191607 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:39:02.192061 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.7523303, "process_user_time": 2.353646, "process_kernel_time": 0.097109, "process_mem_max_rss": "212276", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:39:02.192243 [debug] [MainThread]: Command `dbt test` succeeded at 08:39:02.192203 after 3.75 seconds
[0m08:39:02.192378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6b55f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a599490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85be88f0>]}
[0m08:39:02.192513 [debug] [MainThread]: Flushing usage events
[0m08:40:31.194883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab8274d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabc58c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab8bf740>]}


============================== 08:40:31.197959 | fd67ba83-de20-4caa-8e23-002775ce568c ==============================
[0m08:40:31.197959 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:40:31.198415 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:40:31.546715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd67ba83-de20-4caa-8e23-002775ce568c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87fcee40>]}
[0m08:40:31.577136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd67ba83-de20-4caa-8e23-002775ce568c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e9a97f0>]}
[0m08:40:31.577496 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:40:31.581439 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:40:31.594199 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:40:31.594384 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:40:31.596598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd67ba83-de20-4caa-8e23-002775ce568c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86575be0>]}
[0m08:40:31.602362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd67ba83-de20-4caa-8e23-002775ce568c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86440980>]}
[0m08:40:31.602539 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:40:31.602829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd67ba83-de20-4caa-8e23-002775ce568c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e9a9c10>]}
[0m08:40:31.603567 [info ] [MainThread]: 
[0m08:40:31.603899 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:40:31.604410 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:40:31.609363 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:40:31.609527 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:40:31.609646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:40:32.109027 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:40:32.110972 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:40:32.238513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:40:32.248242 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:40:32.248968 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:40:32.249395 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:40:32.676778 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:40:32.680327 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:40:32.846253 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:40:32.851239 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:40:32.851929 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:40:32.852972 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:40:33.280804 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:40:33.281756 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:40:33.410109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd67ba83-de20-4caa-8e23-002775ce568c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86a4bf80>]}
[0m08:40:33.411193 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:40:33.412086 [info ] [MainThread]: 
[0m08:40:33.420692 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:40:33.421376 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:40:33.421701 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:40:33.428045 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:40:33.429818 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:40:33.421918 => 08:40:33.429645
[0m08:40:33.430438 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:40:33.430720 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:40:33.431343 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:40:33.431580 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:40:33.433779 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:40:33.434563 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:40:33.431740 => 08:40:33.434445
[0m08:40:33.435075 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:40:33.435581 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:40:33.435854 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:40:33.436550 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:40:33.436761 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:40:33.459919 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:40:33.460657 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:40:33.436893 => 08:40:33.460548
[0m08:40:33.460845 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:40:33.472303 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:40:33.474578 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:40:33.474857 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:40:33.475153 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:40:34.859147 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:40:34.883790 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:40:33.460977 => 08:40:34.883584
[0m08:40:34.884296 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:40:35.024031 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd67ba83-de20-4caa-8e23-002775ce568c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff864424b0>]}
[0m08:40:35.025374 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.59s]
[0m08:40:35.026807 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:40:35.029230 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:40:35.029733 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:40:35.030227 [info ] [MainThread]: 
[0m08:40:35.031314 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.43 seconds (3.43s).
[0m08:40:35.032487 [debug] [MainThread]: Command end result
[0m08:40:35.044534 [info ] [MainThread]: 
[0m08:40:35.045336 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:40:35.045634 [info ] [MainThread]: 
[0m08:40:35.046150 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:40:35.047068 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8736603, "process_user_time": 2.416578, "process_kernel_time": 0.115122, "process_mem_max_rss": "212504", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:40:35.047480 [debug] [MainThread]: Command `dbt run` succeeded at 08:40:35.047392 after 3.87 seconds
[0m08:40:35.047798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabbb1640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabc5bb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabbb8470>]}
[0m08:40:35.048142 [debug] [MainThread]: Flushing usage events
[0m08:40:36.820550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac6cb1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac2628a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadeef020>]}


============================== 08:40:36.823184 | 3fe5c923-53ce-4a76-8548-7c48d494433b ==============================
[0m08:40:36.823184 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:40:36.823623 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:40:37.156197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3fe5c923-53ce-4a76-8548-7c48d494433b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff877d7e00>]}
[0m08:40:37.186382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3fe5c923-53ce-4a76-8548-7c48d494433b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86ff1910>]}
[0m08:40:37.186703 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:40:37.189870 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:40:37.201720 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:40:37.201893 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:40:37.203992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3fe5c923-53ce-4a76-8548-7c48d494433b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86ff2750>]}
[0m08:40:37.209679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3fe5c923-53ce-4a76-8548-7c48d494433b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d84dd0>]}
[0m08:40:37.209852 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:40:37.210133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3fe5c923-53ce-4a76-8548-7c48d494433b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b3a19d0>]}
[0m08:40:37.210802 [info ] [MainThread]: 
[0m08:40:37.211183 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:40:37.211735 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m08:40:37.217110 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:40:37.217298 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:40:37.217506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:40:37.677127 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:40:37.680305 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:40:37.838982 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:40:37.843137 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:40:37.843601 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:40:37.844040 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:40:38.342993 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:40:38.346031 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:40:38.497593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3fe5c923-53ce-4a76-8548-7c48d494433b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8733f440>]}
[0m08:40:38.499247 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:40:38.500431 [info ] [MainThread]: 
[0m08:40:38.511970 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:40:38.512625 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:40:38.513808 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:40:38.514177 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:40:38.527528 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:40:38.529543 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:40:38.514416 => 08:40:38.529341
[0m08:40:38.529857 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:40:38.541199 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:40:38.542147 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:40:38.542375 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:40:38.542593 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:40:39.001795 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:40:39.019350 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:40:38.530074 => 08:40:39.018762
[0m08:40:39.020236 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:40:39.158587 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.64s]
[0m08:40:39.161306 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:40:39.162287 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:40:39.163160 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:40:39.164466 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:40:39.165008 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:40:39.171052 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:40:39.172562 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:40:39.165334 => 08:40:39.172386
[0m08:40:39.172899 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:40:39.175277 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:40:39.176533 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:40:39.176834 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:40:39.177173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:40:39.712146 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:40:39.715933 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:40:39.173176 => 08:40:39.715495
[0m08:40:39.716738 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:40:39.894043 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.73s]
[0m08:40:39.895640 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:40:39.896246 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:40:39.896780 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:40:39.898047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:40:39.898563 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:40:39.911623 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:40:39.913336 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:40:39.898895 => 08:40:39.913118
[0m08:40:39.913707 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:40:39.916252 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:40:39.917526 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:40:39.917869 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:40:39.918241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:40:40.345333 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:40:40.348816 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:40:39.913950 => 08:40:40.348416
[0m08:40:40.349524 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:40:40.483194 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.59s]
[0m08:40:40.484500 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:40:40.488326 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:40:40.489083 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:40:40.489797 [info ] [MainThread]: 
[0m08:40:40.491058 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.28 seconds (3.28s).
[0m08:40:40.492437 [debug] [MainThread]: Command end result
[0m08:40:40.507652 [info ] [MainThread]: 
[0m08:40:40.508373 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:40:40.508674 [info ] [MainThread]: 
[0m08:40:40.509249 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:40:40.511246 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.7103415, "process_user_time": 2.454517, "process_kernel_time": 0.093866, "process_mem_max_rss": "212644", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:40:40.511868 [debug] [MainThread]: Command `dbt test` succeeded at 08:40:40.511724 after 3.71 seconds
[0m08:40:40.512375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadeef020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac7e8320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87177530>]}
[0m08:40:40.512775 [debug] [MainThread]: Flushing usage events
[0m08:40:43.202595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5410bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5413740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5411f40>]}


============================== 08:40:43.206106 | fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8 ==============================
[0m08:40:43.206106 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:40:43.207389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:40:43.547810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9500e9f0>]}
[0m08:40:43.577505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9580d040>]}
[0m08:40:43.577811 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:40:43.580938 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:40:43.593092 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:40:43.593256 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:40:43.595370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ffc6330>]}
[0m08:40:43.599981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8fff8620>]}
[0m08:40:43.600147 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:40:43.600445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff944e2450>]}
[0m08:40:43.601117 [info ] [MainThread]: 
[0m08:40:43.601483 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:40:43.602010 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:40:43.606929 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:40:43.607075 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:40:43.607201 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:40:44.094015 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:40:44.095670 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:40:44.238489 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:40:44.249657 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:40:44.250436 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:40:44.250953 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:40:44.651224 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:40:44.654128 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:40:44.812998 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:40:44.817291 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:40:44.817836 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:40:44.818694 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:40:45.366825 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m08:40:45.369745 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:40:45.548381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8fd663f0>]}
[0m08:40:45.549990 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:40:45.551346 [info ] [MainThread]: 
[0m08:40:45.562641 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:40:45.563479 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:40:45.564581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:40:45.564977 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:40:45.572801 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:40:45.565227 => 08:40:45.572609
[0m08:40:45.573238 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:40:45.606223 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:45.606453 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:40:45.606638 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:40:46.066440 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:40:46.070757 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:46.071093 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:40:46.147641 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:40:46.150672 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:46.150869 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:40:46.269336 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:40:46.281418 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:46.281738 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:40:47.297475 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:40:47.299234 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:47.299483 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:40:47.390020 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:40:47.391759 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:47.391950 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:40:47.488096 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:40:47.489777 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:47.489979 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:40:47.922850 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:40:47.929951 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:47.930841 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:40:48.025563 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:40:48.033410 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:48.033978 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:40:48.128524 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:40:48.139472 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:40:48.142623 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:48.142949 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:40:48.272477 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:40:48.273598 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:48.274165 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:40:48.840438 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:40:48.840907 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:40:48.841188 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:40:49.253912 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:40:49.277124 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:40:45.573450 => 08:40:49.276888
[0m08:40:49.277654 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:40:49.458251 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f21ce30>]}
[0m08:40:49.460769 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 0[0m in 3.89s]
[0m08:40:49.463206 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:40:49.463869 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:40:49.464822 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:40:49.466160 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:40:49.466655 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:40:49.473675 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:40:49.466950 => 08:40:49.473341
[0m08:40:49.474276 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:40:49.478468 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:49.478846 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:40:49.479216 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:40:49.918883 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:40:49.923214 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:49.923758 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:40:50.024471 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:40:50.030655 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:50.031217 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:40:50.108620 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:40:50.116150 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:50.116727 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:40:51.301670 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:40:51.306672 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:51.307362 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:40:51.422161 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:40:51.428903 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:51.429555 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:40:51.538149 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:40:51.544454 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:51.549122 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:40:51.631402 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:40:51.637462 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:51.638109 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:40:51.749622 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:40:51.756678 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:51.757384 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:40:51.860348 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:40:51.864893 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:51.868853 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:51.869428 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:40:52.066290 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:40:52.067319 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:52.067870 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:40:52.966887 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:40:52.967933 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:40:52.968596 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:40:53.553890 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:40:53.558975 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:40:49.474537 => 08:40:53.558628
[0m08:40:53.559567 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:40:53.706501 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa8a8ed3-25fd-4f1d-8bd4-62e07207d3c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f227d70>]}
[0m08:40:53.707468 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.24s]
[0m08:40:53.708626 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:40:53.710501 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:40:53.710767 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:40:53.711004 [info ] [MainThread]: 
[0m08:40:53.711380 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.11 seconds (10.11s).
[0m08:40:53.711875 [debug] [MainThread]: Command end result
[0m08:40:53.720013 [info ] [MainThread]: 
[0m08:40:53.720410 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:40:53.720670 [info ] [MainThread]: 
[0m08:40:53.721017 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:40:53.721934 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 10.543961, "process_user_time": 2.655442, "process_kernel_time": 0.123741, "process_mem_max_rss": "214296", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:40:53.722299 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:40:53.722237 after 10.54 seconds
[0m08:40:53.722586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb53cde80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5a6bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94fef230>]}
[0m08:40:53.722810 [debug] [MainThread]: Flushing usage events
[0m08:47:08.020134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b3b8980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b4b7410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b3bbf50>]}


============================== 08:47:08.023012 | 83959e2b-e045-496c-9e67-0c6377f6d317 ==============================
[0m08:47:08.023012 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:47:08.023399 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:47:08.392022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83959e2b-e045-496c-9e67-0c6377f6d317', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff763873e0>]}
[0m08:47:08.425953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83959e2b-e045-496c-9e67-0c6377f6d317', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7656e330>]}
[0m08:47:08.426412 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:47:08.429842 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:47:08.446783 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:47:08.447068 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:47:08.449540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83959e2b-e045-496c-9e67-0c6377f6d317', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff760f58b0>]}
[0m08:47:08.456447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83959e2b-e045-496c-9e67-0c6377f6d317', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff75f9c4d0>]}
[0m08:47:08.456722 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:47:08.457119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83959e2b-e045-496c-9e67-0c6377f6d317', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76422840>]}
[0m08:47:08.457925 [info ] [MainThread]: 
[0m08:47:08.458351 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:47:08.458997 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:47:08.464817 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:47:08.465044 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:47:08.465184 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:47:08.967202 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:47:08.968651 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:47:09.092254 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:47:09.098347 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:47:09.098716 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:47:09.098914 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:09.550107 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:47:09.554018 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:47:09.676563 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:47:09.681193 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:47:09.681715 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:47:09.682516 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:10.103138 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:47:10.106364 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:47:10.264435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83959e2b-e045-496c-9e67-0c6377f6d317', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7550fb00>]}
[0m08:47:10.264987 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:47:10.265631 [info ] [MainThread]: 
[0m08:47:10.270745 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:47:10.271107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:47:10.271290 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:47:10.275402 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:47:10.276224 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:47:10.271422 => 08:47:10.276086
[0m08:47:10.276657 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:47:10.276855 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:47:10.277275 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:47:10.277465 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:47:10.279007 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:47:10.279489 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:47:10.277580 => 08:47:10.279411
[0m08:47:10.279856 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:47:10.280226 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:47:10.280425 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:47:10.280957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:47:10.281107 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:47:10.299856 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:47:10.300628 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:47:10.281197 => 08:47:10.300549
[0m08:47:10.300791 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:47:10.312817 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:47:10.315123 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:47:10.315401 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:47:10.315715 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:12.252440 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:47:12.281010 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:47:10.300958 => 08:47:12.280608
[0m08:47:12.281772 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:47:12.408468 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83959e2b-e045-496c-9e67-0c6377f6d317', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff755e1f10>]}
[0m08:47:12.410547 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.13s]
[0m08:47:12.414593 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:47:12.418785 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:47:12.419328 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:47:12.419727 [info ] [MainThread]: 
[0m08:47:12.420787 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.96 seconds (3.96s).
[0m08:47:12.422192 [debug] [MainThread]: Command end result
[0m08:47:12.437985 [info ] [MainThread]: 
[0m08:47:12.438786 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:47:12.439085 [info ] [MainThread]: 
[0m08:47:12.439582 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:47:12.441296 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4427633, "process_user_time": 2.434826, "process_kernel_time": 0.181252, "process_mem_max_rss": "213064", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:47:12.441890 [debug] [MainThread]: Command `dbt run` succeeded at 08:47:12.441786 after 4.44 seconds
[0m08:47:12.442261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa040a9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff761fc140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff75fbbf80>]}
[0m08:47:12.442603 [debug] [MainThread]: Flushing usage events
[0m08:47:15.282297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fa18470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fab06e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fab10d0>]}


============================== 08:47:15.285650 | 70c15924-1bb6-4a48-aaab-3feeee8d2ee5 ==============================
[0m08:47:15.285650 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:47:15.286148 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:47:15.724144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '70c15924-1bb6-4a48-aaab-3feeee8d2ee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c778bc0>]}
[0m08:47:15.761748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '70c15924-1bb6-4a48-aaab-3feeee8d2ee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5aaaef00>]}
[0m08:47:15.762288 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:47:15.766171 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:47:15.782358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:47:15.782603 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:47:15.785184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '70c15924-1bb6-4a48-aaab-3feeee8d2ee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c75e060>]}
[0m08:47:15.791370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '70c15924-1bb6-4a48-aaab-3feeee8d2ee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a7dd6a0>]}
[0m08:47:15.791629 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:47:15.791955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70c15924-1bb6-4a48-aaab-3feeee8d2ee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a714500>]}
[0m08:47:15.792776 [info ] [MainThread]: 
[0m08:47:15.793242 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:47:15.793866 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m08:47:15.801399 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:47:15.801679 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:47:15.801873 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:47:16.252544 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:47:16.254077 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:47:16.388055 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:47:16.397134 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:47:16.397432 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:47:16.397623 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:16.785524 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:47:16.786621 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:47:16.895560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70c15924-1bb6-4a48-aaab-3feeee8d2ee5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a8a7f80>]}
[0m08:47:16.896054 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:47:16.896556 [info ] [MainThread]: 
[0m08:47:16.902195 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:16.902431 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:47:16.902844 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:47:16.903038 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:16.910218 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:47:16.911197 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:47:16.903177 => 08:47:16.911100
[0m08:47:16.911380 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:16.919547 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:47:16.920550 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:47:16.920812 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:47:16.921072 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:17.363907 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:17.368234 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:47:16.911505 => 08:47:17.368086
[0m08:47:17.368514 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:47:17.510341 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.61s]
[0m08:47:17.512487 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:17.513728 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:47:17.514393 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:47:17.516009 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:47:17.516420 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:47:17.523360 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:47:17.525252 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:47:17.516702 => 08:47:17.525009
[0m08:47:17.525662 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:47:17.528352 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:47:17.529924 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:47:17.530342 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:47:17.530733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:17.908599 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:17.912081 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:47:17.525913 => 08:47:17.911699
[0m08:47:17.913004 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:47:18.047424 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.53s]
[0m08:47:18.050001 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:47:18.050912 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:47:18.051766 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:47:18.053427 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:47:18.054010 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:47:18.064792 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:47:18.066238 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:47:18.054470 => 08:47:18.066052
[0m08:47:18.066543 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:47:18.068678 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:47:18.070097 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:47:18.070484 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:47:18.070907 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:18.521142 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:18.525421 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:47:18.066713 => 08:47:18.525072
[0m08:47:18.526299 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:47:18.649629 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.60s]
[0m08:47:18.651861 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:47:18.655834 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:47:18.657300 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:47:18.658328 [info ] [MainThread]: 
[0m08:47:18.661229 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 2.87 seconds (2.87s).
[0m08:47:18.663866 [debug] [MainThread]: Command end result
[0m08:47:18.674258 [info ] [MainThread]: 
[0m08:47:18.674922 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:47:18.675189 [info ] [MainThread]: 
[0m08:47:18.675554 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:47:18.676780 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.4195697, "process_user_time": 2.444447, "process_kernel_time": 0.211636, "process_mem_max_rss": "212548", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:47:18.677158 [debug] [MainThread]: Command `dbt test` succeeded at 08:47:18.677088 after 3.42 seconds
[0m08:47:18.677478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fd66c60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a631640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64a28b60>]}
[0m08:47:18.677791 [debug] [MainThread]: Flushing usage events
[0m08:47:21.240873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94694380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9509abd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff946942f0>]}


============================== 08:47:21.243887 | 4f12d849-4238-4296-b6f3-222690ed9954 ==============================
[0m08:47:21.243887 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:47:21.244345 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:47:21.612802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7423af00>]}
[0m08:47:21.644831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff857c6d20>]}
[0m08:47:21.645258 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:47:21.648733 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:47:21.663171 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:47:21.663365 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:47:21.665699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f431ee0>]}
[0m08:47:21.671875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f36cfb0>]}
[0m08:47:21.672120 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:47:21.672452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff946988c0>]}
[0m08:47:21.673241 [info ] [MainThread]: 
[0m08:47:21.673688 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:47:21.674263 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:47:21.679669 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:47:21.679852 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:47:21.680018 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:47:22.254727 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:47:22.257963 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:47:22.394508 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:47:22.406685 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:47:22.407194 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:47:22.407569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:22.931142 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m08:47:22.934865 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:47:23.049320 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:47:23.053204 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:47:23.053812 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:47:23.054731 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:23.400810 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:47:23.402968 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:47:23.556568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f33aab0>]}
[0m08:47:23.557830 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:47:23.559435 [info ] [MainThread]: 
[0m08:47:23.568807 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:47:23.569358 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:47:23.570197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:47:23.570483 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:47:23.577192 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:47:23.570687 => 08:47:23.577012
[0m08:47:23.577468 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:47:23.606552 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:23.606780 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:47:23.606964 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:24.212323 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:47:24.224980 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:24.226070 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:24.309872 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:24.322681 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:24.323317 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:24.430505 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:24.461710 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:24.462229 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:47:25.870268 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:47:25.875706 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:25.876356 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:47:26.008680 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:47:26.010963 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:26.011251 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:26.137170 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:26.143296 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:26.144159 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:47:26.225731 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:47:26.229339 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:26.229671 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:26.312560 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:26.323109 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:26.323749 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:47:26.446251 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:47:26.457438 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:47:26.461317 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:26.461887 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:47:26.575074 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:26.576081 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:26.576603 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:47:27.309099 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m08:47:27.310284 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:27.310941 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:47:27.711478 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:27.735567 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:47:23.577649 => 08:47:27.735370
[0m08:47:27.736096 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:47:27.855425 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e7f0bc0>]}
[0m08:47:27.857010 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 4.29s]
[0m08:47:27.858564 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:47:27.859203 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:27.859866 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:47:27.860970 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:47:27.861531 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:27.867079 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:47:27.861917 => 08:47:27.866667
[0m08:47:27.867734 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:27.871976 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:27.872580 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:47:27.872955 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:28.429937 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:47:28.436122 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:28.437015 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:28.537490 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:47:28.542867 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:28.543926 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:28.617298 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:47:28.627195 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:28.627951 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:47:29.657556 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:47:29.660208 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:29.660463 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:47:29.780643 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:47:29.784351 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:29.784689 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:29.865983 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:47:29.871559 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:29.872277 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:47:29.981399 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:47:29.987340 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:29.988165 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:30.081398 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:47:30.088422 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:30.089407 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:47:30.179541 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:47:30.182939 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:30.185108 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:30.185475 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:47:30.376696 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:30.377853 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:30.378493 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:47:31.220637 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:47:31.221693 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:31.222277 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:47:31.602790 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:31.607426 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:47:27.868066 => 08:47:31.607158
[0m08:47:31.608359 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:47:31.795829 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f12d849-4238-4296-b6f3-222690ed9954', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e6c5e20>]}
[0m08:47:31.797535 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.93s]
[0m08:47:31.800121 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:31.803586 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:47:31.804044 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:47:31.804468 [info ] [MainThread]: 
[0m08:47:31.805400 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.13 seconds (10.13s).
[0m08:47:31.806439 [debug] [MainThread]: Command end result
[0m08:47:31.820774 [info ] [MainThread]: 
[0m08:47:31.821648 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:47:31.821974 [info ] [MainThread]: 
[0m08:47:31.822356 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:47:31.824248 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 10.605894, "process_user_time": 2.810442, "process_kernel_time": 0.143785, "process_mem_max_rss": "213900", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:47:31.824849 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:47:31.824763 after 10.61 seconds
[0m08:47:31.825288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91365610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f4626f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f0da5a0>]}
[0m08:47:31.825587 [debug] [MainThread]: Flushing usage events
[0m08:54:59.704932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa77ea1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7c1fe90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa77e9b20>]}


============================== 08:54:59.709445 | d9a7571d-8ab4-4a04-81cd-43bc021f6a16 ==============================
[0m08:54:59.709445 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:54:59.709726 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:55:00.083844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9a7571d-8ab4-4a04-81cd-43bc021f6a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7b38770>]}
[0m08:55:00.114744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9a7571d-8ab4-4a04-81cd-43bc021f6a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa78807a0>]}
[0m08:55:00.115121 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:55:00.118462 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:55:00.134600 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:55:00.134777 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:55:00.137269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9a7571d-8ab4-4a04-81cd-43bc021f6a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff823fb980>]}
[0m08:55:00.142707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9a7571d-8ab4-4a04-81cd-43bc021f6a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff823b0860>]}
[0m08:55:00.142897 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:55:00.143035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9a7571d-8ab4-4a04-81cd-43bc021f6a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff828e6a50>]}
[0m08:55:00.143711 [info ] [MainThread]: 
[0m08:55:00.144033 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:55:00.144542 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:55:00.149554 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:55:00.149717 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:55:00.149862 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:55:00.685460 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:55:00.688641 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:55:00.842883 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m08:55:00.853179 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:55:00.854089 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:55:00.854653 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:55:01.311829 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:55:01.315085 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:55:01.471617 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:55:01.475902 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:55:01.476589 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:55:01.477689 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:55:01.946070 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:55:01.949460 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:55:02.078496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9a7571d-8ab4-4a04-81cd-43bc021f6a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82346420>]}
[0m08:55:02.079943 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:55:02.081315 [info ] [MainThread]: 
[0m08:55:02.092409 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:55:02.093371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m08:55:02.093780 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:55:02.101216 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:55:02.103483 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:55:02.094064 => 08:55:02.103277
[0m08:55:02.104262 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:55:02.104609 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:55:02.105325 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:55:02.105614 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:55:02.108057 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:55:02.108909 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:55:02.105808 => 08:55:02.108762
[0m08:55:02.109424 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:55:02.109914 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:55:02.110204 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:55:02.110969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:55:02.111217 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:55:02.134350 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:55:02.135293 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:55:02.111382 => 08:55:02.135203
[0m08:55:02.135474 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:55:02.147204 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:55:02.149525 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:55:02.149870 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m08:55:02.150171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:55:03.675505 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:55:03.686551 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:55:02.135592 => 08:55:03.686434
[0m08:55:03.686822 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:55:03.851309 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9a7571d-8ab4-4a04-81cd-43bc021f6a16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff823b2240>]}
[0m08:55:03.852519 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.74s]
[0m08:55:03.853640 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:55:03.856845 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:55:03.857311 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:55:03.857735 [info ] [MainThread]: 
[0m08:55:03.858413 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.71 seconds (3.71s).
[0m08:55:03.859231 [debug] [MainThread]: Command end result
[0m08:55:03.872037 [info ] [MainThread]: 
[0m08:55:03.872735 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:55:03.873218 [info ] [MainThread]: 
[0m08:55:03.874131 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:55:03.875616 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.195479, "process_user_time": 2.487012, "process_kernel_time": 0.14516, "process_mem_max_rss": "212796", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m08:55:03.876186 [debug] [MainThread]: Command `dbt run` succeeded at 08:55:03.876027 after 4.20 seconds
[0m08:55:03.876525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa77ed0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82676150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff819f97f0>]}
[0m08:55:03.876879 [debug] [MainThread]: Flushing usage events
[0m08:55:06.744215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff944bfe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff945551f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94476360>]}


============================== 08:55:06.746901 | 1aee7ffd-977e-4d97-afeb-9705b7dec487 ==============================
[0m08:55:06.746901 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:55:06.747204 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:55:07.092912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1aee7ffd-977e-4d97-afeb-9705b7dec487', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74242840>]}
[0m08:55:07.123336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1aee7ffd-977e-4d97-afeb-9705b7dec487', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f667aa0>]}
[0m08:55:07.123647 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:55:07.126743 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:55:07.139112 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:55:07.139283 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:55:07.141467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1aee7ffd-977e-4d97-afeb-9705b7dec487', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f0e3f50>]}
[0m08:55:07.146344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1aee7ffd-977e-4d97-afeb-9705b7dec487', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f2ad100>]}
[0m08:55:07.146526 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:55:07.146715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1aee7ffd-977e-4d97-afeb-9705b7dec487', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff944776e0>]}
[0m08:55:07.147484 [info ] [MainThread]: 
[0m08:55:07.147824 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:55:07.148405 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m08:55:07.154043 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:55:07.154221 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:55:07.154359 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:55:07.651339 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:55:07.654301 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:55:07.819029 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:55:07.825247 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:55:07.826291 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:55:07.826978 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:55:08.358345 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m08:55:08.361729 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:55:08.533724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1aee7ffd-977e-4d97-afeb-9705b7dec487', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6f531c70>]}
[0m08:55:08.534962 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:55:08.535518 [info ] [MainThread]: 
[0m08:55:08.542582 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:55:08.542899 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:55:08.543284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:55:08.543451 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:55:08.550795 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:55:08.552382 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:55:08.543568 => 08:55:08.552287
[0m08:55:08.552561 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:55:08.563439 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:55:08.566270 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:55:08.566563 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:55:08.566818 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:55:08.997999 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:55:09.008482 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:55:08.552669 => 08:55:09.008073
[0m08:55:09.009359 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:55:09.123058 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.58s]
[0m08:55:09.124370 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:55:09.125046 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:55:09.125641 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:55:09.126627 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:55:09.127170 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:55:09.133035 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:55:09.135039 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:55:09.127485 => 08:55:09.134840
[0m08:55:09.135352 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:55:09.137450 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:55:09.138619 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:55:09.138934 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:55:09.139161 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:55:09.696378 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:55:09.699577 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:55:09.135555 => 08:55:09.699286
[0m08:55:09.700113 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:55:09.831884 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.71s]
[0m08:55:09.832913 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:55:09.833444 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:55:09.833941 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:55:09.834753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:55:09.835193 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:55:09.843938 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:55:09.845255 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:55:09.835482 => 08:55:09.845078
[0m08:55:09.845552 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:55:09.846946 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:55:09.847928 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:55:09.848143 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:55:09.848322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:55:10.382471 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:55:10.386092 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:55:09.845750 => 08:55:10.385739
[0m08:55:10.386734 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:55:10.558370 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.72s]
[0m08:55:10.559799 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:55:10.563272 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:55:10.564072 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:55:10.564724 [info ] [MainThread]: 
[0m08:55:10.565998 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.42 seconds (3.42s).
[0m08:55:10.568420 [debug] [MainThread]: Command end result
[0m08:55:10.581469 [info ] [MainThread]: 
[0m08:55:10.582050 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:55:10.582304 [info ] [MainThread]: 
[0m08:55:10.582686 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:55:10.584166 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.8602638, "process_user_time": 2.429308, "process_kernel_time": 0.120965, "process_mem_max_rss": "212160", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m08:55:10.584627 [debug] [MainThread]: Command `dbt test` succeeded at 08:55:10.584538 after 3.86 seconds
[0m08:55:10.584980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff944bfe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff944774a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94477ad0>]}
[0m08:55:10.585307 [debug] [MainThread]: Flushing usage events
[0m08:55:12.807950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff880d0200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff880d0ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff885bcd70>]}


============================== 08:55:12.810619 | cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a ==============================
[0m08:55:12.810619 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:55:12.811026 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:55:13.180711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62e78050>]}
[0m08:55:13.211550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b1a69f0>]}
[0m08:55:13.211880 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:55:13.215009 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:55:13.227621 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:55:13.227787 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:55:13.229827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62d32a20>]}
[0m08:55:13.235159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62de50d0>]}
[0m08:55:13.235347 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:55:13.235652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62e4c680>]}
[0m08:55:13.236347 [info ] [MainThread]: 
[0m08:55:13.236760 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:55:13.237306 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:55:13.242330 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:55:13.242478 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:55:13.242608 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:55:13.632743 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:55:13.633784 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:55:13.759804 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:55:13.769258 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:55:13.769680 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:55:13.770035 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:55:14.178166 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:55:14.180059 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:55:14.362810 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:55:14.367805 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:55:14.368815 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:55:14.370193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:55:14.760808 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m08:55:14.764178 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:55:14.926701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62121c70>]}
[0m08:55:14.928337 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:55:14.929645 [info ] [MainThread]: 
[0m08:55:14.943338 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:55:14.944117 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:55:14.944944 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:55:14.945320 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:55:14.952872 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:55:14.945590 => 08:55:14.952664
[0m08:55:14.953198 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:55:14.988840 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:14.989195 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:55:14.989425 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:55:15.428524 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:55:15.441302 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:15.442090 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:55:15.526739 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:55:15.539315 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:15.539929 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:55:15.638491 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:55:15.662175 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:15.662640 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:55:16.680619 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:55:16.684604 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:16.685174 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:55:16.861950 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:55:16.865367 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:16.865715 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:55:16.978365 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:55:16.982559 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:16.982972 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:55:17.089968 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:55:17.095844 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:17.096476 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:55:17.173565 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:55:17.184084 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:17.184731 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:55:17.284944 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:55:17.295852 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:55:17.299552 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:17.300042 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:55:17.461935 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:55:17.463037 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:17.463747 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:55:18.211056 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m08:55:18.212232 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:55:18.212844 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:55:18.471590 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:55:18.495915 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:55:14.953408 => 08:55:18.495691
[0m08:55:18.496448 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:55:18.635875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6215dee0>]}
[0m08:55:18.636822 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 3.69s]
[0m08:55:18.637568 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:55:18.638046 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:55:18.638497 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:55:18.639205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:55:18.639602 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:55:18.641938 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:55:18.639887 => 08:55:18.641769
[0m08:55:18.642238 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:55:18.644138 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:18.644381 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:55:18.644587 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:55:19.145251 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:55:19.150246 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:19.150975 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:55:19.236476 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:55:19.241927 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:19.242392 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:55:19.332812 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:55:19.342939 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:19.343812 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:55:20.164823 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:55:20.169587 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.170247 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:55:20.351948 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:55:20.357209 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.357743 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:55:20.453642 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:55:20.459792 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.460484 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:55:20.569263 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:55:20.576144 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.577112 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:55:20.653853 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:55:20.657888 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.658304 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:55:20.746589 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:55:20.750826 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.753897 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.754552 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:55:20.878283 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:55:20.879217 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:20.879791 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:55:21.369926 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:55:21.371063 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:55:21.371778 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:55:21.937583 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:55:21.941683 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:55:18.642394 => 08:55:21.941423
[0m08:55:21.942254 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:55:22.101096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb7ba018-4f0b-4a0c-aeb6-751ca2f86b9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62097020>]}
[0m08:55:22.104977 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.46s]
[0m08:55:22.105901 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:55:22.108654 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:55:22.109721 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:55:22.110633 [info ] [MainThread]: 
[0m08:55:22.111085 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.87 seconds (8.87s).
[0m08:55:22.111568 [debug] [MainThread]: Command end result
[0m08:55:22.121685 [info ] [MainThread]: 
[0m08:55:22.121940 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:55:22.122065 [info ] [MainThread]: 
[0m08:55:22.122379 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:55:22.122877 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 9.336043, "process_user_time": 2.678588, "process_kernel_time": 0.16255, "process_mem_max_rss": "213564", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m08:55:22.124662 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:55:22.124580 after 9.34 seconds
[0m08:55:22.124995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88453530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff887e7800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62db6b40>]}
[0m08:55:22.125247 [debug] [MainThread]: Flushing usage events
[0m09:02:13.089354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1bc48c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1ffa120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1bc4890>]}


============================== 09:02:13.092693 | 28373bad-3451-4625-bde5-678b17678c26 ==============================
[0m09:02:13.092693 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:02:13.092957 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:02:13.476191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28373bad-3451-4625-bde5-678b17678c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff912bed80>]}
[0m09:02:13.507804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28373bad-3451-4625-bde5-678b17678c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90eef1d0>]}
[0m09:02:13.508155 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:02:13.512229 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:02:13.526135 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:02:13.526320 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:02:13.528720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28373bad-3451-4625-bde5-678b17678c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1bcb620>]}
[0m09:02:13.534620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28373bad-3451-4625-bde5-678b17678c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff907b4b60>]}
[0m09:02:13.534845 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:02:13.535150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28373bad-3451-4625-bde5-678b17678c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9215ab70>]}
[0m09:02:13.535942 [info ] [MainThread]: 
[0m09:02:13.536361 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:02:13.536876 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m09:02:13.542035 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m09:02:13.542224 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m09:02:13.542362 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:02:13.980498 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m09:02:13.981485 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m09:02:14.134753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m09:02:14.144158 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:02:14.144696 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:02:14.145120 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:02:14.541386 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m09:02:14.550292 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:02:14.710702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m09:02:14.716249 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:02:14.717013 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:02:14.718238 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:02:15.452651 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m09:02:15.454864 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:02:15.612546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28373bad-3451-4625-bde5-678b17678c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff905ecf20>]}
[0m09:02:15.614521 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:02:15.617085 [info ] [MainThread]: 
[0m09:02:15.631452 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m09:02:15.632618 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m09:02:15.633108 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m09:02:15.641904 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m09:02:15.644497 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 09:02:15.633417 => 09:02:15.644309
[0m09:02:15.645281 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m09:02:15.645640 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m09:02:15.646376 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m09:02:15.646650 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m09:02:15.649121 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m09:02:15.650191 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 09:02:15.646848 => 09:02:15.650066
[0m09:02:15.650743 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m09:02:15.651501 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m09:02:15.651919 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m09:02:15.652798 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m09:02:15.653036 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m09:02:15.676202 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m09:02:15.677043 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 09:02:15.653169 => 09:02:15.676914
[0m09:02:15.677261 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m09:02:15.689500 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m09:02:15.691791 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m09:02:15.692072 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m09:02:15.692362 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:02:17.686883 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m09:02:17.705430 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 09:02:15.677396 => 09:02:17.705314
[0m09:02:17.705753 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m09:02:17.864589 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28373bad-3451-4625-bde5-678b17678c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90c13050>]}
[0m09:02:17.865721 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.21s]
[0m09:02:17.867321 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m09:02:17.870048 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:02:17.870588 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m09:02:17.871314 [info ] [MainThread]: 
[0m09:02:17.872329 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.33 seconds (4.33s).
[0m09:02:17.873447 [debug] [MainThread]: Command end result
[0m09:02:17.886238 [info ] [MainThread]: 
[0m09:02:17.886907 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:02:17.887150 [info ] [MainThread]: 
[0m09:02:17.887552 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:02:17.888633 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8223605, "process_user_time": 2.490398, "process_kernel_time": 0.134505, "process_mem_max_rss": "212636", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m09:02:17.888999 [debug] [MainThread]: Command `dbt run` succeeded at 09:02:17.888923 after 4.82 seconds
[0m09:02:17.889250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1bc8440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1fae2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90c13050>]}
[0m09:02:17.889434 [debug] [MainThread]: Flushing usage events
[0m09:02:21.002463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa824ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaad2b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa927950>]}


============================== 09:02:21.005525 | 8ac8319a-b977-4e25-ad70-ad5ca2de802b ==============================
[0m09:02:21.005525 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:02:21.006282 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m09:02:21.392870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ac8319a-b977-4e25-ad70-ad5ca2de802b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89d21c10>]}
[0m09:02:21.423745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ac8319a-b977-4e25-ad70-ad5ca2de802b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f861130>]}
[0m09:02:21.424079 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:02:21.427355 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:02:21.440455 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:02:21.440640 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:02:21.442810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ac8319a-b977-4e25-ad70-ad5ca2de802b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff898fb170>]}
[0m09:02:21.448132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ac8319a-b977-4e25-ad70-ad5ca2de802b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8962cc50>]}
[0m09:02:21.448324 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:02:21.448648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ac8319a-b977-4e25-ad70-ad5ca2de802b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa6a1d60>]}
[0m09:02:21.449358 [info ] [MainThread]: 
[0m09:02:21.449738 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:02:21.450334 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m09:02:21.455951 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:02:21.456122 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:02:21.456257 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:02:21.978057 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m09:02:21.980144 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:02:22.108220 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m09:02:22.112752 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:02:22.113121 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:02:22.113438 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:02:22.558644 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:02:22.561355 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:02:22.708901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ac8319a-b977-4e25-ad70-ad5ca2de802b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa8250a0>]}
[0m09:02:22.710323 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:02:22.711641 [info ] [MainThread]: 
[0m09:02:22.722755 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:02:22.723425 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m09:02:22.724569 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m09:02:22.724954 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:02:22.737132 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:02:22.738296 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 09:02:22.725220 => 09:02:22.738184
[0m09:02:22.738468 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:02:22.748467 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:02:22.749440 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:02:22.749675 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m09:02:22.749914 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:02:23.904230 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:02:23.910914 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 09:02:22.738584 => 09:02:23.910705
[0m09:02:23.911290 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m09:02:24.043540 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 1.32s]
[0m09:02:24.045045 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:02:24.045526 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:02:24.045969 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m09:02:24.046831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m09:02:24.047166 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:02:24.051520 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m09:02:24.053119 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 09:02:24.047403 => 09:02:24.052969
[0m09:02:24.053411 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:02:24.055421 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m09:02:24.056440 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m09:02:24.056672 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m09:02:24.056896 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:02:24.502447 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:02:24.504183 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 09:02:24.053604 => 09:02:24.504032
[0m09:02:24.504461 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m09:02:24.617249 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.57s]
[0m09:02:24.618177 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:02:24.618438 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:02:24.618656 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m09:02:24.619060 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m09:02:24.619323 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:02:24.624571 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m09:02:24.625528 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 09:02:24.619446 => 09:02:24.625430
[0m09:02:24.625708 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:02:24.626893 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m09:02:24.627789 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m09:02:24.627981 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m09:02:24.628163 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:02:25.177582 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:02:25.178928 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 09:02:24.625827 => 09:02:25.178822
[0m09:02:25.179150 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m09:02:25.325273 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.71s]
[0m09:02:25.325729 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:02:25.326850 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:02:25.327039 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m09:02:25.327228 [info ] [MainThread]: 
[0m09:02:25.327583 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.88 seconds (3.88s).
[0m09:02:25.328077 [debug] [MainThread]: Command end result
[0m09:02:25.333177 [info ] [MainThread]: 
[0m09:02:25.333543 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:02:25.333726 [info ] [MainThread]: 
[0m09:02:25.333979 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m09:02:25.334602 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.3538284, "process_user_time": 2.576096, "process_kernel_time": 0.181699, "process_mem_max_rss": "212416", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m09:02:25.334863 [debug] [MainThread]: Command `dbt test` succeeded at 09:02:25.334814 after 4.35 seconds
[0m09:02:25.335057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa927950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89305a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaac14ad0>]}
[0m09:02:25.335252 [debug] [MainThread]: Flushing usage events
[0m09:02:27.104394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9064440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91032c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9064bf0>]}


============================== 09:02:27.107210 | 7a70c37e-d553-47ba-911f-9a449f4f7cbb ==============================
[0m09:02:27.107210 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:02:27.107666 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:02:27.441050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff882fc740>]}
[0m09:02:27.472829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83f7e630>]}
[0m09:02:27.473171 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:02:27.476781 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:02:27.489165 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:02:27.489344 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:02:27.491627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d259a0>]}
[0m09:02:27.497230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d5c7d0>]}
[0m09:02:27.497431 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:02:27.497771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83ca4ec0>]}
[0m09:02:27.498535 [info ] [MainThread]: 
[0m09:02:27.498950 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:02:27.499514 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m09:02:27.504936 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m09:02:27.505159 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m09:02:27.505376 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:02:27.915791 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m09:02:27.918100 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m09:02:28.055434 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m09:02:28.063328 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:02:28.063723 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:02:28.064200 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:02:28.471985 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m09:02:28.475584 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:02:28.619866 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m09:02:28.624309 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:02:28.624892 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:02:28.625804 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:02:29.060564 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:02:29.064141 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:02:29.239889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8963fdd0>]}
[0m09:02:29.241283 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:02:29.241812 [info ] [MainThread]: 
[0m09:02:29.253179 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m09:02:29.253963 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m09:02:29.254893 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m09:02:29.255396 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m09:02:29.263065 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 09:02:29.255670 => 09:02:29.262858
[0m09:02:29.263406 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m09:02:29.295645 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:29.295873 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m09:02:29.296065 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:02:29.801331 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m09:02:29.813425 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:29.814196 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:02:29.894773 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:02:29.906486 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:29.907112 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:02:30.131342 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:02:30.157440 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:30.157932 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:02:31.273601 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:02:31.279030 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:31.279657 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:02:31.417033 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:02:31.422387 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:31.422956 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:02:31.535492 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:02:31.540147 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:31.540675 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:02:31.639445 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:02:31.644738 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:31.646622 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:02:31.732874 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:02:31.742041 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:31.742612 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:02:31.873753 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:02:31.883983 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m09:02:31.886461 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:31.886893 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m09:02:32.030704 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:02:32.031304 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:32.031584 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m09:02:32.743517 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m09:02:32.744209 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:02:32.744699 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m09:02:33.093064 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:02:33.110359 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 09:02:29.263618 => 09:02:33.110192
[0m09:02:33.110656 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m09:02:33.257158 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff831072c0>]}
[0m09:02:33.258558 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 4.00s]
[0m09:02:33.262715 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m09:02:33.263411 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m09:02:33.264042 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m09:02:33.265044 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m09:02:33.265480 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m09:02:33.269387 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 09:02:33.265733 => 09:02:33.269265
[0m09:02:33.269629 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m09:02:33.271639 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:33.271828 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m09:02:33.272024 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:02:35.537292 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 2.0 seconds
[0m09:02:35.542721 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:35.543426 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:02:35.642223 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:02:35.647402 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:35.647904 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:02:35.747647 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:02:35.758052 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:35.758915 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:02:37.328726 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m09:02:37.333480 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:37.334144 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:02:37.496725 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:02:37.501855 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:37.502387 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:02:37.625109 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:02:37.630774 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:37.631313 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:02:37.770921 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:02:37.775725 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:37.776201 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:02:37.867376 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:02:37.873770 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:37.874351 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:02:37.982441 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:02:37.987830 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:37.992716 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:37.993486 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m09:02:38.231762 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:02:38.233109 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:38.233817 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m09:02:38.987662 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m09:02:38.989011 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:02:38.989586 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m09:02:39.396042 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:02:39.402346 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 09:02:33.269761 => 09:02:39.401801
[0m09:02:39.403358 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m09:02:39.541032 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a70c37e-d553-47ba-911f-9a449f4f7cbb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff830a4e00>]}
[0m09:02:39.542116 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 6.28s]
[0m09:02:39.543601 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m09:02:39.551698 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:02:39.552001 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m09:02:39.552348 [info ] [MainThread]: 
[0m09:02:39.552857 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 12.05 seconds (12.05s).
[0m09:02:39.553614 [debug] [MainThread]: Command end result
[0m09:02:39.562357 [info ] [MainThread]: 
[0m09:02:39.562841 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:02:39.563030 [info ] [MainThread]: 
[0m09:02:39.563328 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:02:39.564809 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.481814, "process_user_time": 2.710015, "process_kernel_time": 0.134149, "process_mem_max_rss": "213644", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m09:02:39.565278 [debug] [MainThread]: Command `dbt snapshot` succeeded at 09:02:39.565186 after 12.48 seconds
[0m09:02:39.565649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa93d9640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91032c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83102ae0>]}
[0m09:02:39.565893 [debug] [MainThread]: Flushing usage events
[0m09:09:00.877038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1227ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa165c950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa12bf110>]}


============================== 09:09:00.879976 | 45bf29bb-ff31-46dc-aa46-1ebed67a4e14 ==============================
[0m09:09:00.879976 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:09:00.880699 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:09:01.261687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45bf29bb-ff31-46dc-aa46-1ebed67a4e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8189b950>]}
[0m09:09:01.296160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45bf29bb-ff31-46dc-aa46-1ebed67a4e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80a2e000>]}
[0m09:09:01.296528 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:09:01.301079 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:09:01.317695 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:09:01.317872 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:09:01.320025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45bf29bb-ff31-46dc-aa46-1ebed67a4e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff802186e0>]}
[0m09:09:01.325541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45bf29bb-ff31-46dc-aa46-1ebed67a4e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bff9490>]}
[0m09:09:01.325797 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:09:01.326109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45bf29bb-ff31-46dc-aa46-1ebed67a4e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa12c2f60>]}
[0m09:09:01.326887 [info ] [MainThread]: 
[0m09:09:01.327318 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:09:01.327842 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m09:09:01.332776 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m09:09:01.332926 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m09:09:01.333060 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:09:01.884652 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m09:09:01.887726 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m09:09:02.041408 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m09:09:02.054441 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:09:02.055056 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:09:02.055509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:09:02.486292 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:09:02.490795 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:09:02.615047 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m09:09:02.619349 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:09:02.619995 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:09:02.621186 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:09:03.328907 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.0 seconds
[0m09:09:03.332355 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:09:03.478453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45bf29bb-ff31-46dc-aa46-1ebed67a4e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa10a2300>]}
[0m09:09:03.480853 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:09:03.483417 [info ] [MainThread]: 
[0m09:09:03.497101 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m09:09:03.497992 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m09:09:03.498427 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m09:09:03.506869 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m09:09:03.508635 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 09:09:03.498704 => 09:09:03.508455
[0m09:09:03.509376 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m09:09:03.509713 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m09:09:03.510424 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m09:09:03.510751 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m09:09:03.512969 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m09:09:03.513897 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 09:09:03.510923 => 09:09:03.513771
[0m09:09:03.514415 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m09:09:03.515060 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m09:09:03.515414 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m09:09:03.516178 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m09:09:03.516395 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m09:09:03.539839 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m09:09:03.540597 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 09:09:03.516517 => 09:09:03.540506
[0m09:09:03.540781 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m09:09:03.554376 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m09:09:03.556907 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m09:09:03.557183 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m09:09:03.557504 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:09:04.955945 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:09:04.979086 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 09:09:03.540914 => 09:09:04.978870
[0m09:09:04.979533 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m09:09:05.114678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45bf29bb-ff31-46dc-aa46-1ebed67a4e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b301490>]}
[0m09:09:05.115887 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.60s]
[0m09:09:05.117467 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m09:09:05.119859 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:09:05.120298 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m09:09:05.120724 [info ] [MainThread]: 
[0m09:09:05.121430 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.79 seconds (3.79s).
[0m09:09:05.122216 [debug] [MainThread]: Command end result
[0m09:09:05.136286 [info ] [MainThread]: 
[0m09:09:05.136898 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:09:05.137296 [info ] [MainThread]: 
[0m09:09:05.137713 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:09:05.139074 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.282976, "process_user_time": 2.463176, "process_kernel_time": 0.145852, "process_mem_max_rss": "212528", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m09:09:05.139630 [debug] [MainThread]: Command `dbt run` succeeded at 09:09:05.139517 after 4.28 seconds
[0m09:09:05.140036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1728980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa18bc440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa12c2f60>]}
[0m09:09:05.140368 [debug] [MainThread]: Flushing usage events
[0m09:09:07.977133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa01c1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa01d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa01ef60>]}


============================== 09:09:07.979890 | 3f33c954-0cd2-40f6-bb6e-80dc7c89a658 ==============================
[0m09:09:07.979890 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:09:07.980286 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:09:08.374267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3f33c954-0cd2-40f6-bb6e-80dc7c89a658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89067800>]}
[0m09:09:08.404932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3f33c954-0cd2-40f6-bb6e-80dc7c89a658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a6660c0>]}
[0m09:09:08.405314 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:09:08.408479 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:09:08.420339 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:09:08.420505 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:09:08.422574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3f33c954-0cd2-40f6-bb6e-80dc7c89a658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff890679e0>]}
[0m09:09:08.427597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3f33c954-0cd2-40f6-bb6e-80dc7c89a658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88e08fe0>]}
[0m09:09:08.427782 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:09:08.428072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f33c954-0cd2-40f6-bb6e-80dc7c89a658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89342d20>]}
[0m09:09:08.428777 [info ] [MainThread]: 
[0m09:09:08.429138 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:09:08.429707 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m09:09:08.435103 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:09:08.435282 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:09:08.435427 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:09:08.870939 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m09:09:08.872779 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:09:09.010725 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m09:09:09.014158 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:09:09.014589 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:09:09.014894 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:09:09.440308 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:09:09.443704 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:09:09.580639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f33c954-0cd2-40f6-bb6e-80dc7c89a658', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88e75f40>]}
[0m09:09:09.582224 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:09:09.582720 [info ] [MainThread]: 
[0m09:09:09.592807 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:09:09.593414 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m09:09:09.594534 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m09:09:09.595043 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:09:09.609345 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:09:09.611683 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 09:09:09.595480 => 09:09:09.611526
[0m09:09:09.611969 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:09:09.623218 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:09:09.624263 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:09:09.624474 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m09:09:09.624675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:09:10.134128 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:09:10.146873 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 09:09:09.612151 => 09:09:10.146443
[0m09:09:10.147638 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m09:09:10.496390 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.90s]
[0m09:09:10.498463 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:09:10.499329 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:09:10.499945 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m09:09:10.501174 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m09:09:10.501724 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:09:10.508076 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m09:09:10.511111 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 09:09:10.502070 => 09:09:10.510758
[0m09:09:10.511704 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:09:10.518201 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m09:09:10.520362 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m09:09:10.520780 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m09:09:10.521415 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:09:11.025874 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:09:11.030054 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 09:09:10.512085 => 09:09:11.029712
[0m09:09:11.030915 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m09:09:11.164795 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.66s]
[0m09:09:11.166828 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m09:09:11.167628 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:09:11.168221 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m09:09:11.169463 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m09:09:11.169955 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:09:11.182601 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m09:09:11.184214 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 09:09:11.170327 => 09:09:11.183996
[0m09:09:11.184602 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:09:11.187153 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m09:09:11.188703 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m09:09:11.189024 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m09:09:11.189335 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:09:11.796632 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:09:11.797870 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 09:09:11.184841 => 09:09:11.797770
[0m09:09:11.798098 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m09:09:11.968202 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.80s]
[0m09:09:11.968900 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m09:09:11.970208 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:09:11.970487 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m09:09:11.970756 [info ] [MainThread]: 
[0m09:09:11.971125 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.54 seconds (3.54s).
[0m09:09:11.971689 [debug] [MainThread]: Command end result
[0m09:09:11.977883 [info ] [MainThread]: 
[0m09:09:11.978182 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:09:11.978387 [info ] [MainThread]: 
[0m09:09:11.978611 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m09:09:11.979166 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.0223527, "process_user_time": 2.41316, "process_kernel_time": 0.139766, "process_mem_max_rss": "212284", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m09:09:11.979438 [debug] [MainThread]: Command `dbt test` succeeded at 09:09:11.979387 after 4.02 seconds
[0m09:09:11.979627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaae23620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f0b9be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa01c1a0>]}
[0m09:09:11.979837 [debug] [MainThread]: Flushing usage events
[0m09:09:14.304115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa37d28d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3335a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3337980>]}


============================== 09:09:14.306711 | d1b9e3f1-7be1-4d1e-8deb-47d63fd4e740 ==============================
[0m09:09:14.306711 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:09:14.307215 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:09:14.677096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3335280>]}
[0m09:09:14.708083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88340c80>]}
[0m09:09:14.708420 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:09:14.711741 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:09:14.724781 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:09:14.724946 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:09:14.727104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff820604a0>]}
[0m09:09:14.731852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff820c9250>]}
[0m09:09:14.732066 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:09:14.732384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa333bc80>]}
[0m09:09:14.733111 [info ] [MainThread]: 
[0m09:09:14.733549 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:09:14.734116 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m09:09:14.739084 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m09:09:14.739242 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m09:09:14.739395 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:09:15.204579 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m09:09:15.206546 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m09:09:15.352199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m09:09:15.363025 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:09:15.363620 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:09:15.364215 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:09:15.755629 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:09:15.758919 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:09:15.888647 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m09:09:15.890075 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:09:15.890311 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:09:15.890695 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:09:16.267538 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m09:09:16.271051 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:09:16.402617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81eeff20>]}
[0m09:09:16.403833 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:09:16.405082 [info ] [MainThread]: 
[0m09:09:16.415408 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m09:09:16.415995 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m09:09:16.416929 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m09:09:16.417211 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m09:09:16.423532 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 09:09:16.417425 => 09:09:16.423382
[0m09:09:16.423788 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m09:09:16.453666 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:16.453978 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m09:09:16.454172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:09:16.872016 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m09:09:16.884103 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:16.884844 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:09:16.984105 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:09:16.994923 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:16.995577 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:09:17.080878 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:09:17.105748 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:17.106188 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:09:18.558316 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:09:18.564245 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:18.564896 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:09:18.700952 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:09:18.706777 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:18.707550 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:09:18.806411 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:09:18.808494 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:18.808766 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:09:19.240326 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:09:19.247128 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:19.247794 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:09:19.333958 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:09:19.344212 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:19.345077 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:09:19.435722 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:09:19.446558 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m09:09:19.449981 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:19.450381 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m09:09:19.613374 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:09:19.614412 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:19.615070 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m09:09:20.443662 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m09:09:20.444932 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:09:20.445460 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m09:09:20.913812 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:09:20.938368 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 09:09:16.423951 => 09:09:20.938125
[0m09:09:20.938823 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m09:09:21.065691 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81312c90>]}
[0m09:09:21.067055 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 4.65s]
[0m09:09:21.068129 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m09:09:21.068985 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m09:09:21.069612 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m09:09:21.070688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m09:09:21.071175 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m09:09:21.078693 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 09:09:21.071517 => 09:09:21.078345
[0m09:09:21.079267 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m09:09:21.083875 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:21.084394 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m09:09:21.084758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:09:21.834522 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m09:09:21.840010 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:21.840786 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:09:21.964530 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:09:21.969827 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:21.970351 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:09:22.449566 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:09:22.461642 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:22.462347 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:09:23.733137 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:09:23.737428 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:23.737920 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:09:23.832656 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:09:23.835175 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:23.837485 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:09:23.923200 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:09:23.924958 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:23.925161 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:09:24.014819 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:09:24.017321 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:24.017639 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:09:24.104931 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:09:24.107143 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:24.107411 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:09:24.243791 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:09:24.245320 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:24.247641 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:24.247904 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m09:09:24.405927 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:09:24.406338 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:24.406763 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m09:09:25.368284 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m09:09:25.369154 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:09:25.369410 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m09:09:25.756935 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:09:25.786391 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 09:09:21.079630 => 09:09:25.784917
[0m09:09:25.787106 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m09:09:25.931253 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b9e3f1-7be1-4d1e-8deb-47d63fd4e740', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8131c4a0>]}
[0m09:09:25.932154 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.86s]
[0m09:09:25.934084 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m09:09:25.938839 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:09:25.939157 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m09:09:25.939450 [info ] [MainThread]: 
[0m09:09:25.939946 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 11.21 seconds (11.21s).
[0m09:09:25.940705 [debug] [MainThread]: Command end result
[0m09:09:25.954794 [info ] [MainThread]: 
[0m09:09:25.955423 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:09:25.955655 [info ] [MainThread]: 
[0m09:09:25.956062 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:09:25.957701 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.673479, "process_user_time": 2.742907, "process_kernel_time": 0.12712, "process_mem_max_rss": "213624", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m09:09:25.958354 [debug] [MainThread]: Command `dbt snapshot` succeeded at 09:09:25.958219 after 11.67 seconds
[0m09:09:25.958819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa32f1e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81eeff80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81eef9b0>]}
[0m09:09:25.959074 [debug] [MainThread]: Flushing usage events
[0m02:01:20.288422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa19b6900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2966000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa19b4bc0>]}


============================== 02:01:20.292490 | da83c272-f622-47c2-93b0-bc53d3256962 ==============================
[0m02:01:20.292490 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:20.293169 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:01:20.716230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da83c272-f622-47c2-93b0-bc53d3256962', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86a6f650>]}
[0m02:01:20.746855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da83c272-f622-47c2-93b0-bc53d3256962', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff809a36e0>]}
[0m02:01:20.747178 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:20.750609 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:20.764547 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:20.764681 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:20.767064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da83c272-f622-47c2-93b0-bc53d3256962', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80a3a930>]}
[0m02:01:20.775328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da83c272-f622-47c2-93b0-bc53d3256962', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff805b88f0>]}
[0m02:01:20.775806 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:20.776138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da83c272-f622-47c2-93b0-bc53d3256962', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8087d880>]}
[0m02:01:20.777625 [info ] [MainThread]: 
[0m02:01:20.778497 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:20.779450 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m02:01:20.788319 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m02:01:20.788627 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m02:01:20.788842 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:21.498228 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m02:01:21.501985 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m02:01:21.640530 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m02:01:21.650667 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:01:21.651542 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:01:21.652078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:22.149624 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m02:01:22.151383 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:01:22.312485 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m02:01:22.316019 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:01:22.316933 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:01:22.317357 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:23.101065 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m02:01:23.104535 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:01:23.247572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da83c272-f622-47c2-93b0-bc53d3256962', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80bf7c20>]}
[0m02:01:23.249475 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:23.252076 [info ] [MainThread]: 
[0m02:01:23.265010 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m02:01:23.265980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m02:01:23.266341 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m02:01:23.273885 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m02:01:23.275634 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 02:01:23.266562 => 02:01:23.275426
[0m02:01:23.276531 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m02:01:23.277150 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m02:01:23.277953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m02:01:23.278253 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m02:01:23.280571 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m02:01:23.281472 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 02:01:23.278435 => 02:01:23.281350
[0m02:01:23.281995 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m02:01:23.282436 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m02:01:23.282827 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m02:01:23.283439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m02:01:23.283661 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m02:01:23.307954 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m02:01:23.308887 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 02:01:23.283804 => 02:01:23.308791
[0m02:01:23.309061 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m02:01:23.322044 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m02:01:23.325347 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m02:01:23.325975 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m02:01:23.326322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:24.999191 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m02:01:25.027367 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 02:01:23.309181 => 02:01:25.027084
[0m02:01:25.027940 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m02:01:25.195940 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da83c272-f622-47c2-93b0-bc53d3256962', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8049b6e0>]}
[0m02:01:25.197018 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.91s]
[0m02:01:25.198428 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m02:01:25.200197 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:25.200518 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m02:01:25.200850 [info ] [MainThread]: 
[0m02:01:25.201148 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.42 seconds (4.42s).
[0m02:01:25.201930 [debug] [MainThread]: Command end result
[0m02:01:25.210728 [info ] [MainThread]: 
[0m02:01:25.211436 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:25.211819 [info ] [MainThread]: 
[0m02:01:25.212191 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:01:25.213372 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.971745, "process_user_time": 2.518143, "process_kernel_time": 0.205459, "process_mem_max_rss": "212644", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m02:01:25.213773 [debug] [MainThread]: Command `dbt run` succeeded at 02:01:25.213682 after 4.97 seconds
[0m02:01:25.214058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa19725d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80952930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86a0f710>]}
[0m02:01:25.214273 [debug] [MainThread]: Flushing usage events
[0m02:01:28.059179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a01a5a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a87ea80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c43aa80>]}


============================== 02:01:28.062224 | a828978b-d8d0-4807-8b27-76bec68e1245 ==============================
[0m02:01:28.062224 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:28.062577 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m02:01:28.470418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a828978b-d8d0-4807-8b27-76bec68e1245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6921a6f0>]}
[0m02:01:28.499849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a828978b-d8d0-4807-8b27-76bec68e1245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a66e0c0>]}
[0m02:01:28.500195 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:28.503284 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:28.515539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:28.515665 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:28.517801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a828978b-d8d0-4807-8b27-76bec68e1245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68d44a10>]}
[0m02:01:28.523025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a828978b-d8d0-4807-8b27-76bec68e1245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68c145c0>]}
[0m02:01:28.523214 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:28.523480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a828978b-d8d0-4807-8b27-76bec68e1245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68e44170>]}
[0m02:01:28.524195 [info ] [MainThread]: 
[0m02:01:28.524597 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:28.525146 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m02:01:28.530695 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:01:28.530851 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:01:28.530976 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:29.124301 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m02:01:29.127567 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:01:29.337814 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m02:01:29.345219 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:01:29.346197 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:01:29.346917 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:29.777694 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m02:01:29.779652 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:01:29.905990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a828978b-d8d0-4807-8b27-76bec68e1245', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d612b0>]}
[0m02:01:29.906818 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:29.907599 [info ] [MainThread]: 
[0m02:01:29.914457 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:29.914786 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m02:01:29.915369 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m02:01:29.915639 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:29.924922 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:29.926219 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 02:01:29.915844 => 02:01:29.926069
[0m02:01:29.926458 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:29.935478 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:29.936256 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:29.936468 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m02:01:29.936659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:30.378078 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:30.389104 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 02:01:29.926629 => 02:01:30.388701
[0m02:01:30.389757 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m02:01:30.537384 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.62s]
[0m02:01:30.538814 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:30.539620 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:30.540303 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m02:01:30.541603 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m02:01:30.542095 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:30.548828 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:01:30.550593 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 02:01:30.542384 => 02:01:30.550303
[0m02:01:30.551066 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:30.553822 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:01:30.555095 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:01:30.555465 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m02:01:30.555887 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:31.035112 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:31.039419 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 02:01:30.551338 => 02:01:31.038958
[0m02:01:31.040174 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m02:01:31.186375 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.65s]
[0m02:01:31.187262 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:01:31.187536 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:31.187854 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m02:01:31.188472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m02:01:31.188708 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:31.193948 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:01:31.194771 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 02:01:31.188864 => 02:01:31.194647
[0m02:01:31.194979 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:31.196399 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:01:31.197261 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:01:31.197429 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m02:01:31.197577 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:31.708224 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:31.712595 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 02:01:31.195133 => 02:01:31.712403
[0m02:01:31.713890 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m02:01:31.887849 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.70s]
[0m02:01:31.892004 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:01:31.895104 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:31.895842 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m02:01:31.896991 [info ] [MainThread]: 
[0m02:01:31.897905 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.37 seconds (3.37s).
[0m02:01:31.899169 [debug] [MainThread]: Command end result
[0m02:01:31.912372 [info ] [MainThread]: 
[0m02:01:31.912672 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:31.913067 [info ] [MainThread]: 
[0m02:01:31.913244 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m02:01:31.914146 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.8752067, "process_user_time": 2.372155, "process_kernel_time": 0.111226, "process_mem_max_rss": "212864", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m02:01:31.914721 [debug] [MainThread]: Command `dbt test` succeeded at 02:01:31.914646 after 3.88 seconds
[0m02:01:31.914985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ee44dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a488770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a42dc10>]}
[0m02:01:31.915196 [debug] [MainThread]: Flushing usage events
[0m02:01:34.213458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa7942f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab6fbf80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa7993d0>]}


============================== 02:01:34.216355 | b6101f4e-42e1-4080-8287-4ddd2ebe4b4f ==============================
[0m02:01:34.216355 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:34.216923 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:01:34.595272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89800200>]}
[0m02:01:34.625714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8974d3d0>]}
[0m02:01:34.626071 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:34.629482 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:34.644532 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:34.644756 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:34.647052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8949a750>]}
[0m02:01:34.652635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff894c9160>]}
[0m02:01:34.652852 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:34.653230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89592450>]}
[0m02:01:34.653936 [info ] [MainThread]: 
[0m02:01:34.654381 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:34.654985 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m02:01:34.660210 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m02:01:34.660376 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m02:01:34.660525 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:35.193235 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m02:01:35.194703 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m02:01:35.339412 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m02:01:35.349704 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:01:35.350333 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:01:35.350707 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:36.057582 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.0 seconds
[0m02:01:36.059598 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:01:36.172220 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m02:01:36.176433 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:01:36.177269 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:01:36.177655 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:37.178420 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m02:01:37.180736 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:01:37.324652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89405940>]}
[0m02:01:37.325522 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:37.325918 [info ] [MainThread]: 
[0m02:01:37.333427 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m02:01:37.333811 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m02:01:37.334361 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m02:01:37.334594 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m02:01:37.339873 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 02:01:37.334775 => 02:01:37.339735
[0m02:01:37.340106 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m02:01:37.367020 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:37.367235 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:01:37.367454 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:37.934612 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:01:37.940934 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:37.941323 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:38.070649 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:38.075930 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:38.076230 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:38.179164 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:38.199310 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:38.199715 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:01:39.665392 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:39.669515 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:39.670202 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:39.779175 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:39.785253 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:39.785973 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:39.918934 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:39.924548 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:39.925249 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:40.247884 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:40.251439 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:40.251916 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:40.391479 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:40.397912 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:40.398283 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:40.495643 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:40.506839 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m02:01:40.511404 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:40.511865 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m02:01:40.644026 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:40.644974 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:40.645546 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:01:41.795358 [debug] [Thread-1 (]: SQL status: SUCCESS 4 in 1.0 seconds
[0m02:01:41.796523 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:41.797112 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m02:01:42.139235 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:42.164907 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 02:01:37.340256 => 02:01:42.164647
[0m02:01:42.165341 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m02:01:42.320260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88715430>]}
[0m02:01:42.321904 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 4[0m in 4.99s]
[0m02:01:42.324010 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m02:01:42.325014 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:42.326040 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m02:01:42.327740 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m02:01:42.328225 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:42.333610 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 02:01:42.328550 => 02:01:42.333288
[0m02:01:42.334191 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:42.338770 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:42.339164 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:01:42.339509 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:42.921774 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:01:42.928229 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:42.929284 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:43.016586 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:43.020031 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:43.020363 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:43.158306 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:43.169663 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:43.170613 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:01:44.660332 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:44.665557 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:44.666242 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:44.764879 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:44.771705 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:44.772402 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:44.896128 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:44.903066 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:44.903752 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:44.992207 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:44.998228 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:44.998921 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:45.110560 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:45.114993 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.116599 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:45.225076 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:45.229253 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.233173 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.233725 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m02:01:45.379227 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:45.380388 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:45.381049 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:01:46.084566 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:01:46.085124 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:46.085434 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m02:01:46.460207 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:46.463715 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 02:01:42.334506 => 02:01:46.463515
[0m02:01:46.464181 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m02:01:46.659309 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6101f4e-42e1-4080-8287-4ddd2ebe4b4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaceecbc0>]}
[0m02:01:46.660826 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.33s]
[0m02:01:46.662347 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:46.665533 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:46.666005 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m02:01:46.666472 [info ] [MainThread]: 
[0m02:01:46.666941 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 12.01 seconds (12.01s).
[0m02:01:46.667924 [debug] [MainThread]: Command end result
[0m02:01:46.678234 [info ] [MainThread]: 
[0m02:01:46.678744 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:46.678971 [info ] [MainThread]: 
[0m02:01:46.679271 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m02:01:46.680451 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.495988, "process_user_time": 2.778709, "process_kernel_time": 0.160349, "process_mem_max_rss": "213924", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m02:01:46.680868 [debug] [MainThread]: Command `dbt snapshot` succeeded at 02:01:46.680782 after 12.50 seconds
[0m02:01:46.681169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaadca600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaac674a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff887467b0>]}
[0m02:01:46.681433 [debug] [MainThread]: Flushing usage events
[0m12:23:31.949599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032d1550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043654f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104365310>]}


============================== 12:23:31.952480 | cc424905-5b53-4ec8-9443-1676a308bbb2 ==============================
[0m12:23:31.952480 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m12:23:31.952739 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'empty': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'printer_width': '80', 'invocation_command': 'dbt ', 'introspect': 'True', 'warn_error': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'debug': 'False', 'log_cache_events': 'False', 'write_json': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'no_print': 'None'}
[0m12:23:32.018807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc424905-5b53-4ec8-9443-1676a308bbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104339cd0>]}
[0m12:23:32.025257 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m12:23:32.025771 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m12:23:32.027417 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.113537915, "process_in_blocks": "0", "process_kernel_time": 0.065422, "process_mem_max_rss": "100286464", "process_out_blocks": "0", "process_user_time": 0.646074}
[0m12:23:32.027648 [debug] [MainThread]: Command `cli deps` succeeded at 12:23:32.027601 after 0.11 seconds
[0m12:23:32.027827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032d1550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044fd190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104340b80>]}
[0m12:23:32.028013 [debug] [MainThread]: Flushing usage events
[0m12:23:32.526321 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:29:39.296914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb48dfc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4d67110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4d358b0>]}


============================== 20:29:39.299951 | bf0ecc06-9ef4-4644-b0c9-dc510376df4d ==============================
[0m20:29:39.299951 [info ] [MainThread]: Running with dbt=1.7.19
[0m20:29:39.300389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:29:39.716964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bf0ecc06-9ef4-4644-b0c9-dc510376df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f781760>]}
[0m20:29:39.749099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bf0ecc06-9ef4-4644-b0c9-dc510376df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad9020f0>]}
[0m20:29:39.749489 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m20:29:39.753343 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m20:29:39.773328 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:29:39.773568 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:29:39.776766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bf0ecc06-9ef4-4644-b0c9-dc510376df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5c4db20>]}
[0m20:29:39.784267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bf0ecc06-9ef4-4644-b0c9-dc510376df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f4f8ce0>]}
[0m20:29:39.784516 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m20:29:39.784856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf0ecc06-9ef4-4644-b0c9-dc510376df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f7ae360>]}
[0m20:29:39.785617 [info ] [MainThread]: 
[0m20:29:39.786056 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:29:39.786627 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m20:29:39.791723 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m20:29:39.791889 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m20:29:39.792021 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:29:40.257063 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m20:29:40.259206 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m20:29:40.522536 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m20:29:40.535836 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m20:29:40.536380 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m20:29:40.536725 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:29:40.948382 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m20:29:40.952641 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m20:29:41.603791 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m20:29:41.610701 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m20:29:41.612970 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m20:29:41.613464 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:29:42.063106 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m20:29:42.066349 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m20:29:42.193370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf0ecc06-9ef4-4644-b0c9-dc510376df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f74b2f0>]}
[0m20:29:42.194251 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:29:42.195293 [info ] [MainThread]: 
[0m20:29:42.202960 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m20:29:42.203503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m20:29:42.203794 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m20:29:42.209677 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m20:29:42.211332 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 20:29:42.203976 => 20:29:42.211191
[0m20:29:42.211914 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m20:29:42.212201 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m20:29:42.212764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m20:29:42.212977 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m20:29:42.214898 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m20:29:42.215549 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 20:29:42.213111 => 20:29:42.215413
[0m20:29:42.216031 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m20:29:42.216440 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m20:29:42.216773 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m20:29:42.217520 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m20:29:42.217717 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m20:29:42.239285 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m20:29:42.240301 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 20:29:42.217840 => 20:29:42.240205
[0m20:29:42.240463 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m20:29:42.252272 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m20:29:42.254793 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m20:29:42.255050 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m20:29:42.255359 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:29:43.633461 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:29:43.661036 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 20:29:42.240573 => 20:29:43.660816
[0m20:29:43.661603 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m20:29:43.784351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf0ecc06-9ef4-4644-b0c9-dc510376df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f6919d0>]}
[0m20:29:43.786394 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.57s]
[0m20:29:43.789019 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m20:29:43.795728 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:29:43.796196 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m20:29:43.796608 [info ] [MainThread]: 
[0m20:29:43.797405 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.01 seconds (4.01s).
[0m20:29:43.798202 [debug] [MainThread]: Command end result
[0m20:29:43.808471 [info ] [MainThread]: 
[0m20:29:43.809086 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:29:43.809382 [info ] [MainThread]: 
[0m20:29:43.809697 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:29:43.810879 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.536243, "process_user_time": 2.544651, "process_kernel_time": 0.263737, "process_mem_max_rss": "213056", "process_out_blocks": "3188", "process_in_blocks": "0"}
[0m20:29:43.811347 [debug] [MainThread]: Command `dbt run` succeeded at 20:29:43.811267 after 4.54 seconds
[0m20:29:43.811673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb99b6a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4d67110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8fec9e80>]}
[0m20:29:43.811975 [debug] [MainThread]: Flushing usage events
[0m20:29:46.362719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92e54860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92e54c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92e56900>]}


============================== 20:29:46.365631 | 07916af2-c3c2-44ca-b50f-b1125848353c ==============================
[0m20:29:46.365631 [info ] [MainThread]: Running with dbt=1.7.19
[0m20:29:46.366071 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:29:46.751133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07916af2-c3c2-44ca-b50f-b1125848353c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7349a330>]}
[0m20:29:46.782771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07916af2-c3c2-44ca-b50f-b1125848353c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92e5bd40>]}
[0m20:29:46.783115 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m20:29:46.786561 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m20:29:46.803500 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:29:46.803678 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:29:46.806030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07916af2-c3c2-44ca-b50f-b1125848353c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71c90f20>]}
[0m20:29:46.811664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07916af2-c3c2-44ca-b50f-b1125848353c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71c28c80>]}
[0m20:29:46.811890 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m20:29:46.812378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07916af2-c3c2-44ca-b50f-b1125848353c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71fc7830>]}
[0m20:29:46.813181 [info ] [MainThread]: 
[0m20:29:46.813576 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:29:46.814185 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m20:29:46.819998 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m20:29:46.820195 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m20:29:46.820358 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:29:47.345367 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m20:29:47.348123 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m20:29:47.479175 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m20:29:47.481695 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m20:29:47.481937 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m20:29:47.482110 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:29:47.865118 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m20:29:47.870470 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m20:29:47.993076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07916af2-c3c2-44ca-b50f-b1125848353c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7266fdd0>]}
[0m20:29:47.995628 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:29:47.997480 [info ] [MainThread]: 
[0m20:29:48.014698 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m20:29:48.015344 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m20:29:48.016489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m20:29:48.016973 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m20:29:48.031177 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m20:29:48.032619 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 20:29:48.017251 => 20:29:48.032450
[0m20:29:48.032891 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m20:29:48.044305 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m20:29:48.046033 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m20:29:48.046269 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m20:29:48.046494 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:29:48.625426 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:29:48.641092 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 20:29:48.033047 => 20:29:48.640549
[0m20:29:48.641953 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m20:29:48.782392 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.77s]
[0m20:29:48.785061 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m20:29:48.785933 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m20:29:48.786665 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m20:29:48.788682 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m20:29:48.789821 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m20:29:48.800009 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m20:29:48.801972 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 20:29:48.790701 => 20:29:48.801715
[0m20:29:48.802401 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m20:29:48.804920 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m20:29:48.806112 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m20:29:48.806467 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m20:29:48.806768 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:29:49.222664 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:29:49.224004 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 20:29:48.802665 => 20:29:49.223863
[0m20:29:49.224266 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m20:29:49.391130 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.60s]
[0m20:29:49.393109 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m20:29:49.394018 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m20:29:49.394660 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m20:29:49.395972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m20:29:49.396479 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m20:29:49.405621 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m20:29:49.406936 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 20:29:49.396808 => 20:29:49.406819
[0m20:29:49.407162 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m20:29:49.408425 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m20:29:49.409103 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m20:29:49.409286 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m20:29:49.409453 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:29:50.609038 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:29:50.610780 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 20:29:49.407291 => 20:29:50.610636
[0m20:29:50.611027 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m20:29:50.766272 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 1.37s]
[0m20:29:50.767060 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m20:29:50.768307 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:29:50.768483 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m20:29:50.768687 [info ] [MainThread]: 
[0m20:29:50.769051 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.96 seconds (3.96s).
[0m20:29:50.769523 [debug] [MainThread]: Command end result
[0m20:29:50.776376 [info ] [MainThread]: 
[0m20:29:50.776868 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:29:50.777036 [info ] [MainThread]: 
[0m20:29:50.777248 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m20:29:50.778092 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.436846, "process_user_time": 2.562657, "process_kernel_time": 0.140602, "process_mem_max_rss": "212244", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m20:29:50.778414 [debug] [MainThread]: Command `dbt test` succeeded at 20:29:50.778367 after 4.44 seconds
[0m20:29:50.778663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9326aea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92f684a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71d23560>]}
[0m20:29:50.778847 [debug] [MainThread]: Flushing usage events
[0m20:29:53.718170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabc2e8a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabc2dfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabc2f470>]}


============================== 20:29:53.720990 | 55310575-08a6-4c70-9bc3-510024d41bbf ==============================
[0m20:29:53.720990 [info ] [MainThread]: Running with dbt=1.7.19
[0m20:29:53.721543 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:29:54.098152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff870eae40>]}
[0m20:29:54.129775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90c5e150>]}
[0m20:29:54.130135 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m20:29:54.133834 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m20:29:54.152365 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:29:54.152587 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:29:54.155360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86a4da60>]}
[0m20:29:54.161240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86981790>]}
[0m20:29:54.161444 [info ] [MainThread]: Found 3 models, 3 tests, 2 snapshots, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m20:29:54.161844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86bb2d20>]}
[0m20:29:54.162651 [info ] [MainThread]: 
[0m20:29:54.163063 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:29:54.163731 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m20:29:54.169211 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m20:29:54.169374 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m20:29:54.169539 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:29:54.629065 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m20:29:54.633750 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m20:29:54.791359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m20:29:54.795663 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m20:29:54.795907 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m20:29:54.796092 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:29:55.203305 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m20:29:55.205400 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m20:29:55.316444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m20:29:55.319774 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m20:29:55.320102 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m20:29:55.320716 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:29:55.740101 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m20:29:55.742365 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m20:29:55.897320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86a4d940>]}
[0m20:29:55.899368 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:29:55.902020 [info ] [MainThread]: 
[0m20:29:55.915343 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m20:29:55.915984 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m20:29:55.917098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m20:29:55.917509 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m20:29:55.925196 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 20:29:55.917772 => 20:29:55.924985
[0m20:29:55.925498 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m20:29:55.957070 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:55.957330 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m20:29:55.957519 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:29:56.466417 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m20:29:56.484009 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:56.484988 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m20:29:56.641602 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m20:29:56.661604 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:56.662084 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m20:29:56.784953 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m20:29:56.801355 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:56.801715 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m20:29:58.186288 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:29:58.195541 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.196427 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m20:29:58.298011 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m20:29:58.302493 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.302950 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m20:29:58.432106 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m20:29:58.438279 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.439346 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m20:29:58.531365 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m20:29:58.538045 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.539185 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m20:29:58.652879 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m20:29:58.665443 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.665960 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m20:29:58.774200 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m20:29:58.787470 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.790208 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.790560 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m20:29:58.893335 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:29:58.896379 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:58.897725 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:29:59.473069 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m20:29:59.474876 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m20:29:59.475763 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m20:29:59.695573 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:29:59.723134 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 20:29:55.925692 => 20:29:59.722856
[0m20:29:59.723704 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m20:29:59.847455 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85dd7fe0>]}
[0m20:29:59.850298 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 3.93s]
[0m20:29:59.854101 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m20:29:59.855365 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m20:29:59.856390 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m20:29:59.857765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m20:29:59.858252 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m20:29:59.862777 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 20:29:59.858649 => 20:29:59.862555
[0m20:29:59.863156 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m20:29:59.867260 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:29:59.867647 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m20:29:59.867995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:30:00.383235 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m20:30:00.386735 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:00.387146 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m20:30:00.489182 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:30:00.495996 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:00.496349 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m20:30:00.598138 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:30:00.611458 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:00.612531 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m20:30:01.988217 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m20:30:01.995042 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:01.996113 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m20:30:02.099154 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m20:30:02.102693 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:02.103042 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m20:30:02.195368 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:30:02.201147 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:02.201904 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m20:30:02.306417 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m20:30:02.315821 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:02.316769 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m20:30:02.444680 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m20:30:02.453443 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:02.454250 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m20:30:02.684443 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m20:30:02.687457 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:02.689771 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:02.690150 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m20:30:02.807755 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:30:02.808339 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:02.808640 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m20:30:03.691985 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m20:30:03.692439 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m20:30:03.692651 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m20:30:04.055746 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m20:30:04.057500 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 20:29:59.863482 => 20:30:04.057385
[0m20:30:04.057762 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m20:30:04.186724 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55310575-08a6-4c70-9bc3-510024d41bbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85cd24b0>]}
[0m20:30:04.187352 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.33s]
[0m20:30:04.188417 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m20:30:04.190111 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:30:04.190291 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m20:30:04.190505 [info ] [MainThread]: 
[0m20:30:04.190835 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.03 seconds (10.03s).
[0m20:30:04.191281 [debug] [MainThread]: Command end result
[0m20:30:04.200201 [info ] [MainThread]: 
[0m20:30:04.200618 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:30:04.200820 [info ] [MainThread]: 
[0m20:30:04.201064 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m20:30:04.202170 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 10.505997, "process_user_time": 2.762613, "process_kernel_time": 0.217648, "process_mem_max_rss": "214336", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m20:30:04.202505 [debug] [MainThread]: Command `dbt snapshot` succeeded at 20:30:04.202451 after 10.51 seconds
[0m20:30:04.202794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabc2e8a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac1128a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86bb2d20>]}
[0m20:30:04.202997 [debug] [MainThread]: Flushing usage events
[0m23:11:17.673747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d894f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e1d490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e1d2b0>]}


============================== 23:11:17.676219 | 76b9ef8f-a7ad-4abe-9bab-ef0dc0bb101f ==============================
[0m23:11:17.676219 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:11:17.676489 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'quiet': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'partial_parse': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'invocation_command': 'dbt ', 'debug': 'False', 'empty': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'log_format': 'default', 'indirect_selection': 'eager', 'warn_error': 'None', 'introspect': 'True', 'version_check': 'True'}
[0m23:11:17.730157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '76b9ef8f-a7ad-4abe-9bab-ef0dc0bb101f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106edf4f0>]}
[0m23:11:17.736509 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m23:11:17.737352 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m23:11:17.739182 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.098199874, "process_in_blocks": "0", "process_kernel_time": 0.06891, "process_mem_max_rss": "100515840", "process_out_blocks": "0", "process_user_time": 0.598002}
[0m23:11:17.739419 [debug] [MainThread]: Command `cli deps` succeeded at 23:11:17.739365 after 0.10 seconds
[0m23:11:17.739634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d894f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fb6130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106edf0d0>]}
[0m23:11:17.739878 [debug] [MainThread]: Flushing usage events
[0m23:11:18.180578 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:16:53.632158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b51520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110021580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100213a0>]}


============================== 23:16:53.642342 | 5d88a808-3cfd-4557-9aef-a36a777c86b6 ==============================
[0m23:16:53.642342 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:16:53.643432 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'version_check': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'empty': 'None', 'printer_width': '80', 'indirect_selection': 'eager', 'target_path': 'None', 'debug': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'invocation_command': 'dbt ', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/Users/snehasingh/.dbt', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True'}
[0m23:16:53.732901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d88a808-3cfd-4557-9aef-a36a777c86b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ffe8b0>]}
[0m23:16:53.738865 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m23:16:53.739348 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m23:16:53.740841 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.17760392, "process_in_blocks": "0", "process_kernel_time": 0.077266, "process_mem_max_rss": "102318080", "process_out_blocks": "0", "process_user_time": 0.67265}
[0m23:16:53.741062 [debug] [MainThread]: Command `cli deps` succeeded at 23:16:53.741016 after 0.18 seconds
[0m23:16:53.741238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b51520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101b9160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aa37f0>]}
[0m23:16:53.741416 [debug] [MainThread]: Flushing usage events
[0m23:16:54.103629 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:39:03.055202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f52900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073d39d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073d3c50>]}


============================== 23:39:03.057673 | bf79fa5d-81b2-4359-90bd-ac1ef6a9f6b8 ==============================
[0m23:39:03.057673 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:39:03.057946 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'indirect_selection': 'eager', 'partial_parse': 'True', 'target_path': 'None', 'quiet': 'False', 'invocation_command': 'dbt debug', 'introspect': 'True', 'static_parser': 'True', 'empty': 'None', 'printer_width': '80', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'no_print': 'None'}
[0m23:39:03.065857 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m23:39:03.066043 [info ] [MainThread]: python version: 3.13.5
[0m23:39:03.066148 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m23:39:03.066242 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m23:39:03.069406 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_TYPE'
[0m23:39:03.071300 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.043646876, "process_in_blocks": "0", "process_kernel_time": 0.116095, "process_mem_max_rss": "112852992", "process_out_blocks": "0", "process_user_time": 0.475548}
[0m23:39:03.071543 [debug] [MainThread]: Command `dbt debug` failed at 23:39:03.071493 after 0.04 seconds
[0m23:39:03.071705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10742afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107483530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074869c0>]}
[0m23:39:03.071852 [debug] [MainThread]: Flushing usage events
[0m23:39:03.462303 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:42:59.692565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043be900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f37c50>]}


============================== 23:42:59.695035 | 9b2d0bc8-6bc5-427b-900f-66ce9447312a ==============================
[0m23:42:59.695035 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:42:59.695284 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'partial_parse': 'True', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'warn_error': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'quiet': 'False', 'printer_width': '80', 'fail_fast': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'None', 'version_check': 'True'}
[0m23:42:59.702994 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m23:42:59.703179 [info ] [MainThread]: python version: 3.13.5
[0m23:42:59.703286 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m23:42:59.703382 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m23:42:59.706523 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_TYPE'
[0m23:42:59.708280 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.04278717, "process_in_blocks": "0", "process_kernel_time": 0.107213, "process_mem_max_rss": "113377280", "process_out_blocks": "0", "process_user_time": 0.477805}
[0m23:42:59.708569 [debug] [MainThread]: Command `dbt debug` failed at 23:42:59.708525 after 0.04 seconds
[0m23:42:59.708706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f86fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fdf530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fe29c0>]}
[0m23:42:59.708855 [debug] [MainThread]: Flushing usage events
[0m23:43:00.098074 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:47:27.606295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106466900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078c79d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078c7c50>]}


============================== 23:47:27.608860 | 883a8acb-ad92-4198-8563-ec1d3401cd57 ==============================
[0m23:47:27.608860 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:47:27.609125 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'use_colors': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'indirect_selection': 'eager', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'empty': 'None', 'partial_parse': 'True', 'printer_width': '80', 'invocation_command': 'dbt debug', 'debug': 'False', 'static_parser': 'True', 'warn_error': 'None', 'fail_fast': 'False'}
[0m23:47:27.617039 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m23:47:27.617219 [info ] [MainThread]: python version: 3.13.5
[0m23:47:27.617325 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m23:47:27.617420 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m23:47:27.620611 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_TYPE'
[0m23:47:27.622208 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.045515, "process_in_blocks": "0", "process_kernel_time": 0.110345, "process_mem_max_rss": "113262592", "process_out_blocks": "0", "process_user_time": 0.486077}
[0m23:47:27.622404 [debug] [MainThread]: Command `dbt debug` failed at 23:47:27.622360 after 0.05 seconds
[0m23:47:27.622551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10791efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107977530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10797a9c0>]}
[0m23:47:27.622705 [debug] [MainThread]: Flushing usage events
[0m23:47:28.076066 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:50:08.438238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106266900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e79d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e7c50>]}


============================== 23:50:08.440677 | a043a860-a460-47e4-b6ff-6d73b117d46b ==============================
[0m23:50:08.440677 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:50:08.440922 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'introspect': 'True', 'debug': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'static_parser': 'True', 'use_colors': 'True', 'target_path': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_format': 'default', 'quiet': 'False', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'fail_fast': 'False', 'invocation_command': 'dbt clean', 'use_experimental_parser': 'False', 'version_check': 'True', 'empty': 'None', 'warn_error': 'None'}
[0m23:50:08.542053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a043a860-a460-47e4-b6ff-6d73b117d46b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a75f30>]}
[0m23:50:08.553945 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.14396334, "process_in_blocks": "0", "process_kernel_time": 0.12956, "process_mem_max_rss": "115605504", "process_out_blocks": "0", "process_user_time": 0.512351}
[0m23:50:08.554165 [debug] [MainThread]: Command `dbt clean` succeeded at 23:50:08.554121 after 0.14 seconds
[0m23:50:08.554307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107567130>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107566cf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10788e450>]}
[0m23:50:08.554466 [debug] [MainThread]: Flushing usage events
[0m23:50:08.940889 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:50:18.134901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142ba900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11642f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11642fc50>]}


============================== 23:50:18.137154 | 272b85fa-02bc-4ad4-a848-3b2123d0939e ==============================
[0m23:50:18.137154 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:50:18.137406 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'invocation_command': 'dbt debug', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'version_check': 'True', 'empty': 'None', 'quiet': 'False', 'printer_width': '80', 'log_format': 'default', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'use_experimental_parser': 'False', 'no_print': 'None', 'introspect': 'True', 'target_path': 'None', 'debug': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True'}
[0m23:50:18.144595 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m23:50:18.144803 [info ] [MainThread]: python version: 3.13.5
[0m23:50:18.144913 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m23:50:18.145010 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m23:50:18.147801 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'DBT_TYPE'
[0m23:50:18.148973 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.042622168, "process_in_blocks": "0", "process_kernel_time": 0.103833, "process_mem_max_rss": "114245632", "process_out_blocks": "0", "process_user_time": 0.508637}
[0m23:50:18.149131 [debug] [MainThread]: Command `dbt debug` failed at 23:50:18.149094 after 0.04 seconds
[0m23:50:18.149252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116486fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1164df530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1164e29c0>]}
[0m23:50:18.149381 [debug] [MainThread]: Flushing usage events
[0m23:50:18.518481 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:52:04.313695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10948e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a837c50>]}


============================== 23:52:04.316930 | 371a02ce-8a3e-45ef-a1d9-e402b4d65ce1 ==============================
[0m23:52:04.316930 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:52:04.317226 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'no_print': 'None', 'fail_fast': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'introspect': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'use_colors': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'empty': 'None', 'target_path': 'None', 'debug': 'False'}
[0m23:52:04.328594 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m23:52:04.328804 [info ] [MainThread]: python version: 3.13.5
[0m23:52:04.328910 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m23:52:04.329006 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m23:52:05.051083 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:52:05.051296 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:52:05.051407 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:52:05.073415 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m23:52:05.073595 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m23:52:05.073705 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m23:52:05.073898 [info ] [MainThread]: adapter type: snowflake
[0m23:52:05.074004 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m23:52:05.106101 [info ] [MainThread]: Configuration:
[0m23:52:05.106309 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m23:52:05.106433 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m23:52:05.106531 [info ] [MainThread]: Required dependencies:
[0m23:52:05.106676 [debug] [MainThread]: Executing "git --help"
[0m23:52:05.125481 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m23:52:05.125929 [debug] [MainThread]: STDERR: "b''"
[0m23:52:05.126083 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m23:52:05.126216 [info ] [MainThread]: Connection:
[0m23:52:05.126356 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m23:52:05.126460 [info ] [MainThread]:   user: PEACOCK
[0m23:52:05.126555 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m23:52:05.126646 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m23:52:05.126729 [info ] [MainThread]:   role: TRAINING_ROLE
[0m23:52:05.126827 [info ] [MainThread]:   schema: analytics
[0m23:52:05.126909 [info ] [MainThread]:   authenticator: None
[0m23:52:05.126992 [info ] [MainThread]:   oauth_client_id: None
[0m23:52:05.127075 [info ] [MainThread]:   query_tag: None
[0m23:52:05.127159 [info ] [MainThread]:   client_session_keep_alive: False
[0m23:52:05.127247 [info ] [MainThread]:   host: None
[0m23:52:05.127329 [info ] [MainThread]:   port: None
[0m23:52:05.127409 [info ] [MainThread]:   proxy_host: None
[0m23:52:05.127492 [info ] [MainThread]:   proxy_port: None
[0m23:52:05.127571 [info ] [MainThread]:   protocol: None
[0m23:52:05.127655 [info ] [MainThread]:   connect_retries: 1
[0m23:52:05.127733 [info ] [MainThread]:   connect_timeout: None
[0m23:52:05.127815 [info ] [MainThread]:   retry_on_database_errors: False
[0m23:52:05.127898 [info ] [MainThread]:   retry_all: False
[0m23:52:05.127979 [info ] [MainThread]:   insecure_mode: False
[0m23:52:05.128059 [info ] [MainThread]:   reuse_connections: True
[0m23:52:05.128143 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m23:52:05.128226 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m23:52:05.128484 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:52:05.171492 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m23:52:05.215670 [debug] [MainThread]: Using snowflake connection "debug"
[0m23:52:05.215848 [debug] [MainThread]: On debug: select 1 as id
[0m23:52:05.215948 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:52:05.698866 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.483 seconds
[0m23:52:05.700349 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m23:52:05.700829 [info ] [MainThread]: [32mAll checks passed![0m
[0m23:52:05.710152 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.4267596, "process_in_blocks": "0", "process_kernel_time": 0.842286, "process_mem_max_rss": "222904320", "process_out_blocks": "0", "process_user_time": 2.376695}
[0m23:52:05.711393 [debug] [MainThread]: Command `dbt debug` succeeded at 23:52:05.711176 after 1.43 seconds
[0m23:52:05.711825 [debug] [MainThread]: Connection 'debug' was left open.
[0m23:52:05.712120 [debug] [MainThread]: On debug: Close
[0m23:52:05.863652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147cd7e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158806450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147b4b8a0>]}
[0m23:52:05.864577 [debug] [MainThread]: Flushing usage events
[0m23:52:06.265734 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:53:53.278453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f0a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10739b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10739bc50>]}


============================== 23:53:53.280880 | b7777441-02d1-4bad-9755-5f10168e3201 ==============================
[0m23:53:53.280880 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:53:53.281144 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'log_format': 'default', 'write_json': 'True', 'printer_width': '80', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'cache_selected_only': 'False', 'quiet': 'False', 'debug': 'False', 'version_check': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'log_cache_events': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None'}
[0m23:53:53.963258 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:53:53.963485 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:53:53.963591 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:53:54.076865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106719f30>]}
[0m23:53:54.095790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f57ff00>]}
[0m23:53:54.096272 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:53:54.141287 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:53:54.141704 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:53:54.141869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f735350>]}
[0m23:53:54.654847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fc9c7d0>]}
[0m23:53:54.686797 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:53:54.687837 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:53:54.697612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fcfc590>]}
[0m23:53:54.697799 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:53:54.697925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ae8add0>]}
[0m23:53:54.698632 [info ] [MainThread]: 
[0m23:53:54.698766 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:53:54.698869 [info ] [MainThread]: 
[0m23:53:54.699049 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:53:54.699392 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:53:54.748611 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:53:54.748799 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:53:54.748900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:55.274198 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.525 seconds
[0m23:53:55.279710 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m23:53:55.291890 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:53:55.292334 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:53:55.451609 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.159 seconds
[0m23:53:55.454844 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m23:53:55.458789 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:53:55.459166 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:53:55.629167 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.169 seconds
[0m23:53:55.633719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14afde5d0>]}
[0m23:53:55.638479 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:53:55.638963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m23:53:55.639253 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:53:55.651431 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:53:55.652881 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:53:55.653173 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:53:55.653522 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:53:55.653840 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:53:55.656238 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:53:55.656884 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:53:55.657367 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:53:55.657813 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:53:55.658137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:53:55.658341 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:53:55.683322 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:53:55.683881 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:53:55.697212 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:53:55.699196 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:53:55.699463 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:53:57.247419 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.548 seconds
[0m23:53:57.272738 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7777441-02d1-4bad-9755-5f10168e3201', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14de68470>]}
[0m23:53:57.273354 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.61s]
[0m23:53:57.273767 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:53:57.274723 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:57.274997 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:53:57.275214 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:53:57.402038 [info ] [MainThread]: 
[0m23:53:57.402549 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.70 seconds (2.70s).
[0m23:53:57.403225 [debug] [MainThread]: Command end result
[0m23:53:57.419799 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:53:57.420680 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:53:57.423990 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:53:57.424209 [info ] [MainThread]: 
[0m23:53:57.424423 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:53:57.424573 [info ] [MainThread]: 
[0m23:53:57.424731 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:53:57.428968 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1763535, "process_in_blocks": "0", "process_kernel_time": 0.879645, "process_mem_max_rss": "241991680", "process_out_blocks": "0", "process_user_time": 3.322421}
[0m23:53:57.429299 [debug] [MainThread]: Command `dbt run` succeeded at 23:53:57.429229 after 4.18 seconds
[0m23:53:57.429584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14de23110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ddb3bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14adaa0d0>]}
[0m23:53:57.429989 [debug] [MainThread]: Flushing usage events
[0m23:53:57.877458 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:57:09.642638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046a2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b079d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b07c50>]}


============================== 23:57:09.645319 | 6fcb2131-7175-4651-9774-ed5355b86b76 ==============================
[0m23:57:09.645319 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:57:09.645587 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'invocation_command': 'dbt test', 'use_colors': 'True', 'quiet': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'introspect': 'True', 'target_path': 'None', 'debug': 'False', 'write_json': 'True', 'no_print': 'None', 'warn_error': 'None', 'fail_fast': 'False', 'printer_width': '80', 'log_format': 'default', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'empty': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m23:57:10.304981 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:57:10.305196 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:57:10.305310 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:57:10.418144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6fcb2131-7175-4651-9774-ed5355b86b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e91f30>]}
[0m23:57:10.436329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6fcb2131-7175-4651-9774-ed5355b86b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12797ff00>]}
[0m23:57:10.436802 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:57:10.483478 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:57:10.551515 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:57:10.551669 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:57:10.571182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6fcb2131-7175-4651-9774-ed5355b86b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127a36150>]}
[0m23:57:10.602004 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:57:10.603913 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:57:10.618265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6fcb2131-7175-4651-9774-ed5355b86b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132a3e3f0>]}
[0m23:57:10.618437 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:57:10.618563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fcb2131-7175-4651-9774-ed5355b86b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132aae0b0>]}
[0m23:57:10.619253 [info ] [MainThread]: 
[0m23:57:10.619385 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:57:10.619484 [info ] [MainThread]: 
[0m23:57:10.619662 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:57:10.621157 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m23:57:10.674305 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:57:10.674501 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:57:10.674608 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:57:11.398199 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.723 seconds
[0m23:57:11.401760 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m23:57:11.405380 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:57:11.405764 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:57:11.514841 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.109 seconds
[0m23:57:11.520191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6fcb2131-7175-4651-9774-ed5355b86b76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132f0d4a0>]}
[0m23:57:11.525798 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:57:11.526476 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m23:57:11.527177 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m23:57:11.527597 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:57:11.542227 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:57:11.543094 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:57:11.555604 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:57:11.556469 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m23:57:11.556717 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m23:57:11.904852 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.348 seconds
[0m23:57:11.908541 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.38s]
[0m23:57:11.908808 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m23:57:11.908955 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:57:11.909115 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m23:57:11.909268 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m23:57:11.909391 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:57:11.910675 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:57:11.910955 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:57:11.911851 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:57:11.912189 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m23:57:11.912328 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m23:57:12.150803 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.238 seconds
[0m23:57:12.153957 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.24s]
[0m23:57:12.154685 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m23:57:12.155134 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:57:12.155610 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m23:57:12.156168 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m23:57:12.156555 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:57:12.163914 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:57:12.165092 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:57:12.168447 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:57:12.170360 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m23:57:12.170838 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m23:57:12.417921 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.247 seconds
[0m23:57:12.420647 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.26s]
[0m23:57:12.421433 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m23:57:12.422939 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:57:12.423349 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m23:57:12.423635 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m23:57:12.569757 [info ] [MainThread]: 
[0m23:57:12.570323 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 1.95 seconds (1.95s).
[0m23:57:12.571327 [debug] [MainThread]: Command end result
[0m23:57:12.593912 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:57:12.595471 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:57:12.600673 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:57:12.600929 [info ] [MainThread]: 
[0m23:57:12.601190 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:57:12.601370 [info ] [MainThread]: 
[0m23:57:12.601562 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m23:57:12.606385 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.9928296, "process_in_blocks": "0", "process_kernel_time": 0.571876, "process_mem_max_rss": "224460800", "process_out_blocks": "0", "process_user_time": 3.198966}
[0m23:57:12.606649 [debug] [MainThread]: Command `dbt test` succeeded at 23:57:12.606598 after 2.99 seconds
[0m23:57:12.606874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ac4a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137a1f8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137a1f800>]}
[0m23:57:12.607074 [debug] [MainThread]: Flushing usage events
[0m23:57:13.031165 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:58:44.858923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10848e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c73bb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c73bd90>]}


============================== 23:58:44.861361 | 05f0b9de-5879-487e-8b31-ff557dfd1214 ==============================
[0m23:58:44.861361 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:58:44.861604 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error': 'None', 'version_check': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'invocation_command': 'dbt source freshness', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'debug': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'introspect': 'True', 'partial_parse': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'target_path': 'None', 'log_format': 'default', 'write_json': 'True', 'use_experimental_parser': 'False', 'empty': 'None'}
[0m23:58:45.557427 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:58:45.557638 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:58:45.557748 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:58:45.673644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05f0b9de-5879-487e-8b31-ff557dfd1214', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cbdf30>]}
[0m23:58:45.694085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05f0b9de-5879-487e-8b31-ff557dfd1214', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ce7ff00>]}
[0m23:58:45.694698 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:58:45.745532 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:58:45.812147 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:58:45.812303 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:58:45.832107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05f0b9de-5879-487e-8b31-ff557dfd1214', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cf36150>]}
[0m23:58:45.864559 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:45.865735 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:45.876016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05f0b9de-5879-487e-8b31-ff557dfd1214', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cf4d400>]}
[0m23:58:45.876204 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:58:45.876335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05f0b9de-5879-487e-8b31-ff557dfd1214', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cf8ec10>]}
[0m23:58:45.876931 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m23:58:45.884425 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:58:45.885195 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:58:45.886319 [debug] [MainThread]: Wrote artifact FreshnessResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/sources.json
[0m23:58:45.886422 [info ] [MainThread]: Done.
[0m23:58:45.889474 [debug] [MainThread]: Resource report: {"command_name": "freshness", "command_success": true, "command_wall_clock_time": 1.0581136, "process_in_blocks": "0", "process_kernel_time": 0.812483, "process_mem_max_rss": "215744512", "process_out_blocks": "0", "process_user_time": 2.618249}
[0m23:58:45.889668 [debug] [MainThread]: Command `dbt source freshness` succeeded at 23:58:45.889633 after 1.06 seconds
[0m23:58:45.889810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d405640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6f0a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d39f110>]}
[0m23:58:45.889929 [debug] [MainThread]: Flushing usage events
[0m23:58:46.268990 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:59:11.756492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120cbe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1227379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122737c50>]}


============================== 23:59:11.759578 | f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d ==============================
[0m23:59:11.759578 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:59:11.759841 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'version_check': 'True', 'empty': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_format': 'default', 'log_cache_events': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'quiet': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'target_path': 'None', 'printer_width': '80', 'invocation_command': 'dbt snapshot', 'static_parser': 'True', 'introspect': 'True'}
[0m23:59:12.346468 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:59:12.346683 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:59:12.346796 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:59:12.416125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1216bdf30>]}
[0m23:59:12.435242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157b7ff00>]}
[0m23:59:12.435814 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:59:12.480489 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:59:12.543783 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:59:12.543954 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:59:12.563758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157d35450>]}
[0m23:59:12.595050 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:59:12.595971 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:59:12.604755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1584b0aa0>]}
[0m23:59:12.604949 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:59:12.605084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157d93e70>]}
[0m23:59:12.605766 [info ] [MainThread]: 
[0m23:59:12.605899 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:59:12.606001 [info ] [MainThread]: 
[0m23:59:12.606177 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:59:12.607609 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:59:12.656865 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:59:12.657063 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:59:12.657173 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:59:13.191014 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.534 seconds
[0m23:59:13.195801 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m23:59:13.206569 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:59:13.206914 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:59:13.363893 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.157 seconds
[0m23:59:13.366703 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m23:59:13.369692 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:59:13.370059 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:59:13.471284 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.101 seconds
[0m23:59:13.475683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15894d230>]}
[0m23:59:13.479937 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m23:59:13.480543 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m23:59:13.481003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m23:59:13.481334 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m23:59:13.488888 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m23:59:13.521931 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:13.522178 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:13.764743 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.242 seconds
[0m23:59:13.777411 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:13.779243 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:13.908177 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.127 seconds
[0m23:59:13.922660 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:13.923279 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:14.086013 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.162 seconds
[0m23:59:14.124594 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:14.124962 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
as (
    
    
    with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */;
[0m23:59:15.402292 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.277 seconds
[0m23:59:15.406118 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:15.406604 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:15.496635 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.089 seconds
[0m23:59:15.501311 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:15.501776 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:15.580322 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.078 seconds
[0m23:59:15.585517 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:15.586000 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:15.673718 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.087 seconds
[0m23:59:15.678329 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:15.678856 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:15.777694 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.098 seconds
[0m23:59:15.787215 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:15.787801 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:15.903719 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.115 seconds
[0m23:59:15.928567 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:15.929093 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        
    
    with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:16.224067 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.294 seconds
[0m23:59:16.228792 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:16.229283 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:16.320394 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.090 seconds
[0m23:59:16.322067 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m23:59:16.324193 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:16.324561 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:16.441842 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.117 seconds
[0m23:59:16.442674 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:16.443329 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")


/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */;
[0m23:59:17.177034 [debug] [Thread-1 (]: SQL status: SUCCESS 3 in 0.733 seconds
[0m23:59:17.177961 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m23:59:17.178404 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m23:59:17.654901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.476 seconds
[0m23:59:17.678333 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158953d10>]}
[0m23:59:17.678999 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 3[0m in 4.20s]
[0m23:59:17.679407 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m23:59:17.679669 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m23:59:17.680127 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m23:59:17.680509 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m23:59:17.680747 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m23:59:17.682891 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m23:59:17.685170 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:17.685421 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:17.809606 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.124 seconds
[0m23:59:17.814621 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:17.816674 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:17.963870 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.145 seconds
[0m23:59:17.972191 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:17.972693 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:18.053819 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.081 seconds
[0m23:59:18.064361 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:18.065553 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
as (
    
    
    with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */;
[0m23:59:19.104413 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.038 seconds
[0m23:59:19.109618 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.110145 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:19.193851 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.083 seconds
[0m23:59:19.199489 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.199987 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:19.274490 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.074 seconds
[0m23:59:19.279282 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.279693 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:19.366239 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.086 seconds
[0m23:59:19.372572 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.372986 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:19.465183 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.092 seconds
[0m23:59:19.470341 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.470805 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:19.560664 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.089 seconds
[0m23:59:19.570879 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.571607 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        
    
    with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:19.914207 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.342 seconds
[0m23:59:19.916009 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.916531 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:19.988055 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.071 seconds
[0m23:59:19.989080 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.990809 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:19.991179 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:20.083503 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m23:59:20.084357 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:20.084917 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")


/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */;
[0m23:59:20.829240 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.744 seconds
[0m23:59:20.829868 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m23:59:20.830136 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m23:59:21.239902 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.409 seconds
[0m23:59:21.244226 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1e3e8c9-e926-406d-b8d6-8ea77e1ea11d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158d46c50>]}
[0m23:59:21.245253 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.56s]
[0m23:59:21.245864 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m23:59:21.247571 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:59:21.247969 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was left open.
[0m23:59:21.248306 [debug] [MainThread]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m23:59:21.371823 [info ] [MainThread]: 
[0m23:59:21.372437 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.77 seconds (8.77s).
[0m23:59:21.373336 [debug] [MainThread]: Command end result
[0m23:59:21.396472 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:59:21.398210 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:59:21.402513 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:59:21.402724 [info ] [MainThread]: 
[0m23:59:21.402969 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:59:21.403146 [info ] [MainThread]: 
[0m23:59:21.403333 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:59:21.410028 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 9.681327, "process_in_blocks": "0", "process_kernel_time": 0.58847, "process_mem_max_rss": "232767488", "process_out_blocks": "0", "process_user_time": 3.48113}
[0m23:59:21.410368 [debug] [MainThread]: Command `dbt snapshot` succeeded at 23:59:21.410308 after 9.68 seconds
[0m23:59:21.410608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158de4910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158dcaf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158312dd0>]}
[0m23:59:21.410823 [debug] [MainThread]: Flushing usage events
[0m23:59:21.761535 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:00:23.652195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d9e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a13f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a13fc50>]}


============================== 00:00:23.654776 | 69fd85e6-7825-4fc2-91c9-9b12325a0105 ==============================
[0m00:00:23.654776 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:00:23.655016 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'introspect': 'True', 'no_print': 'None', 'debug': 'False', 'invocation_command': 'dbt list', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'use_colors': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'target_path': 'None', 'static_parser': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'empty': 'None'}
[0m00:00:24.275699 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:00:24.275928 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:00:24.276036 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:00:24.390064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '69fd85e6-7825-4fc2-91c9-9b12325a0105', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091bdf30>]}
[0m00:00:24.408793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '69fd85e6-7825-4fc2-91c9-9b12325a0105', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c37ff00>]}
[0m00:00:24.409265 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:00:24.458943 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:00:24.541345 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:00:24.541585 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:00:24.566019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '69fd85e6-7825-4fc2-91c9-9b12325a0105', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c436150>]}
[0m00:00:24.608187 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:00:24.609426 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:00:24.618148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '69fd85e6-7825-4fc2-91c9-9b12325a0105', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cbb0c80>]}
[0m00:00:24.618525 [info ] [MainThread]: btc_elt.output.fct_btc_indicators
[0m00:00:24.618664 [info ] [MainThread]: btc_elt.input.stg_btc_market
[0m00:00:24.618755 [info ] [MainThread]: btc_elt.input.stg_btc_ohlc
[0m00:00:24.618837 [info ] [MainThread]: btc_elt.snap_btc_market.snap_btc_market
[0m00:00:24.618921 [info ] [MainThread]: btc_elt.snap_btc_ohlc.snap_btc_ohlc
[0m00:00:24.619002 [info ] [MainThread]: source:btc_elt.analytics.fct_btc_indicators
[0m00:00:24.619083 [info ] [MainThread]: source:btc_elt.raw.coin_gecko_market_daily
[0m00:00:24.619163 [info ] [MainThread]: source:btc_elt.raw.coin_gecko_ohlc
[0m00:00:24.619240 [info ] [MainThread]: btc_elt.not_null_fct_btc_indicators_date
[0m00:00:24.619321 [info ] [MainThread]: btc_elt.not_null_fct_btc_indicators_price
[0m00:00:24.619402 [info ] [MainThread]: btc_elt.unique_fct_btc_indicators_date
[0m00:00:24.622156 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 0.9961404, "process_in_blocks": "0", "process_kernel_time": 1.093662, "process_mem_max_rss": "217923584", "process_out_blocks": "0", "process_user_time": 2.303173}
[0m00:00:24.622310 [debug] [MainThread]: Command `dbt list` succeeded at 00:00:24.622274 after 1.00 seconds
[0m00:00:24.622440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11be70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c77d7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ca7f2b0>]}
[0m00:00:24.622544 [debug] [MainThread]: Flushing usage events
[0m00:00:25.074964 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:01:39.514952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067fe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11843f9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11843fc50>]}


============================== 00:01:39.517287 | c736e8d4-152f-4ba9-8d12-ab2c1a87fa55 ==============================
[0m00:01:39.517287 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:01:39.517542 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'cache_selected_only': 'False', 'write_json': 'True', 'static_parser': 'True', 'introspect': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'invocation_command': 'dbt compile', 'printer_width': '80', 'empty': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'debug': 'False', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'no_print': 'None', 'indirect_selection': 'eager', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m00:01:40.110339 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:01:40.110566 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:01:40.110680 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:01:40.181163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c736e8d4-152f-4ba9-8d12-ab2c1a87fa55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072bdf30>]}
[0m00:01:40.199895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c736e8d4-152f-4ba9-8d12-ab2c1a87fa55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b97ff00>]}
[0m00:01:40.200394 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:01:40.246298 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:01:40.314610 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:01:40.314807 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:01:40.336236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c736e8d4-152f-4ba9-8d12-ab2c1a87fa55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ba36150>]}
[0m00:01:40.369892 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:01:40.370953 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:01:40.379767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c736e8d4-152f-4ba9-8d12-ab2c1a87fa55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c1b0c80>]}
[0m00:01:40.380000 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m00:01:40.380134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c736e8d4-152f-4ba9-8d12-ab2c1a87fa55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baf04b0>]}
[0m00:01:40.380926 [info ] [MainThread]: 
[0m00:01:40.381067 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:01:40.381165 [info ] [MainThread]: 
[0m00:01:40.381353 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:01:40.382923 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m00:01:40.437240 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:01:40.437441 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:01:40.437548 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:01:41.481982 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.044 seconds
[0m00:01:41.484645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m00:01:41.486895 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:01:41.487172 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:01:41.836618 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.349 seconds
[0m00:01:41.840054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c736e8d4-152f-4ba9-8d12-ab2c1a87fa55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c63cae0>]}
[0m00:01:41.847387 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m00:01:41.847865 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m00:01:41.848194 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m00:01:41.854115 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m00:01:41.854986 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m00:01:41.855159 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m00:01:41.855380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m00:01:41.855550 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m00:01:41.856854 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m00:01:41.857235 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m00:01:41.857378 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m00:01:41.857542 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now snapshot.btc_elt.snap_btc_market)
[0m00:01:41.857683 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m00:01:41.859040 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m00:01:41.859246 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m00:01:41.859372 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m00:01:41.859508 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m00:01:41.859624 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m00:01:41.860573 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m00:01:41.860758 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m00:01:41.860881 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m00:01:41.861007 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m00:01:41.861122 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m00:01:41.877751 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m00:01:41.878496 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m00:01:41.878778 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m00:01:41.879134 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:01:41.879329 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.fct_btc_indicators, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:01:41.879448 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:01:41.883636 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:01:41.884170 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:01:41.884384 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:01:41.884524 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:01:41.884667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m00:01:41.884781 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:01:41.885981 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m00:01:41.886212 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:01:41.886409 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m00:01:41.886528 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:01:41.886655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m00:01:41.886766 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:01:41.888759 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m00:01:41.888999 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:01:41.889201 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m00:01:41.889669 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:01:41.889829 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m00:01:41.889958 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m00:01:42.206652 [debug] [MainThread]: Command end result
[0m00:01:42.224930 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:01:42.225696 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:01:42.228591 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:01:42.231684 [debug] [MainThread]: Resource report: {"command_name": "compile", "command_success": true, "command_wall_clock_time": 2.7414691, "process_in_blocks": "0", "process_kernel_time": 0.665117, "process_mem_max_rss": "225574912", "process_out_blocks": "0", "process_user_time": 3.031428}
[0m00:01:42.231898 [debug] [MainThread]: Command `dbt compile` succeeded at 00:01:42.231857 after 2.74 seconds
[0m00:01:42.232052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1183f0a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1528c5180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1528c4f70>]}
[0m00:01:42.232196 [debug] [MainThread]: Flushing usage events
[0m00:01:42.647732 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:03:11.052917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037ce900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c339d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c33c50>]}


============================== 00:03:11.055380 | f9d6f4f3-e87c-459e-9080-cc8c3b291f69 ==============================
[0m00:03:11.055380 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:03:11.055624 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'use_colors': 'True', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'cache_selected_only': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'write_json': 'True', 'no_print': 'None', 'quiet': 'False', 'partial_parse': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'debug': 'False', 'printer_width': '80'}
[0m00:03:11.063556 [info ] [MainThread]: dbt version: 1.11.0-b3
[0m00:03:11.063746 [info ] [MainThread]: python version: 3.13.5
[0m00:03:11.063854 [info ] [MainThread]: python path: /opt/anaconda3/bin/python3.13
[0m00:03:11.063952 [info ] [MainThread]: os info: macOS-15.6.1-arm64-arm-64bit-Mach-O
[0m00:03:11.705169 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:03:11.705385 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:03:11.705502 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:03:11.727480 [info ] [MainThread]: Using profiles dir at /Users/snehasingh/.dbt
[0m00:03:11.727660 [info ] [MainThread]: Using profiles.yml file at /Users/snehasingh/.dbt/profiles.yml
[0m00:03:11.727771 [info ] [MainThread]: Using dbt_project.yml file at /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/dbt_project.yml
[0m00:03:11.727958 [info ] [MainThread]: adapter type: snowflake
[0m00:03:11.728056 [info ] [MainThread]: adapter version: 1.11.0rc1
[0m00:03:11.760904 [info ] [MainThread]: Configuration:
[0m00:03:11.761127 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:03:11.761259 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:03:11.761353 [info ] [MainThread]: Required dependencies:
[0m00:03:11.761500 [debug] [MainThread]: Executing "git --help"
[0m00:03:11.785670 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:03:11.786084 [debug] [MainThread]: STDERR: "b''"
[0m00:03:11.786241 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:03:11.786373 [info ] [MainThread]: Connection:
[0m00:03:11.786494 [info ] [MainThread]:   account: SFEDU02-LVB17920
[0m00:03:11.786588 [info ] [MainThread]:   user: PEACOCK
[0m00:03:11.786672 [info ] [MainThread]:   database: USER_DB_PEACOCK
[0m00:03:11.786759 [info ] [MainThread]:   warehouse: PEACOCK_QUERY_WH
[0m00:03:11.786839 [info ] [MainThread]:   role: TRAINING_ROLE
[0m00:03:11.786924 [info ] [MainThread]:   schema: analytics
[0m00:03:11.787007 [info ] [MainThread]:   authenticator: None
[0m00:03:11.787085 [info ] [MainThread]:   oauth_client_id: None
[0m00:03:11.787165 [info ] [MainThread]:   query_tag: None
[0m00:03:11.787248 [info ] [MainThread]:   client_session_keep_alive: False
[0m00:03:11.787331 [info ] [MainThread]:   host: None
[0m00:03:11.787410 [info ] [MainThread]:   port: None
[0m00:03:11.787487 [info ] [MainThread]:   proxy_host: None
[0m00:03:11.787566 [info ] [MainThread]:   proxy_port: None
[0m00:03:11.787647 [info ] [MainThread]:   protocol: None
[0m00:03:11.787727 [info ] [MainThread]:   connect_retries: 1
[0m00:03:11.787806 [info ] [MainThread]:   connect_timeout: None
[0m00:03:11.787895 [info ] [MainThread]:   retry_on_database_errors: False
[0m00:03:11.787983 [info ] [MainThread]:   retry_all: False
[0m00:03:11.788061 [info ] [MainThread]:   insecure_mode: False
[0m00:03:11.788143 [info ] [MainThread]:   reuse_connections: True
[0m00:03:11.788222 [info ] [MainThread]:   s3_stage_vpce_dns_name: None
[0m00:03:11.788305 [info ] [MainThread]:   platform_detection_timeout_seconds: 0.0
[0m00:03:11.788563 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:03:11.851361 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m00:03:11.896093 [debug] [MainThread]: Using snowflake connection "debug"
[0m00:03:11.896269 [debug] [MainThread]: On debug: select 1 as id
[0m00:03:11.896365 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:03:12.460676 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.564 seconds
[0m00:03:12.461618 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m00:03:12.461905 [info ] [MainThread]: [32mAll checks passed![0m
[0m00:03:12.468222 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.4493002, "process_in_blocks": "0", "process_kernel_time": 0.702078, "process_mem_max_rss": "221954048", "process_out_blocks": "0", "process_user_time": 2.776311}
[0m00:03:12.468738 [debug] [MainThread]: Command `dbt debug` succeeded at 00:03:12.468645 after 1.45 seconds
[0m00:03:12.469055 [debug] [MainThread]: Connection 'debug' was left open.
[0m00:03:12.469362 [debug] [MainThread]: On debug: Close
[0m00:03:12.694880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f0d7e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f40a450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ee4b8a0>]}
[0m00:03:12.695890 [debug] [MainThread]: Flushing usage events
[0m00:03:13.132186 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:21:52.184494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061de900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076479d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107647c50>]}


============================== 18:21:52.188451 | a3cf56af-c0e7-4f6a-8910-64d0d1d04336 ==============================
[0m18:21:52.188451 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m18:21:52.188721 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'quiet': 'False', 'invocation_command': 'dbt test', 'profiles_dir': '/Users/snehasingh/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'use_colors': 'True', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'introspect': 'True', 'no_print': 'None', 'debug': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'write_json': 'True', 'log_cache_events': 'False'}
[0m18:21:52.908346 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m18:21:52.908563 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m18:21:52.908677 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m18:21:53.013436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3cf56af-c0e7-4f6a-8910-64d0d1d04336', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069d1f30>]}
[0m18:21:53.032159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3cf56af-c0e7-4f6a-8910-64d0d1d04336', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14087ff00>]}
[0m18:21:53.032641 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m18:21:53.077662 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m18:21:53.146962 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:21:53.147120 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:21:53.165912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3cf56af-c0e7-4f6a-8910-64d0d1d04336', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140a36150>]}
[0m18:21:53.197490 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m18:21:53.198507 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m18:21:53.212403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3cf56af-c0e7-4f6a-8910-64d0d1d04336', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141aaa3f0>]}
[0m18:21:53.212581 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m18:21:53.212713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3cf56af-c0e7-4f6a-8910-64d0d1d04336', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141a9e430>]}
[0m18:21:53.213414 [info ] [MainThread]: 
[0m18:21:53.213548 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:21:53.213648 [info ] [MainThread]: 
[0m18:21:53.213832 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:21:53.215329 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m18:21:53.266049 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m18:21:53.266221 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m18:21:53.266318 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:21:54.338566 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.072 seconds
[0m18:21:54.340592 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m18:21:54.342960 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m18:21:54.343344 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m18:21:54.471457 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.128 seconds
[0m18:21:54.476309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3cf56af-c0e7-4f6a-8910-64d0d1d04336', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141ea25b0>]}
[0m18:21:54.481011 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m18:21:54.481544 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m18:21:54.482038 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m18:21:54.482378 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m18:21:54.496693 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m18:21:54.498183 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m18:21:54.511745 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m18:21:54.512618 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m18:21:54.512859 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m18:21:54.684310 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.171 seconds
[0m18:21:54.695233 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.21s]
[0m18:21:54.695958 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m18:21:54.696367 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m18:21:54.696851 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m18:21:54.697354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m18:21:54.697689 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m18:21:54.702516 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m18:21:54.703309 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m18:21:54.705971 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m18:21:54.707069 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m18:21:54.707358 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
[0m18:21:54.979047 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.271 seconds
[0m18:21:54.981397 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.28s]
[0m18:21:54.982093 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m18:21:54.982466 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m18:21:54.982867 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m18:21:54.983289 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m18:21:54.983582 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m18:21:54.988921 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m18:21:54.989694 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m18:21:54.992000 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m18:21:54.992793 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m18:21:54.993272 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
[0m18:21:55.153596 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.160 seconds
[0m18:21:55.156382 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.17s]
[0m18:21:55.156952 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m18:21:55.158303 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:21:55.158676 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was left open.
[0m18:21:55.158973 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m18:21:55.321931 [info ] [MainThread]: 
[0m18:21:55.322728 [info ] [MainThread]: Finished running 3 data tests in 0 hours 0 minutes and 2.11 seconds (2.11s).
[0m18:21:55.323761 [debug] [MainThread]: Command end result
[0m18:21:55.347603 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m18:21:55.349326 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m18:21:55.354892 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m18:21:55.355118 [info ] [MainThread]: 
[0m18:21:55.355362 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:21:55.355546 [info ] [MainThread]: 
[0m18:21:55.355743 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m18:21:55.360475 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.2056942, "process_in_blocks": "0", "process_kernel_time": 0.529135, "process_mem_max_rss": "232914944", "process_out_blocks": "0", "process_user_time": 3.27918}
[0m18:21:55.360746 [debug] [MainThread]: Command `dbt test` succeeded at 18:21:55.360692 after 3.21 seconds
[0m18:21:55.361018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107604a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1423938b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142393800>]}
[0m18:21:55.361234 [debug] [MainThread]: Flushing usage events
[0m18:21:55.784451 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:44:51.015483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061978b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076557c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076559a0>]}


============================== 21:44:51.017628 | 35c774b7-5563-496f-b12a-d38904d4430c ==============================
[0m21:44:51.017628 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m21:44:51.017936 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'write_json': 'True', 'log_format': 'default', 'invocation_command': 'dbt ', 'no_print': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'empty': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'quiet': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'target_path': 'None', 'fail_fast': 'False', 'printer_width': '80', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m21:44:51.072332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '35c774b7-5563-496f-b12a-d38904d4430c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10760c340>]}
[0m21:44:51.078633 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m21:44:51.079079 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m21:44:51.080871 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.101121336, "process_in_blocks": "0", "process_kernel_time": 0.068905, "process_mem_max_rss": "100483072", "process_out_blocks": "0", "process_user_time": 0.641085}
[0m21:44:51.081104 [debug] [MainThread]: Command `cli deps` succeeded at 21:44:51.081054 after 0.10 seconds
[0m21:44:51.081284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061978b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10778ec10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075f8a60>]}
[0m21:44:51.081480 [debug] [MainThread]: Flushing usage events
[0m21:44:51.489636 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:17:56.158682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa34152e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5169400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa34ecaa0>]}


============================== 07:17:56.161470 | 8da19538-f72e-461e-acf1-2a21ca27464d ==============================
[0m07:17:56.161470 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:17:56.161733 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:17:56.529311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f9edcd0>]}
[0m07:17:56.560328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fd56f00>]}
[0m07:17:56.560715 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:17:56.564228 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:17:56.569719 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m07:17:56.569917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e028b60>]}
[0m07:17:57.105093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7df4fd10>]}
[0m07:17:57.110492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d3e0800>]}
[0m07:17:57.110716 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:17:57.110932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d78f830>]}
[0m07:17:57.111772 [info ] [MainThread]: 
[0m07:17:57.112145 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:17:57.112662 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:17:57.117686 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:17:57.117837 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:17:57.117951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:17:57.608279 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:17:57.609857 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:17:57.740266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m07:17:57.751334 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:17:57.751867 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:17:57.752226 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:58.268761 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:17:58.271741 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:17:58.496838 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:17:58.501502 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:17:58.502057 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:17:58.503054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:17:58.950139 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m07:17:58.952168 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:17:59.109509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cf53cb0>]}
[0m07:17:59.111128 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:17:59.111586 [info ] [MainThread]: 
[0m07:17:59.122447 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:17:59.123317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m07:17:59.123744 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:17:59.132192 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:17:59.135548 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:17:59.124009 => 07:17:59.135343
[0m07:17:59.136310 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:17:59.136666 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:17:59.137337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:17:59.137586 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:17:59.139961 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:17:59.141061 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:17:59.137784 => 07:17:59.140933
[0m07:17:59.141655 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:17:59.142224 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:17:59.142521 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m07:17:59.142982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:17:59.143226 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:17:59.165848 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:17:59.166914 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:17:59.143361 => 07:17:59.166819
[0m07:17:59.167097 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:17:59.178788 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m07:17:59.181436 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m07:17:59.181694 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m07:17:59.181949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:00.704885 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:18:00.727430 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:17:59.167219 => 07:18:00.727216
[0m07:18:00.727951 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m07:18:00.852023 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8da19538-f72e-461e-acf1-2a21ca27464d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c7af800>]}
[0m07:18:00.853304 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.71s]
[0m07:18:00.854273 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:18:00.856945 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:18:00.857485 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m07:18:00.857965 [info ] [MainThread]: 
[0m07:18:00.858397 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.75 seconds (3.75s).
[0m07:18:00.859309 [debug] [MainThread]: Command end result
[0m07:18:00.874800 [info ] [MainThread]: 
[0m07:18:00.875301 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:18:00.875605 [info ] [MainThread]: 
[0m07:18:00.875912 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:18:00.876907 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.739738, "process_user_time": 3.010319, "process_kernel_time": 0.174715, "process_mem_max_rss": "224932", "process_in_blocks": "5240", "process_out_blocks": "4058"}
[0m07:18:00.877306 [debug] [MainThread]: Command `dbt run` succeeded at 07:18:00.877219 after 4.74 seconds
[0m07:18:00.877629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa856aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d3e0110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5169400>]}
[0m07:18:00.877932 [debug] [MainThread]: Flushing usage events
[0m07:18:03.373756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c413b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ca1e960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ca1da60>]}


============================== 07:18:03.376449 | 5fbdb342-a775-4679-9bf1-ebf4271d377d ==============================
[0m07:18:03.376449 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:18:03.376729 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m07:18:03.719510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5fbdb342-a775-4679-9bf1-ebf4271d377d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c40e3f0>]}
[0m07:18:03.749604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5fbdb342-a775-4679-9bf1-ebf4271d377d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c780650>]}
[0m07:18:03.749919 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:18:03.753014 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:18:03.767439 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:18:03.767600 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:18:03.769892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5fbdb342-a775-4679-9bf1-ebf4271d377d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77649af0>]}
[0m07:18:03.774546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5fbdb342-a775-4679-9bf1-ebf4271d377d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76f2baa0>]}
[0m07:18:03.774736 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:18:03.774888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fbdb342-a775-4679-9bf1-ebf4271d377d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7700dc70>]}
[0m07:18:03.775606 [info ] [MainThread]: 
[0m07:18:03.775935 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:18:03.776495 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:18:03.782127 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:18:03.782271 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:18:03.782389 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:05.110399 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:18:05.113694 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:18:05.248363 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:18:05.253894 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:18:05.254606 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:18:05.255054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:18:05.630538 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m07:18:05.631929 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:18:05.742381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5fbdb342-a775-4679-9bf1-ebf4271d377d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76f2a060>]}
[0m07:18:05.743813 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:18:05.744386 [info ] [MainThread]: 
[0m07:18:05.756971 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:18:05.757553 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m07:18:05.758327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:18:05.758722 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:18:05.771766 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:18:05.774112 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:18:05.758970 => 07:18:05.773958
[0m07:18:05.774376 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:18:05.785013 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:18:05.786203 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:18:05.786394 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m07:18:05.786565 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:06.331035 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:18:06.341539 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:18:05.774551 => 07:18:06.341071
[0m07:18:06.342308 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m07:18:06.473741 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.72s]
[0m07:18:06.474965 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:18:06.475634 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:18:06.476175 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m07:18:06.477099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:18:06.477600 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:18:06.486308 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:18:06.489536 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:18:06.477935 => 07:18:06.489143
[0m07:18:06.490067 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:18:06.493187 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:18:06.494747 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:18:06.495118 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m07:18:06.495478 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:07.013311 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:18:07.016283 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:18:06.490468 => 07:18:07.015967
[0m07:18:07.016859 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m07:18:07.160452 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.68s]
[0m07:18:07.161152 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:18:07.161548 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:18:07.161877 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m07:18:07.162438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:18:07.162754 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:18:07.168364 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:18:07.169858 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:18:07.162963 => 07:18:07.169686
[0m07:18:07.170143 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:18:07.172053 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:18:07.173210 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:18:07.173567 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m07:18:07.173850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:07.690792 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:18:07.695734 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:18:07.170333 => 07:18:07.695275
[0m07:18:07.696431 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m07:18:07.815009 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.65s]
[0m07:18:07.816464 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:18:07.819596 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:18:07.820317 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:18:07.820840 [info ] [MainThread]: 
[0m07:18:07.821288 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 4.04 seconds (4.04s).
[0m07:18:07.822396 [debug] [MainThread]: Command end result
[0m07:18:07.835000 [info ] [MainThread]: 
[0m07:18:07.835497 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:18:07.835919 [info ] [MainThread]: 
[0m07:18:07.836313 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:18:07.837430 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.485238, "process_user_time": 2.450598, "process_kernel_time": 0.128398, "process_mem_max_rss": "213100", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m07:18:07.837835 [debug] [MainThread]: Command `dbt test` succeeded at 07:18:07.837747 after 4.49 seconds
[0m07:18:07.838138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c40c6e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77362c60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76d8d100>]}
[0m07:18:07.838439 [debug] [MainThread]: Flushing usage events
[0m07:18:10.192820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90804b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90bf5880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90bf59d0>]}


============================== 07:18:10.195602 | 1617115b-81dd-4ba1-ae80-ed4529844a46 ==============================
[0m07:18:10.195602 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:18:10.195864 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:18:10.603041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b623c50>]}
[0m07:18:10.695398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6bcd7200>]}
[0m07:18:10.696227 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:18:10.703260 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:18:10.749412 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:18:10.750315 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:18:10.756167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b52e1e0>]}
[0m07:18:10.763972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b39c230>]}
[0m07:18:10.764289 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:18:10.764541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b4c2ff0>]}
[0m07:18:10.765744 [info ] [MainThread]: 
[0m07:18:10.766196 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:18:10.767034 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:18:10.773572 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:18:10.773807 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:18:10.773946 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:11.184545 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:18:11.185625 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:18:11.317936 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:18:11.322308 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:18:11.322642 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:18:11.322989 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:18:11.681952 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m07:18:11.683349 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:18:11.829424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:18:11.837458 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:18:11.838343 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:18:11.840467 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:18:12.183574 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:18:12.185696 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:18:12.318084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b658980>]}
[0m07:18:12.318817 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:18:12.319068 [info ] [MainThread]: 
[0m07:18:12.324324 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:18:12.324734 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:18:12.325213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:18:12.325415 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:18:12.330200 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:18:12.325543 => 07:18:12.330028
[0m07:18:12.330571 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:18:12.364668 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:12.365210 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:18:12.365525 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:12.833373 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:18:12.837888 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:12.838243 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:18:13.198264 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:18:13.203555 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:13.203809 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:18:13.305791 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:18:13.326299 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:13.326857 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:18:15.308712 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:18:15.315989 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:15.316653 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:18:15.410590 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:18:15.416959 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:15.417627 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:18:15.602656 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:18:15.605330 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:15.605568 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:18:15.691834 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:18:15.694881 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:15.695213 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:18:15.799283 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:18:15.810434 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:15.811080 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:18:16.654404 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 1.0 seconds
[0m07:18:16.666096 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m07:18:16.670882 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:16.671630 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m07:18:16.791287 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:18:16.792367 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:16.793150 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:18:17.595686 [debug] [Thread-1 (]: SQL status: SUCCESS 23 in 1.0 seconds
[0m07:18:17.597328 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:18:17.598027 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m07:18:18.008019 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:18:18.019350 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:18:12.330771 => 07:18:18.019164
[0m07:18:18.019664 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:18:18.154554 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a92fcb0>]}
[0m07:18:18.155236 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 23[0m in 5.83s]
[0m07:18:18.155780 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:18:18.156143 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:18:18.156554 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:18:18.157310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:18:18.157539 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:18:18.160414 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:18:18.157655 => 07:18:18.160321
[0m07:18:18.160621 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:18:18.162377 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:18.162551 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:18:18.162702 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:18.938245 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:18:18.945584 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:18.946392 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:18:19.087975 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:18:19.093833 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:19.094396 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:18:19.197774 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:18:19.202480 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:19.202931 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:18:20.594685 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:18:20.599534 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:20.600133 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:18:20.687414 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:18:20.693202 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:20.693917 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:18:20.801115 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:18:20.807581 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:20.808335 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:18:20.953487 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:18:20.959640 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:20.960377 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:18:21.054767 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:18:21.063236 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:21.064325 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:18:21.179152 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:18:21.183206 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:21.186306 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:21.186996 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m07:18:21.270854 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:18:21.271352 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:21.271647 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:18:22.079835 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:18:22.080718 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:18:22.081287 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m07:18:22.513921 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:18:22.519580 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:18:18.160728 => 07:18:22.519179
[0m07:18:22.520286 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:18:22.656173 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1617115b-81dd-4ba1-ae80-ed4529844a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a92fcb0>]}
[0m07:18:22.657625 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 6[0m in 4.50s]
[0m07:18:22.658829 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:18:22.663362 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:18:22.663983 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:18:22.664445 [info ] [MainThread]: 
[0m07:18:22.664967 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 11.90 seconds (11.90s).
[0m07:18:22.666022 [debug] [MainThread]: Command end result
[0m07:18:22.677065 [info ] [MainThread]: 
[0m07:18:22.677480 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:18:22.677744 [info ] [MainThread]: 
[0m07:18:22.677990 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m07:18:22.683995 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.511482, "process_user_time": 2.764072, "process_kernel_time": 0.142701, "process_mem_max_rss": "213836", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m07:18:22.686181 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:18:22.686018 after 12.51 seconds
[0m07:18:22.686945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff958c69c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff70e087d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff906e7bf0>]}
[0m07:18:22.687279 [debug] [MainThread]: Flushing usage events
[0m07:18:53.778528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3b19a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3e451f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3c1e7b0>]}


============================== 07:18:53.781405 | 47137f88-72ad-4854-9120-b10151e1abd6 ==============================
[0m07:18:53.781405 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:18:53.781680 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m07:18:54.150299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47137f88-72ad-4854-9120-b10151e1abd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e9264e0>]}
[0m07:18:54.180664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47137f88-72ad-4854-9120-b10151e1abd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e896bd0>]}
[0m07:18:54.180973 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:18:54.184859 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:18:54.199189 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:18:54.199344 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:18:54.201437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47137f88-72ad-4854-9120-b10151e1abd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e8f4fe0>]}
[0m07:18:54.206465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47137f88-72ad-4854-9120-b10151e1abd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e667950>]}
[0m07:18:54.206652 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:18:54.206812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47137f88-72ad-4854-9120-b10151e1abd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e864b30>]}
[0m07:18:54.207540 [info ] [MainThread]: 
[0m07:18:54.207870 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:18:54.208407 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:18:54.213207 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:18:54.213363 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:18:54.213491 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:54.702780 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:18:54.704000 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:18:54.882234 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:18:54.886652 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:18:54.886866 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:18:54.887044 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:18:55.314035 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m07:18:55.315027 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:18:55.438928 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:18:55.441693 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:18:55.442407 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:18:55.442782 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:18:55.897044 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:18:55.898118 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:18:56.020370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47137f88-72ad-4854-9120-b10151e1abd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e926450>]}
[0m07:18:56.021061 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:18:56.021405 [info ] [MainThread]: 
[0m07:18:56.027696 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:18:56.028096 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m07:18:56.028313 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:18:56.033101 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:18:56.033882 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:18:56.028456 => 07:18:56.033768
[0m07:18:56.034400 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:18:56.034643 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:18:56.035170 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:18:56.035390 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:18:56.037174 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:18:56.037764 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:18:56.035518 => 07:18:56.037675
[0m07:18:56.038134 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:18:56.038590 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:18:56.038809 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m07:18:56.039261 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:18:56.039442 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:18:56.059909 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:18:56.061090 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:18:56.039559 => 07:18:56.060955
[0m07:18:56.061307 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:18:56.072851 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m07:18:56.074898 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m07:18:56.075139 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m07:18:56.075422 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:18:57.841287 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:18:57.854492 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:18:56.061443 => 07:18:57.854347
[0m07:18:57.854779 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m07:18:58.004950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47137f88-72ad-4854-9120-b10151e1abd6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e9263c0>]}
[0m07:18:58.005595 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.97s]
[0m07:18:58.006178 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:18:58.007773 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:18:58.008024 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m07:18:58.008267 [info ] [MainThread]: 
[0m07:18:58.008524 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.80 seconds (3.80s).
[0m07:18:58.009039 [debug] [MainThread]: Command end result
[0m07:18:58.016706 [info ] [MainThread]: 
[0m07:18:58.016953 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:18:58.017147 [info ] [MainThread]: 
[0m07:18:58.017335 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:18:58.018115 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.2608795, "process_user_time": 2.302379, "process_kernel_time": 0.128188, "process_mem_max_rss": "212828", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m07:18:58.018433 [debug] [MainThread]: Command `dbt run` succeeded at 07:18:58.018372 after 4.26 seconds
[0m07:18:58.018700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3b1b3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3e451f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4172a80>]}
[0m07:18:58.018931 [debug] [MainThread]: Flushing usage events
[0m07:18:59.766114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95e1d0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9646d8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95ebd730>]}


============================== 07:18:59.768977 | f78f17e8-b10e-48d9-8c19-71ad433eb966 ==============================
[0m07:18:59.768977 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:18:59.769234 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:19:00.155331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f78f17e8-b10e-48d9-8c19-71ad433eb966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff921c6b70>]}
[0m07:19:00.186552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f78f17e8-b10e-48d9-8c19-71ad433eb966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cc99ca0>]}
[0m07:19:00.186936 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:19:00.190018 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:19:00.204516 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:19:00.204692 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:19:00.206889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f78f17e8-b10e-48d9-8c19-71ad433eb966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74b010d0>]}
[0m07:19:00.212074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f78f17e8-b10e-48d9-8c19-71ad433eb966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74947530>]}
[0m07:19:00.212384 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:19:00.212620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f78f17e8-b10e-48d9-8c19-71ad433eb966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74a6c6e0>]}
[0m07:19:00.213616 [info ] [MainThread]: 
[0m07:19:00.214029 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:19:00.215797 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:19:00.222707 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:19:00.222953 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:19:00.223111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:19:00.742219 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:19:00.744789 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:19:00.874444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:19:00.879574 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:19:00.880134 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:19:00.880584 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:19:01.256079 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m07:19:01.260148 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:19:01.434932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f78f17e8-b10e-48d9-8c19-71ad433eb966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74945f10>]}
[0m07:19:01.436685 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:19:01.437480 [info ] [MainThread]: 
[0m07:19:01.450757 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:19:01.451400 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m07:19:01.452190 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:19:01.452575 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:19:01.466725 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:19:01.468139 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:19:01.452836 => 07:19:01.467871
[0m07:19:01.468466 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:19:01.479512 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:19:01.480537 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:19:01.480747 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m07:19:01.480952 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:19:02.069415 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:19:02.080015 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:19:01.468670 => 07:19:02.079580
[0m07:19:02.080829 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m07:19:02.235465 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.78s]
[0m07:19:02.236655 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:19:02.237285 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:19:02.237824 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m07:19:02.238941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:19:02.239688 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:19:02.247407 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:19:02.249383 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:19:02.240077 => 07:19:02.249148
[0m07:19:02.249878 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:19:02.253521 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:19:02.255299 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:19:02.255695 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m07:19:02.256050 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:19:02.691741 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:19:02.694197 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:19:02.250534 => 07:19:02.693994
[0m07:19:02.694581 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m07:19:03.173081 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.93s]
[0m07:19:03.174577 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:19:03.175409 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:19:03.176103 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m07:19:03.177440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:19:03.178115 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:19:03.188730 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:19:03.190613 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:19:03.178638 => 07:19:03.190380
[0m07:19:03.191038 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:19:03.193552 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:19:03.194869 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:19:03.195265 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m07:19:03.195551 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:19:03.775789 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:19:03.778396 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:19:03.191288 => 07:19:03.778142
[0m07:19:03.778842 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m07:19:03.886688 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.71s]
[0m07:19:03.887553 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:19:03.889699 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:19:03.890122 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:19:03.890499 [info ] [MainThread]: 
[0m07:19:03.890875 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.68 seconds (3.68s).
[0m07:19:03.891774 [debug] [MainThread]: Command end result
[0m07:19:03.901752 [info ] [MainThread]: 
[0m07:19:03.902094 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:19:03.902340 [info ] [MainThread]: 
[0m07:19:03.902596 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:19:03.903480 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.158358, "process_user_time": 2.440114, "process_kernel_time": 0.138917, "process_mem_max_rss": "212196", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m07:19:03.903914 [debug] [MainThread]: Command `dbt test` succeeded at 07:19:03.903812 after 4.16 seconds
[0m07:19:03.904226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9646d8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ae0a9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74adbfe0>]}
[0m07:19:03.904536 [debug] [MainThread]: Flushing usage events
[0m07:19:05.739833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7af1670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7bf3890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7b30500>]}


============================== 07:19:05.742542 | a963eb1c-b847-4a37-866c-102dbaf061ed ==============================
[0m07:19:05.742542 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:19:05.742833 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:19:06.101625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82e39580>]}
[0m07:19:06.132526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b537980>]}
[0m07:19:06.132920 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:19:06.135852 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:19:06.149136 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:19:06.149309 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:19:06.151478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff830205c0>]}
[0m07:19:06.156296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff826ec260>]}
[0m07:19:06.156512 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:19:06.156695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82973f50>]}
[0m07:19:06.157419 [info ] [MainThread]: 
[0m07:19:06.157767 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:19:06.158307 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:19:06.163314 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:19:06.163483 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:19:06.163623 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:19:06.585813 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:19:06.588816 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:19:06.715516 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:19:06.721026 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:19:06.721274 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:19:06.721497 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:19:07.043687 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.0 seconds
[0m07:19:07.046833 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:19:07.171427 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:19:07.176506 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:19:07.177546 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:19:07.177977 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:19:07.922761 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:19:07.926068 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:19:08.079664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff827d3bc0>]}
[0m07:19:08.081392 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:19:08.083503 [info ] [MainThread]: 
[0m07:19:08.093907 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:19:08.094612 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:19:08.095670 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m07:19:08.096011 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:19:08.102528 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:19:08.096238 => 07:19:08.102359
[0m07:19:08.102831 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:19:08.133825 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:08.134067 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:19:08.134258 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:19:08.696305 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:19:08.702014 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:08.702483 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:19:08.789133 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:19:08.796910 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:08.797289 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:19:08.879632 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:19:08.903368 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:08.903808 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:19:10.440694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:19:10.445739 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:10.446458 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:19:10.565579 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:19:10.570657 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:10.571351 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:19:10.641730 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:19:10.648103 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:10.648773 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:19:10.810223 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:19:10.815534 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:10.816084 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:19:10.944762 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:19:10.954227 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:10.954732 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:19:11.217413 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:19:11.228671 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m07:19:11.233167 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:11.233620 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m07:19:11.975196 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:19:11.976522 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:11.977158 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:19:12.691191 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:19:12.692348 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:19:12.693113 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m07:19:13.599868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:19:13.623583 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:19:08.103033 => 07:19:13.623361
[0m07:19:13.624150 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:19:13.740857 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81b3e060>]}
[0m07:19:13.742476 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 0[0m in 5.65s]
[0m07:19:13.743745 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:19:13.745251 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:19:13.746081 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:19:13.747679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:19:13.748261 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:19:13.755697 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:19:13.748590 => 07:19:13.755380
[0m07:19:13.756230 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:19:13.760396 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:13.760773 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:19:13.761132 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:19:14.168878 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m07:19:14.173960 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:14.174833 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:19:14.267795 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:19:14.272791 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:14.273407 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:19:14.348808 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:19:14.360642 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:14.361611 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:19:15.975293 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:19:15.980787 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:15.981454 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:19:16.067313 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:19:16.073350 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:16.074012 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:19:16.161768 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:19:16.167444 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:16.168185 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:19:16.270697 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:19:16.276376 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:16.276936 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:19:16.346089 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:19:16.348301 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:16.348528 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:19:16.451550 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:19:16.453004 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:16.454094 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:16.454309 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m07:19:17.032950 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:19:17.033358 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:17.033548 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:19:17.662589 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:19:17.663258 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:19:17.663500 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m07:19:18.082535 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:19:18.085066 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:19:13.756528 => 07:19:18.084886
[0m07:19:18.085307 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:19:18.214662 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a963eb1c-b847-4a37-866c-102dbaf061ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81bffbf0>]}
[0m07:19:18.215402 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.47s]
[0m07:19:18.216717 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:19:18.218382 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:19:18.218591 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:19:18.218787 [info ] [MainThread]: 
[0m07:19:18.219077 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 12.06 seconds (12.06s).
[0m07:19:18.219639 [debug] [MainThread]: Command end result
[0m07:19:18.228382 [info ] [MainThread]: 
[0m07:19:18.228723 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:19:18.228909 [info ] [MainThread]: 
[0m07:19:18.229176 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m07:19:18.230138 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.511188, "process_user_time": 2.658865, "process_kernel_time": 0.139091, "process_mem_max_rss": "214232", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m07:19:18.230479 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:19:18.230412 after 12.51 seconds
[0m07:19:18.230737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7bf3890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82b26780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d3b2990>]}
[0m07:19:18.230916 [debug] [MainThread]: Flushing usage events
[0m07:44:19.750878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae9d8a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae9d9940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae9d8b90>]}


============================== 07:44:19.753766 | 2c8665d9-9564-469c-9a12-c70b86a95923 ==============================
[0m07:44:19.753766 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:44:19.754265 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:44:20.095957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c8665d9-9564-469c-9a12-c70b86a95923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d7ca270>]}
[0m07:44:20.125928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c8665d9-9564-469c-9a12-c70b86a95923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d979ca0>]}
[0m07:44:20.126250 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:44:20.129712 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:44:20.144867 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:44:20.145017 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:44:20.147174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2c8665d9-9564-469c-9a12-c70b86a95923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d625af0>]}
[0m07:44:20.152757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2c8665d9-9564-469c-9a12-c70b86a95923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d544080>]}
[0m07:44:20.152972 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:44:20.153242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c8665d9-9564-469c-9a12-c70b86a95923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e612c00>]}
[0m07:44:20.154006 [info ] [MainThread]: 
[0m07:44:20.154357 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:44:20.154866 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:44:20.159764 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:44:20.159913 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:44:20.160033 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:44:20.608913 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:44:20.611845 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:44:20.731778 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:44:20.736706 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:44:20.737079 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:44:20.737288 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:44:21.082497 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:44:21.085423 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:44:21.208141 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:44:21.214059 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:44:21.214833 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:44:21.215447 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:44:21.656113 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:44:21.659706 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:44:22.295941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c8665d9-9564-469c-9a12-c70b86a95923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d6a3dd0>]}
[0m07:44:22.297608 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:44:22.299259 [info ] [MainThread]: 
[0m07:44:22.311936 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:44:22.313063 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m07:44:22.313546 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:44:22.322139 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:44:22.323911 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:44:22.313884 => 07:44:22.323743
[0m07:44:22.324599 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:44:22.324889 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:44:22.325614 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:44:22.325970 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:44:22.328604 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:44:22.329473 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:44:22.326206 => 07:44:22.329361
[0m07:44:22.329968 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:44:22.330539 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:44:22.330841 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m07:44:22.331636 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:44:22.331853 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:44:22.356010 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:44:22.357419 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:44:22.331987 => 07:44:22.357242
[0m07:44:22.357734 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:44:22.370636 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m07:44:22.373040 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m07:44:22.373353 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m07:44:22.373661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:44:23.828479 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:44:23.851148 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:44:22.357916 => 07:44:23.850937
[0m07:44:23.851692 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m07:44:23.987732 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c8665d9-9564-469c-9a12-c70b86a95923', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cbefad0>]}
[0m07:44:23.989186 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.66s]
[0m07:44:23.990957 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:44:23.993846 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:44:23.994388 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m07:44:23.994878 [info ] [MainThread]: 
[0m07:44:23.995582 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.84 seconds (3.84s).
[0m07:44:23.996389 [debug] [MainThread]: Command end result
[0m07:44:24.010730 [info ] [MainThread]: 
[0m07:44:24.011386 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:44:24.011710 [info ] [MainThread]: 
[0m07:44:24.012226 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:44:24.013318 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.2837243, "process_user_time": 2.381642, "process_kernel_time": 0.124085, "process_mem_max_rss": "212572", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m07:44:24.013791 [debug] [MainThread]: Command `dbt run` succeeded at 07:44:24.013681 after 4.28 seconds
[0m07:44:24.014128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3a0aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ef74d40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d7cb980>]}
[0m07:44:24.014417 [debug] [MainThread]: Flushing usage events
[0m07:44:25.780349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb560d640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb560d760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb560c350>]}


============================== 07:44:25.783010 | ab4a89e8-fb6a-4699-972c-67bd66d1b90e ==============================
[0m07:44:25.783010 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:44:25.783400 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:44:26.170770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab4a89e8-fb6a-4699-972c-67bd66d1b90e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a62b110>]}
[0m07:44:26.200615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ab4a89e8-fb6a-4699-972c-67bd66d1b90e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9450c200>]}
[0m07:44:26.200915 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:44:26.204146 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:44:26.217486 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:44:26.217635 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:44:26.219804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ab4a89e8-fb6a-4699-972c-67bd66d1b90e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94294cb0>]}
[0m07:44:26.224680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ab4a89e8-fb6a-4699-972c-67bd66d1b90e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9414f470>]}
[0m07:44:26.224865 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:44:26.225138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab4a89e8-fb6a-4699-972c-67bd66d1b90e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94367170>]}
[0m07:44:26.225906 [info ] [MainThread]: 
[0m07:44:26.226284 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:44:26.226892 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:44:26.232442 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:44:26.232618 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:44:26.232768 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:44:26.604501 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:44:26.606447 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:44:26.727660 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:44:26.732864 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:44:26.733658 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:44:26.734151 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:44:27.345261 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:44:27.348955 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:44:27.482323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab4a89e8-fb6a-4699-972c-67bd66d1b90e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9414dcd0>]}
[0m07:44:27.484303 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:44:27.486432 [info ] [MainThread]: 
[0m07:44:27.498370 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:44:27.499064 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m07:44:27.500151 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:44:27.500517 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:44:27.514664 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:44:27.516202 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:44:27.500833 => 07:44:27.516051
[0m07:44:27.516436 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:44:27.527276 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:44:27.528401 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:44:27.528653 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m07:44:27.528873 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:44:28.043892 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:44:28.053958 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:44:27.516577 => 07:44:28.053523
[0m07:44:28.054827 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m07:44:28.168830 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.67s]
[0m07:44:28.170664 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:44:28.171369 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:44:28.172000 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m07:44:28.173185 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:44:28.173765 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:44:28.183556 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:44:28.185644 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:44:28.174155 => 07:44:28.185415
[0m07:44:28.186053 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:44:28.188587 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:44:28.189896 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:44:28.190261 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m07:44:28.190630 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:44:28.674412 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:44:28.675623 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:44:28.186358 => 07:44:28.675495
[0m07:44:28.675841 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m07:44:28.794098 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.62s]
[0m07:44:28.795303 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:44:28.795874 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:44:28.796363 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m07:44:28.797028 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:44:28.797394 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:44:28.803414 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:44:28.804692 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:44:28.797630 => 07:44:28.804511
[0m07:44:28.805003 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:44:28.807049 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:44:28.808286 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:44:28.808636 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m07:44:28.808914 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:44:29.391710 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:44:29.394274 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:44:28.805208 => 07:44:29.394087
[0m07:44:29.394630 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m07:44:29.499500 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.70s]
[0m07:44:29.501011 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:44:29.502685 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:44:29.502927 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:44:29.503217 [info ] [MainThread]: 
[0m07:44:29.503688 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.28 seconds (3.28s).
[0m07:44:29.504526 [debug] [MainThread]: Command end result
[0m07:44:29.512921 [info ] [MainThread]: 
[0m07:44:29.513428 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:44:29.513634 [info ] [MainThread]: 
[0m07:44:29.514057 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:44:29.515507 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.7561803, "process_user_time": 2.444164, "process_kernel_time": 0.096321, "process_mem_max_rss": "213064", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m07:44:29.516007 [debug] [MainThread]: Command `dbt test` succeeded at 07:44:29.515904 after 3.76 seconds
[0m07:44:29.516339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba5b69f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff943bef60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f51ae70>]}
[0m07:44:29.516665 [debug] [MainThread]: Flushing usage events
[0m07:44:33.043649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb92aed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9dc4e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba2a2e40>]}


============================== 07:44:33.046353 | a4d63594-f6ec-428d-aa7d-0dfdcd574bc9 ==============================
[0m07:44:33.046353 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:44:33.046614 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m07:44:33.400097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff989d44d0>]}
[0m07:44:33.430740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f5c3950>]}
[0m07:44:33.431052 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:44:33.434193 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:44:33.450474 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:44:33.450631 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:44:33.452903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9932d580>]}
[0m07:44:33.457989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9892f800>]}
[0m07:44:33.458193 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:44:33.458388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98f4e840>]}
[0m07:44:33.459200 [info ] [MainThread]: 
[0m07:44:33.459546 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:44:33.460126 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:44:33.465755 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:44:33.466011 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:44:33.466174 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:44:33.916642 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:44:33.919269 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:44:34.053228 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m07:44:34.064140 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:44:34.064726 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:44:34.065193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:44:34.472567 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:44:34.475105 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:44:34.596386 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:44:34.600415 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:44:34.600912 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:44:34.601799 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:44:34.971973 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:44:34.973392 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:44:35.090958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98d57fe0>]}
[0m07:44:35.092323 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:44:35.093373 [info ] [MainThread]: 
[0m07:44:35.104235 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:44:35.104824 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:44:35.105738 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:44:35.106072 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:44:35.112547 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:44:35.106298 => 07:44:35.112377
[0m07:44:35.112848 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:44:35.146175 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:35.146493 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:44:35.146732 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:44:35.710532 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:44:35.722872 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:35.723786 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:44:35.830702 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:44:35.840635 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:35.841425 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:44:35.917780 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:44:35.953620 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:35.955244 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:44:37.240973 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:44:37.243066 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:37.243269 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:44:37.334249 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:44:37.335981 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:37.336162 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:44:37.421970 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:44:37.423593 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:37.423804 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:44:37.540168 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:44:37.542440 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:37.542732 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:44:37.752688 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:44:37.756726 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:37.756981 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:44:37.959245 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:44:37.963043 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m07:44:37.965672 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:37.965895 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m07:44:38.124729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:44:38.125156 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:38.125350 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:44:38.881174 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m07:44:38.882140 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:44:38.882692 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m07:44:39.170216 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:44:39.195128 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:44:35.113058 => 07:44:39.194911
[0m07:44:39.195632 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:44:39.307670 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98780a70>]}
[0m07:44:39.309697 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 4.20s]
[0m07:44:39.312525 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:44:39.313296 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:44:39.314193 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:44:39.315540 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:44:39.316114 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:44:39.324304 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:44:39.316494 => 07:44:39.323992
[0m07:44:39.324787 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:44:39.328880 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:39.329402 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:44:39.329879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:44:39.876414 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:44:39.881942 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:39.882822 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:44:39.993565 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:44:39.999805 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:40.000634 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:44:40.129476 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:44:40.140737 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:40.141598 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:44:41.341012 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:44:41.346613 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:41.347321 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:44:41.468147 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:44:41.474208 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:41.474887 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:44:41.612678 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:44:41.618582 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:41.619206 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:44:41.706365 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:44:41.712385 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:41.713062 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:44:41.817157 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:44:41.823496 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:41.824231 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:44:41.907173 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:44:41.911156 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:41.915022 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:41.915560 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m07:44:42.036062 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:44:42.036647 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:42.037116 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:44:42.592596 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:44:42.593189 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:44:42.593541 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m07:44:42.931900 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:44:42.936755 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:44:39.325056 => 07:44:42.936476
[0m07:44:42.937358 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:44:43.057312 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a4d63594-f6ec-428d-aa7d-0dfdcd574bc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98666000>]}
[0m07:44:43.059548 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.74s]
[0m07:44:43.062208 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:44:43.066709 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:44:43.067882 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:44:43.068519 [info ] [MainThread]: 
[0m07:44:43.069690 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 9.61 seconds (9.61s).
[0m07:44:43.071084 [debug] [MainThread]: Command end result
[0m07:44:43.086151 [info ] [MainThread]: 
[0m07:44:43.086755 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:44:43.087035 [info ] [MainThread]: 
[0m07:44:43.087433 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m07:44:43.090003 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 10.067044, "process_user_time": 2.681365, "process_kernel_time": 0.175727, "process_mem_max_rss": "214208", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m07:44:43.090948 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:44:43.090835 after 10.07 seconds
[0m07:44:43.091515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbb92aed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba3aa0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9903a5a0>]}
[0m07:44:43.091982 [debug] [MainThread]: Flushing usage events
[0m19:20:38.516513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa76ac2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7a11070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7a105c0>]}


============================== 19:20:38.519444 | e2312822-5644-4b03-a0f0-e2dbcc63c40d ==============================
[0m19:20:38.519444 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:20:38.519849 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:20:38.858605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6554740>]}
[0m19:20:38.888307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff947c09e0>]}
[0m19:20:38.888639 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:20:38.891869 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:20:38.896745 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m19:20:38.897026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8236ff50>]}
[0m19:20:39.420620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81324110>]}
[0m19:20:39.426798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81326450>]}
[0m19:20:39.427003 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:20:39.427342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82331940>]}
[0m19:20:39.428057 [info ] [MainThread]: 
[0m19:20:39.428441 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:20:39.428960 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m19:20:39.434254 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m19:20:39.434425 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m19:20:39.434552 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:20:40.049601 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:20:40.051132 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m19:20:40.276884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m19:20:40.287761 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m19:20:40.288516 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m19:20:40.289134 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:40.833334 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:20:40.836649 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m19:20:41.051705 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m19:20:41.056997 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m19:20:41.057706 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m19:20:41.058253 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:41.670876 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m19:20:41.674100 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m19:20:41.874862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80f78a40>]}
[0m19:20:41.875351 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:20:41.875571 [info ] [MainThread]: 
[0m19:20:41.880239 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m19:20:41.880662 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m19:20:41.880860 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m19:20:41.884582 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m19:20:41.886882 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 19:20:41.881007 => 19:20:41.886757
[0m19:20:41.887362 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m19:20:41.887606 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m19:20:41.888121 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m19:20:41.888378 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m19:20:41.890039 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m19:20:41.891957 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 19:20:41.888512 => 19:20:41.891793
[0m19:20:41.892523 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m19:20:41.893981 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m19:20:41.894917 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m19:20:41.895729 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m19:20:41.896257 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m19:20:41.916908 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m19:20:41.918049 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 19:20:41.898338 => 19:20:41.917949
[0m19:20:41.918218 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m19:20:41.928136 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m19:20:41.930527 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m19:20:41.930778 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m19:20:41.931037 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:43.639514 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m19:20:43.657533 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 19:20:41.918326 => 19:20:43.657401
[0m19:20:43.657812 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m19:20:43.809077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2312822-5644-4b03-a0f0-e2dbcc63c40d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff817de900>]}
[0m19:20:43.810733 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.91s]
[0m19:20:43.812385 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m19:20:43.816237 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:20:43.817026 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m19:20:43.817734 [info ] [MainThread]: 
[0m19:20:43.818766 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.39 seconds (4.39s).
[0m19:20:43.819841 [debug] [MainThread]: Command end result
[0m19:20:43.829601 [info ] [MainThread]: 
[0m19:20:43.830187 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:20:43.830562 [info ] [MainThread]: 
[0m19:20:43.831009 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:20:43.832276 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.3366823, "process_user_time": 2.861981, "process_kernel_time": 0.211586, "process_mem_max_rss": "225220", "process_out_blocks": "2722", "process_in_blocks": "0"}
[0m19:20:43.832811 [debug] [MainThread]: Command `dbt run` succeeded at 19:20:43.832706 after 5.34 seconds
[0m19:20:43.833245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa76ac170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8218ec30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff824949b0>]}
[0m19:20:43.833589 [debug] [MainThread]: Flushing usage events
[0m19:20:45.948950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf50c560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf50c590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf50c470>]}


============================== 19:20:45.952185 | 601d55e7-9fd5-4378-a027-edab1811168b ==============================
[0m19:20:45.952185 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:20:45.952825 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:20:46.288470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '601d55e7-9fd5-4378-a027-edab1811168b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac1b9f40>]}
[0m19:20:46.319397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '601d55e7-9fd5-4378-a027-edab1811168b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a7cd340>]}
[0m19:20:46.319721 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:20:46.322852 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:20:46.336635 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:20:46.336797 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:20:46.339001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '601d55e7-9fd5-4378-a027-edab1811168b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a13e330>]}
[0m19:20:46.343915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '601d55e7-9fd5-4378-a027-edab1811168b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a06f3b0>]}
[0m19:20:46.344104 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:20:46.344405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '601d55e7-9fd5-4378-a027-edab1811168b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a3e6cf0>]}
[0m19:20:46.345138 [info ] [MainThread]: 
[0m19:20:46.345580 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:20:46.346180 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m19:20:46.351771 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m19:20:46.351928 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m19:20:46.352051 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:20:48.931552 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 3.0 seconds
[0m19:20:48.933617 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m19:20:49.102026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m19:20:49.104390 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m19:20:49.104568 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m19:20:49.104732 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:49.855430 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m19:20:49.856319 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m19:20:50.105258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '601d55e7-9fd5-4378-a027-edab1811168b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a13d520>]}
[0m19:20:50.106208 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:20:50.107795 [info ] [MainThread]: 
[0m19:20:50.118773 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:50.119483 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m19:20:50.120569 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m19:20:50.121064 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:50.132194 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:20:50.133509 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 19:20:50.121405 => 19:20:50.133364
[0m19:20:50.133726 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:50.144375 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:20:50.146434 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m19:20:50.146807 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m19:20:50.147108 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:50.904694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:20:50.917368 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 19:20:50.133868 => 19:20:50.916910
[0m19:20:50.918251 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m19:20:51.085124 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.96s]
[0m19:20:51.086647 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m19:20:51.087323 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:51.087868 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m19:20:51.089044 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m19:20:51.089658 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:51.095203 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:20:51.097144 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 19:20:51.090051 => 19:20:51.096892
[0m19:20:51.097712 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:51.100231 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:20:51.101145 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m19:20:51.101365 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m19:20:51.101524 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:52.145563 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:20:52.148774 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 19:20:51.098028 => 19:20:52.148526
[0m19:20:52.149268 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m19:20:52.673659 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 1.58s]
[0m19:20:52.676151 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m19:20:52.676907 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:52.677618 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m19:20:52.679055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m19:20:52.679616 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:52.689623 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:20:52.691037 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 19:20:52.679931 => 19:20:52.690782
[0m19:20:52.691457 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:52.694006 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:20:52.695119 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m19:20:52.695474 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m19:20:52.695778 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:53.529804 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:20:53.534232 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 19:20:52.691713 => 19:20:53.533854
[0m19:20:53.534884 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m19:20:54.281185 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 1.60s]
[0m19:20:54.283128 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m19:20:54.286392 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:20:54.286912 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m19:20:54.287373 [info ] [MainThread]: 
[0m19:20:54.288141 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 7.94 seconds (7.94s).
[0m19:20:54.289296 [debug] [MainThread]: Command end result
[0m19:20:54.302461 [info ] [MainThread]: 
[0m19:20:54.303185 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:20:54.303524 [info ] [MainThread]: 
[0m19:20:54.304079 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m19:20:54.306788 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 8.379032, "process_user_time": 2.393842, "process_kernel_time": 0.130718, "process_mem_max_rss": "212816", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m19:20:54.307553 [debug] [MainThread]: Command `dbt test` succeeded at 19:20:54.307445 after 8.38 seconds
[0m19:20:54.307984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf50c620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf612fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a13f590>]}
[0m19:20:54.308289 [debug] [MainThread]: Flushing usage events
[0m19:20:57.152771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f810500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f866120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f811a30>]}


============================== 19:20:57.155679 | b855f3de-07b4-4e17-86d8-44d6ced2ada0 ==============================
[0m19:20:57.155679 [info ] [MainThread]: Running with dbt=1.7.19
[0m19:20:57.156213 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:20:57.529821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a5c7ec0>]}
[0m19:20:57.559608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b462690>]}
[0m19:20:57.559971 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m19:20:57.563135 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m19:20:57.576566 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:20:57.576724 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:20:57.578911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a55d130>]}
[0m19:20:57.583737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a39bb30>]}
[0m19:20:57.583923 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:20:57.584190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a533350>]}
[0m19:20:57.584884 [info ] [MainThread]: 
[0m19:20:57.585258 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:20:57.585794 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m19:20:57.590781 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m19:20:57.590941 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m19:20:57.591063 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:20:58.469168 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:20:58.471837 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m19:20:58.769405 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m19:20:58.775074 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m19:20:58.775426 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m19:20:58.775750 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:59.423064 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m19:20:59.426338 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m19:20:59.611948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m19:20:59.616329 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m19:20:59.616876 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m19:20:59.617712 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:00.344978 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m19:21:00.348512 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m19:21:00.520881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e9f68d0>]}
[0m19:21:00.522593 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:21:00.524505 [info ] [MainThread]: 
[0m19:21:00.532599 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m19:21:00.533025 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m19:21:00.533701 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m19:21:00.533963 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m19:21:00.539586 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 19:21:00.534207 => 19:21:00.539417
[0m19:21:00.539847 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m19:21:00.567747 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:00.568008 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m19:21:00.568195 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:21:01.169394 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m19:21:01.179471 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:01.180006 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:21:01.706183 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 1.0 seconds
[0m19:21:01.716079 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:01.716724 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:21:01.917711 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m19:21:01.930009 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:01.930300 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:21:03.493282 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m19:21:03.499365 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:03.500141 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m19:21:03.622842 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m19:21:03.628569 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:03.629303 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:21:03.746087 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m19:21:03.752567 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:03.753260 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m19:21:03.842483 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m19:21:03.849119 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:03.850036 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m19:21:04.015751 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m19:21:04.026057 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:04.026727 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m19:21:04.115921 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m19:21:04.125917 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m19:21:04.130236 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:04.131002 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m19:21:04.242501 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:21:04.243236 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:04.243760 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:21:05.063365 [debug] [Thread-1 (]: SQL status: SUCCESS 2 in 1.0 seconds
[0m19:21:05.063922 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m19:21:05.064156 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m19:21:05.586888 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:21:05.614536 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 19:21:00.540006 => 19:21:05.614235
[0m19:21:05.615249 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m19:21:05.843538 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff798e3a70>]}
[0m19:21:05.845819 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 2[0m in 5.31s]
[0m19:21:05.848369 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m19:21:05.849142 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m19:21:05.849984 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m19:21:05.851181 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m19:21:05.851631 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m19:21:05.857751 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 19:21:05.851915 => 19:21:05.857435
[0m19:21:05.858360 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m19:21:05.862961 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:05.863345 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m19:21:05.863781 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:21:06.637219 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m19:21:06.642156 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:06.642796 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:21:06.785101 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:21:06.792682 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:06.793401 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:21:06.887908 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:21:06.900323 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:06.901503 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m19:21:08.040048 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:21:08.045254 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:08.045862 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m19:21:08.207310 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m19:21:08.213343 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:08.214197 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:21:08.345549 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:21:08.350020 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:08.350564 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m19:21:08.471897 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m19:21:08.477903 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:08.478696 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m19:21:08.731545 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m19:21:08.740479 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:08.741289 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m19:21:08.869739 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m19:21:08.873901 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:08.877377 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:08.877904 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m19:21:09.028252 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:21:09.029409 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:09.029969 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:21:09.815865 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m19:21:09.816716 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m19:21:09.817443 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m19:21:10.304380 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m19:21:10.308472 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 19:21:05.858680 => 19:21:10.308194
[0m19:21:10.309044 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m19:21:10.497754 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b855f3de-07b4-4e17-86d8-44d6ced2ada0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff799e8b90>]}
[0m19:21:10.499326 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.65s]
[0m19:21:10.500914 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m19:21:10.503727 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:21:10.504190 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m19:21:10.504647 [info ] [MainThread]: 
[0m19:21:10.505306 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 12.92 seconds (12.92s).
[0m19:21:10.506115 [debug] [MainThread]: Command end result
[0m19:21:10.515307 [info ] [MainThread]: 
[0m19:21:10.515785 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:21:10.516002 [info ] [MainThread]: 
[0m19:21:10.516253 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m19:21:10.517536 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 13.386855, "process_user_time": 2.743805, "process_kernel_time": 0.187558, "process_mem_max_rss": "214208", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m19:21:10.518071 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:21:10.517928 after 13.39 seconds
[0m19:21:10.518522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f807f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f866120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2cd33b0>]}
[0m19:21:10.518809 [debug] [MainThread]: Flushing usage events
[0m02:03:43.841458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8963ac60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff899b30b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89638770>]}


============================== 02:03:43.844377 | b43c431e-e689-4244-a420-1f0d90881d06 ==============================
[0m02:03:43.844377 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:03:43.844898 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:03:44.206703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b43c431e-e689-4244-a420-1f0d90881d06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6845bb60>]}
[0m02:03:44.236209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b43c431e-e689-4244-a420-1f0d90881d06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8963d3a0>]}
[0m02:03:44.236514 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:03:44.240073 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:03:44.259081 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:03:44.260190 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:03:44.262300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b43c431e-e689-4244-a420-1f0d90881d06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68394aa0>]}
[0m02:03:44.267983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b43c431e-e689-4244-a420-1f0d90881d06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff681e7410>]}
[0m02:03:44.268191 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:03:44.268475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b43c431e-e689-4244-a420-1f0d90881d06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff682fc8c0>]}
[0m02:03:44.269190 [info ] [MainThread]: 
[0m02:03:44.269566 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:03:44.270077 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m02:03:44.275136 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m02:03:44.275292 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m02:03:44.275433 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:03:44.973033 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m02:03:44.975415 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m02:03:45.513970 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m02:03:45.524022 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:03:45.524464 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:03:45.524793 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:03:46.156954 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m02:03:46.159065 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:03:46.267951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m02:03:46.273223 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:03:46.273862 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:03:46.274223 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:03:46.690954 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:03:46.694211 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:03:46.839106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b43c431e-e689-4244-a420-1f0d90881d06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63f4d010>]}
[0m02:03:46.839935 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:03:46.840724 [info ] [MainThread]: 
[0m02:03:46.848917 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m02:03:46.849513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m02:03:46.849898 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m02:03:46.856217 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m02:03:46.858086 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 02:03:46.850140 => 02:03:46.857859
[0m02:03:46.858818 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m02:03:46.859148 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m02:03:46.860866 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m02:03:46.861101 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m02:03:46.863311 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m02:03:46.864383 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 02:03:46.861255 => 02:03:46.864234
[0m02:03:46.865055 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m02:03:46.865778 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m02:03:46.866070 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m02:03:46.866977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m02:03:46.867218 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m02:03:46.894286 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m02:03:46.895571 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 02:03:46.867407 => 02:03:46.895460
[0m02:03:46.895939 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m02:03:46.911323 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m02:03:46.918430 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m02:03:46.918820 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for “Bitcoin’s market behavior, volatility, and price trends”.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily BTC market data (trend inputs: price, market cap, volume)

SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily
WHERE coin_id = 'bitcoin'
),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily BTC candlestick data (volatility inputs)

SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc
WHERE coin_id = 'bitcoin'
), market_data AS (
    -- Staging: BTC daily trend inputs (may contain multiple rows per calendar date)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per date so we can take the LAST (latest timestamp) for that date
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: BTC candlestick inputs (may contain multiple rows per date)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per date so we can pick the first (open) and last (close)
    SELECT
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp ASC)  AS rn_open,
        ROW_NUMBER() OVER (PARTITION BY date ORDER BY timestamp DESC) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per date from OHLC:
    --   open  = earliest ts, close = latest ts, high=max, low=min
    SELECT
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on date → keep only dates present in BOTH (clean BI)
    SELECT
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON m.date = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW)  AS avg_price_7d,
        AVG(price) OVER (ORDER BY trading_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (ORDER BY trading_date) AS previous_price,
        CASE
            WHEN LAG(price) OVER (ORDER BY trading_date) IS NULL THEN NULL
            WHEN LAG(price) OVER (ORDER BY trading_date) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (ORDER BY trading_date))
                 /  LAG(price) OVER (ORDER BY trading_date)
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days
    SELECT
        trading_date, price, market_cap, volume,
        open_price, high_price, low_price, close_price,
        avg_price_7d, avg_price_30d, daily_return_pct,
        AVG(gain) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain_14,
        AVG(loss) OVER (ORDER BY trading_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7)  OVER (ORDER BY trading_date) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY date
        );
[0m02:03:46.919138 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:03:49.222308 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m02:03:49.246324 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 02:03:46.896103 => 02:03:49.246125
[0m02:03:49.246781 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m02:03:49.355802 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b43c431e-e689-4244-a420-1f0d90881d06', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63f4d910>]}
[0m02:03:49.357134 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.49s]
[0m02:03:49.358711 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m02:03:49.361346 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:03:49.362003 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m02:03:49.362538 [info ] [MainThread]: 
[0m02:03:49.363196 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.09 seconds (5.09s).
[0m02:03:49.364020 [debug] [MainThread]: Command end result
[0m02:03:49.378664 [info ] [MainThread]: 
[0m02:03:49.379459 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:03:49.379751 [info ] [MainThread]: 
[0m02:03:49.380133 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:03:49.381127 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.5609384, "process_user_time": 2.380409, "process_kernel_time": 0.263266, "process_mem_max_rss": "212928", "process_out_blocks": "1852", "process_in_blocks": "0"}
[0m02:03:49.381549 [debug] [MainThread]: Command `dbt run` succeeded at 02:03:49.381461 after 5.56 seconds
[0m02:03:49.381903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e60aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89754b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6860a4b0>]}
[0m02:03:49.382268 [debug] [MainThread]: Flushing usage events
[0m02:03:51.341193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8fe48cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9036b170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9033b770>]}


============================== 02:03:51.344490 | 5cceb60f-6551-4a99-ba0c-dc46a1a8d4c2 ==============================
[0m02:03:51.344490 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:03:51.345028 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:03:51.716940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5cceb60f-6551-4a99-ba0c-dc46a1a8d4c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ac024e0>]}
[0m02:03:51.748362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5cceb60f-6551-4a99-ba0c-dc46a1a8d4c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ad660f0>]}
[0m02:03:51.748731 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:03:51.752159 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:03:51.767316 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:03:51.767519 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:03:51.769821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5cceb60f-6551-4a99-ba0c-dc46a1a8d4c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ab6a060>]}
[0m02:03:51.775441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5cceb60f-6551-4a99-ba0c-dc46a1a8d4c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a9d7e00>]}
[0m02:03:51.775639 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:03:51.775949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5cceb60f-6551-4a99-ba0c-dc46a1a8d4c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6aea29c0>]}
[0m02:03:51.776715 [info ] [MainThread]: 
[0m02:03:51.777116 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:03:51.777910 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m02:03:51.783831 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:03:51.784075 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:03:51.784236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:03:52.161383 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:03:52.163417 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:03:52.268332 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m02:03:52.271027 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:03:52.271329 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:03:52.271606 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:03:52.841419 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m02:03:52.844265 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:03:53.425079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5cceb60f-6551-4a99-ba0c-dc46a1a8d4c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69fa09e0>]}
[0m02:03:53.426601 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:03:53.427889 [info ] [MainThread]: 
[0m02:03:53.439505 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:03:53.439980 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m02:03:53.440868 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m02:03:53.441335 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:03:53.453365 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:03:53.455325 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 02:03:53.441591 => 02:03:53.455189
[0m02:03:53.455598 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:03:53.466646 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:03:53.469662 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:03:53.469872 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m02:03:53.470064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:03:54.011498 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:03:54.015801 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 02:03:53.455768 => 02:03:54.015642
[0m02:03:54.016107 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m02:03:54.131115 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.69s]
[0m02:03:54.131883 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:03:54.132219 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:03:54.132547 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m02:03:54.133228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m02:03:54.133578 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:03:54.136821 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:03:54.137873 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 02:03:54.133780 => 02:03:54.137709
[0m02:03:54.138146 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:03:54.139834 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:03:54.140649 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m02:03:54.140895 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m02:03:54.141105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:03:54.729790 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:03:54.733997 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 02:03:54.138314 => 02:03:54.733642
[0m02:03:54.734784 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m02:03:54.857762 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.72s]
[0m02:03:54.859676 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m02:03:54.860378 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:03:54.861034 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m02:03:54.862318 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m02:03:54.862941 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:03:54.871866 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:03:54.873657 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 02:03:54.863326 => 02:03:54.873368
[0m02:03:54.874094 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:03:54.876782 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:03:54.878511 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m02:03:54.879123 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m02:03:54.879601 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:03:55.355145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:03:55.358311 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 02:03:54.874359 => 02:03:55.358000
[0m02:03:55.358849 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m02:03:55.467662 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.61s]
[0m02:03:55.470158 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m02:03:55.472615 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:03:55.473030 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m02:03:55.473349 [info ] [MainThread]: 
[0m02:03:55.474038 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.70 seconds (3.70s).
[0m02:03:55.474851 [debug] [MainThread]: Command end result
[0m02:03:55.487547 [info ] [MainThread]: 
[0m02:03:55.488348 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:03:55.488666 [info ] [MainThread]: 
[0m02:03:55.489070 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m02:03:55.489987 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.1722007, "process_user_time": 2.339108, "process_kernel_time": 0.116253, "process_mem_max_rss": "213200", "process_out_blocks": "1800", "process_in_blocks": "0"}
[0m02:03:55.490440 [debug] [MainThread]: Command `dbt test` succeeded at 02:03:55.490328 after 4.17 seconds
[0m02:03:55.490872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94e0aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff902fd1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ac96450>]}
[0m02:03:55.491286 [debug] [MainThread]: Flushing usage events
[0m02:03:57.327939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b0038f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b44b3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b0551f0>]}


============================== 02:03:57.330638 | 054aee0b-3ed9-499b-a2db-111e9f86876e ==============================
[0m02:03:57.330638 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:03:57.331094 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m02:03:57.656348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b683a40>]}
[0m02:03:57.685518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ae88ad0>]}
[0m02:03:57.685868 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:03:57.688882 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:03:57.702980 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:03:57.703126 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:03:57.705219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6013f170>]}
[0m02:03:57.710168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59bc8230>]}
[0m02:03:57.710378 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:03:57.710683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff59cae630>]}
[0m02:03:57.711420 [info ] [MainThread]: 
[0m02:03:57.711793 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:03:57.712299 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m02:03:57.717145 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m02:03:57.717300 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m02:03:57.717466 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:03:58.151253 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m02:03:58.152682 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m02:03:58.285061 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m02:03:58.295912 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:03:58.296367 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:03:58.296717 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:03:58.728433 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:03:58.729588 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:03:58.874987 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m02:03:58.877259 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:03:58.877906 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:03:58.878630 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:03:59.281422 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m02:03:59.282903 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:03:59.396485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff601482c0>]}
[0m02:03:59.397153 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:03:59.398000 [info ] [MainThread]: 
[0m02:03:59.403284 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m02:03:59.403668 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m02:03:59.404107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m02:03:59.404300 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m02:03:59.408507 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 02:03:59.404449 => 02:03:59.408394
[0m02:03:59.408702 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m02:03:59.431887 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:03:59.432198 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:03:59.432381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:04:01.117417 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 2.0 seconds
[0m02:04:01.130961 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:01.131970 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:04:01.250689 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:04:01.257400 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:01.257803 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:04:01.358960 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:04:01.381764 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:01.382152 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:04:03.047852 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m02:04:03.053507 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.054342 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:04:03.143883 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:04:03.148761 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.149212 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:04:03.226156 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:04:03.232000 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.232638 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:04:03.374017 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:04:03.380572 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.381290 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:04:03.469626 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:04:03.480570 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.481338 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:04:03.625126 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:04:03.635962 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.640464 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.640978 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m02:04:03.969626 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:04:03.973899 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:03.974879 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:04:05.031008 [debug] [Thread-1 (]: SQL status: SUCCESS 4 in 1.0 seconds
[0m02:04:05.032197 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:04:05.032774 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m02:04:05.456199 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:04:05.480835 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 02:03:59.408816 => 02:04:05.480606
[0m02:04:05.481312 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m02:04:05.607145 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff590e40b0>]}
[0m02:04:05.608491 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 4[0m in 6.20s]
[0m02:04:05.610217 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m02:04:05.610947 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m02:04:05.611630 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m02:04:05.612503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m02:04:05.612891 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m02:04:05.616484 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 02:04:05.613146 => 02:04:05.616291
[0m02:04:05.616806 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m02:04:05.620271 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:05.620587 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:04:05.620861 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:04:06.226801 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:04:06.231601 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:06.232341 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:04:06.346080 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:04:06.350528 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:06.350958 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:04:06.493747 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:04:06.505674 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:06.506520 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:04:07.758550 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:04:07.764634 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:07.765431 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:04:07.871805 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:04:07.878526 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:07.879195 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:04:07.972803 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:04:07.978757 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:07.979332 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:04:08.095820 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:04:08.102295 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:08.102993 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:04:08.191922 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:04:08.199985 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:08.200525 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:04:08.300041 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:04:08.304361 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:08.307310 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:08.307775 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m02:04:08.885219 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:04:08.886474 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:08.887066 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:04:09.566411 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:04:09.568622 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:04:09.569380 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m02:04:10.139595 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:04:10.145943 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 02:04:05.617089 => 02:04:10.145496
[0m02:04:10.147017 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m02:04:10.443307 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '054aee0b-3ed9-499b-a2db-111e9f86876e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5915d7f0>]}
[0m02:04:10.445260 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.83s]
[0m02:04:10.448208 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m02:04:10.452007 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:04:10.452560 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m02:04:10.453101 [info ] [MainThread]: 
[0m02:04:10.453863 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 12.74 seconds (12.74s).
[0m02:04:10.455087 [debug] [MainThread]: Command end result
[0m02:04:10.469173 [info ] [MainThread]: 
[0m02:04:10.470034 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:04:10.470319 [info ] [MainThread]: 
[0m02:04:10.470643 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m02:04:10.472842 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 13.165433, "process_user_time": 2.610451, "process_kernel_time": 0.111298, "process_mem_max_rss": "213976", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m02:04:10.473474 [debug] [MainThread]: Command `dbt snapshot` succeeded at 02:04:10.473369 after 13.17 seconds
[0m02:04:10.473894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff800c69c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b040260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c0fc5f0>]}
[0m02:04:10.474173 [debug] [MainThread]: Flushing usage events
[0m22:19:02.991416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082c2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097539d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109753c50>]}


============================== 22:19:02.993929 | cb0d605c-cd5f-4200-825a-258d2b20af21 ==============================
[0m22:19:02.993929 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:19:02.994178 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'printer_width': '80', 'partial_parse': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run --select stg_btc_market --vars coin_id: "bitcoin"', 'debug': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'log_format': 'default', 'profiles_dir': '/Users/snehasingh/.dbt', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'quiet': 'False', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'write_json': 'True', 'empty': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager'}
[0m22:19:03.711134 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:19:03.711366 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:19:03.711487 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:19:03.849554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb0d605c-cd5f-4200-825a-258d2b20af21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ad1f30>]}
[0m22:19:03.868334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb0d605c-cd5f-4200-825a-258d2b20af21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128d87f00>]}
[0m22:19:03.868797 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:19:03.913780 [debug] [MainThread]: checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, vars: {'coin_id': 'bitcoin'}, profile: , target: , version: 1.11.0b3
[0m22:19:03.967718 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:19:03.967949 [debug] [MainThread]: previous checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, current checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349
[0m22:19:03.968065 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m22:19:03.968186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'cb0d605c-cd5f-4200-825a-258d2b20af21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129484350>]}
[0m22:19:04.439982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb0d605c-cd5f-4200-825a-258d2b20af21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1293295e0>]}
[0m22:19:04.470596 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:19:04.471782 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:19:04.482515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb0d605c-cd5f-4200-825a-258d2b20af21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d4f3770>]}
[0m22:19:04.482727 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m22:19:04.482855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb0d605c-cd5f-4200-825a-258d2b20af21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1294a3ad0>]}
[0m22:19:04.483428 [info ] [MainThread]: 
[0m22:19:04.483555 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:19:04.483651 [info ] [MainThread]: 
[0m22:19:04.483823 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:19:04.485341 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m22:19:04.536644 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m22:19:04.536841 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m22:19:04.536948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:19:05.561552 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.024 seconds
[0m22:19:05.565043 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m22:19:05.569073 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m22:19:05.569543 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m22:19:05.763137 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.193 seconds
[0m22:19:05.767383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb0d605c-cd5f-4200-825a-258d2b20af21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d5d41d0>]}
[0m22:19:05.772425 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m22:19:05.773037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m22:19:05.773482 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m22:19:05.782344 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m22:19:05.783832 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m22:19:05.784969 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:19:05.785298 [debug] [MainThread]: Connection 'model.btc_elt.stg_btc_market' was left open.
[0m22:19:05.785554 [debug] [MainThread]: On model.btc_elt.stg_btc_market: Close
[0m22:19:06.075961 [info ] [MainThread]: 
[0m22:19:06.076213 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.59 seconds (1.59s).
[0m22:19:06.076449 [debug] [MainThread]: Command end result
[0m22:19:06.089739 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:19:06.092794 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:19:06.094752 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:19:06.100607 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.14105, "process_in_blocks": "0", "process_kernel_time": 0.722949, "process_mem_max_rss": "238370816", "process_out_blocks": "0", "process_user_time": 3.5618}
[0m22:19:06.100808 [debug] [MainThread]: Command `dbt run` succeeded at 22:19:06.100771 after 3.14 seconds
[0m22:19:06.100956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12eadf540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12edd4f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12edd5130>]}
[0m22:19:06.101093 [debug] [MainThread]: Flushing usage events
[0m22:19:06.527250 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:19:28.035767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109837c50>]}


============================== 22:19:28.038388 | 123dbef1-9dc5-4af0-8127-b034f86c47ce ==============================
[0m22:19:28.038388 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:19:28.038642 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'partial_parse': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'log_format': 'default', 'use_colors': 'True', 'static_parser': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'introspect': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'printer_width': '80', 'empty': 'False', 'write_json': 'True', 'quiet': 'False', 'target_path': 'None', 'warn_error': 'None', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt run --select stg_btc_market --vars coin_id: "ALL"', 'version_check': 'True'}
[0m22:19:28.599444 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:19:28.599727 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:19:28.599922 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:19:28.674740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '123dbef1-9dc5-4af0-8127-b034f86c47ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10806df30>]}
[0m22:19:28.694981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '123dbef1-9dc5-4af0-8127-b034f86c47ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f87ff00>]}
[0m22:19:28.695650 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:19:28.751714 [debug] [MainThread]: checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, vars: {'coin_id': 'ALL'}, profile: , target: , version: 1.11.0b3
[0m22:19:28.805463 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:19:28.805712 [debug] [MainThread]: previous checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, current checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3
[0m22:19:28.805849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '123dbef1-9dc5-4af0-8127-b034f86c47ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1580ac550>]}
[0m22:19:29.298507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '123dbef1-9dc5-4af0-8127-b034f86c47ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ffbd5e0>]}
[0m22:19:29.329927 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:19:29.331119 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:19:29.340340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '123dbef1-9dc5-4af0-8127-b034f86c47ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15874f770>]}
[0m22:19:29.340536 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m22:19:29.340664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '123dbef1-9dc5-4af0-8127-b034f86c47ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1580d7ad0>]}
[0m22:19:29.341239 [info ] [MainThread]: 
[0m22:19:29.341369 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:19:29.341471 [info ] [MainThread]: 
[0m22:19:29.341652 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:19:29.343150 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m22:19:29.368973 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m22:19:29.369175 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m22:19:29.369280 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:19:30.096452 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.727 seconds
[0m22:19:30.100090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m22:19:30.104147 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m22:19:30.104588 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m22:19:32.332280 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 2.227 seconds
[0m22:19:32.336670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '123dbef1-9dc5-4af0-8127-b034f86c47ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1587dc350>]}
[0m22:19:32.341945 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m22:19:32.342614 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m22:19:32.343006 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m22:19:32.351023 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m22:19:32.352345 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m22:19:32.353522 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:19:32.353885 [debug] [MainThread]: Connection 'model.btc_elt.stg_btc_market' was left open.
[0m22:19:32.354148 [debug] [MainThread]: On model.btc_elt.stg_btc_market: Close
[0m22:19:32.701718 [info ] [MainThread]: 
[0m22:19:32.702348 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 3.36 seconds (3.36s).
[0m22:19:32.702967 [debug] [MainThread]: Command end result
[0m22:19:32.726740 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:19:32.728434 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:19:32.730863 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:19:32.735879 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7355685, "process_in_blocks": "0", "process_kernel_time": 1.390825, "process_mem_max_rss": "230326272", "process_out_blocks": "0", "process_user_time": 2.748234}
[0m22:19:32.736216 [debug] [MainThread]: Command `dbt run` succeeded at 22:19:32.736148 after 4.74 seconds
[0m22:19:32.736503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15960a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x159685c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x159685f90>]}
[0m22:19:32.736752 [debug] [MainThread]: Flushing usage events
[0m22:19:33.162092 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:21:35.923385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f92900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110437c50>]}


============================== 22:21:35.925744 | a1942c20-203d-41c7-8cdb-31d5407a7c34 ==============================
[0m22:21:35.925744 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:21:35.926013 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'version_check': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run --select stg_btc_ohlc --vars coin_id: "bitcoin"', 'quiet': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'debug': 'False', 'partial_parse': 'True', 'introspect': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'no_print': 'None', 'target_path': 'None', 'log_cache_events': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:21:36.512144 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:21:36.512396 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:21:36.512523 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:21:36.636450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a1942c20-203d-41c7-8cdb-31d5407a7c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073bdf30>]}
[0m22:21:36.655814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a1942c20-203d-41c7-8cdb-31d5407a7c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154b7ff00>]}
[0m22:21:36.656281 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:21:36.701294 [debug] [MainThread]: checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, vars: {'coin_id': 'bitcoin'}, profile: , target: , version: 1.11.0b3
[0m22:21:36.752425 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:21:36.752633 [debug] [MainThread]: previous checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, current checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349
[0m22:21:36.752751 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m22:21:36.752873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a1942c20-203d-41c7-8cdb-31d5407a7c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155328350>]}
[0m22:21:37.228976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a1942c20-203d-41c7-8cdb-31d5407a7c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15520d5e0>]}
[0m22:21:37.258945 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:21:37.260800 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:21:37.270678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a1942c20-203d-41c7-8cdb-31d5407a7c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1569f3770>]}
[0m22:21:37.270846 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m22:21:37.270979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1942c20-203d-41c7-8cdb-31d5407a7c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155347ad0>]}
[0m22:21:37.271569 [info ] [MainThread]: 
[0m22:21:37.271692 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:21:37.271791 [info ] [MainThread]: 
[0m22:21:37.271964 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:21:37.273469 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m22:21:37.324857 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m22:21:37.325034 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m22:21:37.325134 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:21:38.671960 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.347 seconds
[0m22:21:38.674977 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m22:21:38.679050 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m22:21:38.679539 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m22:21:39.000029 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.320 seconds
[0m22:21:39.004592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1942c20-203d-41c7-8cdb-31d5407a7c34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156ae01d0>]}
[0m22:21:39.009003 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m22:21:39.009388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_ohlc)
[0m22:21:39.009659 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m22:21:39.015402 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m22:21:39.016561 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m22:21:39.017333 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:21:39.017533 [debug] [MainThread]: Connection 'model.btc_elt.stg_btc_ohlc' was left open.
[0m22:21:39.017713 [debug] [MainThread]: On model.btc_elt.stg_btc_ohlc: Close
[0m22:21:39.361916 [info ] [MainThread]: 
[0m22:21:39.362178 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 2.09 seconds (2.09s).
[0m22:21:39.362459 [debug] [MainThread]: Command end result
[0m22:21:39.384156 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:21:39.385776 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:21:39.389128 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:21:39.397482 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.499931, "process_in_blocks": "0", "process_kernel_time": 1.100881, "process_mem_max_rss": "235782144", "process_out_blocks": "0", "process_user_time": 3.030327}
[0m22:21:39.397819 [debug] [MainThread]: Command `dbt run` succeeded at 22:21:39.397765 after 3.50 seconds
[0m22:21:39.398029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c10a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c181a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c181c70>]}
[0m22:21:39.398336 [debug] [MainThread]: Flushing usage events
[0m22:21:39.812765 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:21:58.678832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b3b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b3bc50>]}


============================== 22:21:58.680977 | 53f45f3f-b998-4796-8342-741b4ca8fb87 ==============================
[0m22:21:58.680977 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:21:58.681213 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'printer_width': '80', 'version_check': 'True', 'use_colors': 'True', 'empty': 'False', 'write_json': 'True', 'partial_parse': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --select stg_btc_ohlc --vars coin_id: "ALL"', 'warn_error': 'None', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'log_cache_events': 'False', 'static_parser': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m22:21:59.169840 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:21:59.170078 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:21:59.170204 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:21:59.239726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53f45f3f-b998-4796-8342-741b4ca8fb87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ec1f30>]}
[0m22:21:59.258857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53f45f3f-b998-4796-8342-741b4ca8fb87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c47ff00>]}
[0m22:21:59.259370 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:21:59.304391 [debug] [MainThread]: checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, vars: {'coin_id': 'ALL'}, profile: , target: , version: 1.11.0b3
[0m22:21:59.356235 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:21:59.356437 [debug] [MainThread]: previous checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, current checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3
[0m22:21:59.356581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '53f45f3f-b998-4796-8342-741b4ca8fb87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ccac550>]}
[0m22:21:59.833967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53f45f3f-b998-4796-8342-741b4ca8fb87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cbcd5e0>]}
[0m22:21:59.865062 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:21:59.866058 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:21:59.874682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53f45f3f-b998-4796-8342-741b4ca8fb87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e0f3770>]}
[0m22:21:59.874865 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m22:21:59.874986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53f45f3f-b998-4796-8342-741b4ca8fb87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ccd7ad0>]}
[0m22:21:59.875563 [info ] [MainThread]: 
[0m22:21:59.875691 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:21:59.875789 [info ] [MainThread]: 
[0m22:21:59.875961 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:21:59.877400 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m22:21:59.904442 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m22:21:59.904625 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m22:21:59.904725 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:22:00.696051 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.791 seconds
[0m22:22:00.697216 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m22:22:00.698402 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m22:22:00.698543 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m22:22:00.855974 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.157 seconds
[0m22:22:00.860306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53f45f3f-b998-4796-8342-741b4ca8fb87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e1e01d0>]}
[0m22:22:00.864448 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m22:22:00.865075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_ohlc)
[0m22:22:00.865446 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m22:22:00.872942 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m22:22:00.873987 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m22:22:00.875129 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:22:00.875467 [debug] [MainThread]: Connection 'model.btc_elt.stg_btc_ohlc' was left open.
[0m22:22:00.875725 [debug] [MainThread]: On model.btc_elt.stg_btc_ohlc: Close
[0m22:22:01.071879 [info ] [MainThread]: 
[0m22:22:01.072581 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.20 seconds (1.20s).
[0m22:22:01.073223 [debug] [MainThread]: Command end result
[0m22:22:01.096291 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:22:01.097880 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:22:01.100174 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:22:01.104634 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4497175, "process_in_blocks": "0", "process_kernel_time": 1.116308, "process_mem_max_rss": "241041408", "process_out_blocks": "0", "process_user_time": 3.030068}
[0m22:22:01.104916 [debug] [MainThread]: Command `dbt run` succeeded at 22:22:01.104859 after 2.45 seconds
[0m22:22:01.105147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f30a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f385a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f385c70>]}
[0m22:22:01.105365 [debug] [MainThread]: Flushing usage events
[0m22:22:01.494767 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:23:39.519252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106abe900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e37c50>]}


============================== 22:23:39.521714 | 67bb321c-5d94-4863-853b-1bda39cf7871 ==============================
[0m22:23:39.521714 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:23:39.521971 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'use_colors': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None', 'partial_parse': 'True', 'printer_width': '80', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run --select fct_btc_indicators --vars coin_id: "ALL"', 'no_print': 'None', 'version_check': 'True', 'profiles_dir': '/Users/snehasingh/.dbt', 'log_cache_events': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'quiet': 'False'}
[0m22:23:40.070118 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:23:40.070340 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:23:40.070453 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:23:40.185611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ebdf30>]}
[0m22:23:40.204587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152d7ff00>]}
[0m22:23:40.205087 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:23:40.250488 [debug] [MainThread]: checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, vars: {'coin_id': 'ALL'}, profile: , target: , version: 1.11.0b3
[0m22:23:40.303006 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:23:40.303224 [debug] [MainThread]: previous checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, current checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349
[0m22:23:40.303346 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m22:23:40.303474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1535d0350>]}
[0m22:23:40.788875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1534f15e0>]}
[0m22:23:40.819489 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:23:40.820631 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:23:40.830323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155abb770>]}
[0m22:23:40.830502 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m22:23:40.830628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1535efad0>]}
[0m22:23:40.831187 [info ] [MainThread]: 
[0m22:23:40.831313 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:23:40.831409 [info ] [MainThread]: 
[0m22:23:40.831576 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:23:40.831888 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m22:23:40.880148 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m22:23:40.880333 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m22:23:40.880437 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:23:41.517416 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.637 seconds
[0m22:23:41.525578 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m22:23:41.539068 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m22:23:41.539359 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m22:23:41.753312 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.214 seconds
[0m22:23:41.756689 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m22:23:41.761140 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m22:23:41.761552 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m22:23:41.923616 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.162 seconds
[0m22:23:41.924666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155cd7710>]}
[0m22:23:41.926800 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m22:23:41.927017 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m22:23:41.927192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.fct_btc_indicators)
[0m22:23:41.927313 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m22:23:41.931536 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:23:41.932977 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:23:41.953593 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:23:41.954554 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m22:23:41.966153 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m22:23:41.968242 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m22:23:41.968495 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily candlestick data (volatility inputs)
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m22:23:42.073793 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c0d1bf-0307-2a53-000f-c0df00a9fe62
[0m22:23:42.074445 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 259 at position 143 unexpected ';'.
[0m22:23:42.080262 [debug] [Thread-1 (]: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 259 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m22:23:42.081991 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67bb321c-5d94-4863-853b-1bda39cf7871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156b0fee0>]}
[0m22:23:42.082645 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.fct_btc_indicators ............. [[31mERROR[0m in 0.15s]
[0m22:23:42.083143 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m22:23:42.083555 [debug] [Thread-4 (]: Marking all children of 'model.btc_elt.fct_btc_indicators' to be skipped because of status 'error'.  Reason: Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 259 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql.
[0m22:23:42.084958 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:23:42.085239 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m22:23:42.085477 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m22:23:42.225309 [info ] [MainThread]: 
[0m22:23:42.225853 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.39 seconds (1.39s).
[0m22:23:42.226493 [debug] [MainThread]: Command end result
[0m22:23:42.245476 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:23:42.246404 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:23:42.248914 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:23:42.249122 [info ] [MainThread]: 
[0m22:23:42.249330 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:23:42.249484 [info ] [MainThread]: 
[0m22:23:42.249677 [error] [MainThread]: [31mFailure in model fct_btc_indicators (models/output/fct_btc_indicators.sql)[0m
[0m22:23:42.249844 [error] [MainThread]:   Database Error in model fct_btc_indicators (models/output/fct_btc_indicators.sql)
  001003 (42000): SQL compilation error:
  syntax error line 259 at position 143 unexpected ';'.
  compiled code at target/run/btc_elt/models/output/fct_btc_indicators.sql
[0m22:23:42.249971 [info ] [MainThread]: 
[0m22:23:42.250119 [info ] [MainThread]:   compiled code at target/compiled/btc_elt/models/output/fct_btc_indicators.sql
[0m22:23:42.250243 [info ] [MainThread]: 
[0m22:23:42.250391 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m22:23:42.254040 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.765699, "process_in_blocks": "0", "process_kernel_time": 1.318166, "process_mem_max_rss": "238665728", "process_out_blocks": "0", "process_user_time": 2.914777}
[0m22:23:42.254278 [debug] [MainThread]: Command `dbt run` failed at 22:23:42.254228 after 2.77 seconds
[0m22:23:42.254507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156bf1bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156b88f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155c64050>]}
[0m22:23:42.254688 [debug] [MainThread]: Flushing usage events
[0m22:23:42.668858 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:24:37.017319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064be900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f37c50>]}


============================== 22:24:37.019698 | 1b943318-ae2e-466e-82f7-2193cab4aa77 ==============================
[0m22:24:37.019698 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:24:37.019934 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/Users/snehasingh/.dbt', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'debug': 'False', 'partial_parse': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'version_check': 'True', 'printer_width': '80', 'invocation_command': 'dbt run --select fct_btc_indicators --vars coin_id: "ALL"', 'use_colors': 'True', 'static_parser': 'True', 'log_format': 'default', 'no_print': 'None', 'warn_error': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:24:37.575789 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:24:37.576005 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:24:37.576116 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:24:37.691170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ebdf30>]}
[0m22:24:37.711139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14957ff00>]}
[0m22:24:37.711771 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:24:37.758236 [debug] [MainThread]: checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, vars: {'coin_id': 'ALL'}, profile: , target: , version: 1.11.0b3
[0m22:24:37.810226 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:24:37.810435 [debug] [MainThread]: previous checksum: 1197a7f1a9e1039d77bac203fabebe610f18018cdccba8710a97cecbca5f31c6, current checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349
[0m22:24:37.810572 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m22:24:37.810745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bb7c350>]}
[0m22:24:38.292869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ba9d5e0>]}
[0m22:24:38.323643 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:24:38.325530 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:24:38.335779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c877770>]}
[0m22:24:38.335986 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m22:24:38.336114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bb93ad0>]}
[0m22:24:38.336717 [info ] [MainThread]: 
[0m22:24:38.336844 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:24:38.336943 [info ] [MainThread]: 
[0m22:24:38.337121 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:24:38.337442 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m22:24:38.385769 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m22:24:38.385974 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m22:24:38.386085 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:24:38.944848 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.559 seconds
[0m22:24:38.951859 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m22:24:38.964560 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m22:24:38.964909 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m22:24:39.197678 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.232 seconds
[0m22:24:39.201195 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m22:24:39.204489 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m22:24:39.204882 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m22:24:39.321924 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.117 seconds
[0m22:24:39.325730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c8df4d0>]}
[0m22:24:39.329950 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m22:24:39.330538 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m22:24:39.331028 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.fct_btc_indicators)
[0m22:24:39.331403 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m22:24:39.342171 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:24:39.345439 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:24:39.376937 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:24:39.377597 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m22:24:39.390776 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m22:24:39.392996 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m22:24:39.393273 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily candlestick data (volatility inputs)
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m22:24:41.535519 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.142 seconds
[0m22:24:41.560765 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b943318-ae2e-466e-82f7-2193cab4aa77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15220f750>]}
[0m22:24:41.561494 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.23s]
[0m22:24:41.562079 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m22:24:41.563146 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:24:41.563366 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m22:24:41.563564 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m22:24:42.248864 [info ] [MainThread]: 
[0m22:24:42.249616 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.91 seconds (3.91s).
[0m22:24:42.250485 [debug] [MainThread]: Command end result
[0m22:24:42.278650 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:24:42.280450 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:24:42.284446 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:24:42.284655 [info ] [MainThread]: 
[0m22:24:42.284856 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:24:42.284965 [info ] [MainThread]: 
[0m22:24:42.285100 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:24:42.289123 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.298205, "process_in_blocks": "0", "process_kernel_time": 0.838087, "process_mem_max_rss": "239894528", "process_out_blocks": "0", "process_user_time": 3.381138}
[0m22:24:42.289408 [debug] [MainThread]: Command `dbt run` succeeded at 22:24:42.289351 after 5.30 seconds
[0m22:24:42.289620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152297bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15228a060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c864050>]}
[0m22:24:42.289811 [debug] [MainThread]: Flushing usage events
[0m22:24:42.681327 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:31:49.035743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c0a900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10709b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10709bc50>]}


============================== 22:31:49.038037 | e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd ==============================
[0m22:31:49.038037 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m22:31:49.038282 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'write_json': 'True', 'static_parser': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'debug': 'False', 'warn_error': 'None', 'quiet': 'False', 'target_path': 'None', 'partial_parse': 'True', 'introspect': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'cache_selected_only': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'invocation_command': 'dbt run --select fct_btc_indicators --vars coin_id: "bitcoin"'}
[0m22:31:49.576258 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m22:31:49.576475 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m22:31:49.576591 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m22:31:49.693285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106419f30>]}
[0m22:31:49.711847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131f7ff00>]}
[0m22:31:49.712337 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m22:31:49.760247 [debug] [MainThread]: checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, vars: {'coin_id': 'bitcoin'}, profile: , target: , version: 1.11.0b3
[0m22:31:49.812289 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m22:31:49.812495 [debug] [MainThread]: previous checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, current checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349
[0m22:31:49.812610 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m22:31:49.812730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1328b4350>]}
[0m22:31:50.293780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1327d15e0>]}
[0m22:31:50.324131 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:31:50.325369 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:31:50.335033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132df3770>]}
[0m22:31:50.335210 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m22:31:50.335337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1328cfad0>]}
[0m22:31:50.335946 [info ] [MainThread]: 
[0m22:31:50.336078 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:31:50.336175 [info ] [MainThread]: 
[0m22:31:50.336353 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:31:50.336674 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m22:31:50.388063 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m22:31:50.388243 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m22:31:50.388348 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:51.247288 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.859 seconds
[0m22:31:51.255263 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m22:31:51.269078 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m22:31:51.269480 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m22:31:51.442938 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.173 seconds
[0m22:31:51.446725 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m22:31:51.450364 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m22:31:51.450730 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m22:31:51.607089 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.156 seconds
[0m22:31:51.609770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132ee34d0>]}
[0m22:31:51.612305 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m22:31:51.612803 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m22:31:51.613167 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.fct_btc_indicators)
[0m22:31:51.613453 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m22:31:51.624424 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:31:51.627660 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:31:51.653562 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m22:31:51.654327 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m22:31:51.667176 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m22:31:51.669389 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m22:31:51.669706 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

WHERE coin_id = 'bitcoin'

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily candlestick data (volatility inputs)
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

WHERE coin_id = 'bitcoin'

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m22:31:53.821782 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.151 seconds
[0m22:31:53.842942 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0ae9a53-e1d2-453f-8ffb-d7a5eb102fcd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133e0f750>]}
[0m22:31:53.843513 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.23s]
[0m22:31:53.843891 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m22:31:53.844882 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:31:53.845092 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m22:31:53.845263 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m22:31:54.143724 [info ] [MainThread]: 
[0m22:31:54.144316 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.81 seconds (3.81s).
[0m22:31:54.145161 [debug] [MainThread]: Command end result
[0m22:31:54.176799 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m22:31:54.178034 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m22:31:54.181882 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m22:31:54.182116 [info ] [MainThread]: 
[0m22:31:54.182454 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:31:54.182614 [info ] [MainThread]: 
[0m22:31:54.182761 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m22:31:54.185733 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.176245, "process_in_blocks": "0", "process_kernel_time": 0.754341, "process_mem_max_rss": "239337472", "process_out_blocks": "0", "process_user_time": 3.527491}
[0m22:31:54.185972 [debug] [MainThread]: Command `dbt run` succeeded at 22:31:54.185930 after 5.18 seconds
[0m22:31:54.186146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133e977f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133e8a060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132e64050>]}
[0m22:31:54.186371 [debug] [MainThread]: Flushing usage events
[0m22:31:54.771943 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m06:55:38.835413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e32ae40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dab86e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dc73710>]}


============================== 06:55:38.839498 | 9b4b71b8-6309-44dd-8eca-51f73c1edde3 ==============================
[0m06:55:38.839498 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:55:38.839970 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:55:39.236132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c9cfb00>]}
[0m06:55:39.264603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5d206de0>]}
[0m06:55:39.264956 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:55:39.268929 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m06:55:39.274485 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m06:55:39.274785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c181010>]}
[0m06:55:39.792538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57b62c60>]}
[0m06:55:39.798328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57323ec0>]}
[0m06:55:39.798572 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m06:55:39.798903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57fa5df0>]}
[0m06:55:39.799667 [info ] [MainThread]: 
[0m06:55:39.800052 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:55:39.800574 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m06:55:39.805572 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m06:55:39.805755 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m06:55:39.805890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:55:40.223015 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:55:40.225053 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m06:55:40.373799 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m06:55:40.384853 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m06:55:40.385602 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m06:55:40.386623 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:55:40.906606 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m06:55:40.908901 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m06:55:41.048404 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m06:55:41.052081 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m06:55:41.052637 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m06:55:41.053543 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:55:42.224270 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m06:55:42.226055 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m06:55:42.937971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c593ec0>]}
[0m06:55:42.939772 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:55:42.941032 [info ] [MainThread]: 
[0m06:55:42.954119 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m06:55:42.955067 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m06:55:42.955583 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m06:55:42.963990 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m06:55:42.965890 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 06:55:42.955923 => 06:55:42.965709
[0m06:55:42.966808 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m06:55:42.967175 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m06:55:42.967754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m06:55:42.968032 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m06:55:42.970666 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m06:55:42.971433 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 06:55:42.968226 => 06:55:42.971312
[0m06:55:42.972027 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m06:55:42.972645 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m06:55:42.973001 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m06:55:42.973932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m06:55:42.974191 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m06:55:43.002483 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m06:55:43.003535 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 06:55:42.974341 => 06:55:43.003430
[0m06:55:43.003718 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m06:55:43.015018 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m06:55:43.017591 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m06:55:43.017882 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily candlestick data (volatility inputs)
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m06:55:43.018166 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:55:45.140024 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m06:55:45.166018 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 06:55:43.003840 => 06:55:45.165824
[0m06:55:45.166561 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m06:55:45.333185 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b4b71b8-6309-44dd-8eca-51f73c1edde3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57f52300>]}
[0m06:55:45.334776 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.36s]
[0m06:55:45.336676 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m06:55:45.339513 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:55:45.339988 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m06:55:45.340401 [info ] [MainThread]: 
[0m06:55:45.341099 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.54 seconds (5.54s).
[0m06:55:45.341884 [debug] [MainThread]: Command end result
[0m06:55:45.354855 [info ] [MainThread]: 
[0m06:55:45.355607 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:55:45.355868 [info ] [MainThread]: 
[0m06:55:45.356247 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m06:55:45.357536 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.567785, "process_user_time": 3.001303, "process_kernel_time": 0.235356, "process_mem_max_rss": "225520", "process_out_blocks": "2748", "process_in_blocks": "0"}
[0m06:55:45.357952 [debug] [MainThread]: Command `dbt run` succeeded at 06:55:45.357863 after 6.57 seconds
[0m06:55:45.358273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dab4ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57b62c60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5738b170>]}
[0m06:55:45.358575 [debug] [MainThread]: Flushing usage events
[0m06:55:47.670208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa886960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa50c6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa50f6e0>]}


============================== 06:55:47.673382 | cfaabbd9-6eb6-4fda-a578-40f614ee1bcf ==============================
[0m06:55:47.673382 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:55:47.673868 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:55:48.023482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cfaabbd9-6eb6-4fda-a578-40f614ee1bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f4721b0>]}
[0m06:55:48.053543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cfaabbd9-6eb6-4fda-a578-40f614ee1bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89287650>]}
[0m06:55:48.053839 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:55:48.056913 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m06:55:48.070468 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:55:48.070623 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:55:48.072785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cfaabbd9-6eb6-4fda-a578-40f614ee1bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8917b620>]}
[0m06:55:48.077416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cfaabbd9-6eb6-4fda-a578-40f614ee1bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff890a0920>]}
[0m06:55:48.077632 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m06:55:48.077909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfaabbd9-6eb6-4fda-a578-40f614ee1bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8adbacc0>]}
[0m06:55:48.078663 [info ] [MainThread]: 
[0m06:55:48.079027 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:55:48.079620 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m06:55:48.084997 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m06:55:48.085153 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m06:55:48.085274 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:55:48.538109 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m06:55:48.539969 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m06:55:48.690262 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m06:55:48.695217 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m06:55:48.695995 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m06:55:48.696640 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:55:49.122375 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:55:49.125184 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m06:55:49.278356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfaabbd9-6eb6-4fda-a578-40f614ee1bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff890a2e40>]}
[0m06:55:49.279971 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:55:49.281074 [info ] [MainThread]: 
[0m06:55:49.293899 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m06:55:49.294716 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m06:55:49.295944 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m06:55:49.296346 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m06:55:49.309546 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m06:55:49.311568 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 06:55:49.296629 => 06:55:49.311352
[0m06:55:49.311887 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m06:55:49.324362 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m06:55:49.325733 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m06:55:49.325950 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m06:55:49.326150 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:55:49.902333 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:55:49.906869 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 06:55:49.312152 => 06:55:49.906718
[0m06:55:49.907146 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m06:55:50.075333 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.78s]
[0m06:55:50.076800 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m06:55:50.077120 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m06:55:50.077430 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m06:55:50.077959 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m06:55:50.078145 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m06:55:50.082071 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m06:55:50.083283 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 06:55:50.078274 => 06:55:50.083123
[0m06:55:50.083576 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m06:55:50.085471 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m06:55:50.086832 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m06:55:50.087177 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m06:55:50.087480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:55:50.644078 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:55:50.645527 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 06:55:50.083803 => 06:55:50.645402
[0m06:55:50.645728 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m06:55:50.812903 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.73s]
[0m06:55:50.823006 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m06:55:50.825297 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m06:55:50.827586 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m06:55:50.832014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m06:55:50.835448 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m06:55:50.838948 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m06:55:50.839738 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 06:55:50.835686 => 06:55:50.839649
[0m06:55:50.839902 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m06:55:50.841005 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m06:55:50.841789 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m06:55:50.841981 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m06:55:50.842150 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:55:52.096813 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:55:52.099538 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 06:55:50.840014 => 06:55:52.099349
[0m06:55:52.099955 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m06:55:52.236617 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 1.40s]
[0m06:55:52.237409 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m06:55:52.239064 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:55:52.239331 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m06:55:52.239580 [info ] [MainThread]: 
[0m06:55:52.239922 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 4.16 seconds (4.16s).
[0m06:55:52.240582 [debug] [MainThread]: Command end result
[0m06:55:52.248070 [info ] [MainThread]: 
[0m06:55:52.248382 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:55:52.248568 [info ] [MainThread]: 
[0m06:55:52.249485 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m06:55:52.251433 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.60721, "process_user_time": 2.30601, "process_kernel_time": 0.13832, "process_mem_max_rss": "213112", "process_out_blocks": "1810", "process_in_blocks": "0"}
[0m06:55:52.251780 [debug] [MainThread]: Command `dbt test` succeeded at 06:55:52.251714 after 4.61 seconds
[0m06:55:52.252030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa50c560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8957aea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa71d3b30>]}
[0m06:55:52.252266 [debug] [MainThread]: Flushing usage events
[0m06:55:54.973696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84cd0950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84de51f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84cd07a0>]}


============================== 06:55:54.976591 | 1032be90-5410-4689-b93f-ea82b09de6f4 ==============================
[0m06:55:54.976591 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:55:54.977335 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m06:55:55.407872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a5496d0>]}
[0m06:55:55.439704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5fc71f40>]}
[0m06:55:55.440175 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:55:55.443580 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m06:55:55.461000 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:55:55.461226 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:55:55.463968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a5d81a0>]}
[0m06:55:55.469170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f8a38f0>]}
[0m06:55:55.469376 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m06:55:55.469724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ffc1760>]}
[0m06:55:55.470562 [info ] [MainThread]: 
[0m06:55:55.470958 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:55:55.471569 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m06:55:55.476553 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m06:55:55.476729 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m06:55:55.476886 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:55:55.878276 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:55:55.880190 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m06:55:56.072925 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m06:55:56.084647 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m06:55:56.085202 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m06:55:56.085600 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:55:56.598677 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m06:55:56.602281 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m06:55:56.727363 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m06:55:56.732265 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m06:55:56.732970 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m06:55:56.734126 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:55:57.095679 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:55:57.099131 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m06:55:57.269887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5fa2e540>]}
[0m06:55:57.271369 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:55:57.272534 [info ] [MainThread]: 
[0m06:55:57.283262 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m06:55:57.284055 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m06:55:57.285381 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m06:55:57.285864 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m06:55:57.293604 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 06:55:57.286164 => 06:55:57.293361
[0m06:55:57.293934 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m06:55:57.327869 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:57.328102 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m06:55:57.328289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:55:58.191508 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m06:55:58.202894 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:58.203883 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m06:55:58.295635 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m06:55:58.305010 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:58.305966 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m06:55:58.398520 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m06:55:58.430861 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:58.431586 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m06:55:59.549418 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:55:59.554962 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:59.555725 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m06:55:59.655694 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m06:55:59.661275 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:59.662245 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m06:55:59.742306 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m06:55:59.748724 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:59.749442 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m06:55:59.840235 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m06:55:59.844120 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:59.844499 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m06:55:59.969140 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m06:55:59.979864 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:55:59.980611 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m06:56:00.084320 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m06:56:00.095620 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m06:56:00.099161 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:56:00.099772 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m06:56:00.317311 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:56:00.318637 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:56:00.319284 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:56:01.468716 [debug] [Thread-1 (]: SQL status: SUCCESS 362 in 1.0 seconds
[0m06:56:01.469922 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m06:56:01.470592 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m06:56:01.880585 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:56:01.903289 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 06:55:57.294146 => 06:56:01.903112
[0m06:56:01.903686 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m06:56:02.056663 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ede5100>]}
[0m06:56:02.057327 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 362[0m in 4.77s]
[0m06:56:02.058209 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m06:56:02.058666 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m06:56:02.059310 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m06:56:02.059928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m06:56:02.060264 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m06:56:02.063582 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 06:56:02.060828 => 06:56:02.063405
[0m06:56:02.063954 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m06:56:02.066970 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:02.067319 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m06:56:02.067809 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:56:02.440107 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m06:56:02.446215 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:02.447259 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m06:56:02.553790 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:56:02.560162 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:02.560901 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m06:56:02.636537 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:56:02.645240 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:02.645978 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m06:56:03.937573 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:56:03.943398 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:03.944203 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m06:56:04.028068 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m06:56:04.033403 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:04.034249 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m06:56:04.219891 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:56:04.226228 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:04.227105 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m06:56:04.319968 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m06:56:04.322237 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:04.322470 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m06:56:04.402444 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m06:56:04.406114 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:04.406381 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m06:56:04.504920 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m06:56:04.507055 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:04.508575 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:04.508832 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m06:56:05.093478 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m06:56:05.094641 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:05.095310 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:56:06.097816 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m06:56:06.099349 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m06:56:06.100180 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m06:56:06.420585 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m06:56:06.426005 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 06:56:02.064164 => 06:56:06.425700
[0m06:56:06.426752 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m06:56:06.568799 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1032be90-5410-4689-b93f-ea82b09de6f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ed6f890>]}
[0m06:56:06.570671 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.51s]
[0m06:56:06.573973 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m06:56:06.577098 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:56:06.577643 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m06:56:06.578117 [info ] [MainThread]: 
[0m06:56:06.578936 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 11.11 seconds (11.11s).
[0m06:56:06.579941 [debug] [MainThread]: Command end result
[0m06:56:06.592580 [info ] [MainThread]: 
[0m06:56:06.593255 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:56:06.593602 [info ] [MainThread]: 
[0m06:56:06.594092 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m06:56:06.595154 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.64193, "process_user_time": 2.804218, "process_kernel_time": 0.166905, "process_mem_max_rss": "214456", "process_out_blocks": "1846", "process_in_blocks": "0"}
[0m06:56:06.595605 [debug] [MainThread]: Command `dbt snapshot` succeeded at 06:56:06.595510 after 11.64 seconds
[0m06:56:06.596008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89d16990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85692db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5fa590a0>]}
[0m06:56:06.596388 [debug] [MainThread]: Flushing usage events
[0m06:59:55.112740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae855730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae8b3530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0160da0>]}


============================== 06:59:55.115611 | 2781f1ef-0c8b-4764-a751-38511532762e ==============================
[0m06:59:55.115611 [info ] [MainThread]: Running with dbt=1.7.19
[0m06:59:55.116205 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:59:55.451874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2781f1ef-0c8b-4764-a751-38511532762e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d723ef0>]}
[0m06:59:55.481257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2781f1ef-0c8b-4764-a751-38511532762e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9340a360>]}
[0m06:59:55.481577 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m06:59:55.486014 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m06:59:55.500006 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:59:55.500190 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:59:55.502392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2781f1ef-0c8b-4764-a751-38511532762e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d25a330>]}
[0m06:59:55.508322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2781f1ef-0c8b-4764-a751-38511532762e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cfd4050>]}
[0m06:59:55.508506 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m06:59:55.508808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2781f1ef-0c8b-4764-a751-38511532762e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d597c80>]}
[0m06:59:55.509619 [info ] [MainThread]: 
[0m06:59:55.510042 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:59:55.510541 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m06:59:55.515742 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m06:59:55.515898 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m06:59:55.516012 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:59:55.993511 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:59:55.995356 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m06:59:56.125038 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m06:59:56.137009 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m06:59:56.137601 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m06:59:56.137944 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:59:56.592962 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m06:59:56.596616 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m06:59:56.736728 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m06:59:56.741143 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m06:59:56.741679 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m06:59:56.742569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:59:57.170491 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m06:59:57.173919 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m06:59:57.322779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2781f1ef-0c8b-4764-a751-38511532762e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d165130>]}
[0m06:59:57.324478 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m06:59:57.325111 [info ] [MainThread]: 
[0m06:59:57.339192 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m06:59:57.340062 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m06:59:57.340473 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m06:59:57.349385 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m06:59:57.352545 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 06:59:57.340794 => 06:59:57.352309
[0m06:59:57.354867 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m06:59:57.355203 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m06:59:57.355749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m06:59:57.356006 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m06:59:57.358759 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m06:59:57.359575 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 06:59:57.356168 => 06:59:57.359451
[0m06:59:57.360059 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m06:59:57.360680 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m06:59:57.360985 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m06:59:57.361753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m06:59:57.361963 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m06:59:57.389073 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m06:59:57.389986 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 06:59:57.362083 => 06:59:57.389863
[0m06:59:57.390195 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m06:59:57.402183 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m06:59:57.404749 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m06:59:57.405040 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Staging for daily candlestick data (volatility inputs)
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m06:59:57.405358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:59:59.450387 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m06:59:59.475166 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 06:59:57.390331 => 06:59:59.474978
[0m06:59:59.475608 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m06:59:59.639045 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2781f1ef-0c8b-4764-a751-38511532762e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c408aa0>]}
[0m06:59:59.640601 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.28s]
[0m06:59:59.642323 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m06:59:59.645143 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:59:59.645624 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m06:59:59.646055 [info ] [MainThread]: 
[0m06:59:59.646850 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.14 seconds (4.14s).
[0m06:59:59.647769 [debug] [MainThread]: Command end result
[0m06:59:59.664014 [info ] [MainThread]: 
[0m06:59:59.664723 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:59:59.665047 [info ] [MainThread]: 
[0m06:59:59.665517 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m06:59:59.666777 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.575704, "process_user_time": 2.483625, "process_kernel_time": 0.134087, "process_mem_max_rss": "213044", "process_out_blocks": "1875", "process_in_blocks": "0"}
[0m06:59:59.667230 [debug] [MainThread]: Command `dbt run` succeeded at 06:59:59.667124 after 4.58 seconds
[0m06:59:59.667572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae855730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae438a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d597c80>]}
[0m06:59:59.667861 [debug] [MainThread]: Flushing usage events
[0m07:00:01.918925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83c388f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83fac620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83c38770>]}


============================== 07:00:01.921743 | 8221295d-69ed-4117-9839-1b5e53b74ab8 ==============================
[0m07:00:01.921743 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:00:01.922134 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m07:00:02.302079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8221295d-69ed-4117-9839-1b5e53b74ab8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ee86510>]}
[0m07:00:02.331270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8221295d-69ed-4117-9839-1b5e53b74ab8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68c69f70>]}
[0m07:00:02.331570 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:00:02.334657 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:00:02.348385 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:00:02.348558 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:00:02.350692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8221295d-69ed-4117-9839-1b5e53b74ab8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e89a090>]}
[0m07:00:02.355764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8221295d-69ed-4117-9839-1b5e53b74ab8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e7b7da0>]}
[0m07:00:02.355949 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:00:02.356205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8221295d-69ed-4117-9839-1b5e53b74ab8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff70da8bf0>]}
[0m07:00:02.356952 [info ] [MainThread]: 
[0m07:00:02.357327 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:00:02.357911 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:00:02.363290 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:00:02.363448 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:00:02.363573 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:00:03.115270 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:00:03.118770 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:00:03.284877 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:00:03.290420 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:00:03.291057 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:00:03.291549 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:00:03.855754 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:00:03.859331 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:00:04.062352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8221295d-69ed-4117-9839-1b5e53b74ab8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e89ab40>]}
[0m07:00:04.064075 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:00:04.065739 [info ] [MainThread]: 
[0m07:00:04.078387 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:00:04.079048 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m07:00:04.080155 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:00:04.080617 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:00:04.093768 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:00:04.095643 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:00:04.080886 => 07:00:04.095490
[0m07:00:04.095892 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:00:04.107572 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:00:04.108818 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:00:04.109077 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m07:00:04.109275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:00:05.596074 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:00:05.606688 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:00:04.096063 => 07:00:05.606339
[0m07:00:05.607190 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m07:00:05.879279 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 1.80s]
[0m07:00:05.881714 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:00:05.882593 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:00:05.883278 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m07:00:05.884671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:00:05.885288 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:00:05.892826 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:00:05.894763 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:00:05.885812 => 07:00:05.894497
[0m07:00:05.895217 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:00:05.898064 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:00:05.899459 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:00:05.899806 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m07:00:05.900142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:00:07.029938 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:00:07.034330 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:00:05.895506 => 07:00:07.033972
[0m07:00:07.035089 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m07:00:08.259762 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 2.37s]
[0m07:00:08.262016 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:00:08.262745 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:00:08.263319 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m07:00:08.264828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:00:08.265455 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:00:08.275324 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:00:08.277251 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:00:08.265907 => 07:00:08.277005
[0m07:00:08.277697 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:00:08.280537 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:00:08.282061 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:00:08.282482 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m07:00:08.282841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:00:08.917380 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:00:08.919225 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:00:08.277990 => 07:00:08.919049
[0m07:00:08.919596 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m07:00:09.051479 [info ] [Thread-1 (]: 3 of 3 PASS unique_fct_btc_indicators_date ..................................... [[32mPASS[0m in 0.79s]
[0m07:00:09.052107 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:00:09.053364 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:00:09.053541 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:00:09.053767 [info ] [MainThread]: 
[0m07:00:09.054060 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 6.70 seconds (6.70s).
[0m07:00:09.054532 [debug] [MainThread]: Command end result
[0m07:00:09.060867 [info ] [MainThread]: 
[0m07:00:09.061181 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:00:09.061356 [info ] [MainThread]: 
[0m07:00:09.061631 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:00:09.062246 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 7.1636014, "process_user_time": 2.41617, "process_kernel_time": 0.111422, "process_mem_max_rss": "212892", "process_out_blocks": "1810", "process_in_blocks": "0"}
[0m07:00:09.062493 [debug] [MainThread]: Command `dbt test` succeeded at 07:00:09.062448 after 7.16 seconds
[0m07:00:09.062710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88c0aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5e90c650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ddb5610>]}
[0m07:00:09.062896 [debug] [MainThread]: Flushing usage events
[0m07:00:10.995694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ea04320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9efddac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ea047a0>]}


============================== 07:00:10.998318 | 10a001ee-5b0a-4b16-bb11-c27693c7ed5f ==============================
[0m07:00:10.998318 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:00:10.998739 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m07:00:11.321765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91babc50>]}
[0m07:00:11.351787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dcea6f0>]}
[0m07:00:11.352078 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:00:11.355155 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:00:11.368715 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:00:11.368867 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:00:11.370968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e49ade0>]}
[0m07:00:11.375460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d5cfa70>]}
[0m07:00:11.375665 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:00:11.375910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d6b2960>]}
[0m07:00:11.376605 [info ] [MainThread]: 
[0m07:00:11.376953 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:00:11.377454 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:00:11.382264 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:00:11.382415 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:00:11.382550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:00:12.134367 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:00:12.137358 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:00:13.019226 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m07:00:13.032026 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:00:13.032677 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:00:13.033135 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:00:13.593113 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:00:13.597201 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:00:13.834886 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:00:13.840234 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:00:13.840965 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:00:13.842098 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:00:14.385841 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:00:14.389132 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:00:14.866741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d75dd00>]}
[0m07:00:14.869518 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:00:14.872011 [info ] [MainThread]: 
[0m07:00:14.882806 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m07:00:14.883502 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m07:00:14.884748 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m07:00:14.885141 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m07:00:14.891953 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 07:00:14.885459 => 07:00:14.891780
[0m07:00:14.892277 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m07:00:14.923117 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:14.923386 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:00:14.923572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:00:16.145869 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:00:16.159163 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:16.160275 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:00:16.325873 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:00:16.336789 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:16.337443 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:00:16.436858 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:00:16.469924 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:16.470394 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:00:19.623592 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m07:00:19.630692 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:19.631418 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:00:19.770739 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:00:19.777515 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:19.778164 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:00:20.545576 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 1.0 seconds
[0m07:00:20.551277 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:20.551843 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:00:20.651376 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:00:20.657589 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:20.658357 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m07:00:20.743510 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m07:00:20.752547 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:20.752977 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m07:00:20.975681 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m07:00:20.980608 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m07:00:20.982363 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:20.982630 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m07:00:21.180884 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:00:21.182069 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:21.182803 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:00:22.679883 [debug] [Thread-1 (]: SQL status: SUCCESS 188 in 1.0 seconds
[0m07:00:22.681162 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m07:00:22.681785 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m07:00:23.229773 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:00:23.254914 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 07:00:14.892519 => 07:00:23.254666
[0m07:00:23.255372 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m07:00:23.436465 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cae79e0>]}
[0m07:00:23.438759 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 188[0m in 8.55s]
[0m07:00:23.441815 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m07:00:23.442788 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m07:00:23.444103 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m07:00:23.446275 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m07:00:23.446673 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m07:00:23.449870 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 07:00:23.446839 => 07:00:23.449616
[0m07:00:23.450260 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m07:00:23.454188 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:23.454514 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m07:00:23.454818 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:00:23.972471 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:00:23.978540 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:23.979631 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:00:24.070658 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:00:24.073044 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:24.073275 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:00:24.160766 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:00:24.165669 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:24.166042 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m07:00:25.330893 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:00:25.336819 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:25.337476 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:00:25.771372 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:00:25.778135 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:25.778829 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:00:25.863569 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:00:25.870193 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:25.871009 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:00:26.563167 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 1.0 seconds
[0m07:00:26.569454 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:26.570141 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m07:00:26.677425 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m07:00:26.687521 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:26.688239 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m07:00:26.903074 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m07:00:26.908062 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:26.911420 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:26.911936 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m07:00:27.025355 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:00:27.026584 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:27.027276 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m07:00:27.918013 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m07:00:27.919396 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m07:00:27.920030 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m07:00:28.839966 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:00:28.845849 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 07:00:23.450531 => 07:00:28.845577
[0m07:00:28.846515 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m07:00:29.067034 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '10a001ee-5b0a-4b16-bb11-c27693c7ed5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cbbbec0>]}
[0m07:00:29.068980 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 5.62s]
[0m07:00:29.071641 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m07:00:29.075486 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:00:29.076043 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m07:00:29.076526 [info ] [MainThread]: 
[0m07:00:29.077616 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 17.70 seconds (17.70s).
[0m07:00:29.079015 [debug] [MainThread]: Command end result
[0m07:00:29.095730 [info ] [MainThread]: 
[0m07:00:29.096592 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:00:29.096806 [info ] [MainThread]: 
[0m07:00:29.097341 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m07:00:29.098797 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 18.124289, "process_user_time": 2.750778, "process_kernel_time": 0.121402, "process_mem_max_rss": "213984", "process_out_blocks": "1846", "process_in_blocks": "0"}
[0m07:00:29.099273 [debug] [MainThread]: Command `dbt snapshot` succeeded at 07:00:29.099190 after 18.12 seconds
[0m07:00:29.099654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9eaa2ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ee9f050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dd4f140>]}
[0m07:00:29.099910 [debug] [MainThread]: Flushing usage events
[0m23:47:38.339510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038b2900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d239d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d23c50>]}


============================== 23:47:38.341923 | b2508a5a-6226-4b2e-a9e3-d8016375d8d7 ==============================
[0m23:47:38.341923 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:47:38.342164 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'static_parser': 'True', 'version_check': 'True', 'partial_parse': 'True', 'introspect': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'empty': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'fail_fast': 'False', 'invocation_command': 'dbt run --vars coin_id: "bitcoin"', 'indirect_selection': 'eager', 'no_print': 'None', 'write_json': 'True', 'printer_width': '80', 'target_path': 'None', 'warn_error': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs'}
[0m23:47:39.065404 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:47:39.065626 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:47:39.065740 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:47:39.180239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040a1f30>]}
[0m23:47:39.199581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124323f00>]}
[0m23:47:39.200061 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:47:39.249071 [debug] [MainThread]: checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, vars: {'coin_id': 'bitcoin'}, profile: , target: , version: 1.11.0b3
[0m23:47:39.301481 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m23:47:39.301708 [debug] [MainThread]: previous checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3, current checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349
[0m23:47:39.301824 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m23:47:39.301949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124a34350>]}
[0m23:47:39.800859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1249555e0>]}
[0m23:47:39.833978 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:47:39.835301 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:47:39.845196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124e77770>]}
[0m23:47:39.845385 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:47:39.845509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124a4bad0>]}
[0m23:47:39.846180 [info ] [MainThread]: 
[0m23:47:39.846303 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:47:39.846400 [info ] [MainThread]: 
[0m23:47:39.846588 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:47:39.846934 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:47:39.896018 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:47:39.896201 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:47:39.896302 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:40.899219 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.003 seconds
[0m23:47:40.911473 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:47:40.921464 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:47:40.921765 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:47:41.081981 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.159 seconds
[0m23:47:41.083708 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m23:47:41.088709 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:47:41.088952 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:47:41.247641 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.159 seconds
[0m23:47:41.249078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124f5f710>]}
[0m23:47:41.250989 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:47:41.251221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m23:47:41.251421 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:47:41.256878 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:47:41.257603 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:47:41.257761 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:47:41.257933 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:47:41.258064 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:47:41.259337 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:47:41.260021 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:47:41.261049 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:47:41.261730 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:47:41.261997 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:47:41.262163 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:47:41.304261 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:47:41.305074 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:47:41.321749 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:47:41.323954 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:47:41.324243 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

WHERE coin_id = 'bitcoin'

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

WHERE coin_id = 'bitcoin'

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:47:43.026479 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.702 seconds
[0m23:47:43.046697 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2508a5a-6226-4b2e-a9e3-d8016375d8d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125493800>]}
[0m23:47:43.047092 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.78s]
[0m23:47:43.047356 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:47:43.048052 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:47:43.048172 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:47:43.048271 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:47:43.315986 [info ] [MainThread]: 
[0m23:47:43.316571 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.47 seconds (3.47s).
[0m23:47:43.317405 [debug] [MainThread]: Command end result
[0m23:47:43.336856 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:47:43.337851 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:47:43.340217 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:47:43.340372 [info ] [MainThread]: 
[0m23:47:43.340541 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:47:43.340647 [info ] [MainThread]: 
[0m23:47:43.340778 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:47:43.343995 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.0338254, "process_in_blocks": "0", "process_kernel_time": 0.60811, "process_mem_max_rss": "232488960", "process_out_blocks": "0", "process_user_time": 3.574481}
[0m23:47:43.344233 [debug] [MainThread]: Command `dbt run` succeeded at 23:47:43.344190 after 5.03 seconds
[0m23:47:43.344415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12551aad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12550e060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124ee8050>]}
[0m23:47:43.344562 [debug] [MainThread]: Flushing usage events
[0m23:47:43.755261 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:48:08.178668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104632900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aa79d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aa7c50>]}


============================== 23:48:08.180832 | db764d42-2e77-4f97-a14b-7a09c85bd8a8 ==============================
[0m23:48:08.180832 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:48:08.181090 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'version_check': 'True', 'use_colors': 'True', 'printer_width': '80', 'static_parser': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'no_print': 'None', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'invocation_command': 'dbt run --vars coin_id: "ethereum"', 'warn_error': 'None', 'partial_parse': 'True', 'quiet': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'empty': 'False', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'write_json': 'True', 'fail_fast': 'False'}
[0m23:48:08.651214 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:48:08.651434 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:48:08.651540 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:48:08.721841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e25f30>]}
[0m23:48:08.740995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126e7ff00>]}
[0m23:48:08.741557 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:48:08.786870 [debug] [MainThread]: checksum: bab0911679b22d6fe75aa14f157c6ccf0f7a9d2841240ff7f648b5a0fe964047, vars: {'coin_id': 'ethereum'}, profile: , target: , version: 1.11.0b3
[0m23:48:08.839181 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m23:48:08.839374 [debug] [MainThread]: previous checksum: bab0911679b22d6fe75aa14f157c6ccf0f7a9d2841240ff7f648b5a0fe964047, current checksum: 3b841441c30a9cea9ac0032be6a63e0fa02037d590a52856b05289ae45771fd3
[0m23:48:08.839504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1278ac550>]}
[0m23:48:09.326888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1277d15e0>]}
[0m23:48:09.357269 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:48:09.358546 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:48:09.367488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127df3770>]}
[0m23:48:09.367670 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:48:09.367797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1278d7ad0>]}
[0m23:48:09.368507 [info ] [MainThread]: 
[0m23:48:09.368636 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:48:09.368737 [info ] [MainThread]: 
[0m23:48:09.368917 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:48:09.369228 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:48:09.399768 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:48:09.399941 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:48:09.400042 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:48:09.843060 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.443 seconds
[0m23:48:09.851288 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:48:09.861620 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:48:09.861929 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:48:10.000065 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.138 seconds
[0m23:48:10.003835 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m23:48:10.007754 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:48:10.008079 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:48:10.191955 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.183 seconds
[0m23:48:10.196125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127fe3710>]}
[0m23:48:10.200463 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m23:48:10.201021 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m23:48:10.201419 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m23:48:10.210511 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m23:48:10.211670 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m23:48:10.212054 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m23:48:10.212503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m23:48:10.212902 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m23:48:10.215596 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m23:48:10.216316 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m23:48:10.216903 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:48:10.217405 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:48:10.217834 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m23:48:10.218102 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:48:10.251461 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:48:10.251951 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:48:10.264893 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:48:10.267033 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:48:10.267310 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data
-- Supports single-coin (default) and multi-coin when coin_id = 'ALL'



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

WHERE coin_id = 'ethereum'

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

WHERE coin_id = 'ethereum'

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:48:11.153270 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.885 seconds
[0m23:48:11.179844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db764d42-2e77-4f97-a14b-7a09c85bd8a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13200f800>]}
[0m23:48:11.180479 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 0.96s]
[0m23:48:11.180907 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:48:11.182010 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:48:11.182296 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:48:11.182541 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:48:11.401417 [info ] [MainThread]: 
[0m23:48:11.401947 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.03 seconds (2.03s).
[0m23:48:11.402517 [debug] [MainThread]: Command end result
[0m23:48:11.420008 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:48:11.421050 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:48:11.424531 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:48:11.424733 [info ] [MainThread]: 
[0m23:48:11.424910 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:48:11.425021 [info ] [MainThread]: 
[0m23:48:11.425145 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:48:11.428419 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.275314, "process_in_blocks": "0", "process_kernel_time": 1.295003, "process_mem_max_rss": "242581504", "process_out_blocks": "0", "process_user_time": 2.936375}
[0m23:48:11.428622 [debug] [MainThread]: Command `dbt run` succeeded at 23:48:11.428580 after 3.28 seconds
[0m23:48:11.428796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132096ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13208a060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f64050>]}
[0m23:48:11.428962 [debug] [MainThread]: Flushing usage events
[0m23:48:11.815114 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m07:55:47.067997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff814f0b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81546000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8158dac0>]}


============================== 07:55:47.078615 | 5273eac2-7f14-4153-89ae-5694d7fa132c ==============================
[0m07:55:47.078615 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:55:47.079011 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:55:47.484461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61a709e0>]}
[0m07:55:47.517275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60469550>]}
[0m07:55:47.517773 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:55:47.522613 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:55:47.527996 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m07:55:47.528351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5be204d0>]}
[0m07:55:48.142909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b1a1640>]}
[0m07:55:48.150686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b5cb170>]}
[0m07:55:48.151030 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:55:48.151719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60f2fad0>]}
[0m07:55:48.152793 [info ] [MainThread]: 
[0m07:55:48.153488 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:55:48.154315 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m07:55:48.160328 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m07:55:48.160594 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m07:55:48.160770 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:55:48.712641 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:55:48.714792 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m07:55:48.853990 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m07:55:48.863015 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:55:48.863323 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:55:48.863535 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:55:49.679132 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m07:55:49.683134 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:55:49.834199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m07:55:49.842377 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:55:49.844107 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:55:49.844979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:55:50.262795 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m07:55:50.264700 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:55:50.431872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b935cd0>]}
[0m07:55:50.434610 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:55:50.438566 [info ] [MainThread]: 
[0m07:55:50.453403 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m07:55:50.454621 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m07:55:50.455046 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m07:55:50.466394 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m07:55:50.469534 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 07:55:50.455348 => 07:55:50.469185
[0m07:55:50.470728 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m07:55:50.471397 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m07:55:50.472366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m07:55:50.472856 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m07:55:50.475674 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m07:55:50.476854 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 07:55:50.473114 => 07:55:50.476717
[0m07:55:50.477405 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m07:55:50.478075 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m07:55:50.478418 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m07:55:50.479243 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m07:55:50.479471 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m07:55:50.505955 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m07:55:50.506963 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 07:55:50.479609 => 07:55:50.506850
[0m07:55:50.507168 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m07:55:50.519069 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m07:55:50.521846 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m07:55:50.522138 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m07:55:50.522451 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:55:52.091426 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:55:52.117806 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 07:55:50.507301 => 07:55:52.117613
[0m07:55:52.118350 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m07:55:52.278326 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5273eac2-7f14-4153-89ae-5694d7fa132c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5a966c90>]}
[0m07:55:52.280236 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.80s]
[0m07:55:52.284028 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m07:55:52.289903 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:55:52.290705 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m07:55:52.291469 [info ] [MainThread]: 
[0m07:55:52.293743 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.14 seconds (4.14s).
[0m07:55:52.297385 [debug] [MainThread]: Command end result
[0m07:55:52.318278 [info ] [MainThread]: 
[0m07:55:52.319207 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:55:52.319471 [info ] [MainThread]: 
[0m07:55:52.319933 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m07:55:52.321894 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.3194485, "process_user_time": 3.101899, "process_kernel_time": 0.189973, "process_mem_max_rss": "225168", "process_out_blocks": "2749", "process_in_blocks": "0"}
[0m07:55:52.325997 [debug] [MainThread]: Command `dbt run` succeeded at 07:55:52.325528 after 5.32 seconds
[0m07:55:52.326918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81546000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bf361b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b1d31a0>]}
[0m07:55:52.327235 [debug] [MainThread]: Flushing usage events
[0m07:55:55.074931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fcf0b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fd92db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fe04bf0>]}


============================== 07:55:55.077727 | fc5727a6-e2f3-4db2-9640-23bef577709d ==============================
[0m07:55:55.077727 [info ] [MainThread]: Running with dbt=1.7.19
[0m07:55:55.078433 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:55:55.473111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc5727a6-e2f3-4db2-9640-23bef577709d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7aa56600>]}
[0m07:55:55.507987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc5727a6-e2f3-4db2-9640-23bef577709d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a9cab40>]}
[0m07:55:55.508540 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m07:55:55.512129 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m07:55:55.526409 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:55:55.526584 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:55:55.528850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc5727a6-e2f3-4db2-9640-23bef577709d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cdb92e0>]}
[0m07:55:55.534304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc5727a6-e2f3-4db2-9640-23bef577709d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a79b9b0>]}
[0m07:55:55.534510 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:55:55.534813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc5727a6-e2f3-4db2-9640-23bef577709d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7aa54410>]}
[0m07:55:55.535655 [info ] [MainThread]: 
[0m07:55:55.536098 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:55:55.536750 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m07:55:55.542521 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m07:55:55.542693 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m07:55:55.542841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:55:56.043372 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m07:55:56.045340 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m07:55:56.159764 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m07:55:56.165111 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m07:55:56.165577 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m07:55:56.165885 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:55:56.587188 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m07:55:56.590225 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m07:55:56.751044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc5727a6-e2f3-4db2-9640-23bef577709d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a79a030>]}
[0m07:55:56.752201 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m07:55:56.753511 [info ] [MainThread]: 
[0m07:55:56.763064 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:55:56.763458 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m07:55:56.764140 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m07:55:56.764426 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:55:56.774890 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:55:56.776206 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 07:55:56.764668 => 07:55:56.776083
[0m07:55:56.776425 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:55:56.786175 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:55:56.787313 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m07:55:56.787640 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m07:55:56.787876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:55:57.221402 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:55:57.232004 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 07:55:56.776565 => 07:55:57.231671
[0m07:55:57.232749 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m07:55:57.385194 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.62s]
[0m07:55:57.386856 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m07:55:57.387539 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:55:57.388117 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m07:55:57.389353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m07:55:57.390100 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:55:57.396366 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:55:57.399055 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 07:55:57.390492 => 07:55:57.398780
[0m07:55:57.399838 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:55:57.403450 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:55:57.405315 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m07:55:57.405746 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m07:55:57.406103 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:55:57.870242 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m07:55:57.875842 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 07:55:57.400416 => 07:55:57.875428
[0m07:55:57.876577 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m07:55:58.022663 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.63s]
[0m07:55:58.025596 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m07:55:58.026622 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:55:58.027827 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m07:55:58.029573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m07:55:58.030076 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:55:58.039981 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:55:58.042096 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 07:55:58.030366 => 07:55:58.041866
[0m07:55:58.042513 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:55:58.045275 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:55:58.046716 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m07:55:58.047073 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m07:55:58.047464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:55:58.548505 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:55:58.552027 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 07:55:58.042773 => 07:55:58.551729
[0m07:55:58.552612 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m07:55:58.684653 [error] [Thread-1 (]: 3 of 3 FAIL 22 unique_fct_btc_indicators_date .................................. [[31mFAIL 22[0m in 0.66s]
[0m07:55:58.686796 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m07:55:58.690545 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:55:58.691239 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m07:55:58.691979 [info ] [MainThread]: 
[0m07:55:58.693138 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.16 seconds (3.16s).
[0m07:55:58.694472 [debug] [MainThread]: Command end result
[0m07:55:58.709388 [info ] [MainThread]: 
[0m07:55:58.710199 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:55:58.710562 [info ] [MainThread]: 
[0m07:55:58.710966 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_date (models/schema.yml)[0m
[0m07:55:58.711251 [error] [MainThread]:   Got 22 results, configured to fail if != 0
[0m07:55:58.711602 [info ] [MainThread]: 
[0m07:55:58.711833 [info ] [MainThread]:   compiled Code at target/compiled/btc_elt/models/schema.yml/unique_fct_btc_indicators_date.sql
[0m07:55:58.712198 [info ] [MainThread]: 
[0m07:55:58.712556 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m07:55:58.714084 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 3.6605146, "process_user_time": 2.496901, "process_kernel_time": 0.217034, "process_mem_max_rss": "212868", "process_out_blocks": "1811", "command_success": false, "process_in_blocks": "0"}
[0m07:55:58.714714 [debug] [MainThread]: Command `dbt test` failed at 07:55:58.714589 after 3.66 seconds
[0m07:55:58.715168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fcf0b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4b64a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84d39550>]}
[0m07:55:58.715629 [debug] [MainThread]: Flushing usage events
[0m23:57:00.723576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10489e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067379d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106737c50>]}


============================== 23:57:00.725854 | a914cfd7-9896-4754-9aeb-a71ea7373026 ==============================
[0m23:57:00.725854 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m23:57:00.726086 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'introspect': 'True', 'invocation_command': 'dbt run --select fct_btc_indicators', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'fail_fast': 'False', 'debug': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'quiet': 'False', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'write_json': 'True', 'empty': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'version_check': 'True', 'warn_error': 'None'}
[0m23:57:01.287149 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m23:57:01.287378 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m23:57:01.287496 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m23:57:01.403806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d7df30>]}
[0m23:57:01.423039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13777ff00>]}
[0m23:57:01.423531 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m23:57:01.472271 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m23:57:01.521483 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m23:57:01.521709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137837d50>]}
[0m23:57:02.009310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137f7d7c0>]}
[0m23:57:02.041736 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:57:02.042983 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:57:02.053071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cad6cf0>]}
[0m23:57:02.053267 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 data tests, 3 sources, 516 macros
[0m23:57:02.053403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e120d0>]}
[0m23:57:02.053983 [info ] [MainThread]: 
[0m23:57:02.054119 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:57:02.054216 [info ] [MainThread]: 
[0m23:57:02.054398 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:57:02.054712 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m23:57:02.102501 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m23:57:02.102684 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m23:57:02.102792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:57:02.584307 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.481 seconds
[0m23:57:02.587760 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m23:57:02.593688 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m23:57:02.593897 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m23:57:02.954145 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.360 seconds
[0m23:57:02.957428 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m23:57:02.961397 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m23:57:02.961823 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m23:57:03.080136 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.118 seconds
[0m23:57:03.083998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ccb3890>]}
[0m23:57:03.088421 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m23:57:03.089105 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m23:57:03.089647 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.fct_btc_indicators)
[0m23:57:03.090026 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m23:57:03.101660 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:57:03.105428 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:57:03.137031 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m23:57:03.137727 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m23:57:03.150753 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m23:57:03.152964 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m23:57:03.153246 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
    
    
    
    as (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */;
[0m23:57:04.446854 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.293 seconds
[0m23:57:04.467593 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a914cfd7-9896-4754-9aeb-a71ea7373026', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dad7800>]}
[0m23:57:04.467950 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.38s]
[0m23:57:04.468275 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m23:57:04.468852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:57:04.469017 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was left open.
[0m23:57:04.469269 [debug] [MainThread]: On model.btc_elt.fct_btc_indicators: Close
[0m23:57:04.771542 [info ] [MainThread]: 
[0m23:57:04.772099 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.72 seconds (2.72s).
[0m23:57:04.772905 [debug] [MainThread]: Command end result
[0m23:57:04.790990 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m23:57:04.791846 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m23:57:04.794469 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m23:57:04.794601 [info ] [MainThread]: 
[0m23:57:04.794752 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:57:04.794859 [info ] [MainThread]: 
[0m23:57:04.794975 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:57:04.797612 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1012907, "process_in_blocks": "0", "process_kernel_time": 1.087759, "process_mem_max_rss": "237076480", "process_out_blocks": "0", "process_user_time": 3.147849}
[0m23:57:04.797756 [debug] [MainThread]: Command `dbt run` succeeded at 23:57:04.797724 after 4.10 seconds
[0m23:57:04.797880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db72850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db460f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc534d0>]}
[0m23:57:04.797999 [debug] [MainThread]: Flushing usage events
[0m23:57:05.181705 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:12:40.803590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c8c260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c8f920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c8c2f0>]}


============================== 08:12:40.806484 | 9701cecd-2e56-4325-ab2e-4695bbe3fdb7 ==============================
[0m08:12:40.806484 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:12:40.807131 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:12:41.170191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8296e660>]}
[0m08:12:41.201527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ac36ab0>]}
[0m08:12:41.201848 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:12:41.206228 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:12:41.214666 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m08:12:41.214966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64660680>]}
[0m08:12:41.739676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6412a600>]}
[0m08:12:41.745672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ff88860>]}
[0m08:12:41.745876 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:12:41.746230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ac36ab0>]}
[0m08:12:41.747004 [info ] [MainThread]: 
[0m08:12:41.747403 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:12:41.747960 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:12:41.753301 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:12:41.753452 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:12:41.753632 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:12:42.285584 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:12:42.288791 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:12:42.463731 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:12:42.476286 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:12:42.476922 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:12:42.477364 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:12:42.988868 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m08:12:42.992377 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:12:43.126877 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:12:43.131742 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:12:43.132444 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:12:43.133740 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:12:43.625225 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:12:43.628982 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:12:43.751641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6406e2a0>]}
[0m08:12:43.752139 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:12:43.752651 [info ] [MainThread]: 
[0m08:12:43.757417 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:12:43.757811 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:12:43.757996 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:12:43.762023 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:12:43.763588 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:12:43.758122 => 08:12:43.763493
[0m08:12:43.764078 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:12:43.764278 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:12:43.764592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:12:43.764762 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:12:43.767016 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:12:43.767870 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:12:43.764898 => 08:12:43.767675
[0m08:12:43.768440 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:12:43.768885 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:12:43.769089 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:12:43.769589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:12:43.769781 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:12:43.791077 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:12:43.792010 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:12:43.769887 => 08:12:43.791932
[0m08:12:43.792173 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:12:43.802533 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:12:43.805090 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:12:43.805343 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m08:12:43.805662 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:12:45.885288 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:12:45.911092 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:12:43.792332 => 08:12:45.910867
[0m08:12:45.911597 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:12:46.139268 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9701cecd-2e56-4325-ab2e-4695bbe3fdb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff641f7620>]}
[0m08:12:46.140814 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.37s]
[0m08:12:46.142646 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:12:46.145845 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:12:46.146394 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:12:46.146878 [info ] [MainThread]: 
[0m08:12:46.147650 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.40 seconds (4.40s).
[0m08:12:46.148571 [debug] [MainThread]: Command end result
[0m08:12:46.163150 [info ] [MainThread]: 
[0m08:12:46.164074 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:12:46.164397 [info ] [MainThread]: 
[0m08:12:46.164883 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:12:46.165920 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.3829327, "process_user_time": 2.942302, "process_kernel_time": 0.161332, "process_mem_max_rss": "221708", "process_out_blocks": "2749", "process_in_blocks": "0"}
[0m08:12:46.166374 [debug] [MainThread]: Command `dbt run` succeeded at 08:12:46.166278 after 5.38 seconds
[0m08:12:46.166703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c8c260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64804e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64088260>]}
[0m08:12:46.167003 [debug] [MainThread]: Flushing usage events
[0m08:12:48.354636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dc6e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d611310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d612480>]}


============================== 08:12:48.357312 | 4f2aea95-607b-4623-96bf-0a11694597ac ==============================
[0m08:12:48.357312 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:12:48.357728 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:12:48.707103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f2aea95-607b-4623-96bf-0a11694597ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c33f860>]}
[0m08:12:48.737060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f2aea95-607b-4623-96bf-0a11694597ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c4f1a60>]}
[0m08:12:48.737360 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:12:48.740532 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:12:48.754026 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:12:48.754178 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:12:48.756303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f2aea95-607b-4623-96bf-0a11694597ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c2cd0a0>]}
[0m08:12:48.761696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f2aea95-607b-4623-96bf-0a11694597ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c15cb30>]}
[0m08:12:48.761876 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:12:48.762120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f2aea95-607b-4623-96bf-0a11694597ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c1fa060>]}
[0m08:12:48.762859 [info ] [MainThread]: 
[0m08:12:48.763224 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:12:48.763767 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m08:12:48.769262 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:12:48.769420 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:12:48.769567 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:12:49.267129 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:12:49.270712 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:12:49.393148 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:12:49.398514 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:12:49.399190 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:12:49.399667 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:12:49.822104 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:12:49.823878 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:12:49.984945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f2aea95-607b-4623-96bf-0a11694597ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c1f85c0>]}
[0m08:12:49.986691 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:12:49.988723 [info ] [MainThread]: 
[0m08:12:50.000917 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:12:50.001434 [info ] [Thread-1 (]: 1 of 3 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:12:50.002411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:12:50.002829 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:12:50.016655 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:12:50.018199 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:12:50.003090 => 08:12:50.018027
[0m08:12:50.018463 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:12:50.030183 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:12:50.031294 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:12:50.031567 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:12:50.031790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:12:50.696214 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:12:50.707605 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:12:50.018656 => 08:12:50.707213
[0m08:12:50.708365 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:12:50.859596 [info ] [Thread-1 (]: 1 of 3 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.86s]
[0m08:12:50.861336 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:12:50.862035 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:12:50.862680 [info ] [Thread-1 (]: 2 of 3 START test not_null_fct_btc_indicators_price ............................ [RUN]
[0m08:12:50.863928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe)
[0m08:12:50.864511 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:12:50.870475 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:12:50.872844 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (compile): 08:12:50.864932 => 08:12:50.872643
[0m08:12:50.873209 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:12:50.875412 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:12:50.876667 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"
[0m08:12:50.877055 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where price is null



      
    ) dbt_internal_test
[0m08:12:50.877461 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:12:51.517328 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:12:51.521775 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe (execute): 08:12:50.873450 => 08:12:51.521367
[0m08:12:51.522593 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe: Close
[0m08:12:51.653534 [info ] [Thread-1 (]: 2 of 3 PASS not_null_fct_btc_indicators_price .................................. [[32mPASS[0m in 0.79s]
[0m08:12:51.655482 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe
[0m08:12:51.656356 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:12:51.656981 [info ] [Thread-1 (]: 3 of 3 START test unique_fct_btc_indicators_date ............................... [RUN]
[0m08:12:51.658300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_price.a1c2923efe, now test.btc_elt.unique_fct_btc_indicators_date.60334dbab4)
[0m08:12:51.658983 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:12:51.668504 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:12:51.670503 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (compile): 08:12:51.659395 => 08:12:51.670307
[0m08:12:51.670882 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:12:51.673376 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:12:51.674717 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"
[0m08:12:51.675118 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_fct_btc_indicators_date.60334dbab4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    date as unique_field,
    count(*) as n_records

from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is not null
group by date
having count(*) > 1



      
    ) dbt_internal_test
[0m08:12:51.675512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:12:52.368518 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:12:52.374657 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_fct_btc_indicators_date.60334dbab4 (execute): 08:12:51.671116 => 08:12:52.374051
[0m08:12:52.375716 [debug] [Thread-1 (]: On test.btc_elt.unique_fct_btc_indicators_date.60334dbab4: Close
[0m08:12:52.529143 [error] [Thread-1 (]: 3 of 3 FAIL 22 unique_fct_btc_indicators_date .................................. [[31mFAIL 22[0m in 0.87s]
[0m08:12:52.530459 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_date.60334dbab4
[0m08:12:52.533703 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:12:52.534374 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_date.60334dbab4' was properly closed.
[0m08:12:52.535032 [info ] [MainThread]: 
[0m08:12:52.536122 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 3.77 seconds (3.77s).
[0m08:12:52.537698 [debug] [MainThread]: Command end result
[0m08:12:52.549262 [info ] [MainThread]: 
[0m08:12:52.549803 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m08:12:52.550029 [info ] [MainThread]: 
[0m08:12:52.550388 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_date (models/schema.yml)[0m
[0m08:12:52.550640 [error] [MainThread]:   Got 22 results, configured to fail if != 0
[0m08:12:52.550904 [info ] [MainThread]: 
[0m08:12:52.551098 [info ] [MainThread]:   compiled Code at target/compiled/btc_elt/models/schema.yml/unique_fct_btc_indicators_date.sql
[0m08:12:52.551351 [info ] [MainThread]: 
[0m08:12:52.551583 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m08:12:52.552397 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 4.218342, "process_user_time": 2.412476, "process_kernel_time": 0.118397, "process_mem_max_rss": "209172", "process_out_blocks": "1811", "command_success": false, "process_in_blocks": "0"}
[0m08:12:52.552763 [debug] [MainThread]: Command `dbt test` failed at 08:12:52.552689 after 4.22 seconds
[0m08:12:52.553057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dc6e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff67563ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72713860>]}
[0m08:12:52.553316 [debug] [MainThread]: Flushing usage events
[0m00:16:42.924279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080de900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099339d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109933c50>]}


============================== 00:16:42.926906 | b8be65c5-5793-4c8c-a80b-add1348786da ==============================
[0m00:16:42.926906 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:16:42.927179 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'cache_selected_only': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'target_path': 'None', 'version_check': 'True', 'warn_error': 'None', 'introspect': 'True', 'invocation_command': 'dbt test', 'fail_fast': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'quiet': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'no_print': 'None'}
[0m00:16:43.560048 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:16:43.560270 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:16:43.560383 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:16:43.681912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8be65c5-5793-4c8c-a80b-add1348786da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088edf30>]}
[0m00:16:43.701932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8be65c5-5793-4c8c-a80b-add1348786da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b07f00>]}
[0m00:16:43.702468 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:16:43.761655 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:16:43.827370 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m00:16:43.828344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b8be65c5-5793-4c8c-a80b-add1348786da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143688250>]}
[0m00:16:44.331882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8be65c5-5793-4c8c-a80b-add1348786da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14361d400>]}
[0m00:16:44.359598 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:16:44.361082 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:16:44.376941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8be65c5-5793-4c8c-a80b-add1348786da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143c84bb0>]}
[0m00:16:44.377206 [info ] [MainThread]: Found 3 models, 2 snapshots, 3 sources, 516 macros
[0m00:16:44.377340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8be65c5-5793-4c8c-a80b-add1348786da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143bab520>]}
[0m00:16:44.378011 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m00:16:44.378219 [debug] [MainThread]: Command end result
[0m00:16:44.385984 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:16:44.387110 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:16:44.388539 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:16:44.391148 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 1.4957786, "process_in_blocks": "0", "process_kernel_time": 1.382275, "process_mem_max_rss": "212762624", "process_out_blocks": "0", "process_user_time": 2.522105}
[0m00:16:44.391309 [debug] [MainThread]: Command `dbt test` succeeded at 00:16:44.391276 after 1.50 seconds
[0m00:16:44.391442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098f0a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143bfd9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143bfd7b0>]}
[0m00:16:44.391565 [debug] [MainThread]: Flushing usage events
[0m00:16:44.794927 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:17:48.011875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058aa900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d1b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d1bc50>]}


============================== 00:17:48.014123 | 0b69ddc4-9e79-4e51-b66f-04c9089b9a65 ==============================
[0m00:17:48.014123 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:17:48.014354 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'printer_width': '80', 'partial_parse': 'True', 'empty': 'None', 'profiles_dir': '/Users/snehasingh/.dbt', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'version_check': 'True', 'quiet': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'static_parser': 'True', 'target_path': 'None', 'no_print': 'None', 'log_format': 'default', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'invocation_command': 'dbt test', 'write_json': 'True'}
[0m00:17:48.547676 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:17:48.547893 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:17:48.548000 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:17:48.661912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10609df30>]}
[0m00:17:48.681156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130f7ff00>]}
[0m00:17:48.681638 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:17:48.729010 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:17:48.780775 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m00:17:48.781010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13209c350>]}
[0m00:17:49.196002 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `unique` defined on 'fct_btc_indicators' in
package 'btc_elt' (models/schema.yml). Arguments to generic tests should be
nested under the `arguments` property.
[0m00:17:49.196242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1316ae300>]}
[0m00:17:49.265312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13249fa10>]}
[0m00:17:49.297773 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:17:49.298928 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:17:49.313936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1327194a0>]}
[0m00:17:49.314169 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 data tests, 3 sources, 516 macros
[0m00:17:49.314307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1325adb50>]}
[0m00:17:49.315082 [info ] [MainThread]: 
[0m00:17:49.315227 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:17:49.315326 [info ] [MainThread]: 
[0m00:17:49.315510 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:17:49.317225 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m00:17:49.370704 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:17:49.370886 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:17:49.370992 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:17:49.967845 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.597 seconds
[0m00:17:49.971328 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m00:17:49.975664 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:17:49.976091 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:17:50.143444 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.167 seconds
[0m00:17:50.148496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b69ddc4-9e79-4e51-b66f-04c9089b9a65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1337c9390>]}
[0m00:17:50.152671 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:17:50.153216 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m00:17:50.153629 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:17:50.153917 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:17:50.166481 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:17:50.167477 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:17:50.179247 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:17:50.179969 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:17:50.180173 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m00:17:50.326740 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.146 seconds
[0m00:17:50.337919 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.18s]
[0m00:17:50.338711 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:17:50.339179 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_coin_id__date.37cfbb7e07
[0m00:17:50.339636 [info ] [Thread-1 (]: 2 of 2 START test unique_fct_btc_indicators_coin_id__date ...................... [RUN]
[0m00:17:50.340057 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_fct_btc_indicators_coin_id__date.37cfbb7e07)
[0m00:17:50.340355 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_coin_id__date.37cfbb7e07
[0m00:17:50.349025 [debug] [Thread-1 (]: Compilation Error in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)
  macro 'dbt_macro__test_unique' takes no keyword argument 'column_names'
[0m00:17:50.349630 [error] [Thread-1 (]: 2 of 2 ERROR unique_fct_btc_indicators_coin_id__date ........................... [[31mERROR[0m in 0.01s]
[0m00:17:50.350186 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_coin_id__date.37cfbb7e07
[0m00:17:50.350611 [debug] [Thread-4 (]: Marking all children of 'test.btc_elt.unique_fct_btc_indicators_coin_id__date.37cfbb7e07' to be skipped because of status 'error'.  Reason: Compilation Error in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)
  macro 'dbt_macro__test_unique' takes no keyword argument 'column_names'.
[0m00:17:50.352109 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:17:50.352322 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_coin_id__date.37cfbb7e07' was left open.
[0m00:17:50.352469 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_coin_id__date.37cfbb7e07: Close
[0m00:17:50.536363 [info ] [MainThread]: 
[0m00:17:50.537135 [info ] [MainThread]: Finished running 2 data tests in 0 hours 0 minutes and 1.22 seconds (1.22s).
[0m00:17:50.538123 [debug] [MainThread]: Command end result
[0m00:17:50.556202 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:17:50.557250 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:17:50.561011 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:17:50.561150 [info ] [MainThread]: 
[0m00:17:50.561291 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:17:50.561396 [info ] [MainThread]: 
[0m00:17:50.561564 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)[0m
[0m00:17:50.561786 [error] [MainThread]:   Compilation Error in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)
  macro 'dbt_macro__test_unique' takes no keyword argument 'column_names'
[0m00:17:50.561969 [info ] [MainThread]: 
[0m00:17:50.562165 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:17:50.562495 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m00:17:50.565680 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 2.5808375, "process_in_blocks": "0", "process_kernel_time": 1.162931, "process_mem_max_rss": "242827264", "process_out_blocks": "0", "process_user_time": 3.035592}
[0m00:17:50.565840 [debug] [MainThread]: Command `dbt test` failed at 00:17:50.565807 after 2.58 seconds
[0m00:17:50.566032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13321e030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1337f3020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1321aead0>]}
[0m00:17:50.566235 [debug] [MainThread]: Flushing usage events
[0m00:17:50.985106 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:20:03.172476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10597e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106de79d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106de7c50>]}


============================== 00:20:03.174746 | 0f62362b-f833-4d1c-9894-0d3a920f8d1a ==============================
[0m00:20:03.174746 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:20:03.174989 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'empty': 'None', 'target_path': 'None', 'introspect': 'True', 'version_check': 'True', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'no_print': 'None', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'partial_parse': 'True', 'invocation_command': 'dbt test', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_format': 'default', 'printer_width': '80', 'log_cache_events': 'False'}
[0m00:20:03.800655 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:20:03.800872 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:20:03.800982 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:20:03.948905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106171f30>]}
[0m00:20:03.968406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14197ff00>]}
[0m00:20:03.968902 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:20:04.015362 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:20:04.068270 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m00:20:04.068494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14289c350>]}
[0m00:20:04.503114 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `unique` defined on 'fct_btc_indicators' in
package 'btc_elt' (models/schema.yml). Arguments to generic tests should be
nested under the `arguments` property.
[0m00:20:04.503374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141fa2300>]}
[0m00:20:04.579737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1441a3bd0>]}
[0m00:20:04.611919 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:20:04.613041 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:20:04.628950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1443194a0>]}
[0m00:20:04.629164 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 data tests, 3 sources, 516 macros
[0m00:20:04.629286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1442b5b50>]}
[0m00:20:04.630107 [info ] [MainThread]: 
[0m00:20:04.630655 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:20:04.630842 [info ] [MainThread]: 
[0m00:20:04.631088 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:20:04.633057 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m00:20:04.689526 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:20:04.689745 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:20:04.689863 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:05.491409 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.801 seconds
[0m00:20:05.494724 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m00:20:05.497574 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:20:05.497934 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:20:05.715606 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.217 seconds
[0m00:20:05.719431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0f62362b-f833-4d1c-9894-0d3a920f8d1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1471c9390>]}
[0m00:20:05.723426 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:20:05.723893 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m00:20:05.724345 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:20:05.724697 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:20:05.736332 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:20:05.736907 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:20:05.744688 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:20:05.745246 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:20:05.745384 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m00:20:05.864269 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.118 seconds
[0m00:20:05.874930 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.15s]
[0m00:20:05.875507 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:20:05.875831 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_fct_btc_indicators_coin_id__date.e466b40c7d
[0m00:20:05.876200 [info ] [Thread-1 (]: 2 of 2 START test unique_fct_btc_indicators_coin_id__date ...................... [RUN]
[0m00:20:05.876594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_fct_btc_indicators_coin_id__date.e466b40c7d)
[0m00:20:05.876899 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_fct_btc_indicators_coin_id__date.e466b40c7d
[0m00:20:05.885274 [debug] [Thread-1 (]: Compilation Error in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)
  macro 'dbt_macro__test_unique' takes no keyword argument 'combination_of_columns'
[0m00:20:05.885560 [error] [Thread-1 (]: 2 of 2 ERROR unique_fct_btc_indicators_coin_id__date ........................... [[31mERROR[0m in 0.01s]
[0m00:20:05.885771 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_fct_btc_indicators_coin_id__date.e466b40c7d
[0m00:20:05.885956 [debug] [Thread-4 (]: Marking all children of 'test.btc_elt.unique_fct_btc_indicators_coin_id__date.e466b40c7d' to be skipped because of status 'error'.  Reason: Compilation Error in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)
  macro 'dbt_macro__test_unique' takes no keyword argument 'combination_of_columns'.
[0m00:20:05.886716 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:20:05.886835 [debug] [MainThread]: Connection 'test.btc_elt.unique_fct_btc_indicators_coin_id__date.e466b40c7d' was left open.
[0m00:20:05.886939 [debug] [MainThread]: On test.btc_elt.unique_fct_btc_indicators_coin_id__date.e466b40c7d: Close
[0m00:20:06.097305 [info ] [MainThread]: 
[0m00:20:06.097826 [info ] [MainThread]: Finished running 2 data tests in 0 hours 0 minutes and 1.47 seconds (1.47s).
[0m00:20:06.098578 [debug] [MainThread]: Command end result
[0m00:20:06.119216 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:20:06.120059 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:20:06.122649 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:20:06.122800 [info ] [MainThread]: 
[0m00:20:06.122953 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:20:06.123064 [info ] [MainThread]: 
[0m00:20:06.123196 [error] [MainThread]: [31mFailure in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)[0m
[0m00:20:06.123321 [error] [MainThread]:   Compilation Error in test unique_fct_btc_indicators_coin_id__date (models/schema.yml)
  macro 'dbt_macro__test_unique' takes no keyword argument 'combination_of_columns'
[0m00:20:06.123421 [info ] [MainThread]: 
[0m00:20:06.123536 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m00:20:06.123734 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 1 occurrence
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m00:20:06.126470 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 2.983011, "process_in_blocks": "0", "process_kernel_time": 1.446332, "process_mem_max_rss": "223674368", "process_out_blocks": "0", "process_user_time": 2.532192}
[0m00:20:06.126657 [debug] [MainThread]: Command `dbt test` failed at 00:20:06.126607 after 2.98 seconds
[0m00:20:06.126798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1472471b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1471f34a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1442c1bd0>]}
[0m00:20:06.126927 [debug] [MainThread]: Flushing usage events
[0m00:20:06.558736 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:22:58.518803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104246900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056af9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056afc50>]}


============================== 00:22:58.521071 | f674fc32-80b5-4619-b798-6ab78d84ce10 ==============================
[0m00:22:58.521071 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m00:22:58.521310 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'use_colors': 'True', 'empty': 'None', 'log_format': 'default', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'quiet': 'False', 'log_cache_events': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'printer_width': '80', 'partial_parse': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'invocation_command': 'dbt test', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'no_print': 'None', 'static_parser': 'True'}
[0m00:22:59.095467 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m00:22:59.095676 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m00:22:59.095784 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m00:22:59.211793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f674fc32-80b5-4619-b798-6ab78d84ce10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a39f30>]}
[0m00:22:59.230752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f674fc32-80b5-4619-b798-6ab78d84ce10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13047ff00>]}
[0m00:22:59.231226 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m00:22:59.277365 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m00:22:59.332600 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m00:22:59.332815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f674fc32-80b5-4619-b798-6ab78d84ce10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130da0350>]}
[0m00:22:59.843057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f674fc32-80b5-4619-b798-6ab78d84ce10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130cb5f40>]}
[0m00:22:59.877813 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:22:59.879838 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:22:59.893828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f674fc32-80b5-4619-b798-6ab78d84ce10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b698d0>]}
[0m00:22:59.894010 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 data tests, 3 sources, 516 macros
[0m00:22:59.894132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f674fc32-80b5-4619-b798-6ab78d84ce10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b61b20>]}
[0m00:22:59.894812 [info ] [MainThread]: 
[0m00:22:59.894947 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:22:59.895047 [info ] [MainThread]: 
[0m00:22:59.895224 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:22:59.896677 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m00:22:59.947574 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m00:22:59.947753 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m00:22:59.947850 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:23:00.501618 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.554 seconds
[0m00:23:00.504795 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m00:23:00.508578 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m00:23:00.508971 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m00:23:00.681215 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.172 seconds
[0m00:23:00.684341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f674fc32-80b5-4619-b798-6ab78d84ce10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132a8da90>]}
[0m00:23:00.687763 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:23:00.688073 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m00:23:00.688393 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m00:23:00.688627 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:23:00.699931 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:23:00.700700 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:23:00.711842 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:23:00.712671 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m00:23:00.712861 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
[0m00:23:01.115559 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.402 seconds
[0m00:23:01.127296 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.44s]
[0m00:23:01.128025 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m00:23:01.128439 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_coinid_date
[0m00:23:01.128883 [info ] [Thread-1 (]: 2 of 2 START test unique_coinid_date ........................................... [RUN]
[0m00:23:01.129371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_coinid_date)
[0m00:23:01.129711 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_coinid_date
[0m00:23:01.133212 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_coinid_date"
[0m00:23:01.134608 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_coinid_date
[0m00:23:01.137576 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_coinid_date"
[0m00:23:01.139250 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_coinid_date"
[0m00:23:01.139609 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  select
    coin_id,
    date,
    count(*) as cnt
from USER_DB_PEACOCK.analytics.fct_btc_indicators
group by 1,2
having count(*) > 1
  
  
      
    ) dbt_internal_test
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_coinid_date"} */
[0m00:23:02.041452 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.901 seconds
[0m00:23:02.044759 [info ] [Thread-1 (]: 2 of 2 PASS unique_coinid_date ................................................. [[32mPASS[0m in 0.92s]
[0m00:23:02.045504 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_coinid_date
[0m00:23:02.047235 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:23:02.047691 [debug] [MainThread]: Connection 'test.btc_elt.unique_coinid_date' was left open.
[0m00:23:02.048026 [debug] [MainThread]: On test.btc_elt.unique_coinid_date: Close
[0m00:23:02.207157 [info ] [MainThread]: 
[0m00:23:02.207995 [info ] [MainThread]: Finished running 2 data tests in 0 hours 0 minutes and 2.31 seconds (2.31s).
[0m00:23:02.208996 [debug] [MainThread]: Command end result
[0m00:23:02.302522 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m00:23:02.303339 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m00:23:02.305674 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m00:23:02.305794 [info ] [MainThread]: 
[0m00:23:02.305936 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:23:02.306048 [info ] [MainThread]: 
[0m00:23:02.306163 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m00:23:02.308633 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.8165445, "process_in_blocks": "0", "process_kernel_time": 1.039676, "process_mem_max_rss": "242171904", "process_out_blocks": "0", "process_user_time": 3.269389}
[0m00:23:02.308764 [debug] [MainThread]: Command `dbt test` succeeded at 00:23:02.308737 after 3.82 seconds
[0m00:23:02.308881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130d8ec50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132a1df90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132a1f1b0>]}
[0m00:23:02.308992 [debug] [MainThread]: Flushing usage events
[0m00:23:02.717199 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:25:25.549045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95e4c170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96374620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95e4c7a0>]}


============================== 08:25:25.552121 | 5da3ab4d-a9b2-4538-84da-6db818d443db ==============================
[0m08:25:25.552121 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:25:25.552737 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:25:25.924833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff901cfe90>]}
[0m08:25:25.955321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ae6d190>]}
[0m08:25:25.955668 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:25:25.959999 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:25:25.965408 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m08:25:25.965699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7484cdd0>]}
[0m08:25:26.515351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff742ae450>]}
[0m08:25:26.521002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff740cf800>]}
[0m08:25:26.521222 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:25:26.521567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff741a77d0>]}
[0m08:25:26.522298 [info ] [MainThread]: 
[0m08:25:26.522705 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:25:26.523263 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:25:26.528398 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:25:26.528549 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:25:26.528663 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:25:27.064431 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:25:27.067848 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:25:27.235384 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:25:27.249985 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:25:27.250638 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:25:27.251059 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:25:27.659795 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:25:27.663066 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:25:28.270643 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:25:28.275162 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:25:28.275738 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:25:28.276663 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:25:28.981710 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:25:28.985247 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:25:29.138205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ff1aba0>]}
[0m08:25:29.139770 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:25:29.141084 [info ] [MainThread]: 
[0m08:25:29.152637 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:25:29.153656 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:25:29.154118 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:25:29.162193 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:25:29.164698 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:25:29.154410 => 08:25:29.164484
[0m08:25:29.165473 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:25:29.165836 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:25:29.166531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:25:29.166803 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:25:29.169637 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:25:29.170766 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:25:29.166994 => 08:25:29.170647
[0m08:25:29.171364 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:25:29.171955 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:25:29.172284 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:25:29.173128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:25:29.173377 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:25:29.202060 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:25:29.203065 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:25:29.173515 => 08:25:29.202962
[0m08:25:29.203257 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:25:29.215720 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:25:29.218380 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:25:29.218684 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m08:25:29.219003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:25:31.235375 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:25:31.261277 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:25:29.203387 => 08:25:31.260973
[0m08:25:31.261887 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:25:31.404964 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5da3ab4d-a9b2-4538-84da-6db818d443db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74043fe0>]}
[0m08:25:31.406739 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.23s]
[0m08:25:31.409904 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:25:31.413292 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:25:31.413797 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:25:31.414220 [info ] [MainThread]: 
[0m08:25:31.414941 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.89 seconds (4.89s).
[0m08:25:31.415816 [debug] [MainThread]: Command end result
[0m08:25:31.431906 [info ] [MainThread]: 
[0m08:25:31.432629 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:25:31.432932 [info ] [MainThread]: 
[0m08:25:31.433443 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:25:31.435444 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.908012, "process_user_time": 2.998192, "process_kernel_time": 0.155061, "process_mem_max_rss": "226740", "process_out_blocks": "2734", "process_in_blocks": "0"}
[0m08:25:31.436156 [debug] [MainThread]: Command `dbt run` succeeded at 08:25:31.436001 after 5.91 seconds
[0m08:25:31.436738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95f69250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96374620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff74a0bf20>]}
[0m08:25:31.437373 [debug] [MainThread]: Flushing usage events
[0m08:25:34.500919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c37a2a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c6ed1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cc0f470>]}


============================== 08:25:34.503998 | 6db7566c-9a03-4c37-9668-28a32bcea236 ==============================
[0m08:25:34.503998 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:25:34.504467 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m08:25:34.898315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6db7566c-9a03-4c37-9668-28a32bcea236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff571bbc50>]}
[0m08:25:34.934961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6db7566c-9a03-4c37-9668-28a32bcea236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff767c6ed0>]}
[0m08:25:34.935655 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:25:34.940160 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:25:34.955383 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:25:34.955601 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:25:34.957878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6db7566c-9a03-4c37-9668-28a32bcea236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5708fad0>]}
[0m08:25:34.963302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6db7566c-9a03-4c37-9668-28a32bcea236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56f378f0>]}
[0m08:25:34.963501 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:25:34.963852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6db7566c-9a03-4c37-9668-28a32bcea236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61437f80>]}
[0m08:25:34.964755 [info ] [MainThread]: 
[0m08:25:34.965158 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:25:34.965862 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m08:25:34.971395 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:25:34.971567 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:25:34.971729 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:25:35.672482 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:25:35.674525 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:25:35.833053 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m08:25:35.835046 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:25:35.835277 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:25:35.835533 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:25:36.212056 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:25:36.213542 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:25:36.378055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6db7566c-9a03-4c37-9668-28a32bcea236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5730dd30>]}
[0m08:25:36.379691 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:25:36.380971 [info ] [MainThread]: 
[0m08:25:36.393107 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:25:36.393905 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:25:36.395261 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:25:36.395747 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:25:36.409110 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:25:36.411540 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:25:36.396067 => 08:25:36.411365
[0m08:25:36.411842 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:25:36.424521 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:25:36.425824 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:25:36.426141 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:25:36.426365 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:25:36.987715 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:25:36.996645 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:25:36.412047 => 08:25:36.996208
[0m08:25:36.997590 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:25:37.137280 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.74s]
[0m08:25:37.138996 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:25:37.139737 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_coinid_date
[0m08:25:37.140293 [info ] [Thread-1 (]: 2 of 2 START test unique_coinid_date ........................................... [RUN]
[0m08:25:37.141650 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_coinid_date)
[0m08:25:37.142248 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_coinid_date
[0m08:25:37.146521 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_coinid_date"
[0m08:25:37.149720 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (compile): 08:25:37.142664 => 08:25:37.149432
[0m08:25:37.150242 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_coinid_date
[0m08:25:37.154365 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_coinid_date"
[0m08:25:37.156655 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_coinid_date"
[0m08:25:37.157045 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_coinid_date"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    coin_id,
    date,
    count(*) as cnt
from USER_DB_PEACOCK.analytics.fct_btc_indicators
group by 1,2
having count(*) > 1
      
    ) dbt_internal_test
[0m08:25:37.157417 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:25:37.887424 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:25:37.890586 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (execute): 08:25:37.150642 => 08:25:37.890250
[0m08:25:37.891265 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: Close
[0m08:25:38.103461 [info ] [Thread-1 (]: 2 of 2 PASS unique_coinid_date ................................................. [[32mPASS[0m in 0.96s]
[0m08:25:38.104779 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_coinid_date
[0m08:25:38.107602 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:25:38.108086 [debug] [MainThread]: Connection 'test.btc_elt.unique_coinid_date' was properly closed.
[0m08:25:38.108543 [info ] [MainThread]: 
[0m08:25:38.109482 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 3.14 seconds (3.14s).
[0m08:25:38.110613 [debug] [MainThread]: Command end result
[0m08:25:38.123300 [info ] [MainThread]: 
[0m08:25:38.124116 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:25:38.124453 [info ] [MainThread]: 
[0m08:25:38.124825 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:25:38.126218 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.6466143, "process_user_time": 2.501047, "process_kernel_time": 0.162511, "process_mem_max_rss": "212448", "process_out_blocks": "1788", "process_in_blocks": "0"}
[0m08:25:38.126758 [debug] [MainThread]: Command `dbt test` succeeded at 08:25:38.126655 after 3.65 seconds
[0m08:25:38.127116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8136aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c6ed1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56eb8ad0>]}
[0m08:25:38.127430 [debug] [MainThread]: Flushing usage events
[0m08:25:40.366993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa77cd9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa78261e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa77cc8c0>]}


============================== 08:25:40.369659 | 066976ee-1674-423c-b86a-5dfa35b6fa8a ==============================
[0m08:25:40.369659 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:25:40.370109 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:25:40.707749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8263d6d0>]}
[0m08:25:40.736771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8266d3a0>]}
[0m08:25:40.737054 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:25:40.740095 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:25:40.751973 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:25:40.752126 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:25:40.754265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff824ca4b0>]}
[0m08:25:40.759161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff823e7530>]}
[0m08:25:40.759332 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:25:40.759617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82e4cfe0>]}
[0m08:25:40.760355 [info ] [MainThread]: 
[0m08:25:40.760703 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:25:40.761235 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:25:40.766266 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:25:40.766435 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:25:40.766565 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:25:41.334377 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m08:25:41.337002 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:25:41.521567 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:25:41.532957 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:25:41.533788 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:25:41.534261 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:25:41.986923 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:25:41.991618 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:25:42.175648 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:25:42.180726 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:25:42.181291 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:25:42.184821 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:25:42.637001 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:25:42.640209 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:25:42.790831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff825439e0>]}
[0m08:25:42.792457 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:25:42.794649 [info ] [MainThread]: 
[0m08:25:42.805915 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:25:42.806548 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:25:42.807392 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:25:42.807742 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:25:42.814671 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:25:42.807975 => 08:25:42.814504
[0m08:25:42.814960 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:25:42.845401 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:42.845628 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:25:42.845847 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:25:43.562189 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:25:43.577950 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:43.578893 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:25:43.696368 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:25:43.701111 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:43.701435 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:25:43.817442 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:25:43.847527 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:43.847990 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:25:45.467555 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:25:45.473836 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:45.474493 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:25:45.588397 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:25:45.594500 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:45.595213 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:25:45.687043 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:25:45.692682 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:45.693428 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:25:45.810218 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:25:45.818611 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:45.819394 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:25:45.954170 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:25:45.964647 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:45.965311 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:25:46.072542 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:25:46.083055 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:25:46.087208 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:46.087837 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:25:46.231733 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:25:46.232578 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:46.233247 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:25:47.206829 [debug] [Thread-1 (]: SQL status: SUCCESS 98 in 1.0 seconds
[0m08:25:47.208016 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:25:47.208716 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:25:47.593777 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:25:47.618071 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:25:42.815132 => 08:25:47.617815
[0m08:25:47.618547 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:25:47.756709 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8187ffb0>]}
[0m08:25:47.758393 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 98[0m in 4.95s]
[0m08:25:47.760895 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:25:47.761600 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:25:47.762337 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:25:47.763592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:25:47.764142 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:25:47.769468 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:25:47.764394 => 08:25:47.769209
[0m08:25:47.769954 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:25:47.774577 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:47.774967 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:25:47.775332 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:25:48.435064 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:25:48.437575 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:48.437910 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:25:48.548986 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:25:48.553811 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:48.554242 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:25:48.672129 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:25:48.683770 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:48.684841 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:25:50.378513 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:25:50.390233 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:50.391207 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:25:50.517555 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:25:50.522491 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:50.523062 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:25:50.757608 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:25:50.764427 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:50.765260 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:25:50.870491 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:25:50.876092 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:50.876831 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:25:50.976170 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:25:50.985439 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:50.986336 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:25:51.079428 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:25:51.089096 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:51.092156 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:51.092750 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:25:51.202274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:25:51.203606 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:51.204660 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:25:52.018711 [debug] [Thread-1 (]: SQL status: SUCCESS 45 in 1.0 seconds
[0m08:25:52.019926 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:25:52.020469 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:25:52.428537 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:25:52.434696 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:25:47.770274 => 08:25:52.434194
[0m08:25:52.435370 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:25:52.599417 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '066976ee-1674-423c-b86a-5dfa35b6fa8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81854c50>]}
[0m08:25:52.602121 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 45[0m in 4.84s]
[0m08:25:52.606596 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:25:52.615261 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:25:52.616114 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:25:52.616605 [info ] [MainThread]: 
[0m08:25:52.617392 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 11.86 seconds (11.86s).
[0m08:25:52.618491 [debug] [MainThread]: Command end result
[0m08:25:52.636134 [info ] [MainThread]: 
[0m08:25:52.636910 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:25:52.637171 [info ] [MainThread]: 
[0m08:25:52.637650 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:25:52.640539 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.293009, "process_user_time": 2.731799, "process_kernel_time": 0.141872, "process_mem_max_rss": "214124", "process_out_blocks": "1834", "process_in_blocks": "0"}
[0m08:25:52.641179 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:25:52.641091 after 12.29 seconds
[0m08:25:52.641858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac80a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82352fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff818cd940>]}
[0m08:25:52.642136 [debug] [MainThread]: Flushing usage events
[0m08:47:08.458694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef7c320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef7e930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaefd1280>]}


============================== 08:47:08.461849 | da37b970-b46a-4545-b258-36342ca69c4a ==============================
[0m08:47:08.461849 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:47:08.462318 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:47:08.797276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da37b970-b46a-4545-b258-36342ca69c4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaee08740>]}
[0m08:47:08.825897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da37b970-b46a-4545-b258-36342ca69c4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf098350>]}
[0m08:47:08.826207 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:47:08.830229 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:47:08.844422 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:47:08.844585 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:47:08.846773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da37b970-b46a-4545-b258-36342ca69c4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8de027b0>]}
[0m08:47:08.852579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da37b970-b46a-4545-b258-36342ca69c4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8db47c20>]}
[0m08:47:08.852762 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:47:08.853071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da37b970-b46a-4545-b258-36342ca69c4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e0baea0>]}
[0m08:47:08.853783 [info ] [MainThread]: 
[0m08:47:08.854177 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:47:08.854686 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:47:08.859538 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:47:08.859690 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:47:08.859823 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:47:09.293016 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:47:09.295267 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:47:09.430854 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:47:09.442293 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:47:09.443040 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:47:09.443546 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:09.908110 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m08:47:09.909040 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:47:10.060229 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:47:10.061607 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:47:10.061783 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:47:10.062115 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:10.467622 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:47:10.468416 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:47:10.611352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da37b970-b46a-4545-b258-36342ca69c4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8df799a0>]}
[0m08:47:10.612659 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:47:10.616404 [info ] [MainThread]: 
[0m08:47:10.643489 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m08:47:10.644443 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m08:47:10.644901 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m08:47:10.649421 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m08:47:10.651410 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 08:47:10.645133 => 08:47:10.651296
[0m08:47:10.652532 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m08:47:10.652763 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m08:47:10.653089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m08:47:10.653296 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m08:47:10.654982 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m08:47:10.655736 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 08:47:10.653421 => 08:47:10.655650
[0m08:47:10.656111 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m08:47:10.656426 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m08:47:10.656725 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m08:47:10.657134 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m08:47:10.657302 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m08:47:10.679123 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m08:47:10.680172 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 08:47:10.657416 => 08:47:10.680083
[0m08:47:10.680337 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m08:47:10.691243 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m08:47:10.693986 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m08:47:10.694280 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m08:47:10.694599 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:13.178924 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:47:13.204515 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 08:47:10.680457 => 08:47:13.204281
[0m08:47:13.205000 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m08:47:13.348757 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da37b970-b46a-4545-b258-36342ca69c4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d1c0110>]}
[0m08:47:13.349797 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.69s]
[0m08:47:13.350468 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m08:47:13.351828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:47:13.352072 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m08:47:13.352327 [info ] [MainThread]: 
[0m08:47:13.352700 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.50 seconds (4.50s).
[0m08:47:13.353151 [debug] [MainThread]: Command end result
[0m08:47:13.360619 [info ] [MainThread]: 
[0m08:47:13.360972 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:47:13.361167 [info ] [MainThread]: 
[0m08:47:13.361412 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:47:13.362030 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.927083, "process_user_time": 2.334543, "process_kernel_time": 0.109353, "process_mem_max_rss": "213064", "process_out_blocks": "1863", "process_in_blocks": "0"}
[0m08:47:13.362338 [debug] [MainThread]: Command `dbt run` succeeded at 08:47:13.362277 after 4.93 seconds
[0m08:47:13.362553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dc2b110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef7e930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef7c320>]}
[0m08:47:13.362753 [debug] [MainThread]: Flushing usage events
[0m08:47:15.803989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3ff8080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3fd51f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3ffb3b0>]}


============================== 08:47:15.806808 | 44f920e3-f589-4e56-a4e1-3112b76ee540 ==============================
[0m08:47:15.806808 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:47:15.807751 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:47:16.172196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44f920e3-f589-4e56-a4e1-3112b76ee540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8eb328a0>]}
[0m08:47:16.201529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44f920e3-f589-4e56-a4e1-3112b76ee540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98a79a90>]}
[0m08:47:16.201850 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:47:16.205010 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:47:16.218975 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:47:16.219242 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:47:16.221501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44f920e3-f589-4e56-a4e1-3112b76ee540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e8ecb00>]}
[0m08:47:16.226865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44f920e3-f589-4e56-a4e1-3112b76ee540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e667650>]}
[0m08:47:16.227070 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:47:16.227409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44f920e3-f589-4e56-a4e1-3112b76ee540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e78ce00>]}
[0m08:47:16.228154 [info ] [MainThread]: 
[0m08:47:16.228548 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:47:16.229166 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m08:47:16.235013 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:47:16.235192 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:47:16.235392 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:47:16.829600 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m08:47:16.832652 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:47:16.986830 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:47:16.991867 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:47:16.992483 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:47:16.993057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:18.502277 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 2.0 seconds
[0m08:47:18.505253 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:47:18.636676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44f920e3-f589-4e56-a4e1-3112b76ee540', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e665d30>]}
[0m08:47:18.638046 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:47:18.639308 [info ] [MainThread]: 
[0m08:47:18.651808 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:18.652449 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m08:47:18.653624 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m08:47:18.654053 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:18.668749 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:47:18.671039 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 08:47:18.654310 => 08:47:18.670888
[0m08:47:18.671323 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:18.682330 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:47:18.683398 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m08:47:18.683678 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m08:47:18.683925 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:19.134280 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:19.144239 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 08:47:18.671508 => 08:47:19.143878
[0m08:47:19.145036 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m08:47:19.293319 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.64s]
[0m08:47:19.295284 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m08:47:19.296083 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_coinid_date
[0m08:47:19.296745 [info ] [Thread-1 (]: 2 of 2 START test unique_coinid_date ........................................... [RUN]
[0m08:47:19.298030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_coinid_date)
[0m08:47:19.298552 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_coinid_date
[0m08:47:19.302668 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_coinid_date"
[0m08:47:19.305381 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (compile): 08:47:19.298908 => 08:47:19.305057
[0m08:47:19.305958 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_coinid_date
[0m08:47:19.309092 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_coinid_date"
[0m08:47:19.310860 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_coinid_date"
[0m08:47:19.311228 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_coinid_date"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    coin_id,
    date,
    count(*) as cnt
from USER_DB_PEACOCK.analytics.fct_btc_indicators
group by 1,2
having count(*) > 1
      
    ) dbt_internal_test
[0m08:47:19.311610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:19.869838 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:47:19.874222 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (execute): 08:47:19.306294 => 08:47:19.873856
[0m08:47:19.874875 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: Close
[0m08:47:20.014183 [info ] [Thread-1 (]: 2 of 2 PASS unique_coinid_date ................................................. [[32mPASS[0m in 0.72s]
[0m08:47:20.015416 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_coinid_date
[0m08:47:20.017478 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:47:20.017865 [debug] [MainThread]: Connection 'test.btc_elt.unique_coinid_date' was properly closed.
[0m08:47:20.018220 [info ] [MainThread]: 
[0m08:47:20.018898 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 3.79 seconds (3.79s).
[0m08:47:20.019675 [debug] [MainThread]: Command end result
[0m08:47:20.028993 [info ] [MainThread]: 
[0m08:47:20.029424 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:47:20.029678 [info ] [MainThread]: 
[0m08:47:20.029996 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:47:20.030804 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.2474566, "process_user_time": 2.523301, "process_kernel_time": 0.146292, "process_mem_max_rss": "212304", "process_out_blocks": "1788", "process_in_blocks": "0"}
[0m08:47:20.031176 [debug] [MainThread]: Command `dbt test` succeeded at 08:47:20.031096 after 4.25 seconds
[0m08:47:20.031455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3ff8080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8b6aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98a41520>]}
[0m08:47:20.031794 [debug] [MainThread]: Flushing usage events
[0m08:47:22.145697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87f5e300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8831d4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87b7e1e0>]}


============================== 08:47:22.148434 | 6486f835-0b83-4ce5-9f02-fbb3797d34dc ==============================
[0m08:47:22.148434 [info ] [MainThread]: Running with dbt=1.7.19
[0m08:47:22.148992 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:47:22.479961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87b970b0>]}
[0m08:47:22.509444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6cd22de0>]}
[0m08:47:22.509738 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m08:47:22.512900 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m08:47:22.524876 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:47:22.525022 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:47:22.527112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6262f410>]}
[0m08:47:22.531936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62706f90>]}
[0m08:47:22.532142 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:47:22.532459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62a84c50>]}
[0m08:47:22.533188 [info ] [MainThread]: 
[0m08:47:22.533609 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:47:22.534175 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m08:47:22.538988 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m08:47:22.539140 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m08:47:22.539273 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:47:22.996257 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:47:22.999012 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m08:47:23.142881 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m08:47:23.153781 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m08:47:23.154547 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m08:47:23.155060 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:23.930893 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m08:47:23.934615 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m08:47:24.095904 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m08:47:24.100723 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m08:47:24.101321 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m08:47:24.102386 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:47:24.557043 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m08:47:24.558507 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m08:47:24.692744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62cbf8f0>]}
[0m08:47:24.693998 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:47:24.695128 [info ] [MainThread]: 
[0m08:47:24.704636 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m08:47:24.705097 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m08:47:24.705863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m08:47:24.706178 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m08:47:24.712640 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 08:47:24.706385 => 08:47:24.712486
[0m08:47:24.712958 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m08:47:24.743612 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:24.743848 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:47:24.744034 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:25.124997 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:47:25.138244 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:25.139443 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:25.229270 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:25.239203 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:25.239831 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:25.337183 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:25.366465 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:25.366940 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:47:27.444423 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m08:47:27.449797 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:27.450629 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:47:27.539549 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:47:27.545251 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:27.545851 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:27.644181 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:27.649988 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:27.650698 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:47:27.780531 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:47:27.786422 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:27.787083 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m08:47:27.900207 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m08:47:27.910272 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:27.910919 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m08:47:28.000708 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m08:47:28.010846 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m08:47:28.015043 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:28.015676 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m08:47:28.175512 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:28.176516 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:28.177203 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:47:28.945630 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 1.0 seconds
[0m08:47:28.946350 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m08:47:28.946697 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m08:47:29.357077 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:29.381346 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 08:47:24.713194 => 08:47:29.381102
[0m08:47:29.381855 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m08:47:29.518718 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61bec0e0>]}
[0m08:47:29.520170 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 8[0m in 4.81s]
[0m08:47:29.520971 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m08:47:29.521363 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:29.521766 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m08:47:29.522397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m08:47:29.522672 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:29.525620 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 08:47:29.522899 => 08:47:29.525426
[0m08:47:29.525918 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:29.528551 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:29.528881 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m08:47:29.529227 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:47:30.006377 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m08:47:30.009394 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:30.009876 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:30.549920 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 1.0 seconds
[0m08:47:30.555923 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:30.556469 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:30.682540 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:47:30.686270 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:30.686581 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m08:47:32.110563 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m08:47:32.115248 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.115980 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:47:32.242683 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:47:32.248492 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.249391 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:32.355621 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:47:32.360841 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.361622 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:47:32.488728 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:47:32.494819 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.495657 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m08:47:32.610808 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m08:47:32.619752 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.620660 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m08:47:32.713349 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m08:47:32.718238 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.721515 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.722175 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m08:47:32.857512 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:32.858820 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:32.859405 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m08:47:33.646798 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m08:47:33.648158 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m08:47:33.650052 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m08:47:34.070940 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m08:47:34.076598 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 08:47:29.526091 => 08:47:34.076222
[0m08:47:34.077371 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m08:47:34.260416 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6486f835-0b83-4ce5-9f02-fbb3797d34dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62816b70>]}
[0m08:47:34.262146 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.74s]
[0m08:47:34.263299 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m08:47:34.267772 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:47:34.268222 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m08:47:34.268654 [info ] [MainThread]: 
[0m08:47:34.269338 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 11.74 seconds (11.74s).
[0m08:47:34.270348 [debug] [MainThread]: Command end result
[0m08:47:34.284435 [info ] [MainThread]: 
[0m08:47:34.285262 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:47:34.285602 [info ] [MainThread]: 
[0m08:47:34.286017 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m08:47:34.287623 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.162487, "process_user_time": 2.647837, "process_kernel_time": 0.129356, "process_mem_max_rss": "214204", "process_out_blocks": "1834", "process_in_blocks": "0"}
[0m08:47:34.288178 [debug] [MainThread]: Command `dbt snapshot` succeeded at 08:47:34.288078 after 12.16 seconds
[0m08:47:34.288646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87b7e1e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87f5e300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62cbf0e0>]}
[0m08:47:34.289035 [debug] [MainThread]: Flushing usage events
[0m01:56:51.086399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10657e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079ff9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079ffc50>]}


============================== 01:56:51.088958 | 880e460f-1ed3-4aeb-a57d-f2601011b990 ==============================
[0m01:56:51.088958 [info ] [MainThread]: Running with dbt=1.11.0-b3
[0m01:56:51.089202 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt snapshot', 'quiet': 'False', 'log_cache_events': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/logs', 'warn_error': 'None', 'partial_parse': 'True', 'version_check': 'True', 'use_colors': 'True', 'debug': 'False', 'introspect': 'True', 'fail_fast': 'False', 'printer_width': '80', 'target_path': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/snehasingh/.dbt', 'write_json': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'log_format': 'default'}
[0m01:56:51.768798 [debug] [MainThread]: Snowflake adapter: Setting snowflake.connector to ERROR (file logging only)
[0m01:56:51.769033 [debug] [MainThread]: Snowflake adapter: Setting botocore to ERROR (file logging only)
[0m01:56:51.769155 [debug] [MainThread]: Snowflake adapter: Setting boto3 to ERROR (file logging only)
[0m01:56:51.887186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d89f30>]}
[0m01:56:51.907501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cd7ff00>]}
[0m01:56:51.908022 [info ] [MainThread]: Registered adapter: snowflake=1.11.0-rc1
[0m01:56:51.955835 [debug] [MainThread]: checksum: e63134dccc1251cfb572caf0e4aa952f030c125ee3634f3bf2c0a2e1bb6ae349, vars: {}, profile: , target: , version: 1.11.0b3
[0m01:56:52.010670 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m01:56:52.010911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ce37d50>]}
[0m01:56:52.543487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d42a030>]}
[0m01:56:52.579987 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:56:52.581137 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:56:52.591482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14daf9630>]}
[0m01:56:52.591670 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 data tests, 3 sources, 516 macros
[0m01:56:52.591798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db271e0>]}
[0m01:56:52.592496 [info ] [MainThread]: 
[0m01:56:52.592629 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:56:52.592728 [info ] [MainThread]: 
[0m01:56:52.592957 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:56:52.594415 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m01:56:52.644418 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m01:56:52.644596 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: show terse schemas in database USER_DB_PEACOCK
    limit 10000
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
[0m01:56:52.644698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:56:53.144571 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.500 seconds
[0m01:56:53.148495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m01:56:53.162293 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:56:53.162712 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: show objects in USER_DB_PEACOCK.analytics
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */;
[0m01:56:53.298533 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.136 seconds
[0m01:56:53.301512 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m01:56:53.304990 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:56:53.305319 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: show objects in USER_DB_PEACOCK.snapshot
    limit 10000
    

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */;
[0m01:56:53.443177 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.137 seconds
[0m01:56:53.446299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14daebb90>]}
[0m01:56:53.451452 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m01:56:53.452141 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m01:56:53.452651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m01:56:53.453039 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m01:56:53.462181 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m01:56:53.501007 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:53.501321 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:54.156336 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.655 seconds
[0m01:56:54.166174 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:54.168692 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:54.257644 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.087 seconds
[0m01:56:54.268639 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:54.269395 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:54.418512 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.148 seconds
[0m01:56:54.458485 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:54.458911 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
as (
    
    
    with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */;
[0m01:56:56.450591 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.991 seconds
[0m01:56:56.452030 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:56.452237 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:56.533633 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.081 seconds
[0m01:56:56.535953 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:56.536370 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:56.613612 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.077 seconds
[0m01:56:56.618211 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:56.618652 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:56.771649 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.153 seconds
[0m01:56:56.776137 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:56.776646 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:56.874768 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.097 seconds
[0m01:56:56.889413 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:56.890009 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:57.105303 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.215 seconds
[0m01:56:57.130122 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:57.130812 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        
    
    with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:57.573823 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.442 seconds
[0m01:56:57.578008 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:57.578410 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:57.670770 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.092 seconds
[0m01:56:57.671922 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m01:56:57.674987 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:57.675449 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:57.780928 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.105 seconds
[0m01:56:57.781683 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:57.782203 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")


/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */;
[0m01:56:58.697869 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.915 seconds
[0m01:56:58.698602 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:56:58.698933 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
[0m01:56:58.993403 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.294 seconds
[0m01:56:59.104120 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d55e8e0>]}
[0m01:56:59.104532 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 0[0m in 5.65s]
[0m01:56:59.104782 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m01:56:59.104941 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m01:56:59.105160 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m01:56:59.105377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m01:56:59.105505 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m01:56:59.106745 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m01:56:59.108141 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:56:59.108288 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:56:59.316081 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.207 seconds
[0m01:56:59.319796 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:56:59.321236 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:56:59.433823 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.111 seconds
[0m01:56:59.440928 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:56:59.441440 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:56:59.598714 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.157 seconds
[0m01:56:59.609685 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:56:59.610502 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
as (
    
    
    with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    )

/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */;
[0m01:57:00.692059 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.081 seconds
[0m01:57:00.693625 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:00.693890 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:00.814984 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.121 seconds
[0m01:57:00.820770 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:00.821288 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:00.924795 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.103 seconds
[0m01:57:00.931213 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:00.931856 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:01.041370 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.109 seconds
[0m01:57:01.047515 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:01.048075 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:01.140557 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.092 seconds
[0m01:57:01.144742 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:01.145258 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:01.244779 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.099 seconds
[0m01:57:01.249927 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:01.250479 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        
    
    with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            
  
  coalesce(nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))), null)
  as dbt_valid_to
,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    
,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        business_key as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and (
               (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    )
    ,
    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id
        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:01.680365 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.429 seconds
[0m01:57:01.681845 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:01.682366 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:01.769975 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.087 seconds
[0m01:57:01.770923 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:01.773596 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:01.774125 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: BEGIN
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:01.915526 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.141 seconds
[0m01:57:01.916223 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:01.916785 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     
       and DBT_INTERNAL_DEST.dbt_valid_to is null
     
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")


/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */;
[0m01:57:02.680316 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.763 seconds
[0m01:57:02.681096 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:57:02.681450 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: COMMIT
/* {"app": "dbt", "dbt_version": "1.11.0b3", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
[0m01:57:03.042361 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.360 seconds
[0m01:57:03.045923 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '880e460f-1ed3-4aeb-a57d-f2601011b990', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d848730>]}
[0m01:57:03.047175 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.94s]
[0m01:57:03.048191 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m01:57:03.050034 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:57:03.050499 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was left open.
[0m01:57:03.050844 [debug] [MainThread]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m01:57:03.214021 [info ] [MainThread]: 
[0m01:57:03.214731 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.62 seconds (10.62s).
[0m01:57:03.215616 [debug] [MainThread]: Command end result
[0m01:57:03.236871 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/manifest.json
[0m01:57:03.238856 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/semantic_manifest.json
[0m01:57:03.242974 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/snehasingh/Desktop/airflow-docker/dbt/btc_elt/target/run_results.json
[0m01:57:03.243214 [info ] [MainThread]: 
[0m01:57:03.243443 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:57:03.243574 [info ] [MainThread]: 
[0m01:57:03.243709 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m01:57:03.247826 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 12.1904125, "process_in_blocks": "0", "process_kernel_time": 1.907794, "process_mem_max_rss": "242221056", "process_out_blocks": "0", "process_user_time": 2.74052}
[0m01:57:03.248091 [debug] [MainThread]: Command `dbt snapshot` succeeded at 01:57:03.248035 after 12.19 seconds
[0m01:57:03.248304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dae1150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15330c850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037e9d30>]}
[0m01:57:03.248510 [debug] [MainThread]: Flushing usage events
[0m01:57:03.722522 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m09:58:58.286395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac2fff80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac358500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac2fc6e0>]}


============================== 09:58:58.289749 | 3f6e6f30-5318-474d-9512-27669f4e7648 ==============================
[0m09:58:58.289749 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:58:58.290341 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:58:58.747159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c898080>]}
[0m09:58:58.780605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f3de000>]}
[0m09:58:58.781088 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:58:58.785279 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:58:58.792620 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m09:58:58.793021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86c9ce60>]}
[0m09:58:59.422177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85731730>]}
[0m09:58:59.428340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85730440>]}
[0m09:58:59.428578 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:58:59.428995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff863b76e0>]}
[0m09:58:59.429925 [info ] [MainThread]: 
[0m09:58:59.430375 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:58:59.430955 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m09:58:59.436397 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m09:58:59.436580 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m09:58:59.436739 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:58:59.884482 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m09:58:59.886755 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m09:59:00.030075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m09:59:00.040047 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:59:00.040631 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:59:00.041070 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:00.440381 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m09:59:00.442233 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:59:00.629167 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m09:59:00.631004 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:59:00.631367 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:59:00.632057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:01.043285 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:59:01.045126 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:59:01.221855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85738f80>]}
[0m09:59:01.223247 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:59:01.224266 [info ] [MainThread]: 
[0m09:59:01.233919 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m09:59:01.234852 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m09:59:01.235267 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m09:59:01.240313 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m09:59:01.241597 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 09:59:01.235560 => 09:59:01.241501
[0m09:59:01.242033 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m09:59:01.242251 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m09:59:01.242664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m09:59:01.242831 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m09:59:01.244503 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m09:59:01.245049 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 09:59:01.242935 => 09:59:01.244939
[0m09:59:01.245411 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m09:59:01.245811 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m09:59:01.246010 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m09:59:01.246578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m09:59:01.246749 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m09:59:01.269017 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m09:59:01.272290 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 09:59:01.246858 => 09:59:01.272179
[0m09:59:01.272488 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m09:59:01.284489 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m09:59:01.287781 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m09:59:01.288112 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m09:59:01.288470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:59:02.728526 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:59:02.752327 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 09:59:01.272607 => 09:59:02.752121
[0m09:59:02.753148 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m09:59:02.890115 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3f6e6f30-5318-474d-9512-27669f4e7648', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85360f50>]}
[0m09:59:02.890902 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.64s]
[0m09:59:02.892043 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m09:59:02.893901 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:02.894296 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m09:59:02.894663 [info ] [MainThread]: 
[0m09:59:02.895188 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.46 seconds (3.46s).
[0m09:59:02.895734 [debug] [MainThread]: Command end result
[0m09:59:02.906022 [info ] [MainThread]: 
[0m09:59:02.906416 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:59:02.906598 [info ] [MainThread]: 
[0m09:59:02.906885 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:59:02.907876 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.645582, "process_user_time": 3.285051, "process_kernel_time": 0.270785, "process_mem_max_rss": "226912", "process_out_blocks": "2736", "process_in_blocks": "0"}
[0m09:59:02.908266 [debug] [MainThread]: Command `dbt run` succeeded at 09:59:02.908183 after 4.65 seconds
[0m09:59:02.908571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb12c6a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac2fff80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff863f6630>]}
[0m09:59:02.908939 [debug] [MainThread]: Flushing usage events
[0m09:59:05.749082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d9d1be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e8b8740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dae51f0>]}


============================== 09:59:05.752125 | 975673ef-2ec7-4b12-81f5-9517abf19b90 ==============================
[0m09:59:05.752125 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:59:05.752731 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:59:06.169784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '975673ef-2ec7-4b12-81f5-9517abf19b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62a2a150>]}
[0m09:59:06.201504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '975673ef-2ec7-4b12-81f5-9517abf19b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d854950>]}
[0m09:59:06.201885 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:59:06.205556 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:59:06.219959 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:59:06.220168 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:59:06.222636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '975673ef-2ec7-4b12-81f5-9517abf19b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c6f1640>]}
[0m09:59:06.228354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '975673ef-2ec7-4b12-81f5-9517abf19b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c53bc50>]}
[0m09:59:06.228561 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:59:06.228930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '975673ef-2ec7-4b12-81f5-9517abf19b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ce6c500>]}
[0m09:59:06.229751 [info ] [MainThread]: 
[0m09:59:06.230203 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:59:06.230866 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m09:59:06.237187 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:59:06.237360 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:59:06.237483 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:06.661012 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m09:59:06.663807 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:59:06.815351 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m09:59:06.821369 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:59:06.822278 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:59:06.822935 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:07.204493 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:59:07.207991 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:59:07.342958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '975673ef-2ec7-4b12-81f5-9517abf19b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c539df0>]}
[0m09:59:07.344303 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:59:07.346154 [info ] [MainThread]: 
[0m09:59:07.359151 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:59:07.359764 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m09:59:07.360731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m09:59:07.361121 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:59:07.373139 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:59:07.374841 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 09:59:07.361369 => 09:59:07.374634
[0m09:59:07.375123 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:59:07.386692 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:59:07.387937 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m09:59:07.388181 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m09:59:07.388363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:59:07.854530 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:59:07.863976 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 09:59:07.375290 => 09:59:07.863535
[0m09:59:07.864809 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m09:59:07.992006 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.63s]
[0m09:59:07.993656 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m09:59:07.994383 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_coinid_date
[0m09:59:07.995072 [info ] [Thread-1 (]: 2 of 2 START test unique_coinid_date ........................................... [RUN]
[0m09:59:07.996492 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_coinid_date)
[0m09:59:07.997106 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_coinid_date
[0m09:59:08.001348 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_coinid_date"
[0m09:59:08.003783 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (compile): 09:59:07.997347 => 09:59:08.003565
[0m09:59:08.004157 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_coinid_date
[0m09:59:08.007940 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_coinid_date"
[0m09:59:08.009997 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_coinid_date"
[0m09:59:08.010325 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_coinid_date"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    coin_id,
    date,
    count(*) as cnt
from USER_DB_PEACOCK.analytics.fct_btc_indicators
group by 1,2
having count(*) > 1
      
    ) dbt_internal_test
[0m09:59:08.010535 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:59:08.468177 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:59:08.472140 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (execute): 09:59:08.004430 => 09:59:08.471853
[0m09:59:08.472758 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: Close
[0m09:59:08.629145 [info ] [Thread-1 (]: 2 of 2 PASS unique_coinid_date ................................................. [[32mPASS[0m in 0.63s]
[0m09:59:08.629807 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_coinid_date
[0m09:59:08.631350 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:08.631626 [debug] [MainThread]: Connection 'test.btc_elt.unique_coinid_date' was properly closed.
[0m09:59:08.631853 [info ] [MainThread]: 
[0m09:59:08.632269 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 2.40 seconds (2.40s).
[0m09:59:08.632849 [debug] [MainThread]: Command end result
[0m09:59:08.640771 [info ] [MainThread]: 
[0m09:59:08.641176 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:59:08.641393 [info ] [MainThread]: 
[0m09:59:08.641739 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:59:08.642567 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.9154902, "process_user_time": 2.522055, "process_kernel_time": 0.174805, "process_mem_max_rss": "213016", "process_out_blocks": "1789", "process_in_blocks": "0"}
[0m09:59:08.642901 [debug] [MainThread]: Command `dbt test` succeeded at 09:59:08.642829 after 2.92 seconds
[0m09:59:08.643115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7deffec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dd40ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c6c6420>]}
[0m09:59:08.643324 [debug] [MainThread]: Flushing usage events
[0m09:59:10.993364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9059c4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9069e000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9059caa0>]}


============================== 09:59:10.996258 | 816f333a-8595-41a5-8481-e2435b45b300 ==============================
[0m09:59:10.996258 [info ] [MainThread]: Running with dbt=1.7.19
[0m09:59:10.996528 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:59:11.410723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7026ed20>]}
[0m09:59:11.443057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91698920>]}
[0m09:59:11.443438 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m09:59:11.446993 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m09:59:11.459731 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:59:11.459907 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:59:11.462175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8750eff0>]}
[0m09:59:11.468121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b1c7c50>]}
[0m09:59:11.468291 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m09:59:11.468595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff75f72cc0>]}
[0m09:59:11.469332 [info ] [MainThread]: 
[0m09:59:11.469776 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:59:11.470337 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m09:59:11.475769 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m09:59:11.475944 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m09:59:11.476103 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:59:11.953964 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m09:59:11.958538 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m09:59:12.074969 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m09:59:12.079968 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m09:59:12.080279 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m09:59:12.080495 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:12.463588 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m09:59:12.465361 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m09:59:12.579756 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m09:59:12.584645 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m09:59:12.585258 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m09:59:12.585775 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:59:12.936056 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m09:59:12.938011 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m09:59:13.051623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b424ec0>]}
[0m09:59:13.053816 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:59:13.056274 [info ] [MainThread]: 
[0m09:59:13.068383 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m09:59:13.068979 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m09:59:13.070035 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m09:59:13.070418 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m09:59:13.077247 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 09:59:13.070694 => 09:59:13.077098
[0m09:59:13.077529 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m09:59:13.109248 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:13.109535 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m09:59:13.109745 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:59:13.483975 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m09:59:13.496405 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:13.497472 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:59:13.611249 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:59:13.621429 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:13.622113 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:59:13.722411 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:59:13.750208 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:13.750817 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:59:14.594441 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:59:14.599959 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:14.600922 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:59:14.705045 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:59:14.711408 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:14.712017 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:59:14.807895 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:59:14.813803 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:14.814469 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:59:14.930412 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:59:14.933419 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:14.933812 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m09:59:15.034959 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m09:59:15.046304 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:15.047446 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m09:59:15.177506 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m09:59:15.189416 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m09:59:15.193539 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:15.194123 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m09:59:15.319678 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:59:15.320306 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:15.320749 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m09:59:15.995701 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m09:59:15.996234 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m09:59:15.996461 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m09:59:16.295446 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:59:16.317501 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 09:59:13.077763 => 09:59:16.317347
[0m09:59:16.317950 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m09:59:16.487013 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a6ec950>]}
[0m09:59:16.488732 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 0[0m in 3.42s]
[0m09:59:16.489961 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m09:59:16.490813 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m09:59:16.491468 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m09:59:16.492882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m09:59:16.493332 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m09:59:16.499025 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 09:59:16.493608 => 09:59:16.498541
[0m09:59:16.499562 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m09:59:16.503944 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:16.504159 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m09:59:16.504523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:59:16.842286 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m09:59:16.849047 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:16.850454 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:59:16.931937 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:59:16.938565 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:16.939377 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:59:17.028219 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:59:17.041505 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:17.042333 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:59:18.111514 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m09:59:18.114986 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.115661 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:59:18.216432 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:59:18.221614 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.222243 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:59:18.315803 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:59:18.322239 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.323231 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:59:18.422080 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:59:18.429716 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.430524 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m09:59:18.525980 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m09:59:18.538673 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.539502 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m09:59:18.618235 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m09:59:18.620222 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.621658 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.621929 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m09:59:18.753386 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:59:18.754064 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:18.754609 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m09:59:19.466593 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m09:59:19.468439 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m09:59:19.468903 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m09:59:19.803589 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m09:59:19.808849 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 09:59:16.499925 => 09:59:19.808489
[0m09:59:19.809560 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m09:59:19.947670 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '816f333a-8595-41a5-8481-e2435b45b300', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a677320>]}
[0m09:59:19.949114 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 3.46s]
[0m09:59:19.949969 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m09:59:19.954191 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:59:19.954724 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m09:59:19.955256 [info ] [MainThread]: 
[0m09:59:19.955718 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 8.49 seconds (8.49s).
[0m09:59:19.957050 [debug] [MainThread]: Command end result
[0m09:59:19.972610 [info ] [MainThread]: 
[0m09:59:19.973493 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:59:19.974049 [info ] [MainThread]: 
[0m09:59:19.974594 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:59:19.976547 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 9.004586, "process_user_time": 2.745006, "process_kernel_time": 0.176247, "process_mem_max_rss": "214400", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m09:59:19.977237 [debug] [MainThread]: Command `dbt snapshot` succeeded at 09:59:19.977123 after 9.01 seconds
[0m09:59:19.977738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9560a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9069e000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b5fad20>]}
[0m09:59:19.977998 [debug] [MainThread]: Flushing usage events
[0m01:36:35.820872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82239010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8244b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82238410>]}


============================== 01:36:35.823915 | 22a12406-8c11-4795-a2cf-35e5b3d75690 ==============================
[0m01:36:35.823915 [info ] [MainThread]: Running with dbt=1.7.19
[0m01:36:35.824630 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:36:36.195632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '22a12406-8c11-4795-a2cf-35e5b3d75690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61041b80>]}
[0m01:36:36.225348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '22a12406-8c11-4795-a2cf-35e5b3d75690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff612509b0>]}
[0m01:36:36.225664 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m01:36:36.229358 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m01:36:36.254445 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:36:36.254635 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:36:36.256832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '22a12406-8c11-4795-a2cf-35e5b3d75690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61098e30>]}
[0m01:36:36.262777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '22a12406-8c11-4795-a2cf-35e5b3d75690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60c6b350>]}
[0m01:36:36.263026 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m01:36:36.263381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22a12406-8c11-4795-a2cf-35e5b3d75690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8221ec00>]}
[0m01:36:36.264121 [info ] [MainThread]: 
[0m01:36:36.264502 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:36:36.265039 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m01:36:36.270005 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m01:36:36.270155 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m01:36:36.270296 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:36:37.217128 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m01:36:37.219910 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m01:36:37.361542 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m01:36:37.369168 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:36:37.369510 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m01:36:37.369737 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:36:37.870906 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m01:36:37.876425 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m01:36:38.040681 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:36:38.046299 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:36:38.046903 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m01:36:38.047900 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:36:38.574489 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m01:36:38.576663 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m01:36:38.725107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22a12406-8c11-4795-a2cf-35e5b3d75690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82118d70>]}
[0m01:36:38.727088 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:36:38.729094 [info ] [MainThread]: 
[0m01:36:38.746951 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m01:36:38.747811 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m01:36:38.748141 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m01:36:38.756726 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m01:36:38.759321 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 01:36:38.748366 => 01:36:38.759145
[0m01:36:38.760109 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m01:36:38.760470 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m01:36:38.760999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m01:36:38.761229 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m01:36:38.763912 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m01:36:38.764941 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 01:36:38.761371 => 01:36:38.764827
[0m01:36:38.765431 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m01:36:38.765954 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m01:36:38.766339 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m01:36:38.767149 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m01:36:38.767352 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m01:36:38.795241 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m01:36:38.796861 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 01:36:38.767476 => 01:36:38.796711
[0m01:36:38.797093 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m01:36:38.809221 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m01:36:38.812190 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m01:36:38.812476 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m01:36:38.812841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:36:40.610194 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m01:36:40.634978 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 01:36:38.797226 => 01:36:40.634756
[0m01:36:40.635431 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m01:36:40.761445 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22a12406-8c11-4795-a2cf-35e5b3d75690', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff600e0b00>]}
[0m01:36:40.763147 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 1.99s]
[0m01:36:40.764904 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m01:36:40.767669 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:36:40.768171 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m01:36:40.768574 [info ] [MainThread]: 
[0m01:36:40.769371 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.50 seconds (4.50s).
[0m01:36:40.770354 [debug] [MainThread]: Command end result
[0m01:36:40.785840 [info ] [MainThread]: 
[0m01:36:40.786609 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:36:40.786973 [info ] [MainThread]: 
[0m01:36:40.787425 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:36:40.788732 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.9892015, "process_user_time": 2.466819, "process_kernel_time": 0.267305, "process_mem_max_rss": "213452", "process_out_blocks": "1864", "process_in_blocks": "0"}
[0m01:36:40.789293 [debug] [MainThread]: Command `dbt run` succeeded at 01:36:40.789174 after 4.99 seconds
[0m01:36:40.789740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82565a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62a6cb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8244b890>]}
[0m01:36:40.790105 [debug] [MainThread]: Flushing usage events
[0m01:36:43.539293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa02a95b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa063d1f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1e44c20>]}


============================== 01:36:43.542045 | 09c5cfa4-11b5-4e8f-96f4-381ddc527a88 ==============================
[0m01:36:43.542045 [info ] [MainThread]: Running with dbt=1.7.19
[0m01:36:43.542487 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:36:43.884922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '09c5cfa4-11b5-4e8f-96f4-381ddc527a88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b8eb470>]}
[0m01:36:43.913272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '09c5cfa4-11b5-4e8f-96f4-381ddc527a88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b13d3a0>]}
[0m01:36:43.913565 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m01:36:43.917012 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m01:36:43.931592 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:36:43.931764 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:36:43.933864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '09c5cfa4-11b5-4e8f-96f4-381ddc527a88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa018b680>]}
[0m01:36:43.938340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '09c5cfa4-11b5-4e8f-96f4-381ddc527a88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ad27770>]}
[0m01:36:43.938514 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m01:36:43.938801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09c5cfa4-11b5-4e8f-96f4-381ddc527a88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7af87f20>]}
[0m01:36:43.939491 [info ] [MainThread]: 
[0m01:36:43.939868 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:36:43.940451 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m01:36:43.946043 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:36:43.946197 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m01:36:43.946314 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:36:44.408332 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m01:36:44.410518 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m01:36:44.542737 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:36:44.547752 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:36:44.548560 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m01:36:44.548973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:36:45.006354 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m01:36:45.008980 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m01:36:45.573904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09c5cfa4-11b5-4e8f-96f4-381ddc527a88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7b13cfe0>]}
[0m01:36:45.575753 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:36:45.577053 [info ] [MainThread]: 
[0m01:36:45.593023 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:36:45.593607 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m01:36:45.594159 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m01:36:45.594459 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:36:45.606327 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:36:45.607422 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 01:36:45.594732 => 01:36:45.607311
[0m01:36:45.607669 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:36:45.617831 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:36:45.619330 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:36:45.619591 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m01:36:45.619836 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:36:46.207070 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:36:46.217118 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 01:36:45.607874 => 01:36:46.216357
[0m01:36:46.218495 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m01:36:46.362773 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.77s]
[0m01:36:46.365052 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:36:46.366159 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_coinid_date
[0m01:36:46.367037 [info ] [Thread-1 (]: 2 of 2 START test unique_coinid_date ........................................... [RUN]
[0m01:36:46.368696 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_coinid_date)
[0m01:36:46.369429 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_coinid_date
[0m01:36:46.379764 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_coinid_date"
[0m01:36:46.383868 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (compile): 01:36:46.369946 => 01:36:46.383558
[0m01:36:46.384413 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_coinid_date
[0m01:36:46.387050 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_coinid_date"
[0m01:36:46.388949 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_coinid_date"
[0m01:36:46.389471 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_coinid_date"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    coin_id,
    date,
    count(*) as cnt
from USER_DB_PEACOCK.analytics.fct_btc_indicators
group by 1,2
having count(*) > 1
      
    ) dbt_internal_test
[0m01:36:46.389919 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:36:47.062291 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:36:47.066895 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (execute): 01:36:46.384658 => 01:36:47.066471
[0m01:36:47.067842 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: Close
[0m01:36:47.284045 [info ] [Thread-1 (]: 2 of 2 PASS unique_coinid_date ................................................. [[32mPASS[0m in 0.92s]
[0m01:36:47.286107 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_coinid_date
[0m01:36:47.289207 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:36:47.289705 [debug] [MainThread]: Connection 'test.btc_elt.unique_coinid_date' was properly closed.
[0m01:36:47.290194 [info ] [MainThread]: 
[0m01:36:47.290955 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 3.35 seconds (3.35s).
[0m01:36:47.292036 [debug] [MainThread]: Command end result
[0m01:36:47.305153 [info ] [MainThread]: 
[0m01:36:47.305867 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:36:47.306135 [info ] [MainThread]: 
[0m01:36:47.306479 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m01:36:47.307729 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.7891417, "process_user_time": 2.353985, "process_kernel_time": 0.109417, "process_mem_max_rss": "212432", "process_out_blocks": "1789", "process_in_blocks": "0"}
[0m01:36:47.308222 [debug] [MainThread]: Command `dbt test` succeeded at 01:36:47.308128 after 3.79 seconds
[0m01:36:47.308578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa516aa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa08d3350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa02a8e00>]}
[0m01:36:47.308933 [debug] [MainThread]: Flushing usage events
[0m01:36:49.670008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97ca8b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9818f2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff980e9c70>]}


============================== 01:36:49.672740 | f7ea1495-1fb5-44e4-b83a-94829ad628c1 ==============================
[0m01:36:49.672740 [info ] [MainThread]: Running with dbt=1.7.19
[0m01:36:49.673180 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:36:50.033911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72b64b30>]}
[0m01:36:50.062744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72ce2150>]}
[0m01:36:50.063051 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m01:36:50.066218 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m01:36:50.083808 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:36:50.084032 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:36:50.086726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72a98ad0>]}
[0m01:36:50.095141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72917560>]}
[0m01:36:50.095401 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m01:36:50.095736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72d45b20>]}
[0m01:36:50.096530 [info ] [MainThread]: 
[0m01:36:50.096994 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:36:50.097537 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m01:36:50.102869 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m01:36:50.103040 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m01:36:50.103183 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:36:50.644267 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m01:36:50.647149 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m01:36:50.826769 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m01:36:50.839001 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:36:50.839578 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m01:36:50.840013 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:36:51.261968 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m01:36:51.265105 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m01:36:51.427367 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:36:51.431769 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:36:51.432558 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m01:36:51.434040 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:36:51.836339 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m01:36:51.840998 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m01:36:52.680012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98163770>]}
[0m01:36:52.682521 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:36:52.685826 [info ] [MainThread]: 
[0m01:36:52.699561 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m01:36:52.700416 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m01:36:52.701486 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m01:36:52.702020 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m01:36:52.710770 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 01:36:52.702338 => 01:36:52.710541
[0m01:36:52.711092 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m01:36:52.742318 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:52.742544 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m01:36:52.742764 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:36:53.410780 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m01:36:53.423098 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:53.423945 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:36:53.559560 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:36:53.563632 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:53.563954 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:36:53.706319 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:36:53.720858 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:53.721235 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m01:36:55.697794 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m01:36:55.703774 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:55.704493 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m01:36:55.824850 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m01:36:55.831258 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:55.831978 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:36:55.919812 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:36:55.926435 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:55.927174 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m01:36:56.020512 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m01:36:56.027170 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:56.027892 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:36:56.176786 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:36:56.187607 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:56.188260 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m01:36:56.574148 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m01:36:56.580751 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m01:36:56.583023 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:56.583334 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m01:36:56.724602 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:36:56.725672 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:56.726292 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m01:36:57.918998 [debug] [Thread-1 (]: SQL status: SUCCESS 102 in 1.0 seconds
[0m01:36:57.920775 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:36:57.921484 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m01:36:58.323516 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:36:58.350705 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 01:36:52.711278 => 01:36:58.350381
[0m01:36:58.351411 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m01:36:58.508931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71dbae40>]}
[0m01:36:58.511087 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 102[0m in 5.81s]
[0m01:36:58.514825 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m01:36:58.515591 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m01:36:58.516585 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m01:36:58.518149 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m01:36:58.518754 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m01:36:58.525892 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 01:36:58.519081 => 01:36:58.525652
[0m01:36:58.526331 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m01:36:58.530292 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:36:58.530676 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m01:36:58.531034 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:36:59.966927 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m01:36:59.973197 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:36:59.974004 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:37:00.262083 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:37:00.266255 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:00.266586 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:37:00.368460 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:37:00.380814 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:00.382041 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m01:37:01.603201 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:37:01.608599 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:01.609395 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m01:37:01.695077 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m01:37:01.701554 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:01.702273 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:37:01.833991 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:37:01.841193 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:01.842424 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m01:37:01.962339 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m01:37:01.968896 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:01.969606 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:37:02.133357 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:37:02.140361 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:02.141048 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m01:37:02.254198 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m01:37:02.258959 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:02.262024 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:02.262540 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m01:37:02.417815 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:37:02.419035 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:02.419850 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m01:37:03.141313 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m01:37:03.142801 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:37:03.143412 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m01:37:03.547894 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:37:03.552973 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 01:36:58.526626 => 01:37:03.552659
[0m01:37:03.553650 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m01:37:03.745949 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7ea1495-1fb5-44e4-b83a-94829ad628c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff727a9700>]}
[0m01:37:03.747850 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 5.23s]
[0m01:37:03.749874 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m01:37:03.754458 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:37:03.755081 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m01:37:03.755719 [info ] [MainThread]: 
[0m01:37:03.756415 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 13.66 seconds (13.66s).
[0m01:37:03.757998 [debug] [MainThread]: Command end result
[0m01:37:03.785693 [info ] [MainThread]: 
[0m01:37:03.786708 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:37:03.787030 [info ] [MainThread]: 
[0m01:37:03.787504 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m01:37:03.793150 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 14.142909, "process_user_time": 2.759584, "process_kernel_time": 0.172663, "process_mem_max_rss": "214600", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m01:37:03.793960 [debug] [MainThread]: Command `dbt snapshot` succeeded at 01:37:03.793879 after 14.14 seconds
[0m01:37:03.794538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9818f2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72b3ffb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97da2fc0>]}
[0m01:37:03.794834 [debug] [MainThread]: Flushing usage events
[0m01:42:46.346649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81c43830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81c40cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81c95c40>]}


============================== 01:42:46.349567 | 117c7eea-6176-4eae-bddf-76f27c9f315c ==============================
[0m01:42:46.349567 [info ] [MainThread]: Running with dbt=1.7.19
[0m01:42:46.349997 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m01:42:46.685573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '117c7eea-6176-4eae-bddf-76f27c9f315c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81c43a10>]}
[0m01:42:46.713909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '117c7eea-6176-4eae-bddf-76f27c9f315c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60cd3800>]}
[0m01:42:46.714200 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m01:42:46.718663 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m01:42:46.733539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:42:46.733722 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:42:46.735794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '117c7eea-6176-4eae-bddf-76f27c9f315c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff609ff5c0>]}
[0m01:42:46.741536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '117c7eea-6176-4eae-bddf-76f27c9f315c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff607df620>]}
[0m01:42:46.741719 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m01:42:46.741996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '117c7eea-6176-4eae-bddf-76f27c9f315c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81c314c0>]}
[0m01:42:46.742698 [info ] [MainThread]: 
[0m01:42:46.743068 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:42:46.743563 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m01:42:46.748414 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m01:42:46.748568 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m01:42:46.748686 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:42:47.385767 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m01:42:47.387400 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m01:42:47.849307 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m01:42:47.854129 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:42:47.854344 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m01:42:47.854513 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:42:48.455747 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m01:42:48.461137 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m01:42:48.578315 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m01:42:48.584459 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:42:48.584978 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m01:42:48.585308 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:42:49.020322 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m01:42:49.024102 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m01:42:49.186597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '117c7eea-6176-4eae-bddf-76f27c9f315c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff607389e0>]}
[0m01:42:49.187180 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:42:49.188478 [info ] [MainThread]: 
[0m01:42:49.193554 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m01:42:49.193937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now model.btc_elt.stg_btc_market)
[0m01:42:49.194104 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m01:42:49.198761 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m01:42:49.200148 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 01:42:49.194205 => 01:42:49.200002
[0m01:42:49.200696 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m01:42:49.200947 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m01:42:49.202391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m01:42:49.202554 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m01:42:49.204226 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m01:42:49.204747 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 01:42:49.202655 => 01:42:49.204665
[0m01:42:49.205088 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m01:42:49.205509 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m01:42:49.205720 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m01:42:49.206319 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m01:42:49.206489 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m01:42:49.228634 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m01:42:49.229569 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 01:42:49.206586 => 01:42:49.229458
[0m01:42:49.229736 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m01:42:49.240065 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m01:42:49.242770 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m01:42:49.243094 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m01:42:49.243441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:42:51.824370 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m01:42:51.858739 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 01:42:49.229844 => 01:42:51.858435
[0m01:42:51.859535 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m01:42:51.994936 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '117c7eea-6176-4eae-bddf-76f27c9f315c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60758a40>]}
[0m01:42:51.996440 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 2.79s]
[0m01:42:52.000226 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m01:42:52.003828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:42:52.004336 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m01:42:52.004908 [info ] [MainThread]: 
[0m01:42:52.005753 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.26 seconds (5.26s).
[0m01:42:52.006610 [debug] [MainThread]: Command end result
[0m01:42:52.022271 [info ] [MainThread]: 
[0m01:42:52.023045 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:42:52.023358 [info ] [MainThread]: 
[0m01:42:52.023856 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:42:52.025634 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.7021523, "process_user_time": 2.368901, "process_kernel_time": 0.124309, "process_mem_max_rss": "213052", "process_out_blocks": "1864", "process_in_blocks": "0"}
[0m01:42:52.026198 [debug] [MainThread]: Command `dbt run` succeeded at 01:42:52.026116 after 5.70 seconds
[0m01:42:52.026576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81d5d3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60758a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff62383e00>]}
[0m01:42:52.026886 [debug] [MainThread]: Flushing usage events
[0m01:42:54.509271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1048230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1532180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa10482c0>]}


============================== 01:42:54.512216 | a5d2c911-f56c-426b-ba43-7cc3291e6f27 ==============================
[0m01:42:54.512216 [info ] [MainThread]: Running with dbt=1.7.19
[0m01:42:54.512947 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:42:54.869494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a5d2c911-f56c-426b-ba43-7cc3291e6f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80c4f620>]}
[0m01:42:54.898949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a5d2c911-f56c-426b-ba43-7cc3291e6f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7be44c80>]}
[0m01:42:54.899273 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m01:42:54.902477 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m01:42:54.917562 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:42:54.917850 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:42:54.920333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a5d2c911-f56c-426b-ba43-7cc3291e6f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bc6f7d0>]}
[0m01:42:54.925435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a5d2c911-f56c-426b-ba43-7cc3291e6f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bb87950>]}
[0m01:42:54.925651 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m01:42:54.926002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a5d2c911-f56c-426b-ba43-7cc3291e6f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bcb3ec0>]}
[0m01:42:54.926750 [info ] [MainThread]: 
[0m01:42:54.927172 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:42:54.927772 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_analytics'
[0m01:42:54.933672 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:42:54.933839 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m01:42:54.933979 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:42:55.486560 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m01:42:55.490079 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m01:42:55.610670 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m01:42:55.616394 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:42:55.616989 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m01:42:55.617522 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:42:56.024895 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m01:42:56.028270 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m01:42:56.159239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a5d2c911-f56c-426b-ba43-7cc3291e6f27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80cf6540>]}
[0m01:42:56.160823 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:42:56.162187 [info ] [MainThread]: 
[0m01:42:56.173564 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:42:56.174099 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m01:42:56.175255 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m01:42:56.175608 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:42:56.188228 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:42:56.190564 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 01:42:56.175874 => 01:42:56.190389
[0m01:42:56.190870 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:42:56.203554 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:42:56.205182 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m01:42:56.205613 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m01:42:56.205843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:42:56.770040 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:42:56.780418 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 01:42:56.191052 => 01:42:56.780107
[0m01:42:56.781055 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m01:42:56.922883 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.75s]
[0m01:42:56.924355 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m01:42:56.924973 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_coinid_date
[0m01:42:56.925563 [info ] [Thread-1 (]: 2 of 2 START test unique_coinid_date ........................................... [RUN]
[0m01:42:56.926651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_coinid_date)
[0m01:42:56.927030 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_coinid_date
[0m01:42:56.930290 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_coinid_date"
[0m01:42:56.931728 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (compile): 01:42:56.927286 => 01:42:56.931573
[0m01:42:56.932069 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_coinid_date
[0m01:42:56.934726 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_coinid_date"
[0m01:42:56.936298 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_coinid_date"
[0m01:42:56.936651 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_coinid_date"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    coin_id,
    date,
    count(*) as cnt
from USER_DB_PEACOCK.analytics.fct_btc_indicators
group by 1,2
having count(*) > 1
      
    ) dbt_internal_test
[0m01:42:56.936972 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:42:57.412067 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:42:57.415174 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (execute): 01:42:56.932271 => 01:42:57.414812
[0m01:42:57.415797 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: Close
[0m01:42:57.544331 [info ] [Thread-1 (]: 2 of 2 PASS unique_coinid_date ................................................. [[32mPASS[0m in 0.62s]
[0m01:42:57.545331 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_coinid_date
[0m01:42:57.549221 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:42:57.550190 [debug] [MainThread]: Connection 'test.btc_elt.unique_coinid_date' was properly closed.
[0m01:42:57.550863 [info ] [MainThread]: 
[0m01:42:57.552622 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 2.62 seconds (2.62s).
[0m01:42:57.554676 [debug] [MainThread]: Command end result
[0m01:42:57.586769 [info ] [MainThread]: 
[0m01:42:57.589133 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:42:57.591370 [info ] [MainThread]: 
[0m01:42:57.592903 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m01:42:57.595357 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.107355, "process_user_time": 2.369864, "process_kernel_time": 0.206685, "process_mem_max_rss": "212420", "process_out_blocks": "1789", "process_in_blocks": "0"}
[0m01:42:57.596797 [debug] [MainThread]: Command `dbt test` succeeded at 01:42:57.596650 after 3.11 seconds
[0m01:42:57.597408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa149af00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bad3e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1532180>]}
[0m01:42:57.597997 [debug] [MainThread]: Flushing usage events
[0m01:42:59.584817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabf30cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabf6e390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac02dbe0>]}


============================== 01:42:59.587558 | 95e4efae-f8ab-47a7-8e1c-27b0046d6109 ==============================
[0m01:42:59.587558 [info ] [MainThread]: Running with dbt=1.7.19
[0m01:42:59.588190 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:42:59.963510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabf30680>]}
[0m01:42:59.993854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87088c20>]}
[0m01:42:59.994187 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m01:42:59.997533 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m01:43:00.009710 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:43:00.009884 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:43:00.012162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabdc1010>]}
[0m01:43:00.017602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86b276b0>]}
[0m01:43:00.017824 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m01:43:00.018192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86b274d0>]}
[0m01:43:00.019128 [info ] [MainThread]: 
[0m01:43:00.019538 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:43:00.020114 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m01:43:00.025354 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m01:43:00.025526 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m01:43:00.025683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:43:00.508004 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m01:43:00.509559 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m01:43:00.700046 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m01:43:00.704123 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m01:43:00.704345 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m01:43:00.704515 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:43:01.097743 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m01:43:01.101085 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m01:43:01.219188 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m01:43:01.223411 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m01:43:01.224009 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m01:43:01.224858 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:43:01.604268 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.0 seconds
[0m01:43:01.608046 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m01:43:01.766800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8744e0c0>]}
[0m01:43:01.768560 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:43:01.770863 [info ] [MainThread]: 
[0m01:43:01.783896 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m01:43:01.784751 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m01:43:01.785965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now snapshot.btc_elt.snap_btc_market)
[0m01:43:01.786401 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m01:43:01.794416 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 01:43:01.786695 => 01:43:01.794238
[0m01:43:01.794727 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m01:43:01.827172 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:01.827420 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m01:43:01.827634 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:43:02.292982 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.0 seconds
[0m01:43:02.305691 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:02.306764 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:43:02.467404 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:43:02.478522 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:02.479870 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:43:02.601229 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:43:02.629548 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:02.630212 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m01:43:03.802145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:43:03.809635 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:03.810677 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m01:43:03.897573 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m01:43:03.899486 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:03.899682 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:43:04.053137 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:43:04.055124 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:04.055360 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m01:43:04.147061 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m01:43:04.149077 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:04.149289 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m01:43:04.275428 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m01:43:04.281233 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:04.281564 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m01:43:04.414551 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m01:43:04.418990 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m01:43:04.420420 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:04.420603 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m01:43:04.555761 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:43:04.556091 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:04.556270 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m01:43:05.539866 [debug] [Thread-1 (]: SQL status: SUCCESS 96 in 1.0 seconds
[0m01:43:05.540375 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m01:43:05.540563 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m01:43:05.948198 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:43:05.962631 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 01:43:01.794933 => 01:43:05.961968
[0m01:43:05.963268 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m01:43:06.242721 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85fece30>]}
[0m01:43:06.244747 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 96[0m in 4.46s]
[0m01:43:06.249807 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m01:43:06.251363 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m01:43:06.252543 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m01:43:06.253439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m01:43:06.253717 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m01:43:06.256963 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 01:43:06.253881 => 01:43:06.256799
[0m01:43:06.257278 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m01:43:06.261063 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:06.261569 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m01:43:06.261810 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:43:06.781909 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m01:43:06.787779 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:06.789206 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:43:06.874329 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:43:06.880926 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:06.881663 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:43:06.970064 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:43:06.984699 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:06.985342 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m01:43:08.407369 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:43:08.413303 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:08.414194 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m01:43:08.527383 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m01:43:08.532584 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:08.533326 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:43:08.622619 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:43:08.626403 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:08.626900 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m01:43:08.715255 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m01:43:08.720861 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:08.721452 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m01:43:09.125029 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m01:43:09.135212 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:09.136596 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m01:43:09.248383 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m01:43:09.253040 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:09.255694 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:09.256229 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m01:43:09.404088 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m01:43:09.404624 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:09.404933 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m01:43:10.148412 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m01:43:10.149127 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m01:43:10.149531 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m01:43:10.662420 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m01:43:10.668634 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 01:43:06.257486 => 01:43:10.668326
[0m01:43:10.669272 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m01:43:10.818185 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '95e4efae-f8ab-47a7-8e1c-27b0046d6109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85f760f0>]}
[0m01:43:10.819983 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 4.56s]
[0m01:43:10.822465 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m01:43:10.827177 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:43:10.827737 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m01:43:10.828200 [info ] [MainThread]: 
[0m01:43:10.829019 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 10.81 seconds (10.81s).
[0m01:43:10.830470 [debug] [MainThread]: Command end result
[0m01:43:10.847985 [info ] [MainThread]: 
[0m01:43:10.848722 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:43:10.849007 [info ] [MainThread]: 
[0m01:43:10.849313 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m01:43:10.852474 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.289429, "process_user_time": 2.673827, "process_kernel_time": 0.16305, "process_mem_max_rss": "213968", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m01:43:10.853644 [debug] [MainThread]: Command `dbt snapshot` succeeded at 01:43:10.853500 after 11.29 seconds
[0m01:43:10.854828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabf6e390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86c3ea80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8698f0e0>]}
[0m01:43:10.855228 [debug] [MainThread]: Flushing usage events
[0m02:01:29.908018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8948f4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8989e000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89aae4b0>]}


============================== 02:01:29.911223 | d5e4ab33-9c6d-43d0-b87b-241c82876dc1 ==============================
[0m02:01:29.911223 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:29.911614 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:01:30.291964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5e4ab33-9c6d-43d0-b87b-241c82876dc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff689e1f40>]}
[0m02:01:30.322536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5e4ab33-9c6d-43d0-b87b-241c82876dc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff686eef00>]}
[0m02:01:30.322868 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:30.326574 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:30.340743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:30.340916 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:30.343094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5e4ab33-9c6d-43d0-b87b-241c82876dc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68180f50>]}
[0m02:01:30.348934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5e4ab33-9c6d-43d0-b87b-241c82876dc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff63f3b6e0>]}
[0m02:01:30.349156 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:30.349369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5e4ab33-9c6d-43d0-b87b-241c82876dc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68280080>]}
[0m02:01:30.350125 [info ] [MainThread]: 
[0m02:01:30.350497 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:30.351043 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m02:01:30.356251 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m02:01:30.356411 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m02:01:30.356548 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:30.892311 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m02:01:30.894116 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m02:01:31.529927 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_snapshot)
[0m02:01:31.541052 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:01:31.541891 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:01:31.542458 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:31.979644 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:01:31.980557 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:01:32.128961 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m02:01:32.130797 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:01:32.131026 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:01:32.131450 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:32.707658 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m02:01:32.711028 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:01:33.238119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5e4ab33-9c6d-43d0-b87b-241c82876dc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86170c50>]}
[0m02:01:33.238650 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:33.239176 [info ] [MainThread]: 
[0m02:01:33.243516 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_market
[0m02:01:33.243864 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now model.btc_elt.stg_btc_market)
[0m02:01:33.244038 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_market
[0m02:01:33.248708 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_market"
[0m02:01:33.250074 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_market (compile): 02:01:33.244161 => 02:01:33.249984
[0m02:01:33.250480 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_market
[0m02:01:33.250651 [debug] [Thread-1 (]: Began running node model.btc_elt.stg_btc_ohlc
[0m02:01:33.250934 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_market, now model.btc_elt.stg_btc_ohlc)
[0m02:01:33.251091 [debug] [Thread-1 (]: Began compiling node model.btc_elt.stg_btc_ohlc
[0m02:01:33.252658 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.stg_btc_ohlc"
[0m02:01:33.253259 [debug] [Thread-1 (]: Timing info for model.btc_elt.stg_btc_ohlc (compile): 02:01:33.251198 => 02:01:33.253178
[0m02:01:33.253622 [debug] [Thread-1 (]: Finished running node model.btc_elt.stg_btc_ohlc
[0m02:01:33.254020 [debug] [Thread-1 (]: Began running node model.btc_elt.fct_btc_indicators
[0m02:01:33.254254 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.fct_btc_indicators ...................... [RUN]
[0m02:01:33.254844 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.btc_elt.stg_btc_ohlc, now model.btc_elt.fct_btc_indicators)
[0m02:01:33.254988 [debug] [Thread-1 (]: Began compiling node model.btc_elt.fct_btc_indicators
[0m02:01:33.278233 [debug] [Thread-1 (]: Writing injected SQL for node "model.btc_elt.fct_btc_indicators"
[0m02:01:33.279386 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (compile): 02:01:33.255083 => 02:01:33.279290
[0m02:01:33.279561 [debug] [Thread-1 (]: Began executing node model.btc_elt.fct_btc_indicators
[0m02:01:33.290797 [debug] [Thread-1 (]: Writing runtime sql for node "model.btc_elt.fct_btc_indicators"
[0m02:01:33.293701 [debug] [Thread-1 (]: Using snowflake connection "model.btc_elt.fct_btc_indicators"
[0m02:01:33.294005 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "model.btc_elt.fct_btc_indicators"} */
create or replace transient table USER_DB_PEACOCK.analytics.fct_btc_indicators
         as
        (-- models/output/fct_btc_indicators.sql
-- Goal: BI-ready table for market behavior, volatility, and price trends.
-- Now supports multi-coin by carrying coin_id through all steps.

WITH  __dbt__cte__stg_btc_market as (
-- models/input/stg_btc_market.sql
-- Staging for daily market data (multi-coin by default)
-- If coin_id var = 'ALL', keep all coins (recommended default)
-- If coin_id is passed (e.g., 'bitcoin'), filter accordingly.



SELECT
    timestamp,
    price,
    market_cap,
    volume,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_market_daily

),  __dbt__cte__stg_btc_ohlc as (
-- models/input/stg_btc_ohlc.sql
-- Multi-coin OHLC staging (default: ALL COINS)
-- If user passes coin_id var, we filter, otherwise return all



SELECT
    timestamp,
    open,
    high,
    low,
    close,
    coin_id,
    date
FROM USER_DB_PEACOCK.raw.coin_gecko_ohlc

), market_data AS (
    -- Staging: daily trend inputs (may contain multiple rows per calendar date and coin)
    SELECT * FROM __dbt__cte__stg_btc_market
),
market_ranked AS (
    -- Rank rows per (coin_id, date) so we can take the LAST (latest timestamp) for that date+coin
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_last
    FROM market_data
),
market_daily AS (
    -- Exactly one row per coin_id, per date from market:
    -- take the row with latest timestamp (rn_last = 1)
    SELECT
        coin_id,
        date,
        timestamp,
        price,
        market_cap,
        volume
    FROM market_ranked
    WHERE rn_last = 1
),
ohlc_data AS (
    -- Staging: candlestick inputs (may contain multiple rows per date and coin)
    SELECT * FROM __dbt__cte__stg_btc_ohlc
),
ohlc_ranked AS (
    -- Rank rows per (coin_id, date) so we can pick the first (open) and last (close)
    SELECT
        coin_id,
        date,
        timestamp,
        open,
        high,
        low,
        close,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp ASC
        )  AS rn_open,
        ROW_NUMBER() OVER (
            PARTITION BY coin_id, date
            ORDER BY timestamp DESC
        ) AS rn_close
    FROM ohlc_data
),
ohlc_daily AS (
    -- One row per coin_id, per date from OHLC:
    --   open  = earliest ts, close = latest ts, high = max, low = min
    SELECT
        d.coin_id,
        d.date,
        MIN(d.low)  AS low_price,
        MAX(d.high) AS high_price,
        MAX(CASE WHEN d.rn_open  = 1 THEN d.open  END) AS open_price,
        MAX(CASE WHEN d.rn_close = 1 THEN d.close END) AS close_price
    FROM ohlc_ranked d
    GROUP BY d.coin_id, d.date
),
joined_data AS (
    -- Join de-duplicated market + OHLC on (coin_id, date)
    -- → keep only dates present in BOTH (clean BI)
    SELECT
        m.coin_id,
        m.date         AS trading_date,
        m.price,
        m.market_cap,
        m.volume,
        o.open_price,
        o.high_price,
        o.low_price,
        o.close_price
    FROM market_daily m
    INNER JOIN ohlc_daily o
      ON  m.coin_id = o.coin_id
      AND m.date    = o.date
),
moving_averages AS (
    -- Price trends: short & medium moving averages (7d and 30d)
    SELECT
        *,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS avg_price_7d,
        AVG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
        ) AS avg_price_30d
    FROM joined_data
),
rsi_and_deltas AS (
    -- Prepare RSI + momentum inputs: yesterday’s price and simple daily return
    SELECT
        *,
        LAG(price) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS previous_price,
        CASE
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) IS NULL THEN NULL
            WHEN LAG(price) OVER (
                     PARTITION BY coin_id
                     ORDER BY trading_date
                 ) = 0     THEN NULL
            ELSE (price - LAG(price) OVER (
                               PARTITION BY coin_id
                               ORDER BY trading_date
                           ))
                 /  LAG(price) OVER (
                        PARTITION BY coin_id
                        ORDER BY trading_date
                    )
        END AS daily_return_pct
    FROM moving_averages
),
gains_losses AS (
    -- Split daily price change into gain/loss (non-negative) for RSI math
    SELECT
        *,
        CASE WHEN price > previous_price THEN price - previous_price ELSE 0 END AS gain,
        CASE WHEN price < previous_price THEN previous_price - price ELSE 0 END AS loss
    FROM rsi_and_deltas
),
rsi_window AS (
    -- RSI(14): rolling averages of gains and losses over last 14 days, per coin
    SELECT
        coin_id,
        trading_date,
        price,
        market_cap,
        volume,
        open_price,
        high_price,
        low_price,
        close_price,
        avg_price_7d,
        avg_price_30d,
        daily_return_pct,
        AVG(gain) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_gain_14,
        AVG(loss) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
            ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
        ) AS avg_loss_14
    FROM gains_losses
),
momentum_window AS (
    -- Price momentum signals: 7-day level & percent changes
    SELECT
        *,
        LAG(price, 7) OVER (
            PARTITION BY coin_id
            ORDER BY trading_date
        ) AS price_7d_ago
    FROM rsi_window
),
final_output AS (
    -- Final indicators:
    -- - avg_price_7d / avg_price_30d: price trends
    -- - rsi_strength_14d: strength vs weakness (RSI)
    -- - intraday_range_pct: simple daily volatility proxy
    -- - price_momentum_7d / price_return_7d_pct: momentum views
    SELECT
        coin_id,
        trading_date                                            AS date,
        price,
        market_cap,
        volume,
        open_price                                              AS open,
        high_price                                              AS high,
        low_price                                               AS low,
        close_price                                             AS close,
        avg_price_7d,
        avg_price_30d,
        CASE
            WHEN NULLIF(avg_loss_14, 0) IS NULL THEN NULL
            ELSE 100 - (100 / (1 + (avg_gain_14 / NULLIF(avg_loss_14, 0))))
        END                                                     AS rsi_strength_14d,
        CASE
            WHEN open_price IS NOT NULL AND open_price <> 0
                 THEN (high_price - low_price) / open_price
            ELSE NULL
        END                                                     AS intraday_range_pct,
        CASE
            WHEN price_7d_ago IS NULL THEN NULL
            ELSE price - price_7d_ago
        END                                                     AS price_momentum_7d,
        CASE
            WHEN price_7d_ago IS NULL OR price_7d_ago = 0 THEN NULL
            ELSE (price / price_7d_ago) - 1
        END                                                     AS price_return_7d_pct
    FROM momentum_window
)

SELECT *
FROM final_output
ORDER BY coin_id, date
        );
[0m02:01:33.294320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:36.342770 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m02:01:36.361456 [debug] [Thread-1 (]: Timing info for model.btc_elt.fct_btc_indicators (execute): 02:01:33.279668 => 02:01:36.361350
[0m02:01:36.361726 [debug] [Thread-1 (]: On model.btc_elt.fct_btc_indicators: Close
[0m02:01:37.277999 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5e4ab33-9c6d-43d0-b87b-241c82876dc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6330ef30>]}
[0m02:01:37.278956 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.fct_btc_indicators ................. [[32mSUCCESS 1[0m in 4.02s]
[0m02:01:37.280095 [debug] [Thread-1 (]: Finished running node model.btc_elt.fct_btc_indicators
[0m02:01:37.282049 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:37.282501 [debug] [MainThread]: Connection 'model.btc_elt.fct_btc_indicators' was properly closed.
[0m02:01:37.282919 [info ] [MainThread]: 
[0m02:01:37.283548 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.93 seconds (6.93s).
[0m02:01:37.284250 [debug] [MainThread]: Command end result
[0m02:01:37.294295 [info ] [MainThread]: 
[0m02:01:37.294660 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:37.294862 [info ] [MainThread]: 
[0m02:01:37.295111 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m02:01:37.295602 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.4130964, "process_user_time": 2.483059, "process_kernel_time": 0.156589, "process_mem_max_rss": "213488", "process_out_blocks": "1864", "process_in_blocks": "0"}
[0m02:01:37.295827 [debug] [MainThread]: Command `dbt run` succeeded at 02:01:37.295779 after 7.41 seconds
[0m02:01:37.296004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8989e000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff894eb110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68b9b680>]}
[0m02:01:37.296182 [debug] [MainThread]: Flushing usage events
[0m02:01:40.112814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80e8c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80f92180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81990b30>]}


============================== 02:01:40.115609 | 652a31c4-d9cf-436e-a3a3-e70f8268cbbe ==============================
[0m02:01:40.115609 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:40.115891 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:01:40.496084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '652a31c4-d9cf-436e-a3a3-e70f8268cbbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65f39ac0>]}
[0m02:01:40.527301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '652a31c4-d9cf-436e-a3a3-e70f8268cbbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5babac90>]}
[0m02:01:40.527634 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:40.530935 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:40.544005 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:40.544171 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:40.546304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '652a31c4-d9cf-436e-a3a3-e70f8268cbbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bc64b0>]}
[0m02:01:40.551149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '652a31c4-d9cf-436e-a3a3-e70f8268cbbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b99bcb0>]}
[0m02:01:40.551339 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:40.551518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '652a31c4-d9cf-436e-a3a3-e70f8268cbbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bc58da0>]}
[0m02:01:40.552325 [info ] [MainThread]: 
[0m02:01:40.552675 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:40.553275 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK_snapshot'
[0m02:01:40.558735 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:01:40.558891 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:01:40.559018 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:41.078678 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.0 seconds
[0m02:01:41.081887 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:01:41.258003 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now list_USER_DB_PEACOCK_analytics)
[0m02:01:41.260928 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:01:41.261267 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:01:41.261565 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:41.830819 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m02:01:41.833748 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:01:42.112784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '652a31c4-d9cf-436e-a3a3-e70f8268cbbe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65f3bc50>]}
[0m02:01:42.114370 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:42.114998 [info ] [MainThread]: 
[0m02:01:42.127827 [debug] [Thread-1 (]: Began running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:42.128606 [info ] [Thread-1 (]: 1 of 2 START test not_null_fct_btc_indicators_date ............................. [RUN]
[0m02:01:42.129578 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2)
[0m02:01:42.130061 [debug] [Thread-1 (]: Began compiling node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:42.144416 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:42.146629 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (compile): 02:01:42.130367 => 02:01:42.146465
[0m02:01:42.146905 [debug] [Thread-1 (]: Began executing node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:42.158988 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:42.160151 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"
[0m02:01:42.160372 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_PEACOCK.analytics.fct_btc_indicators
where date is null



      
    ) dbt_internal_test
[0m02:01:42.160576 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:42.677630 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:42.689344 [debug] [Thread-1 (]: Timing info for test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2 (execute): 02:01:42.147080 => 02:01:42.688579
[0m02:01:42.690639 [debug] [Thread-1 (]: On test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2: Close
[0m02:01:42.836668 [info ] [Thread-1 (]: 1 of 2 PASS not_null_fct_btc_indicators_date ................................... [[32mPASS[0m in 0.71s]
[0m02:01:42.837202 [debug] [Thread-1 (]: Finished running node test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2
[0m02:01:42.837460 [debug] [Thread-1 (]: Began running node test.btc_elt.unique_coinid_date
[0m02:01:42.837709 [info ] [Thread-1 (]: 2 of 2 START test unique_coinid_date ........................................... [RUN]
[0m02:01:42.838118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.btc_elt.not_null_fct_btc_indicators_date.31d24da9c2, now test.btc_elt.unique_coinid_date)
[0m02:01:42.838379 [debug] [Thread-1 (]: Began compiling node test.btc_elt.unique_coinid_date
[0m02:01:42.840001 [debug] [Thread-1 (]: Writing injected SQL for node "test.btc_elt.unique_coinid_date"
[0m02:01:42.840999 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (compile): 02:01:42.838508 => 02:01:42.840888
[0m02:01:42.841204 [debug] [Thread-1 (]: Began executing node test.btc_elt.unique_coinid_date
[0m02:01:42.842906 [debug] [Thread-1 (]: Writing runtime sql for node "test.btc_elt.unique_coinid_date"
[0m02:01:42.843962 [debug] [Thread-1 (]: Using snowflake connection "test.btc_elt.unique_coinid_date"
[0m02:01:42.844288 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "test.btc_elt.unique_coinid_date"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      select
    coin_id,
    date,
    count(*) as cnt
from USER_DB_PEACOCK.analytics.fct_btc_indicators
group by 1,2
having count(*) > 1
      
    ) dbt_internal_test
[0m02:01:42.844604 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:43.237021 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:43.240935 [debug] [Thread-1 (]: Timing info for test.btc_elt.unique_coinid_date (execute): 02:01:42.841403 => 02:01:43.240598
[0m02:01:43.241578 [debug] [Thread-1 (]: On test.btc_elt.unique_coinid_date: Close
[0m02:01:43.379439 [info ] [Thread-1 (]: 2 of 2 PASS unique_coinid_date ................................................. [[32mPASS[0m in 0.54s]
[0m02:01:43.380718 [debug] [Thread-1 (]: Finished running node test.btc_elt.unique_coinid_date
[0m02:01:43.383711 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:01:43.384249 [debug] [MainThread]: Connection 'test.btc_elt.unique_coinid_date' was properly closed.
[0m02:01:43.384743 [info ] [MainThread]: 
[0m02:01:43.385214 [info ] [MainThread]: Finished running 2 tests in 0 hours 0 minutes and 2.83 seconds (2.83s).
[0m02:01:43.386238 [debug] [MainThread]: Command end result
[0m02:01:43.399340 [info ] [MainThread]: 
[0m02:01:43.399866 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:01:43.400253 [info ] [MainThread]: 
[0m02:01:43.400634 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m02:01:43.401972 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.3095267, "process_user_time": 2.509652, "process_kernel_time": 0.168792, "process_mem_max_rss": "212344", "process_out_blocks": "1789", "process_in_blocks": "0"}
[0m02:01:43.402518 [debug] [MainThread]: Command `dbt test` succeeded at 02:01:43.402365 after 3.31 seconds
[0m02:01:43.402934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ec6a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80f92180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5bb55640>]}
[0m02:01:43.403293 [debug] [MainThread]: Flushing usage events
[0m02:01:45.594070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f7de510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f81e1e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f7dc590>]}


============================== 02:01:45.596722 | ba57294f-358a-4148-94a4-f36933f7f9a3 ==============================
[0m02:01:45.596722 [info ] [MainThread]: Running with dbt=1.7.19
[0m02:01:45.597223 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/btc_elt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt/btc_elt', 'send_anonymous_usage_stats': 'True'}
[0m02:01:45.960648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a67b8f0>]}
[0m02:01:45.990716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7be64b60>]}
[0m02:01:45.991064 [info ] [MainThread]: Registered adapter: snowflake=1.7.0
[0m02:01:45.994263 [debug] [MainThread]: checksum: a8d43cdff37d0f32d7fbe4c5c25bea4bb6c86e162f8ce8fdb1a38cdcf7495431, vars: {}, profile: , target: , version: 1.7.19
[0m02:01:46.006793 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:01:46.006978 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:01:46.009331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a3b8f20>]}
[0m02:01:46.014843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a403500>]}
[0m02:01:46.015038 [info ] [MainThread]: Found 3 models, 2 snapshots, 2 tests, 3 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m02:01:46.015397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a7cd9a0>]}
[0m02:01:46.016173 [info ] [MainThread]: 
[0m02:01:46.016581 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:01:46.017119 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_PEACOCK'
[0m02:01:46.022127 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK"
[0m02:01:46.022305 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK"} */
show terse schemas in database USER_DB_PEACOCK
    limit 10000
[0m02:01:46.022452 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:01:46.646086 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m02:01:46.649888 [debug] [ThreadPool]: On list_USER_DB_PEACOCK: Close
[0m02:01:46.800758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK, now list_USER_DB_PEACOCK_analytics)
[0m02:01:46.808025 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_analytics"
[0m02:01:46.808361 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_analytics"} */
show terse objects in USER_DB_PEACOCK.analytics limit 10000
[0m02:01:46.808659 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:47.733101 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.0 seconds
[0m02:01:47.735164 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_analytics: Close
[0m02:01:47.883619 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_analytics, now list_USER_DB_PEACOCK_snapshot)
[0m02:01:47.887866 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_PEACOCK_snapshot"
[0m02:01:47.888305 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "connection_name": "list_USER_DB_PEACOCK_snapshot"} */
show terse objects in USER_DB_PEACOCK.snapshot limit 10000
[0m02:01:47.888707 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:01:48.223236 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.0 seconds
[0m02:01:48.224793 [debug] [ThreadPool]: On list_USER_DB_PEACOCK_snapshot: Close
[0m02:01:48.367647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a553a70>]}
[0m02:01:48.369383 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:01:48.371019 [info ] [MainThread]: 
[0m02:01:48.382534 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_market
[0m02:01:48.383235 [info ] [Thread-1 (]: 1 of 2 START snapshot snapshot.snap_btc_market ................................. [RUN]
[0m02:01:48.384235 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_PEACOCK_snapshot, now snapshot.btc_elt.snap_btc_market)
[0m02:01:48.384587 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_market
[0m02:01:48.391741 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (compile): 02:01:48.384813 => 02:01:48.391559
[0m02:01:48.392043 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_market
[0m02:01:48.424585 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:48.424857 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
select * from (
        select price, market_cap, volume from (
                



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:01:48.425052 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:49.549152 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:01:49.562847 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:49.564625 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:49.730172 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:49.741106 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:49.741772 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:50.571833 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 1.0 seconds
[0m02:01:50.586192 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:50.586590 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  price,
  market_cap,
  volume,
  coin_id,
  date,
  -- Stable unique key per coin + timestamp
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_market_daily
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."PRICE" != source_data."PRICE"
        or
        (
            ((snapshotted_data."PRICE" is null) and not (source_data."PRICE" is null))
            or
            ((not snapshotted_data."PRICE" is null) and (source_data."PRICE" is null))
        ) or snapshotted_data."MARKET_CAP" != source_data."MARKET_CAP"
        or
        (
            ((snapshotted_data."MARKET_CAP" is null) and not (source_data."MARKET_CAP" is null))
            or
            ((not snapshotted_data."MARKET_CAP" is null) and (source_data."MARKET_CAP" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:01:51.805498 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:51.811189 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:51.811781 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:51.951856 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:51.955714 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:51.956105 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:52.671149 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 1.0 seconds
[0m02:01:52.677377 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:52.677967 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:52.873580 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:52.877711 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:52.878162 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET"
[0m02:01:52.997423 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.0 seconds
[0m02:01:53.008118 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:53.009069 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp"
[0m02:01:53.342156 [debug] [Thread-1 (]: SQL status: SUCCESS 13 in 0.0 seconds
[0m02:01:53.353175 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_market"
[0m02:01:53.357408 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:53.357925 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
BEGIN
[0m02:01:53.465689 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:53.466748 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:53.467372 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_MARKET__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "PRICE", "MARKET_CAP", "VOLUME", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:01:54.870871 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 1.0 seconds
[0m02:01:54.871291 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_market"
[0m02:01:54.871631 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_market"} */
COMMIT
[0m02:01:55.578748 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m02:01:55.599911 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_market (execute): 02:01:48.392222 => 02:01:55.599638
[0m02:01:55.600355 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_market: Close
[0m02:01:55.754679 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff798ec8c0>]}
[0m02:01:55.756566 [info ] [Thread-1 (]: 1 of 2 OK snapshotted snapshot.snap_btc_market ................................. [[32mSUCCESS 8[0m in 7.37s]
[0m02:01:55.759660 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_market
[0m02:01:55.760375 [debug] [Thread-1 (]: Began running node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:55.761128 [info ] [Thread-1 (]: 2 of 2 START snapshot snapshot.snap_btc_ohlc ................................... [RUN]
[0m02:01:55.762323 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly snapshot.btc_elt.snap_btc_market, now snapshot.btc_elt.snap_btc_ohlc)
[0m02:01:55.762789 [debug] [Thread-1 (]: Began compiling node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:55.768325 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (compile): 02:01:55.763078 => 02:01:55.768006
[0m02:01:55.768925 [debug] [Thread-1 (]: Began executing node snapshot.btc_elt.snap_btc_ohlc
[0m02:01:55.773371 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:55.773781 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
select * from (
        select open, high, low, close from (
                



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:01:55.774144 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:01:56.439757 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:01:56.443959 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:56.444739 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:56.550816 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:56.553218 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:56.553593 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:56.642321 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:56.651118 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:56.651980 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
create or replace temporary table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
         as
        (with snapshot_query as (

        



select
  timestamp,
  open,
  high,
  low,
  close,
  coin_id,
  date,
  -- compose a stable unique key for this row
  concat(coin_id, '|', to_varchar(timestamp)) as business_key
from USER_DB_PEACOCK.raw.coin_gecko_ohlc
-- If you want to snapshot only BTC + ETH, uncomment this:
-- where coin_id in ('bitcoin', 'ethereum')


    ),

    snapshotted_data as (

        select *,
            business_key as dbt_unique_key

        from "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(business_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            business_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select
            *,
            business_key as dbt_unique_key
        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."OPEN" != source_data."OPEN"
        or
        (
            ((snapshotted_data."OPEN" is null) and not (source_data."OPEN" is null))
            or
            ((not snapshotted_data."OPEN" is null) and (source_data."OPEN" is null))
        ) or snapshotted_data."HIGH" != source_data."HIGH"
        or
        (
            ((snapshotted_data."HIGH" is null) and not (source_data."HIGH" is null))
            or
            ((not snapshotted_data."HIGH" is null) and (source_data."HIGH" is null))
        ) or snapshotted_data."LOW" != source_data."LOW"
        or
        (
            ((snapshotted_data."LOW" is null) and not (source_data."LOW" is null))
            or
            ((not snapshotted_data."LOW" is null) and (source_data."LOW" is null))
        ) or snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ))
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where source_data.dbt_unique_key is null
    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m02:01:59.174900 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m02:01:59.180473 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.181006 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:59.283471 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:59.290125 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.290780 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:59.388822 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:59.394346 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.394882 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:59.501011 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:59.507400 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.508041 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC"
[0m02:01:59.631485 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.0 seconds
[0m02:01:59.641649 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.642241 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
describe table "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp"
[0m02:01:59.738645 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.0 seconds
[0m02:01:59.743306 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.747145 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.747601 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
BEGIN
[0m02:01:59.853839 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:01:59.854975 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:01:59.855593 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
merge into "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC" as DBT_INTERNAL_DEST
    using "USER_DB_PEACOCK"."SNAPSHOT"."SNAP_BTC_OHLC__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("TIMESTAMP", "OPEN", "HIGH", "LOW", "CLOSE", "COIN_ID", "DATE", "BUSINESS_KEY", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m02:02:00.383220 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.0 seconds
[0m02:02:00.384734 [debug] [Thread-1 (]: Using snowflake connection "snapshot.btc_elt.snap_btc_ohlc"
[0m02:02:00.385352 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: /* {"app": "dbt", "dbt_version": "1.7.19", "profile_name": "btc_elt", "target_name": "dev", "node_id": "snapshot.btc_elt.snap_btc_ohlc"} */
COMMIT
[0m02:02:00.864781 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m02:02:00.870193 [debug] [Thread-1 (]: Timing info for snapshot.btc_elt.snap_btc_ohlc (execute): 02:01:55.769251 => 02:02:00.869863
[0m02:02:00.870866 [debug] [Thread-1 (]: On snapshot.btc_elt.snap_btc_ohlc: Close
[0m02:02:02.300162 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ba57294f-358a-4148-94a4-f36933f7f9a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff799f4410>]}
[0m02:02:02.301925 [info ] [Thread-1 (]: 2 of 2 OK snapshotted snapshot.snap_btc_ohlc ................................... [[32mSUCCESS 0[0m in 6.54s]
[0m02:02:02.302891 [debug] [Thread-1 (]: Finished running node snapshot.btc_elt.snap_btc_ohlc
[0m02:02:02.307187 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:02:02.307768 [debug] [MainThread]: Connection 'snapshot.btc_elt.snap_btc_ohlc' was properly closed.
[0m02:02:02.308330 [info ] [MainThread]: 
[0m02:02:02.309114 [info ] [MainThread]: Finished running 2 snapshots in 0 hours 0 minutes and 16.29 seconds (16.29s).
[0m02:02:02.310074 [debug] [MainThread]: Command end result
[0m02:02:02.323323 [info ] [MainThread]: 
[0m02:02:02.323892 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:02:02.324135 [info ] [MainThread]: 
[0m02:02:02.324540 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m02:02:02.326452 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 16.7524, "process_user_time": 2.719128, "process_kernel_time": 0.168628, "process_mem_max_rss": "214472", "process_out_blocks": "1837", "process_in_blocks": "0"}
[0m02:02:02.327006 [debug] [MainThread]: Command `dbt snapshot` succeeded at 02:02:02.326905 after 16.75 seconds
[0m02:02:02.327422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa480a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f8de030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a655730>]}
[0m02:02:02.327784 [debug] [MainThread]: Flushing usage events
